(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,57745,e=>{"use strict";var t,i,s,r,a,l,n,o,d,h,u=e.i(71866),c=e.i(80744),p=e.i(27508),g=e.i(94334),m=g,f=class{constructor(){this.ieCompatibility=!1}init(){this.ieCompatibility="5d41402abc4b2a76b9719d911017c592"!=this.md5("hello")}md5cycle(e,t){let i=e[0],s=e[1],r=e[2],a=e[3];i=this.ff(i,s,r,a,t[0],7,-0x28955b88),a=this.ff(a,i,s,r,t[1],12,-0x173848aa),r=this.ff(r,a,i,s,t[2],17,0x242070db),s=this.ff(s,r,a,i,t[3],22,-0x3e423112),i=this.ff(i,s,r,a,t[4],7,-0xa83f051),a=this.ff(a,i,s,r,t[5],12,0x4787c62a),r=this.ff(r,a,i,s,t[6],17,-0x57cfb9ed),s=this.ff(s,r,a,i,t[7],22,-0x2b96aff),i=this.ff(i,s,r,a,t[8],7,0x698098d8),a=this.ff(a,i,s,r,t[9],12,-0x74bb0851),r=this.ff(r,a,i,s,t[10],17,-42063),s=this.ff(s,r,a,i,t[11],22,-0x76a32842),i=this.ff(i,s,r,a,t[12],7,0x6b901122),a=this.ff(a,i,s,r,t[13],12,-0x2678e6d),r=this.ff(r,a,i,s,t[14],17,-0x5986bc72),s=this.ff(s,r,a,i,t[15],22,0x49b40821),i=this.gg(i,s,r,a,t[1],5,-0x9e1da9e),a=this.gg(a,i,s,r,t[6],9,-0x3fbf4cc0),r=this.gg(r,a,i,s,t[11],14,0x265e5a51),s=this.gg(s,r,a,i,t[0],20,-0x16493856),i=this.gg(i,s,r,a,t[5],5,-0x29d0efa3),a=this.gg(a,i,s,r,t[10],9,0x2441453),r=this.gg(r,a,i,s,t[15],14,-0x275e197f),s=this.gg(s,r,a,i,t[4],20,-0x182c0438),i=this.gg(i,s,r,a,t[9],5,0x21e1cde6),a=this.gg(a,i,s,r,t[14],9,-0x3cc8f82a),r=this.gg(r,a,i,s,t[3],14,-0xb2af279),s=this.gg(s,r,a,i,t[8],20,0x455a14ed),i=this.gg(i,s,r,a,t[13],5,-0x561c16fb),a=this.gg(a,i,s,r,t[2],9,-0x3105c08),r=this.gg(r,a,i,s,t[7],14,0x676f02d9),s=this.gg(s,r,a,i,t[12],20,-0x72d5b376),i=this.hh(i,s,r,a,t[5],4,-378558),a=this.hh(a,i,s,r,t[8],11,-0x788e097f),r=this.hh(r,a,i,s,t[11],16,0x6d9d6122),s=this.hh(s,r,a,i,t[14],23,-0x21ac7f4),i=this.hh(i,s,r,a,t[1],4,-0x5b4115bc),a=this.hh(a,i,s,r,t[4],11,0x4bdecfa9),r=this.hh(r,a,i,s,t[7],16,-0x944b4a0),s=this.hh(s,r,a,i,t[10],23,-0x41404390),i=this.hh(i,s,r,a,t[13],4,0x289b7ec6),a=this.hh(a,i,s,r,t[0],11,-0x155ed806),r=this.hh(r,a,i,s,t[3],16,-0x2b10cf7b),s=this.hh(s,r,a,i,t[6],23,0x4881d05),i=this.hh(i,s,r,a,t[9],4,-0x262b2fc7),a=this.hh(a,i,s,r,t[12],11,-0x1924661b),r=this.hh(r,a,i,s,t[15],16,0x1fa27cf8),s=this.hh(s,r,a,i,t[2],23,-0x3b53a99b),i=this.ii(i,s,r,a,t[0],6,-0xbd6ddbc),a=this.ii(a,i,s,r,t[7],10,0x432aff97),r=this.ii(r,a,i,s,t[14],15,-0x546bdc59),s=this.ii(s,r,a,i,t[5],21,-0x36c5fc7),i=this.ii(i,s,r,a,t[12],6,0x655b59c3),a=this.ii(a,i,s,r,t[3],10,-0x70f3336e),r=this.ii(r,a,i,s,t[10],15,-1051523),s=this.ii(s,r,a,i,t[1],21,-0x7a7ba22f),i=this.ii(i,s,r,a,t[8],6,0x6fa87e4f),a=this.ii(a,i,s,r,t[15],10,-0x1d31920),r=this.ii(r,a,i,s,t[6],15,-0x5cfebcec),s=this.ii(s,r,a,i,t[13],21,0x4e0811a1),i=this.ii(i,s,r,a,t[4],6,-0x8ac817e),a=this.ii(a,i,s,r,t[11],10,-0x42c50dcb),r=this.ii(r,a,i,s,t[2],15,0x2ad7d2bb),s=this.ii(s,r,a,i,t[9],21,-0x14792c6f),e[0]=this.add32(i,e[0]),e[1]=this.add32(s,e[1]),e[2]=this.add32(r,e[2]),e[3]=this.add32(a,e[3])}cmn(e,t,i,s,r,a){return t=this.add32(this.add32(t,e),this.add32(s,a)),this.add32(t<<r|t>>>32-r,i)}ff(e,t,i,s,r,a,l){return this.cmn(t&i|~t&s,e,t,r,a,l)}gg(e,t,i,s,r,a,l){return this.cmn(t&s|i&~s,e,t,r,a,l)}hh(e,t,i,s,r,a,l){return this.cmn(t^i^s,e,t,r,a,l)}ii(e,t,i,s,r,a,l){return this.cmn(i^(t|~s),e,t,r,a,l)}md51(e){let t,i=e.length,s=[0x67452301,-0x10325477,-0x67452302,0x10325476];for(t=64;t<=e.length;t+=64)this.md5cycle(s,this.md5blk(e.substring(t-64,t)));e=e.substring(t-64);let r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)r[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(r[t>>2]|=128<<(t%4<<3),t>55)for(this.md5cycle(s,r),t=0;t<16;t++)r[t]=0;return r[14]=8*i,this.md5cycle(s,r),s}md5blk(e){let t=[];for(let i=0;i<64;i+=4)t[i>>2]=e.charCodeAt(i)+(e.charCodeAt(i+1)<<8)+(e.charCodeAt(i+2)<<16)+(e.charCodeAt(i+3)<<24);return t}rhex(e){let t="0123456789abcdef".split(""),i="",s=0;for(;s<4;s++)i+=t[e>>8*s+4&15]+t[e>>8*s&15];return i}hex(e){for(let t=0;t<e.length;t++)e[t]=this.rhex(e[t]);return e.join("")}md5(e){return this.hex(this.md51(e))}add32(e,t){return this.ieCompatibility?this.add32Compat(e,t):this.add32Std(e,t)}add32Std(e,t){return e+t|0}add32Compat(e,t){let i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}},C={"01":"GRID","02":"CHARTS","0102":"BOTH"},v=class e{constructor(e){this.watermarkMessage=void 0,this.totalMessageLength=124,this.document=e,this.md5=new f,this.md5.init()}validateLicense(){let t=this.getLicenseDetails(e.licenseKey),i=`AG Grid ${"BOTH"===t.currentLicenseType?"and AG Charts ":""}Enterprise`,s=void 0===t.suppliedLicenseType?"":`AG ${"BOTH"===t.suppliedLicenseType?"Grid and AG Charts":"GRID"===t.suppliedLicenseType?"Grid":"Charts"} Enterprise`;if(t.missing)(!this.isWebsiteUrl()||this.isForceWatermark())&&this.outputMissingLicenseKey(i);else if(t.expired){let r=e.getGridReleaseDate(),a=e.formatDate(r);this.outputExpiredKey(t.expiry,a,i,s)}else t.valid?t.isTrial&&t.trialExpired&&this.outputExpiredTrialKey(t.expiry,i,s):this.outputInvalidLicenseKey(!!t.incorrectLicenseType,i,s)}static extractExpiry(t){let i=t.substring(t.lastIndexOf("_")+1,t.length);return new Date(parseInt(e.decode(i),10))}static extractLicenseComponents(t){let i=t.replace(/[\u200B-\u200D\uFEFF]/g,"");if(i=i.replace(/\r?\n|\r/g,""),t.length<=32)return{md5:null,license:t,version:null,isTrial:null};let s=i.length-32,r=i.substring(s),a=i.substring(0,s),[l,n,o]=e.extractBracketedInformation(i);return{md5:r,license:a,version:l,isTrial:n,type:o}}getLicenseDetails(t){let i,s,r,a=e.chartsLicenseManager?"BOTH":"GRID";if(!t?.length)return{licenseKey:t,valid:!1,missing:!0,currentLicenseType:a};let l=e.getGridReleaseDate(),{md5:n,license:o,version:d,isTrial:h,type:u}=e.extractLicenseComponents(t),c=n===this.md5.md5(o)&&!t.includes("For_Trialing_ag-Grid_Only"),p=null,g=!1;function m(){let e=new Date;i=p<e,s=void 0}if(c&&(c=!isNaN((p=e.extractExpiry(o)).getTime())))switch(s=l>p,d){case"legacy":case"2":h&&m();break;case"3":u?.length?(r=u,u!==C["01"]&&u!==C["0102"]||"BOTH"===a&&"BOTH"!==r?(c=!1,g=!0):h&&m()):c=!1}return c?{licenseKey:t,valid:c,expiry:e.formatDate(p),expired:s,version:d,isTrial:h,trialExpired:i,incorrectLicenseType:g,currentLicenseType:a,suppliedLicenseType:r}:{licenseKey:t,valid:c,incorrectLicenseType:g,currentLicenseType:a,suppliedLicenseType:r}}isDisplayWatermark(){return this.isForceWatermark()||!this.isLocalhost()&&!this.isWebsiteUrl()&&!!this.watermarkMessage?.length}getWatermarkMessage(){return this.watermarkMessage||""}getHostname(){let{hostname:e=""}=(this.document.defaultView||window).location;return e}isForceWatermark(){let{pathname:e}=(this.document.defaultView||window).location;return!!e&&e.includes("forceWatermark")}isWebsiteUrl(){return null!==this.getHostname().match(/^((?:[\w-]+\.)?ag-grid\.com)$/)}isLocalhost(){return null!==this.getHostname().match(/^(?:127\.0\.0\.1|localhost)$/)}static formatDate(e){return e.getDate()+" "+["January","February","March","April","May","June","July","August","September","October","November","December"][e.getMonth()]+" "+e.getFullYear()}static getGridReleaseDate(){return new Date(parseInt(e.decode(e.RELEASE_INFORMATION),10))}static decode(t){let i,s,r,a,l,n,o,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h="",u=0,c=t.replace(/[^A-Za-z0-9+/=]/g,"");for(;u<c.length;)a=d.indexOf(c.charAt(u++)),l=d.indexOf(c.charAt(u++)),n=d.indexOf(c.charAt(u++)),o=d.indexOf(c.charAt(u++)),i=a<<2|l>>4,s=(15&l)<<4|n>>2,r=(3&n)<<6|o,h+=String.fromCharCode(i),64!=n&&(h+=String.fromCharCode(s)),64!=o&&(h+=String.fromCharCode(r));return e.utf8_decode(h)}static utf8_decode(e){e=e.replace(/rn/g,"n");let t="";for(let i=0;i<e.length;i++){let s=e.charCodeAt(i);s<128?t+=String.fromCharCode(s):(s>127&&s<2048?t+=String.fromCharCode(s>>6|192):(t+=String.fromCharCode(s>>12|224),t+=String.fromCharCode(s>>6&63|128)),t+=String.fromCharCode(63&s|128))}return t}static setChartsLicenseManager(e){this.chartsLicenseManager=e,this.chartsLicenseManager?.setLicenseKey(this.licenseKey,!0)}static setLicenseKey(e){(0,m._exists)(this.licenseKey)&&this.licenseKey!==e&&(0,m._logPreInitWarn)(291,void 0,"AG Grid: License Key being set multiple times with different values. This can result in an incorrect license key being used."),this.licenseKey=e,this.chartsLicenseManager?.setLicenseKey(e,!0)}static extractBracketedInformation(e){if(!e.includes("["))return["legacy",!1,void 0];let t=e.match(/\[(.*?)\]/g).map(e=>e.replace("[","").replace("]",""));if(!t||0===t.length)return["legacy",!1,void 0];let i=1===t.filter(e=>"TRIAL"===e).length,s=t.filter(e=>0===e.indexOf("v"))[0];return[s?s.replace("v",""):"legacy",i,C[t.filter(e=>C[e])[0]]]}centerPadAndOutput(e){let t=this.totalMessageLength-e.length;console.error(e.padStart(t/2+e.length,"*").padEnd(this.totalMessageLength,"*"))}padAndOutput(e,t="*",i=""){console.error(e.padEnd(this.totalMessageLength-i.length,t)+i)}outputInvalidLicenseKey(e,t,i){e?(this.centerPadAndOutput(""),this.centerPadAndOutput(` ${t} License `),this.centerPadAndOutput(" Incompatible License Key "),this.padAndOutput(`* Your license key is for ${i} only and does not cover you for ${t}.`," ","*")):(this.centerPadAndOutput(""),this.centerPadAndOutput(` ${t} License `),this.centerPadAndOutput(" Invalid License Key "),this.padAndOutput("* Your license key is not valid."," ","*")),this.padAndOutput("* To troubleshoot your license key visit https://www.ag-grid.com/licensing/."," ","*"),this.centerPadAndOutput(""),this.centerPadAndOutput(""),this.watermarkMessage="Invalid License"}outputExpiredTrialKey(e,t,i){this.centerPadAndOutput(""),this.centerPadAndOutput(` ${t} License `),this.centerPadAndOutput(" Trial Period Expired. "),this.padAndOutput(`* Your trial only license for ${i} expired on ${e}.`," ","*"),this.padAndOutput("* Please email info@ag-grid.com to purchase a license."," ","*"),this.centerPadAndOutput(""),this.centerPadAndOutput(""),this.watermarkMessage="Trial Period Expired"}outputMissingLicenseKey(e){this.centerPadAndOutput(""),this.centerPadAndOutput(` ${e} License `),this.centerPadAndOutput(" License Key Not Found "),this.padAndOutput(`* All ${e} features are unlocked for trial.`," ","*"),this.padAndOutput("* If you want to hide the watermark please email info@ag-grid.com for a trial license key."," ","*"),this.centerPadAndOutput(""),this.centerPadAndOutput(""),this.watermarkMessage="For Trial Use Only"}outputExpiredKey(e,t,i,s){this.centerPadAndOutput(""),this.centerPadAndOutput(` ${i} License `),this.centerPadAndOutput(" Incompatible Software Version "),this.padAndOutput(`* Your license key works with versions${""==s?"":` of ${s}`} released before ${e}.`," ","*"),this.padAndOutput(`* The version you are trying to use was released on ${t}.`," ","*"),this.padAndOutput("* Please contact info@ag-grid.com to renew your license key."," ","*"),this.centerPadAndOutput(""),this.centerPadAndOutput(""),this.watermarkMessage="License Expired"}};v.RELEASE_INFORMATION="MTc3MDgwOTgzNDk5MQ==";var b={tag:"div",cls:"ag-watermark",children:[{tag:"div",ref:"eLicenseTextRef",cls:"ag-watermark-text"}]},y={selector:"AG-WATERMARK",component:class extends m.Component{constructor(){super(b),this.eLicenseTextRef=m.RefPlaceholder,this.registerCSS('.ag-watermark{bottom:20px;color:#9b9b9b;opacity:.7;position:absolute;transition:opacity 1s ease-out 3s}:where(.ag-ltr) .ag-watermark{right:25px}:where(.ag-rtl) .ag-watermark{left:25px}.ag-watermark:before{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDkiIGhlaWdodD0iMzYiIGZpbGw9Im5vbmUiIHZpZXdCb3g9IjAgMCAyMDkgMzYiPjxwYXRoIGZpbGw9IiM5YjliOWIiIGQ9Ik0xOTIuOTkzIDIzLjY1OHYtNy45NDZoLTEzLjU0MWwtNy45NDcgNy45NDZ6TTIwOC4yNSAzLjk1aC0xNi45NzRsLTguMDEgNy45NDdoMjQuOTg0ek0xNjMuNjIyIDMxLjYwNWw0LjA2OS00LjA2OWgxMy43MzJ2Ny45NDdoLTE3LjgwMXoiLz48cGF0aCBmaWxsPSIjOWI5YjliIiBkPSJNMTY2LjYxIDE5Ljc4aDguNzczbDguMDEtNy45NDZIMTY2LjYxek0xNTcuMDExIDMxLjYwNWg2LjYxMWw3Ljg4My03Ljk0N2gtMTQuNDk0ek0xOTEuMjc2IDMuOTVsLTQuMDY4IDQuMDdIMTYxLjI3Vi4wNzJoMzAuMDA2ek0yMC44NCAzMC4yMDZIOC4zNzhsLTIuMTYyIDUuMzRILjc1TDEyLjI1NyA4LjU5Mmg0Ljc2OEwyOC41MyAzNS41NDZoLTUuNTN6bS0xLjcxNy00LjI2TDE0LjYwOSAxNC45NWwtNC41MTQgMTAuOTk4ek0xMDQuNDM3IDE4LjUwOWMxLjU4OS0yLjM1MiA1LjU5NC0yLjYwNyA3LjI0Ny0yLjYwN3Y0LjU3OGMtMi4wMzQgMC00LjA2OS4wNjMtNS4yNzcuOTUzLTEuMjA3Ljg5LTEuODQzIDIuMDk4LTEuODQzIDMuNTZ2MTAuNTUzaC00Ljk1OVYxNS45MDJoNC43Njh6TTExOS4zNzYgMTUuOTAyaC00Ljk1OHYxOS42NDRoNC45NTh6TTExOS4zNzYgNy4xM2gtNC45NTh2NS44NDhoNC45NTh6TTE0My45NzkgNy4xM3YyOC40MTZoLTQuNzY4bC0uMTI3LTIuOTg4YTguMyA4LjMgMCAwIDEtMi42NyAyLjQ4Yy0xLjA4MS41NzItMi40MTYuODktMy45NDIuODktMS4zMzUgMC0yLjYwNi0uMjU1LTMuNjg3LS43LTEuMTQ0LS41MDgtMi4xNjItMS4xNDQtMi45ODgtMi4wMzRhOS42IDkuNiAwIDAgMS0xLjk3MS0zLjE3OWMtLjUwOC0xLjIwNy0uNjk5LTIuNjA2LS42OTktNC4xMzJzLjI1NC0yLjkyNC42OTktNC4xOTZjLjUwOS0xLjI3MSAxLjE0NS0yLjM1MiAxLjk3MS0zLjI0MnMxLjg0NC0xLjU4OSAyLjk4OC0yLjA5OCAyLjM1Mi0uNzYzIDMuNjg3LS43NjNjMS41MjYgMCAyLjc5Ny4yNTUgMy44NzguODI3czEuOTcxIDEuMzM1IDIuNjcgMi40MTZWNy4xOTNoNC45NTl6bS0xMC40MjYgMjQuNTM4YzEuNjUzIDAgMi45MjQtLjU3MiAzLjk0MS0xLjY1M3MxLjUyNi0yLjU0MyAxLjUyNi00LjMyMy0uNTA5LTMuMTc4LTEuNTI2LTQuMzIyYy0xLjAxNy0xLjA4MS0yLjI4OC0xLjY1My0zLjk0MS0xLjY1My0xLjU5IDAtMi45MjUuNTcyLTMuODc4IDEuNjUzLTEuMDE3IDEuMDgtMS41MjYgMi41NDMtMS41MjYgNC4zMjIgMCAxLjc4LjUwOSAzLjE4IDEuNTI2IDQuMjYgMS4wMTcgMS4xNDQgMi4yODggMS43MTYgMy44NzggMS43MTZNNTcuMjAyIDIwLjM1M0g0NC45MzN2NC4yNTloNi45OTNjLS4xOSAyLjE2MS0xLjAxNyAzLjgxNC0yLjQxNiA1LjE1LTEuMzk4IDEuMjctMy4xNzggMS45MDYtNS40NjcgMS45MDYtMS4yNzEgMC0yLjQ4LS4yNTQtMy40OTYtLjY5OWE3IDcgMCAwIDEtMi43MzQtMS45N2MtLjc2My0uODI3LTEuMzM1LTEuODQ0LTEuNzgtMy4wNTJzLS42MzYtMi40OC0uNjM2LTMuOTQyLjE5LTIuNzMzLjYzNi0zLjk0MWMuMzgxLTEuMjA4IDEuMDE3LTIuMTYyIDEuNzgtMy4wNTIuNzYzLS44MjYgMS42NTMtMS40NjIgMi43MzMtMS45N2E5LjEgOS4xIDAgMCAxIDMuNTYtLjdxNC4wMDUgMCA2LjEwMyAxLjkwN2wzLjMwNi0zLjMwNWMtMi40OC0xLjkwNy01LjY1OC0yLjkyNS05LjQwOS0yLjkyNS0yLjA5NyAwLTQuMDA0LjMxOC01LjcyMSAxLjAxOC0xLjcxNi42OTktMy4xNzkgMS41ODktNC4zODYgMi43OTdBMTIuMSAxMi4xIDAgMCAwIDMxLjIgMTYuMjJjLS42MzUgMS43MTctLjk1MyAzLjYyNC0uOTUzIDUuNjU4cy4zMTggMy45NDIgMS4wMTcgNS42NThjLjcgMS43MTcgMS41OSAzLjE3OSAyLjc5NyA0LjM4N2ExMi4xIDEyLjEgMCAwIDAgNC4zODcgMi43OTdjMS43MTYuNyAzLjYyMyAxLjAxNyA1LjY1NyAxLjAxNyAyLjAzNSAwIDMuODc4LS4zMTggNS41MzEtMS4wMTcgMS42NTMtLjcgMy4wNTItMS41OSA0LjE5Ni0yLjc5N3ExLjcxNi0xLjgxMiAyLjY3LTQuMzg3Yy42MzYtMS43MTYuOTU0LTMuNjIzLjk1NC01LjY1OHYtLjgyNmMtLjE5MS0uMTI3LS4yNTUtLjQ0NS0uMjU1LS43TTk1Ljk4MiAyMC4zNTNoLTEyLjI3djQuMjU5aDYuOTkzYy0uMTkgMi4xNjEtMS4wMTcgMy44MTQtMi40MTYgNS4xNS0xLjM5OCAxLjI3LTMuMTc4IDEuOTA2LTUuNDY3IDEuOTA2LTEuMjcxIDAtMi40OC0uMjU0LTMuNDk2LS42OTlhNyA3IDAgMCAxLTIuNzM0LTEuOTdjLS43NjMtLjgyNy0xLjMzNS0xLjg0NC0xLjc4LTMuMDUycy0uNjM2LTIuNDgtLjYzNi0zLjk0Mi4xOS0yLjczMy42MzYtMy45NDFjLjM4MS0xLjIwOCAxLjAxNy0yLjE2MiAxLjc4LTMuMDUyLjc2My0uODI2IDEuNjUzLTEuNDYyIDIuNzM0LTEuOTdhOS4xIDkuMSAwIDAgMSAzLjU2LS43cTQuMDA1IDAgNi4xMDMgMS45MDdsMy4zMDUtMy4zMDVjLTIuNDc5LTEuOTA3LTUuNjU4LTIuOTI1LTkuNDA4LTIuOTI1LTIuMDk4IDAtNC4wMDUuMzE4LTUuNzIyIDEuMDE4LTEuNzE2LjY5OS0zLjE3OCAxLjU4OS00LjM4NiAyLjc5N2ExMi4xIDEyLjEgMCAwIDAtMi43OTcgNC4zODZjLS42MzYgMS43MTctLjk1NCAzLjYyNC0uOTU0IDUuNjU4cy4zMTggMy45NDIgMS4wMTcgNS42NThjLjcgMS43MTcgMS41OSAzLjE3OSAyLjc5NyA0LjM4N2ExMi4xIDEyLjEgMCAwIDAgNC4zODcgMi43OTdjMS43MTYuNyAzLjYyMyAxLjAxNyA1LjY1OCAxLjAxNyAyLjAzNCAwIDMuODc4LS4zMTggNS41My0xLjAxNyAxLjY1My0uNyAzLjA1Mi0xLjU5IDQuMTk2LTIuNzk3cTEuNzE4LTEuODEyIDIuNjctNC4zODdjLjYzNi0xLjcxNi45NTQtMy42MjMuOTU0LTUuNjU4di0uODI2Yy0uMTktLjEyNy0uMjU1LS40NDUtLjI1NS0uNyIvPjwvc3ZnPg==");background-repeat:no-repeat;background-size:170px 40px;content:"";display:block;height:40px;width:170px}.ag-watermark-text{font-family:Impact,sans-serif;font-size:19px;font-weight:700;opacity:.5}:where(.ag-ltr) .ag-watermark-text{padding-left:.7rem}:where(.ag-rtl) .ag-watermark-text{padding-right:.7rem}')}wireBeans(e){this.licenseManager=e.licenseManager}postConstruct(){let e=this.shouldDisplayWatermark();this.setDisplayed(e),e&&(this.eLicenseTextRef.textContent=this.licenseManager.getWatermarkMessage(),window.setTimeout(()=>this.addCss("ag-opacity-zero"),0),window.setTimeout(()=>this.setDisplayed(!1),5e3))}shouldDisplayWatermark(){return this.licenseManager.isDisplayWatermark()}}},w=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="licenseManager"}postConstruct(){this.validateLicense()}validateLicense(){this.licenseManager=new v((0,m._getDocument)(this.beans)),this.licenseManager.validateLicense()}static getLicenseDetails(e){return new v(null).getLicenseDetails(e)}getWatermarkSelector(){return y}isDisplayWatermark(){return this.licenseManager.isDisplayWatermark()}getWatermarkMessage(){return this.licenseManager.getWatermarkMessage()}static setLicenseKey(e){v.setLicenseKey(e)}static setChartsLicenseManager(e){v.setChartsLicenseManager(e)}},S={0:1,"0.00":2,"#,##0":3,"#,##0.00":4,"0%":9,"0.00%":10,"0.00E+00":11,"# ?/?":12,"# ??/??":13,"mm-dd-yy":14,"d-mmm-yy":15,"d-mmm":16,"mmm-yy":17,"h:mm AM/PM":18,"h:mm:ss AM/PM":19,"h:mm":20,"h:mm:ss":21,"m/d/yy h:mm":22,"#,##0 ;(#,##0)":37,"#,##0 ;[Red](#,##0)":38,"#,##0.00;(#,##0.00)":39,"#,##0.00;[Red](#,##0.00)":40,"mm:ss":45,"[h]:mm:ss":46,"mmss.0":47,"##0.0E+0":48,"@":49};function x(e,t,i){if(!t&&""!==t&&0!==t)return"";let s=t;return"boolean"==typeof t&&i&&(s=i(t)),` ${e}="${s}"`}var F=e=>Math.round(96*e/72),A=e=>Math.ceil(9525*e),M=(e,t)=>{if(t)return"number"==typeof t?t:t({rowIndex:e})},R=(e,t)=>{let i=function(e={}){let t=["version"];e.version||(e.version="1.0"),e.encoding&&t.push("encoding"),e.standalone&&t.push("standalone");let i=t.map(t=>`${t}="${e[t]}"`).join(" ");return`<?xml ${i} ?>`}({encoding:"UTF-8",standalone:"yes"}),s=function e(t,i){let s="";if(t.properties&&(t.properties.prefixedAttributes&&t.properties.prefixedAttributes.forEach(e=>{for(let t of Object.keys(e.map))s+=x(e.prefix+t,e.map[t],i)}),t.properties.rawMap))for(let e of Object.keys(t.properties.rawMap))s+=x(e,t.properties.rawMap[e],i);let r="<"+t.name+s;if(!t.children&&null==t.textNode)return r+"/>\r\n";if(null!=t.textNode)return r+">"+t.textNode+"</"+t.name+">\r\n";if(r+=">\r\n",t.children)for(let s of t.children)r+=e(s,i);return r+"</"+t.name+">\r\n"}(e);return t?s:`${i}${s}`},T=e=>{let t=String.fromCharCode,i=Math.floor(e/26),s=e%26;return i&&26!==e?s?i<26?t(65+i-1)+t(65+s-1):T(i)+t(65+s-1):T(i-1)+"Z":t(65+e-1)},P=e=>{if(null==e)return null;let t="";for(let i=0;i<e.length;i++){let s=e.charCodeAt(i);if(s>=0&&s<=31&&10!==s){let e=s.toString(16).toUpperCase().padStart(4,"0");t+=`_x${e}_`}else t+=e[i]}return t},I=class extends m.BaseGridSerializingSession{constructor(e){for(const t of(super(e),this.mixedStyles={},this.mixedStyleCounter=0,this.rows=[],this.frozenRowCount=0,this.skipFrozenRows=!1,this.frozenColumnCount=0,this.skipFrozenColumns=!1,this.formulaSvc=e.formulaSvc,this.config=Object.assign({},e),this.workbook=e.workbook,this.stylesByIds={},this.config.baseExcelStyles))this.stylesByIds[t.id]=t;const t={id:"_quotePrefix",quotePrefix:1};this.stylesByIds[t.id]=t,this.excelStyles=[...this.config.baseExcelStyles,t]}addCustomContent(e){for(let t of e){let e,i=this.rows.length+1;this.config.suppressRowOutline||null==t.outlineLevel||(e=t.outlineLevel);let s={height:M(i,t.height||this.config.rowHeight),cells:(t.cells||[]).map((e,t)=>{let s=this.addImage(i,this.columnsToExport[t],e.data?.value),r=null;e.styleId&&(r="string"==typeof e.styleId?[e.styleId]:e.styleId);let a=this.getStyleId(r);if(s)return this.createCell(a,this.getDataTypeForValue(s.value),null==s.value?"":s.value);let l=e.data?.value??"",n=this.getDataTypeForValue(l);return e.mergeAcross?this.createMergedCell(a,n,l,e.mergeAcross):this.createCell(a,n,l)}),outlineLevel:e};null!=t.collapsed&&(s.collapsed=t.collapsed),null!=t.hidden&&(s.hidden=t.hidden),this.rows.push(s)}}onNewHeaderGroupingRow(){let e=[],{freezeRows:t,headerRowHeight:i}=this.config;return this.rows.push({cells:e,height:M(this.rows.length+1,i)}),t&&this.frozenRowCount++,{onColumn:(t,i,s,r,a)=>{let l=this.config.styleLinker({rowType:"HEADER_GROUPING",rowIndex:1,value:`grouping-${i}`,columnGroup:t});e.push({...this.createMergedCell(this.getStyleId(l),this.getDataTypeForValue("string"),i,r),collapsibleRanges:a})}}}onNewHeaderRow(){let{freezeRows:e,headerRowHeight:t}=this.config;return e&&this.frozenRowCount++,this.onNewRow(this.onNewHeaderColumn,t)}onNewBodyRow(e){let{freezeRows:t,rowHeight:i}=this.config;!this.skipFrozenRows&&("headersAndPinnedRows"===t&&e?.rowPinned==="top"||"function"==typeof t&&t((0,m._addGridCommonParams)(this.gos,{node:e}))?this.frozenRowCount++:this.skipFrozenRows=!0);let s=this.onNewRow(this.onNewBodyColumn,i);return e&&this.addRowOutlineIfNecessary(e),s}prepare(e){super.prepare(e),this.columnsToExport=[...e],this.cols=e.map((e,t)=>this.convertColumnToExcel(e,t))}parse(){let e=this.rows.reduce((e,t)=>Math.max(e,t.cells.length),0);for(;this.cols.length<e;)this.cols.push(this.convertColumnToExcel(null,this.cols.length+1));let t=this.createWorksheet();return this.addWorksheetToWorkbook(t)}createWorksheet(){let{sheetName:e}=this.config;return{name:null!=e?String("function"==typeof e?e((0,m._addGridCommonParams)(this.gos,{})):e).substring(0,31):"ag-grid",table:{columns:this.cols,rows:this.rows}}}addRowOutlineIfNecessary(e){let{gos:t,suppressRowOutline:i,rowGroupExpandState:s="expanded"}=this.config;if(t.get("groupHideOpenParents")||i||null==e.level)return;let r=+!!e.footer,a=(0,m._last)(this.rows);if((null==e.uiLevel||e.level===e.uiLevel)&&(a.outlineLevel=Math.min(e.level+r,7)),"expanded"===s)return;let l="collapsed"===s;e.isExpandable()&&(a.collapsed=!(!l&&e.expanded)),a.hidden=!!e.parent&&-1!==e.parent.level&&(l||this.isAnyParentCollapsed(e.parent))}isAnyParentCollapsed(e){for(;e&&-1!==e.level;){if(!e.expanded)return!0;e=e.parent}return!1}convertColumnToExcel(e,t){let i=this.config.columnWidth,s=(e?this.extractHeaderValue(e):void 0)??"",r=!!e&&e.isFilterAllowed();return i?"number"==typeof i?{width:i,displayName:s,filterAllowed:r}:{width:i({column:e,index:t}),displayName:s,filterAllowed:r}:e?{width:Math.max(e.getActualWidth(),75),displayName:s,filterAllowed:r}:{displayName:s,filterAllowed:r}}onNewHeaderColumn(e,t){return i=>{let s=this.extractHeaderValue(i),r=this.config.styleLinker({rowType:"HEADER",rowIndex:e,value:s,column:i});t.push(this.createCell(this.getStyleId(r),this.getDataTypeForValue("string"),s))}}onNewBodyColumn(e,t){let i=0,{freezeColumns:s,rightToLeft:r}=this.config;return(a,l,n)=>{if(i>0){i-=1;return}if(!this.skipFrozenColumns){let e=a.getPinned();"pinned"===s&&e&&(!0===e||"left"===e)!==r||"function"==typeof s&&s((0,m._addGridCommonParams)(this.gos,{column:a}))?this.frozenColumnCount++:this.skipFrozenColumns=!0}let{value:o,valueFormatted:d}=this.extractRowCellValue({column:a,node:n,currentColumnIndex:l,accumulatedRowIndex:e,type:"excel",useRawFormula:!0}),h="bigint"==typeof o?o.toString():o,u=this.config.styleLinker({rowType:"BODY",rowIndex:e,value:o,column:a,node:n}),c=this.getStyleId(u),p=a.getColSpan(n),g=this.addImage(e,a,h);if(g)t.push(this.createCell(c,this.getDataTypeForValue(g.value),null==g.value?"":g.value));else if(p>1)i=p-1,t.push(this.createMergedCell(c,this.getDataTypeForValue(o),h,p-1));else{let i=a.isAllowFormula()&&this.formulaSvc?.isFormula(h),s=this.createCell(c,i?"f":this.getDataTypeForValue(o),i?this.formulaSvc?.updateFormulaByOffset({value:h,rowDelta:e-(n.formulaRowIndex+1),useRefFormat:!1}):h,d);t.push(s)}}}onNewRow(e,t){let i=[];return this.rows.push({cells:i,height:M(this.rows.length+1,t)}),{onColumn:e.bind(this,this.rows.length,i)()}}addWorksheetToWorkbook(e){let{excelStyles:t,config:i}=this;return this.mapSharedStrings(e),this.frozenColumnCount&&(i.frozenColumnCount=this.frozenColumnCount),this.frozenRowCount&&(i.frozenRowCount=this.frozenRowCount),this.workbook.addWorksheet(t,e,i)}mapSharedStrings(e){let t;for(let i of e.table.rows)for(let e of i.cells){let i=e.data;if(!i||"s"!==i.type)continue;let s=i.value;if(null!=s){if(""===s){t??(t=this.workbook.getStringPosition("").toString()),i.value=t;continue}i.value=this.workbook.getStringPosition(String(s)).toString()}}}getDataTypeForValue(e){if(void 0===e)return"empty";let t="s";try{this.isNumerical(e)&&(t="n")}catch(e){}return t}getTypeFromStyle(e,t){if(this.isFormula(t))return"f";if(e?.dataType)switch(e.dataType.toLocaleLowerCase()){case"formula":return"f";case"string":return"s";case"number":return"n";case"datetime":return"d";case"error":return"e";case"boolean":return"b";default:(0,m._warn)(162,{id:e.id,dataType:e.dataType})}return null}addImage(e,t,i){if(!this.config.addImageToCell)return;let s=this.config.addImageToCell(e,t,i);if(s)return this.workbook.addBodyImageToMap(s.image,e,t,this.columnsToExport,this.config.rowHeight),s}createCell(e,t,i,s){let r=this.getStyleById(e);r?.dataType||"s"!==t||null==s||(i=s);let a=this.getTypeFromStyle(r,i)||t,{value:l,escaped:n}=this.getCellValue(a,i),o=[];return r&&o.push(e),n&&o.push("_quotePrefix"),{styleId:e=this.getStyleId(o)||void 0,data:{type:a,value:l}}}createMergedCell(e,t,i,s){return{styleId:this.getStyleById(e)?e:void 0,data:{type:t,value:"s"===t?String(null==i?"":i):i},mergeAcross:s}}getCellValue(e,t){let i=!1;if(null==t||"s"===e&&""===t)return{value:"",escaped:!1};if("s"===e)"'"===(t=String(t))[0]&&(i=!0,t=t.slice(1));else if("f"===e)t=this.addXlfnPrefix(t).slice(1);else if("n"===e){let e=Number(t);isNaN(e)?t="":""!==t&&(t=e.toString())}return{value:t,escaped:i}}addXlfnPrefix(e){return e?e.replace(/(^|[^A-Z0-9._])(CONCAT)(\s*\()/gi,(e,t,i,s)=>`${t}_xlfn.${i}${s}`):e}getStyleId(e){if(!e?.length)return null;let t=e.filter(e=>null!=this.stylesByIds[e]);if(!t.length)return null;if(1===t.length)return t[0];let i=t.join("-");return this.mixedStyles[i]||this.addNewMixedStyle(t),this.mixedStyles[i].excelID}addNewMixedStyle(e){this.mixedStyleCounter+=1;let t=`mixedStyle${this.mixedStyleCounter}`,i={};for(let t of e){let e=this.stylesByIds[t];e&&(0,m._mergeDeep)(i,e,!0,!0)}i.id=t;let s=e.join("-");this.mixedStyles[s]={excelID:t,key:s,result:i},this.excelStyles.push(i),this.stylesByIds[t]=i}isFormula(e){if(null==e)return!1;let t=String(e);return this.config.autoConvertFormulas&&(0,m._isExpressionString)(t)}isNumerical(e){return"bigint"!=typeof e&&isFinite(e)&&""!==e&&!isNaN(parseFloat(e))}getStyleById(e){return null==e?null:this.stylesByIds[e]||null}},E={getTemplate(e){let{name:t,ContentType:i,Extension:s,PartName:r}=e;return{name:t,properties:{rawMap:{Extension:s,PartName:r,ContentType:i}}}}},D=e=>"jpg"===e?"jpeg":e,k={getTemplate({sheetLen:e,hasCustomProperties:t}){let i=Array(e).fill(void 0).map((e,t)=>({name:"Override",ContentType:"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml",PartName:`/xl/worksheets/sheet${t+1}.xml`})),s=eI.size,r=eE.size,a={};eD.forEach(e=>{a[D(e.type)]=!0});let l=Array(s).fill(void 0).map((e,t)=>({name:"Override",ContentType:"application/vnd.openxmlformats-officedocument.drawing+xml",PartName:`/xl/drawings/drawing${t+1}.xml`})),n=[];eL.forEach(({name:e})=>{n.push({name:"Override",ContentType:"application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml",PartName:`/xl/tables/${e}.xml`})});let o=Object.keys(a).map(e=>({name:"Default",ContentType:`image/${e}`,Extension:e}));return r&&o.push({name:"Default",Extension:"vml",ContentType:"application/vnd.openxmlformats-officedocument.vmlDrawing"}),{name:"Types",properties:{rawMap:{xmlns:"http://schemas.openxmlformats.org/package/2006/content-types"}},children:[...o,{name:"Default",Extension:"rels",ContentType:"application/vnd.openxmlformats-package.relationships+xml"},{name:"Default",ContentType:"application/xml",Extension:"xml"},{name:"Override",ContentType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml",PartName:"/xl/workbook.xml"},...i,{name:"Override",ContentType:"application/vnd.openxmlformats-officedocument.theme+xml",PartName:"/xl/theme/theme1.xml"},{name:"Override",ContentType:"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml",PartName:"/xl/styles.xml"},{name:"Override",ContentType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml",PartName:"/xl/sharedStrings.xml"},...l,...n,{name:"Override",ContentType:"application/vnd.openxmlformats-package.core-properties+xml",PartName:"/docProps/core.xml"},...t?[{name:"Override",ContentType:"application/vnd.openxmlformats-officedocument.custom-properties+xml",PartName:"/docProps/custom.xml"}]:[]].map(e=>E.getTemplate(e))}}},L={getTemplate(e){let t=new Date().toJSON();return{name:"cp:coreProperties",properties:{prefixedAttributes:[{prefix:"xmlns:",map:{cp:"http://schemas.openxmlformats.org/package/2006/metadata/core-properties",dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",dcmitype:"http://purl.org/dc/dcmitype/",xsi:"http://www.w3.org/2001/XMLSchema-instance"}}]},children:[{name:"dc:creator",textNode:e},{name:"dc:title",textNode:"Workbook"},{name:"dcterms:created",properties:{rawMap:{"xsi:type":"dcterms:W3CDTF"}},textNode:t},{name:"dcterms:modified",properties:{rawMap:{"xsi:type":"dcterms:W3CDTF"}},textNode:t}]}}},N=(e,t)=>({name:`xdr:${e}`,children:[{name:"xdr:col",textNode:t.col.toString()},{name:"xdr:colOff",textNode:t.offsetX.toString()},{name:"xdr:row",textNode:t.row.toString()},{name:"xdr:rowOff",textNode:t.offsetY.toString()}]}),G=e=>{if(!e.saturation&&!e.tint)return;let t=[];return e.saturation&&t.push({name:"a:satMod",properties:{rawMap:{val:1e3*e.saturation}}}),e.tint&&t.push({name:"a:tint",properties:{rawMap:{val:1e3*e.tint}}}),t},O={getTemplate(e){let{sheetIndex:t}=e,i=eI.get(t),s=ek.get(t);return{name:"xdr:wsDr",properties:{rawMap:{"xmlns:a":"http://schemas.openxmlformats.org/drawingml/2006/main","xmlns:xdr":"http://schemas.openxmlformats.org/drawingml/2006/spreadsheetDrawing"}},children:i.map((e,t)=>{var i;let r,a=(e=>{e.fitCell=!!e.fitCell||!e.width||!e.height;let{position:t={},fitCell:i,width:s=0,height:r=0,totalHeight:a,totalWidth:l}=e,{offsetX:n=0,offsetY:o=0,row:d=1,rowSpan:h=1,column:u=1,colSpan:c=1}=t;return{from:{row:d-1,col:u-1,offsetX:A(n),offsetY:A(o)},to:{row:d-1+(i?1:h-1),col:u-1+(i?1:c-1),offsetX:A(s+n),offsetY:A(r+o)},height:A(a||r),width:A(l||s)}})(e);return{name:"xdr:twoCellAnchor",properties:{rawMap:{editAs:"absolute"}},children:[N("from",a.from),N("to",a.to),(i=s.get(e.id).index,{name:"xdr:pic",children:[{name:"xdr:nvPicPr",children:[{name:"xdr:cNvPr",properties:{rawMap:{id:t+1,name:e.id,descr:null!=e.altText?e.altText:void 0}},children:[(e=>{let t=[{name:"a:ext",properties:{rawMap:{uri:"{FF2B5EF4-FFF2-40B4-BE49-F238E27FC236}"}},children:[{name:"a16:creationId",properties:{rawMap:{id:"{822E6D20-D7BC-2841-A643-D49A6EF008A2}","xmlns:a16":"http://schemas.microsoft.com/office/drawing/2014/main"}}}]}];switch(e.recolor?.toLowerCase()){case"grayscale":case"sepia":case"washout":t.push({name:"a:ext",properties:{rawMap:{uri:"{C183D7F6-B498-43B3-948B-1728B52AA6E4}"}},children:[{name:"adec:decorative",properties:{rawMap:{val:"0","xmlns:adec":"http://schemas.microsoft.com/office/drawing/2017/decorative"}}}]})}return{name:"a:extLst",children:t}})(e)]},{name:"xdr:cNvPicPr",properties:{rawMap:{preferRelativeResize:"0"}},children:[{name:"a:picLocks"}]}]},((e,t)=>{let i;if(e.transparency&&(i=[{name:"a:alphaModFix",properties:{rawMap:{amt:1e5-Math.round(1e3*Math.min(Math.max(e.transparency,0),100))}}}]),e.recolor)switch(!i&&(i=[]),e.recolor.toLocaleLowerCase()){case"grayscale":i.push({name:"a:grayscl"});break;case"sepia":let s,r;i.push((r={color:"D9C3A5",tint:50,saturation:180},{name:"a:duotone",children:[{name:"a:prstClr",properties:{rawMap:{val:(s={color:"black"}).color}},children:G(s)},{name:"a:srgbClr",properties:{rawMap:{val:r.color}},children:G(r)}]}));break;case"washout":i.push({name:"a:lum",properties:{rawMap:{bright:"70000",contrast:"-70000"}}})}return{name:"xdr:blipFill",children:[{name:"a:blip",properties:{rawMap:{cstate:"print","r:embed":`rId${t}`,"xmlns:r":"http://schemas.openxmlformats.org/officeDocument/2006/relationships"}},children:i},{name:"a:stretch",children:[{name:"a:fillRect"}]}]}})(e,i+1),(r={name:"a:xfrm",children:[{name:"a:off",properties:{rawMap:{x:0,y:0}}},{name:"a:ext",properties:{rawMap:{cx:a.width,cy:a.height}}}]},e.rotation&&(r.properties={rawMap:{rot:6e4*Math.min(Math.max(e.rotation,0),360)}}),{name:"xdr:spPr",children:[r,{name:"a:prstGeom",properties:{rawMap:{prst:"rect"}},children:[{name:"a:avLst"}]}]})]}),{name:"xdr:clientData"}]}})}}},B={getTemplate(e){let{Id:t,Type:i,Target:s}=e;return{name:"Relationship",properties:{rawMap:{Id:t,Type:i,Target:s}}}}},V=e=>({name:"Relationships",properties:{rawMap:{xmlns:"http://schemas.openxmlformats.org/package/2006/relationships"}},children:e.map(e=>B.getTemplate(e))}),_={None:"None",Dot:"Dotted",Dash:"Dashed",Double:"Double",DashDot:"DashDot",DashDotDot:"DashDotDot",SlantDashDot:"SlantDashDot",Continuous:"Continuous"},z=["Dashed","DashDot","DashDotDot"],H={None:"none",Solid:"solid",Gray50:"mediumGray",Gray75:"darkGray",Gray25:"lightGray",HorzStripe:"darkHorizontal",VertStripe:"darkVertical",ReverseDiagStripe:"darkDown",DiagStripe:"darkUp",DiagCross:"darkGrid",ThickDiagCross:"darkTrellis",ThinHorzStripe:"lightHorizontal",ThinVertStripe:"lightVertical",ThinReverseDiagStripe:"lightDown",ThinDiagStripe:"lightUp",ThinHorzCross:"lightGrid",ThinDiagCross:"lightTrellis",Gray125:"gray125",Gray0625:"gray0625"},U={Automatic:"general",Left:"left",Center:"center",Right:"right",Fill:"fill",Justify:"justify",CenterAcrossSelection:"centerContinuous",Distributed:"distributed",JustifyDistributed:"justify"},W={Automatic:void 0,Top:"top",Bottom:"bottom",Center:"center",Justify:"justify",Distributed:"distributed",JustifyDistributed:"justify"},K=e=>void 0==e?e:("#"===e.charAt(0)&&(e=e.substring(1)),6===e.length?"FF"+e:e),$=(e,t)=>{if(!e)return"thin";let i=(e=>{switch(e){case 1:return"thin";case 2:return"medium";case 3:return"thick";default:return"hair"}})(t);if("Continuous"===e)return i;let s=_[e];return"medium"===i&&z.some(e=>e===s)?`medium${s}`:`${s.charAt(0).toLowerCase()}${s.substring(1)}`},j=e=>({name:"color",properties:{rawMap:{rgb:K(e||"#000000")}}}),Y={getTemplate(e){let{left:t,right:i,top:s,bottom:r,diagonal:a}=e,l=t?[j(t.color)]:void 0,n=i?[j(i.color)]:void 0,o=s?[j(s.color)]:void 0,d=r?[j(r.color)]:void 0,h=a?[j(a.color)]:void 0;return{name:"border",children:[{name:"left",properties:{rawMap:{style:t?.style}},children:l},{name:"right",properties:{rawMap:{style:i?.style}},children:n},{name:"top",properties:{rawMap:{style:s?.style}},children:o},{name:"bottom",properties:{rawMap:{style:r?.style}},children:d},{name:"diagonal",properties:{rawMap:{style:a?.style}},children:h}]}}},q={getTemplate(e){let{horizontal:t,indent:i,readingOrder:s,rotate:r,shrinkToFit:a,vertical:l,wrapText:n}=e;return{name:"alignment",properties:{rawMap:{horizontal:t&&(U[t]||"general"),indent:i,readingOrder:s&&Math.max(["Context","LeftToRight","RightToLeft"].indexOf(s),0),textRotation:r,shrinkToFit:a,vertical:l&&(W[l]||void 0),wrapText:n}}}}},Z={getTemplate(e){let t=+(!1!==e.protected);return{name:"protection",properties:{rawMap:{hidden:+(!0===e.hideFormula),locked:t}}}}},X={getTemplate(e){let{alignment:t,borderId:i,fillId:s,fontId:r,numFmtId:a,protection:l,quotePrefix:n,xfId:o}=e,d=[];return t&&d.push(q.getTemplate(t)),l&&d.push(Z.getTemplate(l)),{name:"xf",properties:{rawMap:{applyAlignment:t?1:void 0,applyProtection:l?1:void 0,applyBorder:i?1:void 0,applyFill:s?1:void 0,borderId:i,fillId:s,applyFont:r?1:void 0,fontId:r,applyNumberFormat:a?1:void 0,numFmtId:a,quotePrefix:n?1:void 0,xfId:o}},children:d.length?d:void 0}}},J={getTemplate(e){let{builtinId:t,name:i,xfId:s}=e;return{name:"cellStyle",properties:{rawMap:{builtinId:t,name:i,xfId:s}}}}},Q={getTemplate(e){let{patternType:t,fgTheme:i,fgTint:s,fgRgb:r,bgRgb:a,bgIndexed:l}=e,n={name:"patternFill",properties:{rawMap:{patternType:t}}};return(i||s||r)&&(n.children=[{name:"fgColor",properties:{rawMap:{theme:i,tint:s,rgb:r}}}]),(l||a)&&(n.children||(n.children=[]),n.children.push({name:"bgColor",properties:{rawMap:{indexed:l,rgb:a}}})),{name:"fill",children:[n]}}},ee={getTemplate(e){let{size:t,colorTheme:i,color:s="FF000000",fontName:r="Calibri",family:a,scheme:l,italic:n,bold:o,strikeThrough:d,outline:h,shadow:u,underline:c,verticalAlign:p}=e,g=[{name:"sz",properties:{rawMap:{val:t}}},{name:"color",properties:{rawMap:{theme:i,rgb:s}}},{name:"name",properties:{rawMap:{val:r}}}];return a&&g.push({name:"family",properties:{rawMap:{val:a}}}),l&&g.push({name:"scheme",properties:{rawMap:{val:l}}}),n&&g.push({name:"i"}),o&&g.push({name:"b"}),d&&g.push({name:"strike"}),h&&g.push({name:"outline"}),u&&g.push({name:"shadow"}),c&&g.push({name:"u",properties:{rawMap:{val:c}}}),p&&g.push({name:"vertAlign",properties:{rawMap:{val:p}}}),{name:"font",children:g}}},et={getTemplate(e){let{formatCode:t,numFmtId:i}=e;return t.length&&(t=function(e){let t=e.split(/(\[[^\]]*\])/);for(let e=0;e<t.length;e++){let i=t[e];i.length&&(i.startsWith("[")||(i=i.replace(/\$/g,'"$"')),t[e]=(0,m._escapeString)(i))}return t.join("")}(t)),{name:"numFmt",properties:{rawMap:{formatCode:t,numFmtId:i}}}}},ei=(e,t)=>(e.includes("mixedStyle")&&t>1&&(e+=`_${t}`),e),es=()=>{i={base:0},s=[],r=[{fontName:"Calibri",colorTheme:"1",family:"2",scheme:"minor"}],a=[{patternType:"none"},{patternType:"gray125"}],l=[{left:void 0,right:void 0,top:void 0,bottom:void 0,diagonal:void 0}],n=[{borderId:0,fillId:0,fontId:0,numFmtId:0}],o=[{borderId:0,fillId:0,fontId:0,numFmtId:0,xfId:0}],d=[{builtinId:0,name:"Normal",xfId:0}]},er=e=>{let{alignment:t,borders:n,font:d,interior:u,numberFormat:c,protection:p,quotePrefix:g}=e,{id:m}=e,f=0,C=0,v=0,b=0;if(m&&void 0==i[m=ei(m,h)]){var y;let e,h,w,x;u&&(e=(y=u.pattern)?H[y]||y:"none",h=K(u.color),w=K(u.patternColor),-1===(x=a.findIndex(t=>{let{patternType:i,fgRgb:s,bgRgb:r}=t;return i==e&&s==h&&r==w}))&&(x=a.length,a.push({patternType:e,fgRgb:h,bgRgb:w})),f=x),n&&(C=(e=>{let t,i,s,r,a,n,o,d,{borderBottom:h,borderTop:u,borderLeft:c,borderRight:p}=e;c&&(s=$(c.lineStyle,c.weight),o=K(c.color)),p&&(r=$(p.lineStyle,p.weight),d=K(p.color)),h&&(t=$(h.lineStyle,h.weight),a=K(h.color)),u&&(i=$(u.lineStyle,u.weight),n=K(u.color));let g=l.findIndex(e=>{let{left:l,right:h,top:u,bottom:c}=e;if(!l&&(s||o)||!h&&(r||d)||!u&&(i||n)||!c&&(t||a))return!1;let{style:p,color:g}=l||{},{style:m,color:f}=h||{},{style:C,color:v}=u||{},{style:b,color:y}=c||{};return p==s&&g==o&&m==r&&f==d&&C==i&&v==n&&b==t&&y==a&&!0});return -1===g&&(g=l.length,l.push({left:{style:s,color:o},right:{style:r,color:d},top:{style:i,color:n},bottom:{style:t,color:a},diagonal:{style:void 0,color:void 0}})),g})(n)),d&&(v=(e=>{let{fontName:t="Calibri",color:i,size:s,bold:a,italic:l,outline:n,shadow:o,strikeThrough:d,underline:h,family:u,verticalAlign:c}=e,p=K(i),g=(e=>{if(void 0!==e)return Math.max(["Automatic","Roman","Swiss","Modern","Script","Decorative"].indexOf(e||"Automatic"),0)})(u),m=h?h.toLocaleLowerCase():void 0,f=c?c.toLocaleLowerCase():void 0,C=r.findIndex(e=>e.fontName==t&&e.color==p&&e.size==s&&e.bold==a&&e.italic==l&&e.outline==n&&e.shadow==o&&e.strikeThrough==d&&e.underline==m&&e.verticalAlign==f&&e.family==g);return -1===C&&(C=r.length,r.push({fontName:t,color:p,size:s,bold:a,italic:l,outline:n,shadow:o,strikeThrough:d,underline:m,verticalAlign:f,family:null!=g?g.toString():void 0})),C})(d)),c&&(b=(e=>{if(S[e])return S[e];let t=s.findIndex(t=>t.formatCode===e);return -1===t?(t=s.length+164,s.push({formatCode:e,numFmtId:t})):t=s[t].numFmtId,t})(c.format)),i[m]=o.length,o.push({alignment:t,borderId:C||0,fillId:f||0,fontId:v||0,numFmtId:b||0,protection:p,quotePrefix:g,xfId:0})}},ea={getTemplate(e){let t,i,h,u,c,p,g,m={name:"numFmts",properties:{rawMap:{count:(t=s).length}},children:t.map(e=>et.getTemplate(e))},f={name:"fonts",properties:{rawMap:{count:(i=r.map(t=>({...t,size:null!=t.size?t.size:e}))).length}},children:i.map(e=>ee.getTemplate(e))},C={name:"fills",properties:{rawMap:{count:(h=a).length}},children:h.map(e=>Q.getTemplate(e))},v={name:"borders",properties:{rawMap:{count:(u=l).length}},children:u.map(e=>Y.getTemplate(e))},b={name:"cellStyleXfs",properties:{rawMap:{count:(c=n).length}},children:c.map(e=>X.getTemplate(e))},y={name:"cellXfs",properties:{rawMap:{count:(p=o).length}},children:p.map(e=>X.getTemplate(e))},w={name:"cellStyles",properties:{rawMap:{count:(g=d).length}},children:g.map(e=>J.getTemplate(e))};return es(),{name:"styleSheet",properties:{rawMap:{"mc:Ignorable":"x14ac x16r2 xr",xmlns:"http://schemas.openxmlformats.org/spreadsheetml/2006/main","xmlns:mc":"http://schemas.openxmlformats.org/markup-compatibility/2006","xmlns:x14ac":"http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac","xmlns:x16r2":"http://schemas.microsoft.com/office/spreadsheetml/2015/02/main","xmlns:xr":"http://schemas.microsoft.com/office/spreadsheetml/2014/revision"}},children:[m,f,C,v,b,y,w,{name:"tableStyles",properties:{rawMap:{count:0,defaultPivotStyle:"PivotStyleLight16",defaultTableStyle:"TableStyleMedium2"}}}]}}},el={getTemplate(e,t){let{name:i,columns:s,rowRange:r,displayName:a,showRowStripes:l,showColumnStripes:n,showFilterButtons:o,highlightFirstColumn:d,highlightLastColumn:h}=e||{},u=!r||r[0]-r[1]==0;if(!e||!i||!Array.isArray(s)||!s.length||u)return{name:"table"};let c=s.map((e,t)=>({name:"filterColumn",properties:{rawMap:{colId:t.toString(),hiddenButton:+!o[t]}}})),p=`A${r[0]}`,g=`${T(s.length)}${r[1]}`,f=`${p}:${g}`,C=`${t+1}`,v=t?`${a}_${C}`:a;return{name:"table",properties:{rawMap:{xmlns:"http://schemas.openxmlformats.org/spreadsheetml/2006/main","xmlns:mc":"http://schemas.openxmlformats.org/markup-compatibility/2006","mc:Ignorable":"xr xr3","xmlns:xr":"http://schemas.microsoft.com/office/spreadsheetml/2014/revision","xmlns:xr3":"http://schemas.microsoft.com/office/spreadsheetml/2016/revision3",name:v,displayName:v,ref:f,totalsRowShown:0,id:C}},children:[{name:"autoFilter",properties:{rawMap:{ref:f}},children:c},{name:"tableColumns",properties:{rawMap:{count:s.length}},children:s.map((e,t)=>({name:"tableColumn",properties:{rawMap:{id:(t+1).toString(),name:(0,m._escapeString)(e.replaceAll("\n","_x000a_")),dataCellStyle:"Normal"}}}))},{name:"tableStyleInfo",properties:{rawMap:{name:"TableStyleLight1",showFirstColumn:+!!d,showLastColumn:+!!h,showRowStripes:+!!l,showColumnStripes:+!!n}}}]}}},en=e=>{let[t,i,s,r]=e;return{name:`a:${t}`,children:[{name:`a:${i}`,properties:{rawMap:{val:s,lastClr:r}}}]}},eo=e=>{let[t,i,s,r]=e;return{name:`a:${t}`,properties:{rawMap:{script:s,typeface:i,panose:r}}}},ed=(e,t,i)=>({name:`a:${e}`,properties:{rawMap:{val:t}},children:i}),eh=e=>{let[t,i,s,r,a,l]=e,n=[];return n.push(ed("satMod",s)),r&&n.push(ed("lumMod",r)),a&&n.push(ed("tint",a)),l&&n.push(ed("shade",l)),{name:"a:gs",properties:{rawMap:{pos:t}},children:[{name:"a:schemeClr",properties:{rawMap:{val:i}},children:n}]}},eu=(e,t)=>({name:"a:solidFill",children:[ed("schemeClr",e,t)]}),ec=e=>{let[t,i,s,r,a]=e,[l,n]=a;return{name:"a:gradFill",properties:{rawMap:{rotWithShape:t}},children:[{name:"a:gsLst",children:[eh(i),eh(s),eh(r)]},{name:"a:lin",properties:{rawMap:{ang:l,scaled:n}}}]}},ep=e=>{let[t,i,s,r]=e;return{name:"a:ln",properties:{rawMap:{w:t,cap:i,cmpd:s,algn:r}},children:[eu("phClr"),ed("prstDash","solid"),{name:"a:miter",properties:{rawMap:{lim:"800000"}}}]}},eg=e=>{let t=[];if(e){let[i,s,r,a,l]=e;t.push({name:"a:outerShdw",properties:{rawMap:{blurRad:i,dist:s,dir:r,algn:a,rotWithShape:l}},children:[ed("srgbClr","000000",[ed("alpha","63000")])]})}return{name:"a:effectStyle",children:[Object.assign({},{name:"a:effectLst"},t.length?{children:t}:{})]}},em=e=>{let{aspectratio:t,rotation:i}=e||{},s={};return t&&(s.aspectratio="t"),i&&(s.rotation="t"),{name:"o:lock",properties:{prefixedAttributes:[{prefix:"v:",map:{ext:"edit"}}],rawMap:s}}},ef=e=>Math.floor((e??0)*.74999943307122),eC={getTemplate(e){let t=eE.get(e.sheetIndex)||[];return{name:"xml",properties:{prefixedAttributes:[{prefix:"xmlns:",map:{v:"urn:schemas-microsoft-com:vml",o:"urn:schemas-microsoft-com:office:office",x:"urn:schemas-microsoft-com:office:excel"}}]},children:[{name:"o:shapelayout",properties:{prefixedAttributes:[{prefix:"v:",map:{ext:"edit"}}]},children:[{name:"o:idmap",properties:{prefixedAttributes:[{prefix:"v:",map:{ext:"edit"}}],rawMap:{data:"1"}}}]},{name:"v:shapetype",properties:{prefixedAttributes:[{prefix:"o:",map:{spt:"75",preferrelative:"t"}}],rawMap:{coordsize:"21600,21600",filled:"f",id:"_x0000_t75",path:"m@4@5l@4@11@9@11@9@5xe",stroked:"f"}},children:[{name:"v:stroke",properties:{rawMap:{joinstyle:"miter"}}},{name:"v:formulas",children:["if lineDrawn pixelLineWidth 0","sum @0 1 0","sum 0 0 @1","prod @2 1 2","prod @3 21600 pixelWidth","prod @3 21600 pixelHeight","sum @0 0 1","prod @6 1 2","prod @7 21600 pixelWidth","sum @8 21600 0","prod @7 21600 pixelHeight","sum @10 21600 0"].map(e=>({name:"v:f",properties:{rawMap:{eqn:e}}}))},{name:"v:path",properties:{prefixedAttributes:[{prefix:"o:",map:{connecttype:"rect",extrusionok:"f"}}],rawMap:{gradientshapeok:"t"}}},em({aspectratio:!0})]},...t.map((e,t)=>((e,t)=>{let{width:i=0,height:s=0,altText:r}=e,a=ef(i),l=ef(s);return{name:"v:shape",properties:{rawMap:{id:e.headerFooterPosition,"o:spid":"_x0000_s1025",style:`position: absolute; margin-left: 0; margin-top: 10in; margin-bottom: 0; margin-right: 0; width: ${a}pt; height: ${l}pt; z-index: ${t+1}`,type:"#_x0000_t75",alt:r}},children:[((e,t)=>{let i,{recolor:s,brightness:r,contrast:a,id:l}=e;if(s&&(i={},("Washout"===s||"Grayscale"===s)&&(i.gain="19661f",i.blacklevel="22938f"),("Black & White"===s||"Grayscale"===s)&&(i.grayscale="t","Black & White"===s&&(i.bilevel="t"))),!s||"Grayscale"===s){if(i||(i={}),null!=a&&50!==a){let e="1";a>=0&&(a<50?e=String(a/50):a<100?e=String(50/(100-a)):100===a&&(e="2147483647f")),i.gain=e}null!=r&&50!==r&&(i.blacklevel=((r-0)/100*1+-.5).toString())}return{name:"v:imagedata",properties:{prefixedAttributes:[{prefix:"o:",map:{relid:`rId${t}`,title:l}}],rawMap:i}}})(e,t+1),em({rotation:!0})]}})(e,t))]}}},ev={getTemplate(e,t){let i=(t+1).toString();return{name:"sheet",properties:{rawMap:{name:e,sheetId:i,"r:id":`rId${i}`}}}}},eb={getTemplate(e){let{min:t,max:i,outlineLevel:s,s:r,width:a,hidden:l,bestFit:n}=e,o=1,d="0";return a>1&&(o=Math.ceil((a-12)/7+1),d="1"),{name:"col",properties:{rawMap:{min:t,max:i,outlineLevel:null!=s?s:void 0,width:o,style:r,hidden:l?"1":"0",bestFit:n?"1":"0",customWidth:d}}}}},ey={getTemplate(e,t,s){let{ref:r,data:a,styleId:l}=e,{type:n,value:o}=a||{type:"empty",value:null},d=n;if("f"===n)d="str";else{let e;n.charAt(0)===n.charAt(0).toUpperCase()&&(d="s"===(e=n.charAt(0).toLowerCase())?"inlineStr":e)}let h={name:"c",properties:{rawMap:{r:r,t:"empty"===d?void 0:d,s:l?i[ei(l,s)]||0:void 0}}};return"empty"===d?h:Object.assign({},h,{children:"str"===d&&"f"===n?[{name:"f",textNode:(0,m._escapeString)(P(o))}]:"inlineStr"===d?[{name:"is",children:[{name:"t",textNode:(0,m._escapeString)(P(o))}]}]:[{name:"v",textNode:o}]})}},ew=e=>e.data?.value!==""||void 0!==e.styleId,eS={getTemplate(e,t,i){let{collapsed:s,hidden:r,height:a,outlineLevel:l,cells:n=[]}=e;return((e,t)=>{let i=[],s=0;for(let t=0;t<e.length;t++){let r=e[t];r.mergeAcross&&(i.push({pos:t,excelPos:s}),s+=r.mergeAcross),s++}if(i.length)for(let s=i.length-1;s>=0;s--){let r=[],a=e[i[s].pos];for(let e=1;e<=a.mergeAcross;e++)r.push({ref:`${T(i[s].excelPos+1+e)}${t+1}`,styleId:a.styleId,data:{type:"empty",value:null}});r.length&&e.splice(i[s].pos+1,0,...r)}})(n,t),{name:"row",properties:{rawMap:{r:t+1,collapsed:s?"1":"0",hidden:r?"1":"0",ht:a,customHeight:null!=a?"1":"0",spans:"1:1",outlineLevel:l||void 0}},children:n.filter(ew).map((e,t)=>ey.getTemplate(e,t,i))}}},ex=(e,t,i)=>e.reduce((e,s,r)=>{var a,l,n;let o="Center"===(a=s.position)?"C":"Right"===a?"R":"L",d=(l=`${e}&amp;${o}`,(n=s.font)&&(l+="&amp;&quot;",l+=n.fontName||"Calibri",n.bold!==n.italic?l+=n.bold?",Bold":",Italic":n.bold?l+=",Bold Italic":l+=",Regular",l+="&quot;",n.size&&(l+=`&amp;${n.size}`),n.strikeThrough&&(l+="&amp;S"),n.underline&&(l+=`&amp;${"Double"===n.underline?"E":"U"}`),n.color&&(l+=`&amp;K${n.color.replace("#","").toUpperCase()}`)),l);s.position||(s.position=["Left","Center","Right"][r]);let{image:h}=s;return"&[Picture]"===s.value&&h&&eG(h,`${o}${t}${i}`),`${d}${(0,m._escapeString)((e=>{let t={"&[Page]":"&P","&[Pages]":"&N","&[Date]":"&D","&[Time]":"&T","&[Tab]":"&A","&[Path]":"&Z","&[File]":"&F","&[Picture]":"&G"};for(let i of Object.keys(t))e=e.replace(i,t[i]);return e})(s.value))}`},""),eF={getTemplate(e){var t;let i,s,r,a,l,{worksheet:n,currentSheet:o,config:d}=e,{margins:h={},pageSetup:u,headerFooterConfig:c,suppressColumnOutline:p,rightToLeft:g,frozenRowCount:m,frozenColumnCount:f,protectSheet:C}=d,{table:v}=n,{rows:b,columns:y}=v,w=y?.length?(t=!!p,i=[],s=[],b.forEach((e,t)=>{let r,a=e.cells,l=0;a.forEach((e,a)=>{let n=a+l+1,o=T(n),d=t+1;if(e.mergeAcross){let t=T(a+(l+=e.mergeAcross)+1);i.push(`${o}${d}:${t}${d}`)}y[n-1]||(y[n-1]={});let{collapsibleRanges:h}=e;h&&h.forEach(e=>{s.push([n+e[0],n+e[1]])}),(r=y[n-1]).min=n,r.max=n,e.ref=`${o}${d}`})}),s.sort((e,t)=>e[0]!==t[0]?e[0]-t[0]:t[1]-e[1]),r=new Map,a=new Map,s.filter(e=>{let t=e.toString();return!r.get(t)&&(r.set(t,!0),!0)}).forEach(e=>{let i=y.find(t=>t.min==e[0]&&t.max==e[1]),s=a.get(e[0]);y.push({min:e[0],max:e[1],outlineLevel:t?void 0:s||1,width:(i||{width:100}).width}),a.set(e[0],(s||0)+1)}),i):[],S=eL.get(o),{children:x}=[e=>(e.children.push({name:"sheetPr",children:[{name:"outlinePr",properties:{rawMap:{summaryBelow:0}}}]}),e),((e=!1,t,i)=>s=>(s.children.push({name:"sheetViews",children:[{name:"sheetView",properties:{rawMap:{rightToLeft:!0===e?"1":"0",workbookViewId:"0"}},children:((e=0,t=0)=>{let i=e>0||t>0;return i?[{name:"pane",properties:{rawMap:{state:i?"frozen":void 0,topLeftCell:i?`${T(e+1)}${t+1}`:void 0,xSplit:0===e?void 0:e,ySplit:0===t?void 0:t}}}]:void 0})(t,i)}]}),s))(g,f,m),e=>{let t=b.reduce((e,t)=>t.outlineLevel&&t.outlineLevel>e?t.outlineLevel:e,0);return e.children.push({name:"sheetFormatPr",properties:{rawMap:{baseColWidth:10,defaultRowHeight:16,outlineLevelRow:t||void 0}}}),e},e=>(y.length&&e.children.push({name:"cols",children:y.map(e=>eb.getTemplate(e))}),e),(l=o+1,e=>(b.length&&e.children.push({name:"sheetData",children:b.map((e,t)=>eS.getTemplate(e,t,l))}),e)),e=>{if(!C)return e;let t="boolean"==typeof C?{}:C,i={sheet:1},s=t.password?(e=>{let t=e.length;if(!t)return"";let i=Array(t+1);i[0]=t;for(let s=1;s<=t;s++)i[s]=255&e.charCodeAt(s-1);let s=0;for(let e=i.length-1;e>=0;e--)s=((16384&s)!=0|s<<1&32767)^i[e];return(52811^s).toString(16).toUpperCase().padStart(4,"0")})(t.password):"";s&&(i.password=s);let r={autoFilter:!1,deleteColumns:!1,deleteRows:!1,formatCells:!1,formatColumns:!1,formatRows:!1,insertColumns:!1,insertHyperlinks:!1,insertRows:!1,pivotTables:!1,selectLockedCells:!0,selectUnlockedCells:!0};return Object.keys(r).forEach(e=>{let s=t[e];null!=s&&s!==r[e]&&(i[e]=+!s)}),e.children.push({name:"sheetProtection",properties:{rawMap:i}}),e},e=>(w.length&&e.children.push({name:"mergeCells",properties:{rawMap:{count:w.length}},children:w.map(e=>({name:"mergeCell",properties:{rawMap:{ref:e}}}))}),e),e=>{let{top:t=.75,right:i=.7,bottom:s=.75,left:r=.7,header:a=.3,footer:l=.3}=h;return e.children.push({name:"pageMargins",properties:{rawMap:{bottom:s,footer:l,header:a,left:r,right:i,top:t}}}),e},e=>{var t;return u&&e.children.push({name:"pageSetup",properties:{rawMap:{horizontalDpi:0,verticalDpi:0,orientation:(t=u.orientation)&&("Portrait"===t||"Landscape"===t)?t.toLocaleLowerCase():"portrait",paperSize:(e=>{if(null==e)return 1;let t=["Letter","Letter Small","Tabloid","Ledger","Legal","Statement","Executive","A3","A4","A4 Small","A5","A6","B4","B5","Folio","Envelope","Envelope DL","Envelope C5","Envelope B5","Envelope C3","Envelope C4","Envelope C6","Envelope Monarch","Japanese Postcard","Japanese Double Postcard"].indexOf(e);return -1===t?1:t+1})(u.pageSize)}}}),e},e=>{let t;if(!c)return e;let i=+(null!=c.first),s=+(null!=c.even);return e.children.push({name:"headerFooter",properties:{rawMap:{differentFirst:i,differentOddEven:s}},children:(t=[],["all","first","even"].forEach(e=>{let i=c[e],s="all"===e?"odd":e;if(i)for(let r of Object.keys(i)){let a=i[r],l=`${r.charAt(0).toUpperCase()}${r.slice(1)}`,n=r[0].toUpperCase();if(a){let i="all"===e?"":e.toUpperCase();t.push({name:`${s}${l}`,properties:{rawMap:{"xml:space":"preserve"}},textNode:ex(a,n,i)})}}}),t)}),e},e=>{let t=eI.get(o);return t?.length&&e.children.push({name:"drawing",properties:{rawMap:{"r:id":`rId${++e.rIdCounter}`}}}),e},e=>(eE.get(o)&&e.children.push({name:"legacyDrawingHF",properties:{rawMap:{"r:id":`rId${++e.rIdCounter}`}}}),e),e=>(S&&e.children.push({name:"tableParts",properties:{rawMap:{count:"1"}},children:[{name:"tablePart",properties:{rawMap:{"r:id":`rId${++e.rIdCounter}`}}}]}),e)].reduce((e,t)=>t(e),{children:[],rIdCounter:0});return{name:"worksheet",properties:{prefixedAttributes:[{prefix:"xmlns:",map:{r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships"}}],rawMap:{xmlns:"http://schemas.openxmlformats.org/spreadsheetml/2006/main"}},children:x}}},eA=new Map,eM=[],eR=[],eT=new Map,eP=new Map,eI=new Map,eE=new Map,eD=new Map,ek=new Map,eL=new Map,eN="SINGLE_SHEET";function eG(e,t){let i=eM.length-1;e.headerFooterPosition=t,eO({imageToAdd:e,idx:i});let s=eE.get(i);s||(s=[],eE.set(i,s)),s.find(t=>t.id===e.id)||s.push(e)}function eO(e){let{imageToAdd:t,idx:i}=e,s=eP.get(t.id);if(s){let e=s.find(e=>e.sheetId===i);e?e.image.push(t):s.push({sheetId:i,image:[t]})}else eP.set(t.id,[{sheetId:i,image:[t]}]),eD.set(t.id,{type:t.imageType,index:eD.size})}var eB=(e,t)=>{if(!e.size)return;let i=new Map;t.forEach((t,s)=>{e.has(t)&&i.set(s,e.get(t))}),e.clear(),i.forEach((t,i)=>e.set(i,t))},eV=class{getStringPosition(e){return eA.has(e)?eA.get(e):(eA.set(e,eA.size),eA.size-1)}addBodyImageToMap(e,t,i,s,r){!function(e,t,i,s,r){let a=eM.length,{row:l,column:n}=e.position||{};s&&(null==t||null==i||l&&n||(e.position||(e.position={}),e.position=Object.assign({},e.position,{row:t,column:s.indexOf(i)+1})),((e,t)=>{let{colSpan:i,column:s}=e.position;if(e.width)if(i){let r=t.slice(s-1,s+i-1),a=0;for(let t=0;t<r.length;t++){let i=r[t].getActualWidth();if(e.width<a+i){e.position.colSpan=t+1,e.totalWidth=e.width,e.width=e.totalWidth-a;break}a+=i}}else e.totalWidth=e.width})(e,s),((e,t)=>{let{rowSpan:i,row:s}=e.position;if(e.height)if(i){let r=0,a=0;for(let l=s;l<s+i;l++){let i=F(M(l,t)||20);if(e.height<r+i){e.position.rowSpan=a+1,e.totalHeight=e.height,e.height=e.totalHeight-r;break}r+=i,a++}}else e.totalHeight=e.height})(e,r)),eO({imageToAdd:e,idx:a});let o=ek.get(a);o||(o=new Map,ek.set(a,o));let d=eI.get(a);d?d.push(e):eI.set(a,[e]),o.get(e.id)||o.set(e.id,{index:o.size,type:e.imageType})}(e,t,i,s,r)}addHeaderFooterImageToMap(e,t){eG(e,t)}addWorksheet(e,t,i){var s,r,a;let l,n,o;return function(e){let t=(0,m._escapeString)(e.name)||"",i="";for(;-1!==eM.indexOf(`${t}${i}`);)if(""===i)i="_1";else{let e=parseInt(i.slice(1),10);i=`_${e+1}`}e.name=`${t}${i}`,eM.push(e.name)}(t),1===(h=eM.length)&&es(),e.forEach(er),l=Object.assign({},i),i.exportAsExcelTable&&i.pivotModeActive&&((0,m._warn)(163,{featureName:"pivot mode"}),l.exportAsExcelTable=!1),function(e,t){var i;let{exportAsExcelTable:s,prependContent:r,appendContent:a,headerRowCount:l=0}=t;if(!s)return;let{name:n,showColumnStripes:o,showRowStripes:d,showFilterButton:h,highlightFirstColumn:u,highlightLastColumn:c}="boolean"==typeof s?{}:s,p=(n||"AG-GRID-TABLE").replace(/^[^a-zA-Z_]+/,"_").replace(/\s/g,"_").replace(/[^a-zA-Z0-9_]/g,"_"),g=eM.length-1,{table:f}=e,{rows:C,columns:v}=f,b=r?r.length:0,y=a?a.length:0,w=C.length,S=v.length,x=[],F=[];for(let e=0;e<S;e++){let t=v[e];x.push(t.displayName||""),F.push("match"===h||void 0===h?t.filterAllowed??!1:h)}if(!x?.length||!w||!p)return(0,m._warn)(165);i={name:`table${eL.size+1}`,displayName:p,columns:x,showFilterButtons:F,rowRange:[l+b,l+(w-l)-y],showRowStripes:d??!0,showColumnStripes:o??!1,highlightFirstColumn:u??!1,highlightLastColumn:c??!1},eL.has(g)?(0,m._warn)(164):eL.set(g,i)}(t,l),s=t,r=l,a=n=R(eF.getTemplate({worksheet:s,currentSheet:eM.length-1,config:r})),(o=eT.get(a)??[]).push(eM.length-1),eT.set(a,o),eR.push(a),n}syncOrderWithSheetData(e){(e=>{if(e.length<=1)return;let t=(e=>{let t=new Map(eT),i=[];for(let s of e){let e=t.get(s);if(!e?.length)return null;let r=e.shift();i.push(r),t.set(s,e)}return i})(e)??(e=>{if(!e.length||0===eR.length)return null;let t=new Set,i=[];for(let s of e){let e=eR.findIndex((e,i)=>!t.has(i)&&e===s);if(-1===e)return null;t.add(e),i.push(e)}return i})(e);if(t){let e;e=new Map,t.forEach((t,i)=>e.set(t,i)),eM=t.map(e=>eM[e]),eR=t.map(e=>eR[e]),eB(eI,t),eB(eE,t),eB(eL,t),eB(ek,t),eP.forEach(t=>{t.forEach(t=>{let i=e.get(t.sheetId);null!=i&&(t.sheetId=i)})}),eT=new Map,eR.forEach((e,t)=>{let i=eT.get(e)??[];i.push(t),eT.set(e,i)})}})(e)}reset(){eA.clear(),eP.clear(),eI.clear(),eE.clear(),eD.clear(),ek.clear(),eL.clear(),eM=[],eR=[],eT=new Map,eN="SINGLE_SHEET"}setFactoryMode(e){eN=e}getFactoryMode(){return eN}getSheetNames(){return[...eM]}},e_=async e=>{let t=0,i=[],s=new WritableStream({write:e=>{i.push(e),t+=e.length}}),r=new ReadableStream({start:t=>{let i=new FileReader;i.onload=e=>{e.target?.result&&t.enqueue(e.target.result),t.close()},i.readAsArrayBuffer(e)}}),a=new window.CompressionStream("deflate-raw");return await r.pipeThrough(a).pipeTo(s),{size:t,content:new Blob(i)}},ez=async e=>{let t=new Blob([e]),{size:i,content:s}=await e_(t);return{size:i,content:new Uint8Array(await s.arrayBuffer())}};function eH(e,t){let i="";for(let s=0;s<t;s++)i+=String.fromCharCode(255&e),e>>>=8;return i}var eU=e=>{if(!e.length)return 0;let t=-1,i=0;for(let s=0;s<e.length;s++)i=eK[(t^e[s])&255],t=t>>>8^i;return -1^t},eW=e=>e.length?"string"==typeof e?eU(new TextEncoder().encode(e)):eU(e):0,eK=new Uint32Array([0,0x77073096,0xee0e612c,0x990951ba,0x76dc419,0x706af48f,0xe963a535,0x9e6495a3,0xedb8832,0x79dcb8a4,0xe0d5e91e,0x97d2d988,0x9b64c2b,0x7eb17cbd,0xe7b82d07,0x90bf1d91,0x1db71064,0x6ab020f2,0xf3b97148,0x84be41de,0x1adad47d,0x6ddde4eb,0xf4d4b551,0x83d385c7,0x136c9856,0x646ba8c0,0xfd62f97a,0x8a65c9ec,0x14015c4f,0x63066cd9,0xfa0f3d63,0x8d080df5,0x3b6e20c8,0x4c69105e,0xd56041e4,0xa2677172,0x3c03e4d1,0x4b04d447,0xd20d85fd,0xa50ab56b,0x35b5a8fa,0x42b2986c,0xdbbbc9d6,0xacbcf940,0x32d86ce3,0x45df5c75,0xdcd60dcf,0xabd13d59,0x26d930ac,0x51de003a,0xc8d75180,0xbfd06116,0x21b4f4b5,0x56b3c423,0xcfba9599,0xb8bda50f,0x2802b89e,0x5f058808,0xc60cd9b2,0xb10be924,0x2f6f7c87,0x58684c11,0xc1611dab,0xb6662d3d,0x76dc4190,0x1db7106,0x98d220bc,0xefd5102a,0x71b18589,0x6b6b51f,0x9fbfe4a5,0xe8b8d433,0x7807c9a2,0xf00f934,0x9609a88e,0xe10e9818,0x7f6a0dbb,0x86d3d2d,0x91646c97,0xe6635c01,0x6b6b51f4,0x1c6c6162,0x856530d8,0xf262004e,0x6c0695ed,0x1b01a57b,0x8208f4c1,0xf50fc457,0x65b0d9c6,0x12b7e950,0x8bbeb8ea,0xfcb9887c,0x62dd1ddf,0x15da2d49,0x8cd37cf3,0xfbd44c65,0x4db26158,0x3ab551ce,0xa3bc0074,0xd4bb30e2,0x4adfa541,0x3dd895d7,0xa4d1c46d,0xd3d6f4fb,0x4369e96a,0x346ed9fc,0xad678846,0xda60b8d0,0x44042d73,0x33031de5,0xaa0a4c5f,0xdd0d7cc9,0x5005713c,0x270241aa,0xbe0b1010,0xc90c2086,0x5768b525,0x206f85b3,0xb966d409,0xce61e49f,0x5edef90e,0x29d9c998,0xb0d09822,0xc7d7a8b4,0x59b33d17,0x2eb40d81,0xb7bd5c3b,0xc0ba6cad,0xedb88320,0x9abfb3b6,0x3b6e20c,0x74b1d29a,0xead54739,0x9dd277af,0x4db2615,0x73dc1683,0xe3630b12,0x94643b84,0xd6d6a3e,0x7a6a5aa8,0xe40ecf0b,0x9309ff9d,0xa00ae27,0x7d079eb1,0xf00f9344,0x8708a3d2,0x1e01f268,0x6906c2fe,0xf762575d,0x806567cb,0x196c3671,0x6e6b06e7,0xfed41b76,0x89d32be0,0x10da7a5a,0x67dd4acc,0xf9b9df6f,0x8ebeeff9,0x17b7be43,0x60b08ed5,0xd6d6a3e8,0xa1d1937e,0x38d8c2c4,0x4fdff252,0xd1bb67f1,0xa6bc5767,0x3fb506dd,0x48b2364b,0xd80d2bda,0xaf0a1b4c,0x36034af6,0x41047a60,0xdf60efc3,0xa867df55,0x316e8eef,0x4669be79,0xcb61b38c,0xbc66831a,0x256fd2a0,0x5268e236,0xcc0c7795,0xbb0b4703,0x220216b9,0x5505262f,0xc5ba3bbe,0xb2bd0b28,0x2bb45a92,0x5cb36a04,0xc2d7ffa7,0xb5d0cf31,0x2cd99e8b,0x5bdeae1d,0x9b64c2b0,0xec63f226,0x756aa39c,0x26d930a,0x9c0906a9,0xeb0e363f,0x72076785,0x5005713,0x95bf4a82,0xe2b87a14,0x7bb12bae,0xcb61b38,0x92d28e9b,0xe5d5be0d,0x7cdcefb7,0xbdbdf21,0x86d3d2d4,0xf1d4e242,0x68ddb3f8,0x1fda836e,0x81be16cd,0xf6b9265b,0x6fb077e1,0x18b74777,0x88085ae6,0xff0f6a70,0x66063bca,0x11010b5c,0x8f659eff,0xf862ae69,0x616bffd3,0x166ccf45,0xa00ae278,0xd70dd2ee,0x4e048354,0x3903b3c2,0xa7672661,0xd06016f7,0x4969474d,0x3e6e77db,0xaed16a4a,0xd9d65adc,0x40df0b66,936918e3,0xa9bcae53,0xdebb9ec5,0x47b2cf7f,0x30b5ffe9,0xbdbdf21c,0xcabac28a,0x53b39330,0x24b4a3a6,0xbad03605,0xcdd70693,0x54de5729,0x23d967bf,0xb3667a2e,0xc4614ab8,0x5d681b02,0x2a6f2b94,0xb40bbe37,0xc30c8ea1,0x5a05df1b,0x2d02ef8d]),e$=(e,t,i,s,r,a)=>{let{content:l,path:n,created:o}=e,d=(o.getHours()<<6|o.getMinutes())<<5|o.getSeconds()/2,h=(o.getFullYear()-1980<<4|o.getMonth()+1)<<5|o.getDate(),u=eW(r),c=void 0!==a?a:s,p=function(e){let t=String.fromCharCode;function i(e,i){return t(e>>i&63|128)}let s=function(e){let t,i,s=[];if(!e)return[];let r=e.length,a=0;for(;a<r;)(t=e.charCodeAt(a++))>=55296&&t<=56319&&a<r?(64512&(i=e.charCodeAt(a++)))==56320?s.push(((1023&t)<<10)+(1023&i)+65536):(s.push(t),a--):s.push(t);return s}(e),r=s.length,a=-1,l="";for(;++a<r;)l+=function(e){if((0xffffff80&e)==0)return t(e);let s="";if((0xfffff800&e)==0)s=t(e>>6&31|192);else if((0xffff0000&e)==0){if(e>=55296&&e<=57343)throw Error((0,m._errMsg)(255,{point:e}));s=t(e>>12&15|224)+i(e,6)}else(0xffe00000&e)==0&&(s=t(e>>18&7|240)+i(e,12)+i(e,6));return s+t(63&e|128)}(s[a]);return l}(n),g=p!==n,f="";if(g){let e=eH(1,1)+eH(eW(p),4)+p;f="up"+eH(e.length,2)+e}let C="\x14\0"+(g?"\0\b":"\0\0")+eH(8*!!t,2)+eH(d,2)+eH(h,2)+eH(c?u:0,4)+eH(a??s,4)+eH(s,4)+eH(p.length,2)+eH(f.length,2),v="PK\x03\x04"+C+p+f,b="PK\x01\x02\x14\0"+C+"\0\0\0\0\0\0"+(l?"\0\0\0\0":"\x10\0\0\0")+eH(i,4)+p+f;return{localFileHeader:Uint8Array.from(v,e=>e.charCodeAt(0)),centralDirectoryHeader:Uint8Array.from(b,e=>e.charCodeAt(0))}},ej=e=>{let t;if("string"==typeof e){let i=atob(e.split(";base64,")[1]);t=Uint8Array.from(i,e=>e.charCodeAt(0))}else t=e;return{size:t.length,content:t}},eY=async e=>{let t,i,{content:s}=e,{size:r,content:a}=s?ej(s):{size:0,content:Uint8Array.from([])},l=!1;if("file"===e.type&&a&&r>0){let e=await ez(a);t=e.content,i=e.size,l=!0}return{rawContent:a,rawSize:r,deflatedContent:t,deflatedSize:i,isCompressed:l}},eq=(e,t)=>{let{content:i}=e,{content:s}=i?ej(i):{content:Uint8Array.from([])};return{...e$(e,!1,t,s.length,s,void 0),content:s,isCompressed:!1}},eZ=class{constructor(){this.folders=[],this.files=[]}addFolders(e){e.forEach(this.addFolder.bind(this))}addFolder(e){this.folders.push({path:e,created:new Date,isBase64:!1,type:"folder"})}addFile(e,t,i=!1){this.files.push({path:e,created:new Date,content:i?t:new TextEncoder().encode(t),isBase64:i,type:"file"})}async getZipFile(e="application/zip"){let t=await this.buildCompressedFileStream();return this.clearStream(),new Blob([t],{type:e})}getUncompressedZipFile(e="application/zip"){let t=this.buildFileStream();return this.clearStream(),new Blob([t],{type:e})}clearStream(){this.folders=[],this.files=[]}packageFiles(e){var t,i,s;let r,a=0,l=0;for(let t of e){let{localFileHeader:e,centralDirectoryHeader:i,content:s}=t;a+=e.length+s.length,l+=i.length}let n=new Uint8Array(a),o=new Uint8Array(l),d=0,h=0;for(let t of e){let{localFileHeader:e,centralDirectoryHeader:i,content:s}=t;n.set(e,d),d+=e.length,n.set(s,d),d+=s.length,o.set(i,h),h+=i.length}let u=(t=e.length,i=l,s=a,r="PK\x05\x06\0\0\0\0"+eH(t,2)+eH(t,2)+eH(i,4)+eH(s,4)+"\0\0",Uint8Array.from(r,e=>e.charCodeAt(0))),c=new Uint8Array(n.length+o.length+u.length);return c.set(n),c.set(o,n.length),c.set(u,n.length+o.length),c}async buildCompressedFileStream(){let e=[...this.folders,...this.files],t=await Promise.all(e.map(eY)),i=[],s=0;for(let r=0;r<e.length;r++){let a=e[r],{rawContent:l,rawSize:n,deflatedContent:o,deflatedSize:d,isCompressed:h}=t[r],u=e$(a,h,s,n,l,d),c=o??l;i.push({...u,content:c,isCompressed:h}),s+=u.localFileHeader.length+c.length}return this.packageFiles(i)}buildFileStream(){let e=[...this.folders,...this.files],t=[],i=0;for(let s of e){let e=eq(s,i),{localFileHeader:r,content:a}=e;t.push(e),i+=r.length+a.length}return this.packageFiles(t)}},eX=(e,t,i)=>{let s="xl/drawings",r=`${s}/drawing${i+1}.xml`,a=`${s}/_rels/drawing${i+1}.xml.rels`;e.addFile(a,function(e){let t=ek.get(e)||[],i=[];for(let[e,s]of t){let{index:t,type:r}=s;i.push({Id:`rId${t+1}`,Type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",Target:`../media/image${eD.get(e).index+1}.${D(r)}`})}return R(V(i))}(t)),e.addFile(r,R(O.getTemplate({sheetIndex:t})))},eJ=(e,t,i)=>{let s="xl/drawings",r=`${s}/vmlDrawing${i+1}.vml`,a=`${s}/_rels/vmlDrawing${i+1}.vml.rels`;e.addFile(r,R(eC.getTemplate({sheetIndex:t}),!0)),e.addFile(a,function(e){let t=eE.get(e)||[],i=[];for(let e=0;e<t.length;e++){let s=t[e],r=eD.get(s.id);if(!r)continue;let{index:a,type:l}=r;i.push({Id:`rId${e+1}`,Type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",Target:`../media/image${a+1}.${D(l)}`})}return R(V(i))}(t))},eQ=(e,t,i={},s)=>{if(!t||0===t.length)return(0,m._warn)(159),s.reset(),!1;s.syncOrderWithSheetData(t);let{fontSize:r=11,author:a="AG Grid",activeTab:l=0,customMetadata:n}=i,o=t.length,d=Math.max(Math.min(l,o-1),0);return(e=>{if(e.addFolders(["_rels/","docProps/","xl/","xl/theme/","xl/_rels/","xl/worksheets/"]),!eP.size)return;e.addFolders(["xl/worksheets/_rels","xl/drawings/","xl/drawings/_rels","xl/media/"]);let t=0;eP.forEach(i=>{let{base64:s,imageType:r}=i[0].image[0];e.addFile(`xl/media/image${++t}.${D(r)}`,s,!0)})})(e),(e=>{let t=Array.from(eL.keys());for(let s=0;s<t.length;s++){let r=t[s],a=eL.get(r);if(a){var i;e.addFile(`xl/tables/${a.name}.xml`,(i=s,R(el.getTemplate(a,i))))}}})(e),((e,t)=>{let i=0,s=0;for(let r=0;r<t.length;r++){let a,l,n,o=t[r];e.addFile(`xl/worksheets/sheet${r+1}.xml`,o,!1);let d=eP.size>0&&eI.has(r),h=eL.size>0&&eL.get(r),u=eP.size&&eE.has(r);if(!d&&!h&&!u)continue;d&&(eX(e,r,i),l=i,i++),u&&(eJ(e,r,s),n=s,s++),h&&(a=h.name);let c=`xl/worksheets/_rels/sheet${r+1}.xml.rels`;e.addFile(c,function({drawingIndex:e,vmlDrawingIndex:t,tableName:i}={}){if(void 0===e&&void 0===t&&void 0===i)return"";let s=[];return null!=e&&s.push({Id:`rId${s.length+1}`,Type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",Target:`../drawings/drawing${e+1}.xml`}),null!=t&&s.push({Id:`rId${s.length+1}`,Type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",Target:`../drawings/vmlDrawing${t+1}.vml`}),null!=i&&s.push({Id:`rId${s.length+1}`,Type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/table",Target:`../tables/${i}.xml`}),R(V(s))}({tableName:a,drawingIndex:l,vmlDrawingIndex:n}))}})(e,t),((e,t,i,s,r,a)=>{let l,n,o,d=!!a&&Object.keys(a).some(e=>null!=a[e]);e.addFile("xl/workbook.xml",R(((e,t)=>({name:"workbook",properties:{prefixedAttributes:[{prefix:"xmlns:",map:{r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships"}}],rawMap:{xmlns:"http://schemas.openxmlformats.org/spreadsheetml/2006/main"}},children:[{name:"bookViews",children:[{name:"workbookView",properties:{rawMap:{activeTab:t}}}]},{name:"sheets",children:e.map((e,t)=>ev.getTemplate(e,t))}]}))(eM,r))),e.addFile("xl/styles.xml",R(ea.getTemplate(t))),e.addFile("xl/sharedStrings.xml",R({name:"sst",properties:{rawMap:{xmlns:"http://schemas.openxmlformats.org/spreadsheetml/2006/main",count:(l=eA).size,uniqueCount:l.size}},children:(e=>{let t=[];for(let i of e.keys()){let e=i.toString(),s={name:"t",textNode:(0,m._escapeString)(P(e))};e.trim().length!==e.length&&(s.properties={rawMap:{"xml:space":"preserve"}}),t.push({name:"si",children:[s]})}return t})(l)})),e.addFile("xl/theme/theme1.xml",R({name:"a:theme",properties:{prefixedAttributes:[{prefix:"xmlns:",map:{a:"http://schemas.openxmlformats.org/drawingml/2006/main"}}],rawMap:{name:"Office Theme"}},children:[{name:"a:themeElements",children:[{name:"a:clrScheme",properties:{rawMap:{name:"Office"}},children:[en(["dk1","sysClr","windowText","000000"]),en(["lt1","sysClr","window","FFFFFF"]),en(["dk2","srgbClr","44546A"]),en(["lt2","srgbClr","E7E6E6"]),en(["accent1","srgbClr","4472C4"]),en(["accent2","srgbClr","ED7D31"]),en(["accent3","srgbClr","A5A5A5"]),en(["accent4","srgbClr","FFC000"]),en(["accent5","srgbClr","5B9BD5"]),en(["accent6","srgbClr","70AD47"]),en(["hlink","srgbClr","0563C1"]),en(["folHlink","srgbClr","954F72"])]},{name:"a:fontScheme",properties:{rawMap:{name:"Office"}},children:[{name:"a:majorFont",children:[eo(["latin","Calibri Light",void 0,"020F0302020204030204"]),eo(["ea",""]),eo(["cs",""]),eo(["font"," Light","Jpan"]),eo(["font"," ","Hang"]),eo(["font"," Light","Hans"]),eo(["font","","Hant"]),eo(["font","Times New Roman","Arab"]),eo(["font","Times New Roman","Hebr"]),eo(["font","Tahoma","Thai"]),eo(["font","Nyala","Ethi"]),eo(["font","Vrinda","Beng"]),eo(["font","Shruti","Gujr"]),eo(["font","MoolBoran","Khmr"]),eo(["font","Tunga","Knda"]),eo(["font","Raavi","Guru"]),eo(["font","Euphemia","Cans"]),eo(["font","Plantagenet Cherokee","Cher"]),eo(["font","Microsoft Yi Baiti","Yiii"]),eo(["font","Microsoft Himalaya","Tibt"]),eo(["font","MV Boli","Thaa"]),eo(["font","Mangal","Deva"]),eo(["font","Gautami","Telu"]),eo(["font","Latha","Taml"]),eo(["font","Estrangelo Edessa","Syrc"]),eo(["font","Kalinga","Orya"]),eo(["font","Kartika","Mlym"]),eo(["font","DokChampa","Laoo"]),eo(["font","Iskoola Pota","Sinh"]),eo(["font","Mongolian Baiti","Mong"]),eo(["font","Times New Roman","Viet"]),eo(["font","Microsoft Uighur","Uigh"]),eo(["font","Sylfaen","Geor"]),eo(["font","Arial","Armn"]),eo(["font","Leelawadee UI","Bugi"]),eo(["font","Microsoft JhengHei","Bopo"]),eo(["font","Javanese Text","Java"]),eo(["font","Segoe UI","Lisu"]),eo(["font","Myanmar Text","Mymr"]),eo(["font","Ebrima","Nkoo"]),eo(["font","Nirmala UI","Olck"]),eo(["font","Ebrima","Osma"]),eo(["font","Phagspa","Phag"]),eo(["font","Estrangelo Edessa","Syrn"]),eo(["font","Estrangelo Edessa","Syrj"]),eo(["font","Estrangelo Edessa","Syre"]),eo(["font","Nirmala UI","Sora"]),eo(["font","Microsoft Tai Le","Tale"]),eo(["font","Microsoft New Tai Lue","Talu"]),eo(["font","Ebrima","Tfng"])]},{name:"a:minorFont",children:[eo(["latin","Calibri",void 0,"020F0502020204030204"]),eo(["ea",""]),eo(["cs",""]),eo(["font","","Jpan"]),eo(["font"," ","Hang"]),eo(["font","","Hans"]),eo(["font","","Hant"]),eo(["font","Arial","Arab"]),eo(["font","Arial","Hebr"]),eo(["font","Tahoma","Thai"]),eo(["font","Nyala","Ethi"]),eo(["font","Vrinda","Beng"]),eo(["font","Shruti","Gujr"]),eo(["font","DaunPenh","Khmr"]),eo(["font","Tunga","Knda"]),eo(["font","Raavi","Guru"]),eo(["font","Euphemia","Cans"]),eo(["font","Plantagenet Cherokee","Cher"]),eo(["font","Microsoft Yi Baiti","Yiii"]),eo(["font","Microsoft Himalaya","Tibt"]),eo(["font","MV Boli","Thaa"]),eo(["font","Mangal","Deva"]),eo(["font","Gautami","Telu"]),eo(["font","Latha","Taml"]),eo(["font","Estrangelo Edessa","Syrc"]),eo(["font","Kalinga","Orya"]),eo(["font","Kartika","Mlym"]),eo(["font","DokChampa","Laoo"]),eo(["font","Iskoola Pota","Sinh"]),eo(["font","Mongolian Baiti","Mong"]),eo(["font","Arial","Viet"]),eo(["font","Microsoft Uighur","Uigh"]),eo(["font","Sylfaen","Geor"]),eo(["font","Arial","Armn"]),eo(["font","Leelawadee UI","Bugi"]),eo(["font","Microsoft JhengHei","Bopo"]),eo(["font","Javanese Text","Java"]),eo(["font","Segoe UI","Lisu"]),eo(["font","Myanmar Text","Mymr"]),eo(["font","Ebrima","Nkoo"]),eo(["font","Nirmala UI","Olck"]),eo(["font","Ebrima","Osma"]),eo(["font","Phagspa","Phag"]),eo(["font","Estrangelo Edessa","Syrn"]),eo(["font","Estrangelo Edessa","Syrj"]),eo(["font","Estrangelo Edessa","Syre"]),eo(["font","Nirmala UI","Sora"]),eo(["font","Microsoft Tai Le","Tale"]),eo(["font","Microsoft New Tai Lue","Talu"]),eo(["font","Ebrima","Tfng"])]}]},{name:"a:fmtScheme",properties:{rawMap:{name:"Office"}},children:[{name:"a:fillStyleLst",children:[eu("phClr"),ec(["1",["0","phClr","105000","110000","67000"],["50000","phClr","103000","105000","73000"],["100000","phClr","109000","105000","81000"],["5400000","0"]]),ec(["1",["0","phClr","103000","102000","94000"],["50000","phClr","110000","100000",void 0,"100000"],["100000","phClr","120000","99000",void 0,"78000"],["5400000","0"]])]},{name:"a:lnStyleLst",children:[ep(["6350","flat","sng","ctr"]),ep(["12700","flat","sng","ctr"]),ep(["19050","flat","sng","ctr"])]},{name:"a:effectStyleLst",children:[eg(),eg(),eg(["57150","19050","5400000","ctr","0"])]},{name:"a:bgFillStyleLst",children:[eu("phClr"),eu("phClr",[ed("tint","95000"),ed("satMod","170000")]),ec(["1",["0","phClr","150000","102000","93000","98000"],["50000","phClr","130000","103000","98000","90000"],["100000","phClr","120000",void 0,void 0,"63000"],["5400000","0"]])]}]}]},{name:"a:objectDefaults"},{name:"a:extraClrSchemeLst"}]})),e.addFile("xl/_rels/workbook.xml.rels",(n=Array(s).fill(void 0).map((e,t)=>({Id:`rId${t+1}`,Type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet",Target:`worksheets/sheet${t+1}.xml`})),R(V([...n,{Id:`rId${s+1}`,Type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",Target:"theme/theme1.xml"},{Id:`rId${s+2}`,Type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",Target:"styles.xml"},{Id:`rId${s+3}`,Type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",Target:"sharedStrings.xml"}])))),e.addFile("docProps/core.xml",R(L.getTemplate(i))),d&&e.addFile("docProps/custom.xml",R((e=>({name:"Properties",properties:{rawMap:{xmlns:"http://schemas.openxmlformats.org/officeDocument/2006/custom-properties","xmlns:vt":"http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes"}},children:Object.keys(e).filter(t=>t&&null!=e[t]).map((t,i)=>({name:"property",properties:{rawMap:{fmtid:"{D5CDD505-2E9C-101B-9397-08002B2CF9AE}",pid:(i+2).toString(),name:(0,m._escapeString)(t)??""}},children:[{name:"vt:lpwstr",textNode:(0,m._escapeString)(P(String(e[t])))??""}]}))}))(a))),e.addFile("[Content_Types].xml",R(k.getTemplate({sheetLen:s,hasCustomProperties:d}))),e.addFile("_rels/.rels",(o=[{Id:"rId1",Type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",Target:"xl/workbook.xml"},{Id:"rId2",Type:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",Target:"docProps/core.xml"}],d&&o.push({Id:"rId3",Type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",Target:"docProps/custom.xml"}),R(V(o))))})(e,r,a,o,d,n),s.reset(),!0},e0=(e,t=new eV)=>{let{data:i,fontSize:s,author:r,activeSheetIndex:a,customMetadata:l}=e,n=e.mimeType||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",o=new eZ;return eQ(o,i,{author:r,fontSize:s,activeTab:a,customMetadata:l},t)?o.getZipFile(n):Promise.resolve(void 0)},e1=(e,t=new eV)=>{let{data:i,fontSize:s,author:r,activeSheetIndex:a,customMetadata:l}=e,n=e.mimeType||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",o=new eZ;if(eQ(o,i,{author:r,fontSize:s,activeTab:a,customMetadata:l},t))return o.getUncompressedZipFile(n)},e2=class extends m.BaseCreator{constructor(){super(...arguments),this.beanName="excelCreator",this.workbook=new eV}getMergedParams(e){return Object.assign({},this.gos.get("defaultExcelExportParams"),e)}export(e){if(this.isExportSuppressed())return void(0,m._warn)(160);let t=()=>{let t=this.getMergedParams(e),i=this.getData(t),{fontSize:s,author:r,mimeType:a,customMetadata:l}=t;this.packageCompressedFile({data:[i],fontSize:s,author:r,mimeType:a,customMetadata:l}).then(e=>{if(e){let{fileName:i}=t,s="function"==typeof i?i((0,m._addGridCommonParams)(this.gos,{})):i;(0,m._downloadFile)(this.getFileName(s),e)}})},{overlays:i}=this.beans;i?i.showExportOverlay(t):t()}exportDataAsExcel(e){this.export(e)}getDataAsExcel(e){let t=this.getMergedParams(e),i=this.getData(t),{fontSize:s,author:r,mimeType:a,customMetadata:l}=t;return this.packageFile({data:[i],fontSize:s,author:r,mimeType:a,customMetadata:l})}setFactoryMode(e){this.workbook.setFactoryMode(e)}getFactoryMode(){return this.workbook.getFactoryMode()}getSheetDataForExcel(e){let t=this.getMergedParams(e);return this.getData(t)}getMultipleSheetsAsExcel(e){return e1(e,this.workbook)}exportMultipleSheetsAsExcel(e){e0(e,this.workbook).then(t=>{let{fileName:i="export.xlsx"}=e;if(t){let e="function"==typeof i?i():i;(0,m._downloadFile)(e,t)}})}getDefaultFileExtension(){return"xlsx"}createSerializingSession(e){let{colModel:t,colNames:i,rowGroupColsSvc:s,valueSvc:r,formula:a,gos:l}=this.beans,n=l.get("excelStyles")||[],o=this.createStyleLinker(n),d={...e,colModel:t,colNames:i,rowGroupColsSvc:s,valueSvc:r,formulaSvc:a,gos:l,suppressRowOutline:e.suppressRowOutline||e.skipRowGroups,headerRowHeight:e.headerRowHeight||e.rowHeight,baseExcelStyles:n,rightToLeft:e.rightToLeft??l.get("enableRtl"),styleLinker:o,headerRowCount:(0,m._getHeaderRowCount)(t),pivotModeActive:t.isPivotActive(),workbook:this.workbook};return new I(d)}createStyleLinker(e){let t=[],i=new Set,s=new Map;e.forEach((e,r)=>{t.push(e.id),i.add(e.id),s.set(e.id,r)});let{gos:r,cellStyles:a}=this.beans;return e=>{let{rowType:l,rowIndex:n,value:o,column:d,columnGroup:h,node:u}=e,c="HEADER"===l,p="HEADER_GROUPING"===l,g=c?d:h,f=[];if(c||p)return f.push("header"),p&&f.push("headerGroup"),g&&(f=f.concat((0,m._getHeaderClassesFromColDef)(g.getDefinition(),r,d||null,h||null))),f;let C=["cell"];if(!t.length)return C;let v=d.getDefinition();return a?.processAllCellClasses(v,(0,m._addGridCommonParams)(r,{value:o,data:u.data,node:u,colDef:v,column:d,rowIndex:n}),e=>{i.has(e)&&C.push(e)}),C.sort((e,t)=>{let i=s.get(e)??-1,r=s.get(t)??-1;return i===r?0:i<r?-1:1})}}isExportSuppressed(){return this.gos.get("suppressExcelExport")}packageCompressedFile(e){return e0(e,this.workbook)}packageFile(e){return e1(e,this.workbook)}},e5=class extends m._AgTabGuardComp{constructor(e,t){super(function(e){return{tag:"div",cls:`ag-virtual-list-viewport ag-${e}-virtual-list-viewport`,role:"presentation",children:[{tag:"div",ref:"eContainer",cls:`ag-virtual-list-container ag-${e}-virtual-list-container`}]}}(t?.cssIdentifier||"default")),this.stopPropagationCallbacks=e,this.renderedRows=new Map,this.rowHeight=20,this.pageSize=-1,this.isScrolling=!1,this.isHeightFromTheme=!0,this.eContainer=m.RefPlaceholder,this.awaitStableCallbacks=[],this.registerCSS(":where(.ag-virtual-list-viewport) .ag-tab-guard{position:sticky}.ag-virtual-list-viewport{flex:1 1 auto;height:100%;min-width:0;overflow:auto;position:relative;width:100%}.ag-virtual-list-container{overflow:hidden;position:relative}.ag-virtual-list-item{height:var(--ag-list-item-height);position:absolute;width:100%}");const{cssIdentifier:i="default",ariaRole:s="listbox",listName:r,moveItemCallback:a}=t||{};this.cssIdentifier=i,this.ariaRole=s,this.listName=r,this.moveItemCallback=a}postConstruct(){this.addScrollListener(),this.rowHeight=this.getItemHeight(),this.addResizeObserver(),this.initialiseTabGuard({onFocusIn:e=>this.onFocusIn(e),onFocusOut:e=>this.onFocusOut(e),focusInnerElement:e=>this.focusInnerElement(e),onTabKeyDown:e=>this.onTabKeyDown(e),handleKeyDown:e=>this.handleKeyDown(e)},this.stopPropagationCallbacks),this.refreshAriaProperties(),this.addManagedEventListeners({stylesChanged:this.onStylesChanged.bind(this)})}onStylesChanged(e){e.listItemHeightChanged&&(this.rowHeight=this.getItemHeight(),this.refresh())}refreshAriaProperties(){let e=this.getLocaleTextFunc()("ariaDefaultListName",this.listName||"List"),t=this.eContainer;(0,m._setAriaRole)(t,this.model?.getRowCount()>0?this.ariaRole:"presentation"),(0,m._setAriaLabel)(t,e)}addResizeObserver(){let e=()=>(0,m._requestAnimationFrame)(this.beans,()=>this.drawVirtualRows()),t=(0,m._observeResize)(this.beans,this.getGui(),e);this.addDestroyFunc(t)}focusInnerElement(e){return this.focusRow(e?this.model.getRowCount()-1:0),!0}onFocusIn(e){let t=e.target;t.classList.contains("ag-virtual-list-item")&&(this.lastFocusedRowIndex=(0,m._getAriaPosInSet)(t)-1)}onFocusOut(e){this.getFocusableElement().contains(e.relatedTarget)||(this.lastFocusedRowIndex=null)}handleKeyDown(e){let{key:t,shiftKey:i}=e;switch(t){case m.KeyCode.UP:case m.KeyCode.DOWN:{let s=t===m.KeyCode.UP;e.preventDefault(),i?this.moveItem(s):this.navigate(s)}break;case m.KeyCode.PAGE_HOME:case m.KeyCode.PAGE_END:case m.KeyCode.PAGE_UP:case m.KeyCode.PAGE_DOWN:null!==this.navigateToPage(t)&&e.preventDefault()}}onTabKeyDown(e){this.stopPropagationCallbacks?.stopPropagation(e),this.forceFocusOutOfContainer(e.shiftKey)}getNextRow(e){if(null==this.lastFocusedRowIndex)return;let t=this.lastFocusedRowIndex+(e?-1:1);if(!(t<0||t>=this.model.getRowCount()))return t}moveItem(e){if(!this.moveItemCallback)return;let t=this.getComponentAt(this.lastFocusedRowIndex);t&&this.moveItemCallback(t,e)}navigate(e){let t=this.getNextRow(e);void 0!==t&&this.focusRow(t)}navigateToPage(e,t="focused"){let i=!1;"focused"===t&&(t=this.getLastFocusedRow(),i=!0);let s=this.model.getRowCount()-1,r=-1;return(e===m.KeyCode.PAGE_HOME?r=0:e===m.KeyCode.PAGE_END?r=s:e===m.KeyCode.PAGE_DOWN?r=Math.min(t+this.pageSize,s):e===m.KeyCode.PAGE_UP&&(r=Math.max(t-this.pageSize,0)),-1===r)?null:(i?this.focusRow(r):this.ensureIndexVisible(r),r)}getLastFocusedRow(){return this.lastFocusedRowIndex}focusRow(e){this.isScrolling||(this.isScrolling=!0,this.ensureIndexVisible(e),(0,m._requestAnimationFrame)(this.beans,()=>{if(this.isScrolling=!1,!this.isAlive())return;let t=this.renderedRows.get(e);t&&t.eDiv.focus()}))}getComponentAt(e){let t=this.renderedRows.get(e);return t&&t.rowComponent}forEachRenderedRow(e){this.renderedRows.forEach((t,i)=>e(t.rowComponent,i))}getItemHeight(){return this.isHeightFromTheme?this.beans.environment.getDefaultListItemHeight():this.rowHeight}ensureIndexVisible(e,t=!0){let i=this.model.getRowCount();if("number"!=typeof e||e<0||e>=i)return!1;let s=e*this.rowHeight,r=s+this.rowHeight,a=this.getGui(),l=a.scrollTop,n=a.offsetHeight,o=t?0:this.rowHeight;return l>s+o?(a.scrollTop=s,!0):l+n<r-o&&(a.scrollTop=r-n,!0)}setComponentCreator(e){this.componentCreator=e}setComponentUpdater(e){this.componentUpdater=e}getRowHeight(){return this.rowHeight}getScrollTop(){return this.getGui().scrollTop}setRowHeight(e){this.isHeightFromTheme=!1,this.rowHeight=e,this.refresh()}refresh(e){if(null==this.model||!this.isAlive())return;let t=this.model.getRowCount();this.eContainer.style.height=`${t*this.rowHeight}px`,this.refreshAriaProperties(),this.awaitStable(()=>{this.isAlive()&&(this.canSoftRefresh(e)?this.drawVirtualRows(!0):(this.clearVirtualRows(),this.drawVirtualRows()))})}awaitStable(e){if(this.awaitStableCallbacks.push(e),this.awaitStableCallbacks.length>1)return;let t=this.model.getRowCount();(0,m._waitUntil)(this,()=>this.eContainer.clientHeight>=t*this.rowHeight,()=>{if(!this.isAlive())return;let e=this.awaitStableCallbacks;for(let t of(this.awaitStableCallbacks=[],e))t()})}canSoftRefresh(e){return!!(e&&this.renderedRows.size&&"function"==typeof this.model.areRowsEqual&&this.componentUpdater)}clearVirtualRows(){this.renderedRows.forEach((e,t)=>this.removeRow(t))}drawVirtualRows(e){if(!this.isAlive()||!this.model)return;let t=this.getGui(),i=t.scrollTop,s=i+t.offsetHeight;if(i===s)this.clearVirtualRows();else{let t=Math.floor(i/this.rowHeight),r=Math.floor(s/this.rowHeight);this.pageSize=Math.floor((s-i)/this.rowHeight),this.ensureRowsRendered(t,r,e)}}ensureRowsRendered(e,t,i){this.renderedRows.forEach((i,s)=>{(s<e||s>t)&&s!==this.lastFocusedRowIndex&&this.removeRow(s)}),i&&this.refreshRows();for(let i=e;i<=t;i++)!this.renderedRows.has(i)&&i<this.model.getRowCount()&&this.insertRow(i)}insertRow(e){let t=this.model.getRow(e),i="tree"===this.ariaRole?"treeitem":"option",s=(0,m._createAgElement)({tag:"div",cls:`ag-virtual-list-item ag-${this.cssIdentifier}-virtual-list-item`,role:i,attrs:{tabindex:"-1"}});(0,m._setAriaSetSize)(s,this.model.getRowCount()),(0,m._setAriaPosInSet)(s,e+1),s.style.height=`${this.rowHeight}px`,s.style.top=`${this.rowHeight*e}px`;let r=this.componentCreator(t,s);r.addGuiEventListener("focusin",()=>this.lastFocusedRowIndex=e),s.appendChild(r.getGui()),this.renderedRows.has(e-1)?this.renderedRows.get(e-1).eDiv.insertAdjacentElement("afterend",s):this.renderedRows.has(e+1)?this.renderedRows.get(e+1).eDiv.insertAdjacentElement("beforebegin",s):this.eContainer.appendChild(s),this.renderedRows.set(e,{rowComponent:r,eDiv:s,value:t})}removeRow(e){let t=this.renderedRows.get(e);t.eDiv.remove(),this.destroyBean(t.rowComponent),this.renderedRows.delete(e)}refreshRows(){let e=this.model.getRowCount();this.renderedRows.forEach((t,i)=>{if(i>=e)this.removeRow(i);else{let e=this.model.getRow(i);this.model.areRowsEqual?.(t.value,e)?this.componentUpdater(e,t.rowComponent):this.removeRow(i)}})}addScrollListener(){this.addGuiEventListener("scroll",()=>this.drawVirtualRows(),{passive:!0})}setModel(e){this.model=e}getAriaElement(){return this.eContainer}destroy(){this.isAlive()&&(this.clearVirtualRows(),this.awaitStableCallbacks.length=0,super.destroy())}},e4="ag-list-item-hovered",e3=class extends m._AgBeanStub{constructor(e,t,i){super(),this.comp=e,this.virtualList=t,this.params=i,this.currentDragValue=null,this.lastHoveredListItem=null}postConstruct(){this.beans.environment.addGlobalCSS('.ag-list-item-hovered:after{background-color:var(--ag-accent-color);content:"";height:1px;left:0;position:absolute;right:0}.ag-item-highlight-top:after{top:0}.ag-item-highlight-bottom:after{bottom:0}',"component-AgVirtualListDragFeature"),this.params.addListeners(this,this.listItemDragStart.bind(this),this.listItemDragEnd.bind(this)),this.createDropTarget(),this.createAutoScrollService()}listItemDragStart(e){this.currentDragValue=this.params.getCurrentDragValue(e),this.moveBlocked=this.params.isMoveBlocked(this.currentDragValue)}listItemDragEnd(){window.setTimeout(()=>{this.currentDragValue=null,this.moveBlocked=!1},10)}createDropTarget(){this.beans.dragAndDrop?.addDropTarget({isInterestedIn:e=>e===this.params.dragSourceType,getIconName:()=>this.moveBlocked?"pinned":"move",getContainer:()=>this.comp.getGui(),onDragging:e=>this.onDragging(e),onDragStop:()=>this.onDragStop(),onDragLeave:()=>this.onDragLeave(),onDragCancel:()=>this.onDragCancel()})}createAutoScrollService(){let e=this.virtualList.getGui();this.autoScrollService=new m.AutoScrollService({scrollContainer:e,scrollAxis:"y",getVerticalPosition:()=>e.scrollTop,setVerticalPosition:t=>e.scrollTop=t})}onDragging(e){if(!this.currentDragValue||this.moveBlocked)return;let t=this.getListDragItem(e),i=this.virtualList.getComponentAt(t.rowIndex);if(!i)return;let s=i.getGui().parentElement;this.lastHoveredListItem&&this.lastHoveredListItem.rowIndex===t.rowIndex&&this.lastHoveredListItem.position===t.position||(this.autoScrollService.check(e.event),this.clearHoveredItems(),this.lastHoveredListItem=t,(0,m._radioCssClass)(s,e4),(0,m._radioCssClass)(s,`ag-item-highlight-${t.position}`))}getListDragItem(e){let t=this.virtualList.getGui(),i=Number.parseFloat(window.getComputedStyle(t).paddingTop),s=this.virtualList.getRowHeight(),r=this.virtualList.getScrollTop(),a=Math.max(0,(e.y-i+r)/s),l=this.params.getNumRows(this.comp)-1,n=0|Math.min(l,a);return{rowIndex:n,position:Math.round(a)>a||a>l?"bottom":"top",component:this.virtualList.getComponentAt(n)}}onDragStop(){this.moveBlocked||(this.params.moveItem(this.currentDragValue,this.lastHoveredListItem),this.clearDragProperties())}onDragCancel(){this.clearDragProperties()}onDragLeave(){this.clearDragProperties()}clearDragProperties(){this.clearHoveredItems(),this.autoScrollService.ensureCleared()}clearHoveredItems(){for(let e of this.virtualList.getGui().querySelectorAll(`.${e4}`))for(let t of[e4,"ag-item-highlight-top","ag-item-highlight-bottom"])e.classList.remove(t);this.lastHoveredListItem=null}},e6={selector:"AG-INPUT-RANGE",component:class extends m.AgAbstractInputField{constructor(e){super(e,"ag-range-field","range")}postConstruct(){super.postConstruct();let{min:e,max:t,step:i}=this.config;null!=e&&this.setMinValue(e),null!=t&&this.setMaxValue(t),this.setStep(i||1)}addInputListeners(){this.addManagedElementListeners(this.eInput,{input:e=>{let t=e.target.value;this.setValue(t)}})}setMinValue(e){return this.min=e,this.eInput.setAttribute("min",e.toString()),this}setMaxValue(e){return this.max=e,this.eInput.setAttribute("max",e.toString()),this}setStep(e){return this.eInput.setAttribute("step",e.toString()),this}setValue(e,t){null!=this.min&&(e=Math.max(parseFloat(e),this.min).toString()),null!=this.max&&(e=Math.min(parseFloat(e),this.max).toString());let i=super.setValue(e,t);return this.eInput.value=e,i}}},e8=class extends m.AgAbstractLabel{constructor(e){super(e,`<div class="ag-slider">
            <label data-ref="eLabel"></label>
            <div class="ag-wrapper ag-slider-wrapper">
                <ag-input-range data-ref="eSlider"></ag-input-range>
                <ag-input-number-field data-ref="eText"></ag-input-number-field>
            </div>
        </div>`,[e6,m.AgInputNumberFieldSelector]),this.eLabel=m.RefPlaceholder,this.eSlider=m.RefPlaceholder,this.eText=m.RefPlaceholder,this.labelAlignment="top"}postConstruct(){super.postConstruct(),this.eSlider.addCss("ag-slider-field");let{minValue:e,maxValue:t,textFieldWidth:i,step:s,value:r,onValueChange:a}=this.config;null!=e&&this.setMinValue(e),null!=t&&this.setMaxValue(t),null!=i&&this.setTextFieldWidth(i),null!=s&&this.setStep(s),null!=r&&this.setValue(r),null!=a&&this.onValueChange(a)}onValueChange(e){return this.addManagedListeners(this.eText,{fieldValueChanged:()=>{let t=parseFloat(this.eText.getValue());this.eSlider.setValue(t.toString(),!0),e(t||0)}}),this.addManagedListeners(this.eSlider,{fieldValueChanged:()=>{let t=this.eSlider.getValue();this.eText.setValue(t,!0),e(parseFloat(t))}}),this}setSliderWidth(e){return this.eSlider.setWidth(e),this}setTextFieldWidth(e){return this.eText.setWidth(e),this}setMinValue(e){return this.eSlider.setMinValue(e),this.eText.setMin(e),this}setMaxValue(e){return this.eSlider.setMaxValue(e),this.eText.setMax(e),this}getValue(){return this.eText.getValue()}setValue(e,t){return this.getValue()===e||(this.eText.setValue(e,!0),this.eSlider.setValue(e,!0),t||this.dispatchLocalEvent({type:"fieldValueChanged"})),this}setStep(e){return this.eSlider.setStep(e),this.eText.setStep(e),this}},e7={selector:"AG-SLIDER",component:e8},e9={selector:"AG-COLOR-INPUT",component:class extends m.AgInputTextField{constructor(){super({template:{tag:"div",cls:"ag-color-input",role:"presentation",children:[{tag:"div",ref:"eLabel",cls:"ag-input-field-label"},{tag:"div",ref:"eWrapper",cls:"ag-wrapper ag-input-wrapper",role:"presentation",children:[{tag:"input",ref:"eInput",cls:"ag-input-field-input"},{tag:"div",ref:"eColor",cls:"ag-color-input-color"}]}]}}),this.eColor=m.RefPlaceholder}wireBeans(e){this.color=e.agChartsExports._Util.Color}setColor(e){let t=e.toRgbaString();this.setValue(this.color.fromString(t).toHexString().toUpperCase(),!0),this.eColor.style.backgroundColor=t}setValue(e,t){let i=this.color.validColorString(e??"");return this.eInput.setCustomValidity(i?"":this.getLocaleTextFunc()("invalidColor","Color value is invalid")),super.setValue(e,t),i&&!t&&this.dispatchLocalEvent({type:"colorChanged"}),this}onColorChanged(e){this.addManagedListeners(this,{colorChanged:()=>e(this.color.fromString(this.value))})}}},te=[],tt=class extends m._AgComponentStub{constructor(e){super(`<div class="ag-color-panel" tabindex="-1">
            <div data-ref="spectrumColor" class="ag-spectrum-color">
                <div class="ag-spectrum-sat ag-spectrum-fill">
                    <div data-ref="spectrumVal" class="ag-spectrum-val ag-spectrum-fill">
                        <div data-ref="spectrumDragger" class="ag-spectrum-dragger"></div>
                    </div>
                </div>
            </div>
            <div class="ag-spectrum-tools">
                <div data-ref="spectrumHue" class="ag-spectrum-hue ag-spectrum-tool">
                    <div class="ag-spectrum-hue-background"></div>
                    <div data-ref="spectrumHueSlider" class="ag-spectrum-slider"></div>
                </div>
                <div data-ref="spectrumAlpha" class="ag-spectrum-alpha ag-spectrum-tool">
                    <div class="ag-spectrum-alpha-background"></div>
                    <div data-ref="spectrumAlphaSlider" class="ag-spectrum-slider"></div>
                </div>
                <ag-color-input data-ref="colorInput"></ag-color-input>
                <div data-ref="recentColors" class="ag-recent-colors"></div>
            </div>
        </div>`,[e9]),this.H=1,this.S=1,this.B=1,this.A=1,this.isSpectrumDragging=!1,this.isSpectrumHueDragging=!1,this.isSpectrumAlphaDragging=!1,this.colorChanged=!1,this.spectrumColor=m.RefPlaceholder,this.spectrumVal=m.RefPlaceholder,this.spectrumDragger=m.RefPlaceholder,this.spectrumHue=m.RefPlaceholder,this.spectrumHueSlider=m.RefPlaceholder,this.spectrumAlpha=m.RefPlaceholder,this.spectrumAlphaSlider=m.RefPlaceholder,this.colorInput=m.RefPlaceholder,this.recentColors=m.RefPlaceholder,this.picker=e.picker}wireBeans(e){this._Color=e.agChartsExports._Util.Color}postConstruct(){this.initTabIndex(),this.initRecentColors(),this.addGuiEventListener("focus",()=>this.spectrumColor.focus()),this.addGuiEventListener("keydown",e=>{e.key!==m.KeyCode.ENTER||e.defaultPrevented||this.destroy()}),this.addManagedListeners(this.spectrumColor,{keydown:e=>this.moveDragger(e)}),this.addManagedListeners(this.spectrumAlphaSlider,{keydown:e=>this.moveAlphaSlider(e)}),this.addManagedListeners(this.spectrumHueSlider,{keydown:e=>this.moveHueSlider(e)}),this.addManagedListeners(this.spectrumVal,{mousedown:this.onSpectrumDraggerDown.bind(this)}),this.addManagedListeners(this.spectrumHue,{mousedown:this.onSpectrumHueDown.bind(this)}),this.addManagedListeners(this.spectrumAlpha,{mousedown:this.onSpectrumAlphaDown.bind(this)}),this.addGuiEventListener("mousemove",e=>{this.onSpectrumDraggerMove(e),this.onSpectrumHueMove(e),this.onSpectrumAlphaMove(e)}),this.addManagedListeners(document,{mouseup:this.onMouseUp.bind(this)}),this.colorInput.onColorChanged(this.setColor.bind(this)),this.addManagedListeners(this.recentColors,{click:this.onRecentColorClick.bind(this),keydown:e=>{(e.key===m.KeyCode.ENTER||e.key===m.KeyCode.SPACE)&&(e.preventDefault(),this.onRecentColorClick(e))}})}initTabIndex(){let e=this.tabIndex=this.gos.get("tabIndex").toString();this.spectrumColor.setAttribute("tabindex",e),this.spectrumHueSlider.setAttribute("tabindex",e),this.spectrumAlphaSlider.setAttribute("tabindex",e)}refreshSpectrumRect(){return this.spectrumValRect=this.spectrumVal.getBoundingClientRect()}refreshHueRect(){return this.spectrumHueRect=this.spectrumHue.getBoundingClientRect()}refreshAlphaRect(){return this.spectrumAlphaRect=this.spectrumAlpha.getBoundingClientRect()}onSpectrumDraggerDown(e){e.preventDefault(),this.refreshSpectrumRect(),this.isSpectrumDragging=!0,this.moveDragger(e)}onSpectrumDraggerMove(e){this.isSpectrumDragging&&this.moveDragger(e)}onSpectrumHueDown(e){this.refreshHueRect(),this.isSpectrumHueDragging=!0,this.moveHueSlider(e)}onSpectrumHueMove(e){this.isSpectrumHueDragging&&this.moveHueSlider(e)}onSpectrumAlphaDown(e){this.refreshAlphaRect(),this.isSpectrumAlphaDragging=!0,this.moveAlphaSlider(e)}onSpectrumAlphaMove(e){this.isSpectrumAlphaDragging&&this.moveAlphaSlider(e)}onMouseUp(){this.isSpectrumDragging=!1,this.isSpectrumHueDragging=!1,this.isSpectrumAlphaDragging=!1}moveDragger(e){let t,i,s=this.spectrumValRect;if(s){if(e instanceof MouseEvent)t=e.clientX-s.left,i=e.clientY-s.top;else{let s=e.key===m.KeyCode.LEFT,r=e.key===m.KeyCode.RIGHT,a=e.key===m.KeyCode.UP,l=e.key===m.KeyCode.DOWN,n=a||l,o=s||r;if(!n&&!o)return;e.preventDefault();let{x:d,y:h}=this.getSpectrumValue();t=d+(o?s?-5:5:0),i=h+(n?a?-5:5:0)}t=Math.min(t=Math.max(t,0),s.width),i=Math.min(i=Math.max(i,0),s.height),this.setSpectrumValue(t/s.width,1-i/s.height)}}moveHueSlider(e){let t=this.spectrumHueRect;if(!t)return;let i=this.moveSlider(this.spectrumHueSlider,e);null!=i&&(this.H=1-i/t.width,this.update())}moveAlphaSlider(e){let t=this.spectrumAlphaRect;if(!t)return;let i=this.moveSlider(this.spectrumAlphaSlider,e);null!=i&&(this.A=i/t.width,this.update())}moveSlider(e,t){let i,s=e.getBoundingClientRect(),r=e.parentElement?.getBoundingClientRect();if(!e||!r)return null;let a=s.width/2;if(t instanceof MouseEvent)i=Math.floor(t.clientX-r.left);else{let s=t.key===m.KeyCode.LEFT,r=t.key===m.KeyCode.RIGHT;if(!s&&!r)return null;t.preventDefault(),i=parseFloat(e.style.left)+a+(s?-5:5)}return i=Math.min(i=Math.max(i,0),r.width),e.style.left=i-a+"px",i}update(e){let{A:t,S:i,B:s,H:r,_Color:a}=this,l=360*r,n=a.fromHSB(l,i,s,t),o=n.toRgbaString(),d=a.fromHSB(l,i,s).toRgbaString(),h=a.fromHSB(l,1,1).toRgbaString(),u=this.picker;a.fromString(u.getValue()).toRgbaString()!==o&&(this.colorChanged=!0),u.setValue(o),this.spectrumColor.style.backgroundColor=h,this.spectrumDragger.style.backgroundColor=d,this.spectrumHueSlider.style.backgroundColor=h,this.spectrumAlpha.style.setProperty("--ag-internal-spectrum-alpha-color-from",a.fromHSB(l,i,s,0).toRgbaString()),this.spectrumAlpha.style.setProperty("--ag-internal-spectrum-alpha-color-to",d),this.spectrumAlpha.style.setProperty("--ag-internal-spectrum-alpha-color",o),e||this.colorInput.setColor(n)}setSpectrumValue(e,t,i){let s=this.spectrumValRect||this.refreshSpectrumRect();if(null==s)return;let r=this.spectrumDragger,a=r.getBoundingClientRect();e=Math.min(1,e=Math.max(0,e)),t=Math.min(1,t=Math.max(0,t)),this.S=e,this.B=t,r.style.left=e*s.width-a.width/2+"px",r.style.top=(1-t)*s.height-a.height/2+"px",this.update(i)}getSpectrumValue(){let e=this.spectrumDragger,t=e.getBoundingClientRect();return{x:parseFloat(e.style.left)+t.width/2,y:parseFloat(e.style.top)+t.height/2}}initRecentColors(){let e=te,t=e.map((e,t)=>`<div class="ag-recent-color" id=${t} style="background-color: ${e}; width: 15px; height: 15px;" recent-color="${e}" tabIndex="${this.tabIndex}"></div>`);this.recentColors.innerHTML=t.join(""),(0,m._setDisplayed)(this.recentColors,!!e.length)}setValue(e){let t=this._Color.fromString(e);this.setColor(t,!0)}setColor(e,t){let[i,s,r]=e.toHSB();this.H=(isNaN(i)?0:i)/360,this.A=e.a;let a=this.spectrumHueRect||this.refreshHueRect(),l=this.spectrumAlphaRect||this.refreshAlphaRect();this.spectrumHueSlider.style.left=`${-((this.H-1)*a.width)-this.spectrumHueSlider.getBoundingClientRect().width/2}px`,this.spectrumAlphaSlider.style.left=`${this.A*l.width-this.spectrumAlphaSlider.getBoundingClientRect().width/2}px`,this.setSpectrumValue(s,r,!t)}onRecentColorClick(e){let t=e.target;if(!(0,m._exists)(t.id))return;let i=parseInt(t.id,10);this.setValue(te[i]),this.destroy()}addRecentColor(){let e=this._Color.fromHSB(360*this.H,this.S,this.B,this.A).toRgbaString(),t=te;this.colorChanged&&t[0]!==e&&(t=t.filter(t=>t!=e),(t=[e].concat(t)).length>8&&(t=t.slice(0,8)),te=t)}destroy(){this.addRecentColor(),super.destroy()}},ti=class extends m._AgComponentStub{constructor(e){super(function(e){return e??(e=e||"default"),{tag:"div",cls:`ag-panel ag-${e}-panel`,attrs:{tabindex:"-1"},children:[{tag:"div",ref:"eTitleBar",cls:`ag-panel-title-bar ag-${e}-panel-title-bar ag-unselectable`,children:[{tag:"span",ref:"eTitle",cls:`ag-panel-title-bar-title ag-${e}-panel-title-bar-title`},{tag:"div",ref:"eTitleBarButtons",cls:`ag-panel-title-bar-buttons ag-${e}-panel-title-bar-buttons`}]},{tag:"div",ref:"eContentWrapper",cls:`ag-panel-content-wrapper ag-${e}-panel-content-wrapper`}]}}(e.cssIdentifier)),this.config=e,this.closable=!0,this.eContentWrapper=m.RefPlaceholder,this.eTitleBar=m.RefPlaceholder,this.eTitleBarButtons=m.RefPlaceholder,this.eTitle=m.RefPlaceholder,this.registerCSS(".ag-panel{background-color:var(--ag-panel-background-color);display:flex;flex-direction:column;overflow:hidden;position:relative}.ag-dialog{border:var(--ag-dialog-border);border-radius:var(--ag-border-radius);box-shadow:var(--ag-dialog-shadow);position:absolute}.ag-panel-title-bar{align-items:center;background-color:var(--ag-panel-title-bar-background-color);border-bottom:var(--ag-panel-title-bar-border);color:var(--ag-panel-title-bar-text-color);cursor:default;display:flex;flex:none;font-family:var(--ag-panel-title-bar-font-family);font-size:var(--ag-panel-title-bar-font-size);font-weight:var(--ag-panel-title-bar-font-weight);height:var(--ag-panel-title-bar-height);padding:var(--ag-spacing) var(--ag-cell-horizontal-padding)}.ag-panel-title-bar-button{cursor:pointer;:where(.ag-icon){color:var(--ag-panel-title-bar-icon-color)}}:where(.ag-ltr) .ag-panel-title-bar-button{margin-left:calc(var(--ag-spacing)*2);margin-right:var(--ag-spacing)}:where(.ag-rtl) .ag-panel-title-bar-button{margin-left:var(--ag-spacing);margin-right:calc(var(--ag-spacing)*2)}.ag-panel-title-bar-title{flex:1 1 auto}.ag-panel-title-bar-buttons{display:flex}.ag-panel-content-wrapper{display:flex;flex:1 1 auto;overflow:hidden;position:relative}:where(.ag-dragging-fill-handle) .ag-dialog,:where(.ag-dragging-range-handle) .ag-dialog{opacity:.7;pointer-events:none}")}postConstruct(){let e,{component:t,closable:i,hideTitleBar:s,title:r,minWidth:a=250,width:l,minHeight:n=250,height:o,centered:d,popup:h,x:u,y:c,postProcessPopupParams:p}=this.config,g=this.beans,f=this.createManagedBean(new m._AgPositionableFeature(this.getGui(),{minWidth:a,width:l,minHeight:n,height:o,centered:d,x:u,y:c,popup:h,calculateTopBuffer:()=>this.positionableFeature.getHeight()-this.getBodyHeight()}));this.positionableFeature=f;let C=this.getGui();if(t&&this.setBodyComponent(t),s?(0,m._setDisplayed)(this.eTitleBar,!1):(r&&this.setTitle(r),this.setClosable(null!=i?i:this.closable)),this.addManagedElementListeners(this.eTitleBar,{mousedown:e=>{if(C.contains(e.relatedTarget)||C.contains((0,m._getActiveDomElement)(g))||this.eTitleBarButtons.contains(e.target))return void e.preventDefault();let t=this.eContentWrapper.querySelector("button, [href], input, select, textarea, [tabindex]");t&&t.focus()}}),!(h&&f.isPositioned())){if(this.renderComponent&&this.renderComponent(),p){let{type:t,eventSource:i,mouseEvent:s}=p;e=()=>g.popupSvc?.callPostProcessPopup(p,t,C,i,s)}f.initialisePosition(e),this.eContentWrapper.style.height="0"}}renderComponent(){let e=this.getGui();e.focus(),this.close=()=>{e.remove(),this.destroy()}}getHeight(){return this.positionableFeature.getHeight()}setHeight(e){this.positionableFeature.setHeight(e)}getWidth(){return this.positionableFeature.getWidth()}setWidth(e){this.positionableFeature.setWidth(e)}setClosable(e){if(e!==this.closable&&(this.closable=e),e){let e=this.closeButtonComp=new m._AgComponentStub({tag:"div",cls:"ag-button"});this.createBean(e);let t=e.getGui(),i=this.beans.iconSvc.createIconNoSpan("close",this.beans);i.classList.add("ag-panel-title-bar-button-icon"),t.appendChild(i),this.addTitleBarButton(e),e.addManagedElementListeners(t,{click:this.onBtClose.bind(this)})}else this.closeButtonComp&&(this.closeButtonComp.getGui().remove(),this.closeButtonComp=this.destroyBean(this.closeButtonComp))}setBodyComponent(e){e.setParentComponent(this),this.eContentWrapper.appendChild(e.getGui())}addTitleBarButton(e,t){let i=this.eTitleBarButtons,s=i.children,r=s.length;null==t&&(t=r),t=Math.max(0,Math.min(t,r)),e.addCss("ag-panel-title-bar-button");let a=e.getGui();0===t?i.prepend(a):t===r?i.append(a):s[t-1].after(a),e.setParentComponent(this)}getBodyHeight(){return(0,m._getInnerHeight)(this.eContentWrapper)}getBodyWidth(){return(0,m._getInnerWidth)(this.eContentWrapper)}setTitle(e){this.eTitle.innerText=e}onBtClose(){this.close()}destroy(){this.closeButtonComp&&(this.closeButtonComp=this.destroyBean(this.closeButtonComp));let e=this.getGui();e&&(0,m._isVisible)(e)&&this.close(),super.destroy()}},ts=class extends ti{constructor(e,t){super({...e,popup:!0}),this.callbacks=t,this.isMaximizable=!1,this.isMaximized=!1,this.maximizeListeners=[],this.resizeListenerDestroy=null,this.lastPosition={x:0,y:0,width:0,height:0}}wireBeans(e){this.popupSvc=e.popupSvc}postConstruct(){let e=this.getGui(),{movable:t,resizable:i,maximizable:s,modal:r}=this.config;this.addCss("ag-dialog"),super.postConstruct(),this.tabGuardFeature=this.createManagedBean(new m._AgTabGuardFeature(this,this.callbacks?.stopPropagationCallbacks)),this.tabGuardFeature.initialiseTabGuard({isFocusableContainer:!0,onFocusIn:()=>{this.popupSvc?.bringPopupToFront(e)},onTabKeyDown:t=>{if(r)return;let i=t.shiftKey,s=(0,m._findNextFocusableElement)(this.beans,e,!1,i);(!s||this.tabGuardFeature.getTabGuardCtrl().isTabGuard(s))&&this.callbacks?.focusNextContainer(this.beans,i)&&t.preventDefault()}}),t&&this.setMovable(t),s&&this.setMaximizable(s),i&&this.setResizable(i),this.config.modal||this.callbacks?.configureFocusableContainer(this.beans,this)}setAllowFocus(e){this.tabGuardFeature.getTabGuardCtrl().setAllowFocus(e)}renderComponent(){let e=this.getGui(),{alwaysOnTop:t,modal:i,title:s,afterGuiAttached:r}=this.config,a=this.getLocaleTextFunc(),l=this.popupSvc?.addPopup({modal:i,eChild:e,closeOnEsc:!0,closedCallback:this.onClosed.bind(this),alwaysOnTop:t,ariaLabel:s||a("ariaLabelDialog","Dialog"),afterGuiAttached:r});l&&(this.close=l.hideFunc)}onClosed(e){this.destroy(),this.config.closedCallback?.(e)}setMaximized(e){this.isMaximizable&&e!==this.isMaximized&&this.toggleMaximize()}toggleMaximize(){let e=this.positionableFeature.getPosition();if(this.isMaximized){let{x:e,y:t,width:i,height:s}=this.lastPosition;this.setWidth(i),this.setHeight(s),this.positionableFeature.offsetElement(e,t)}else this.lastPosition.width=this.getWidth(),this.lastPosition.height=this.getHeight(),this.lastPosition.x=e.x,this.lastPosition.y=e.y,this.positionableFeature.offsetElement(0,0),this.setHeight("100%"),this.setWidth("100%");this.isMaximized=!this.isMaximized,this.refreshMaximizeIcon()}refreshMaximizeIcon(){(0,m._setDisplayed)(this.maximizeIcon,!this.isMaximized),(0,m._setDisplayed)(this.minimizeIcon,this.isMaximized)}clearMaximizebleListeners(){if(this.maximizeListeners.length){for(let e of this.maximizeListeners)e();this.maximizeListeners.length=0}this.resizeListenerDestroy&&(this.resizeListenerDestroy(),this.resizeListenerDestroy=null)}destroy(){this.maximizeButtonComp=this.destroyBean(this.maximizeButtonComp),this.clearMaximizebleListeners(),super.destroy()}setResizable(e){this.positionableFeature.setResizable(e)}setMovable(e){this.positionableFeature.setMovable(e,this.eTitleBar)}setMaximizable(e){if(!e){this.clearMaximizebleListeners(),this.maximizeButtonComp&&(this.destroyBean(this.maximizeButtonComp),this.maximizeButtonComp=this.maximizeIcon=this.minimizeIcon=void 0);return}let t=this.eTitleBar;if(!t||e===this.isMaximizable)return;this.isMaximizable=e;let i=this.buildMaximizeAndMinimizeElements();this.refreshMaximizeIcon(),i.addManagedElementListeners(i.getGui(),{click:this.toggleMaximize.bind(this)}),this.addTitleBarButton(i,0),this.maximizeListeners.push(...this.addManagedElementListeners(t,{dblclick:this.toggleMaximize.bind(this)})),[this.resizeListenerDestroy]=this.addManagedListeners(this.positionableFeature,{resize:()=>{this.isMaximized=!1,this.refreshMaximizeIcon()}})}buildMaximizeAndMinimizeElements(){let e=this.maximizeButtonComp=this.createBean(new m._AgComponentStub({tag:"div",cls:"ag-dialog-button"})),t=e.getGui(),i=this.beans.iconSvc;return this.maximizeIcon=i.createIconNoSpan("maximize"),t.appendChild(this.maximizeIcon),this.maximizeIcon.classList.add("ag-panel-title-bar-button-icon"),this.minimizeIcon=i.createIconNoSpan("minimize"),t.appendChild(this.minimizeIcon),this.minimizeIcon.classList.add("ag-panel-title-bar-button-icon"),e}},tr=class extends m.AgPickerField{constructor(e){super({pickerAriaLabelKey:"ariaLabelColorPicker",pickerAriaLabelValue:"Color Picker",pickerType:"ag-list",className:"ag-color-picker",pickerIcon:"chartsColorPicker",...e})}postConstruct(){this.eDisplayFieldColor=(0,m._createElement)({tag:"span",cls:"ag-color-picker-color"}),this.eDisplayFieldText=(0,m._createElement)({tag:"span",cls:"ag-color-picker-value"}),this.eDisplayField.append(this.eDisplayFieldColor,this.eDisplayFieldText),super.postConstruct(),this.value&&this.setValue(this.value)}createPickerComponent(){let e=this.eWrapper.getBoundingClientRect(),t=this.beans.popupSvc.getParentRect();return this.createBean(new ts({closable:!1,modal:!0,hideTitleBar:!0,minWidth:190,width:190,height:250,x:e.right-t.left-190,y:e.top-t.top-250-(this.config.pickerGap??0),postProcessPopupParams:{type:"colorPicker",eventSource:this.eWrapper}},this.config.dialogCallbacks))}renderAndPositionPicker(){let e=this.pickerComponent,t=this.createBean(new tt({picker:this}));return e.addCss("ag-color-dialog"),t.addDestroyFunc(()=>{e.isAlive()&&this.destroyBean(e)}),e.setParentComponent(this),e.setBodyComponent(t),t.setValue(this.getValue()),t.getGui().focus(),e.addDestroyFunc(()=>{this.isDestroyingPicker?this.isDestroyingPicker=!1:(this.beforeHidePicker(),this.isDestroyingPicker=!0,t.isAlive()&&this.destroyBean(t),this.isAlive()&&this.getFocusableElement().focus())}),()=>this.pickerComponent?.close()}setValue(e){return this.value===e?this:(this.eDisplayFieldColor.style.backgroundColor=e,this.eDisplayFieldText.textContent=this.beans.agChartsExports._Util.Color.fromString(e).toHexString().toUpperCase(),super.setValue(e))}getValue(){return this.value}},ta=class extends m._AgTabGuardComp{constructor(e){super(),this.setTemplateFromElement(e.getGui(),void 0,void 0,!0)}postConstruct(){this.initialiseTabGuard({onTabKeyDown:e=>this.onTabKeyDown(e),handleKeyDown:e=>this.handleKeyDown(e)})}handleKeyDown(e){e.key===m.KeyCode.ESCAPE&&this.closePanel()}onTabKeyDown(e){e.defaultPrevented||(this.closePanel(),e.preventDefault())}closePanel(){let e=this.parentComponent;e.closeSubMenu(),setTimeout(()=>e.getGui().focus(),0)}},tl=class extends m._AgBeanStub{constructor(e){super(),this.callbacks=e,this.ACTIVATION_DELAY=80,this.isActive=!1,this.subMenuIsOpen=!1,this.subMenuIsOpening=!1,this.suppressRootStyles=!0,this.suppressAria=!0,this.suppressFocus=!0}init(e){let{menuItemDef:t,isAnotherSubMenuOpen:i,level:s,childComponent:r,contextParams:a}=e;return this.params=e.menuItemDef,this.level=s,this.isAnotherSubMenuOpen=i,this.childComponent=r,this.contextParams=a,this.cssClassPrefix=this.params.menuItemParams?.cssClassPrefix??"ag-menu-option",this.callbacks.getMenuItemComp(this.beans,this.params,{...t,level:s,isAnotherSubMenuOpen:i,openSubMenu:e=>this.openSubMenu(e),closeSubMenu:()=>this.closeSubMenu(),closeMenu:e=>this.closeMenu(e),updateTooltip:(e,t)=>this.refreshTooltip(e,t),onItemActivated:()=>this.onItemActivated()}).then(e=>{if(!e)return;this.menuItemComp=e;let t=e.configureDefaults?.();t&&this.configureDefaults(!0===t?void 0:t)})}addListeners(e,t){t?.suppressClick||this.addManagedElementListeners(e,{click:e=>this.onItemSelected(e)}),t?.suppressKeyboardSelect||this.addManagedElementListeners(e,{keydown:e=>{(e.key===m.KeyCode.ENTER||e.key===m.KeyCode.SPACE)&&(e.preventDefault(),this.onItemSelected(e))}}),t?.suppressMouseDown||this.addManagedElementListeners(e,{mousedown:e=>{e.stopPropagation(),e.preventDefault()}}),t?.suppressMouseOver||this.addManagedElementListeners(e,{mouseenter:()=>this.onMouseEnter(),mouseleave:()=>this.onMouseLeave()})}isDisabled(){return!!this.params.disabled}openSubMenu(e=!1,t){let i;if(this.closeSubMenu(),!this.params.subMenu)return;this.subMenuIsOpening=!0;let s=(0,m._createElement)({tag:"div",cls:"ag-menu",role:"presentation"});this.eSubMenuGui=s;let r=()=>{this.subMenuIsOpening=!1};if(this.childComponent){let e=this.createBean(new ta(this.childComponent));e.setParentComponent(this);let t=e.getGui(),a="mouseenter",l=()=>this.cancelDeactivate();t.addEventListener(a,l),i=()=>{t.removeEventListener(a,l),this.destroyBean(e)},s.appendChild(t),this.childComponent.afterGuiAttached&&(r=()=>{this.childComponent.afterGuiAttached(),this.subMenuIsOpening=!1})}else if(this.params.subMenu){let t=this.createBean(new tn(this.level+1,this.contextParams,this.callbacks));t.setParentComponent(this),t.addMenuItems(this.params.subMenu),s.appendChild(t.getGui()),this.addManagedListeners(t,{closeMenu:e=>this.dispatchLocalEvent(e)}),t.addGuiEventListener("mouseenter",()=>this.cancelDeactivate()),i=()=>this.destroyBean(t),e&&(r=()=>{t.activateFirstItem(),this.subMenuIsOpening=!1})}let a=this.beans.popupSvc,l=()=>{let e=this.eGui;a?.positionPopupForMenu({eventSource:e,ePopup:s,event:t instanceof MouseEvent?t:void 0,additionalParams:this.callbacks.getPostProcessPopupParams(this.contextParams)})},n=this.getLocaleTextFunc(),o=a?.addPopup({modal:!0,eChild:s,positionCallback:l,anchorToElement:this.eGui,ariaLabel:n("ariaLabelSubMenu","SubMenu"),afterGuiAttached:r});this.subMenuIsOpen=!0,this.setAriaExpanded(!0),this.hideSubMenu=()=>{o&&o.hideFunc(),this.subMenuIsOpen=!1,this.setAriaExpanded(!1),i(),this.menuItemComp.setExpanded?.(!1),this.eSubMenuGui=void 0},this.menuItemComp.setExpanded?.(!0)}setAriaExpanded(e){this.suppressAria||(0,m._setAriaExpanded)(this.eGui,e)}closeSubMenu(){this.hideSubMenu&&(this.hideSubMenu(),this.hideSubMenu=null,this.setAriaExpanded(!1))}isSubMenuOpen(){return this.subMenuIsOpen}isSubMenuOpening(){return this.subMenuIsOpening}activate(e,t){this.cancelActivate(),(!this.params.disabled||t)&&(this.isActive=!0,this.suppressRootStyles||this.eGui.classList.add(`${this.cssClassPrefix}-active`),this.menuItemComp.setActive?.(!0),this.suppressFocus||this.callbacks.preserveRangesWhile(this.beans,()=>this.eGui.focus({preventScroll:!t})),e&&this.params.subMenu&&window.setTimeout(()=>{this.isAlive()&&this.isActive&&this.openSubMenu()},300),this.onItemActivated())}deactivate(){this.cancelDeactivate(),this.suppressRootStyles||this.eGui.classList.remove(`${this.cssClassPrefix}-active`),this.menuItemComp.setActive?.(!1),this.isActive=!1,this.subMenuIsOpen&&this.closeSubMenu()}getGui(){return this.menuItemComp.getGui()}getParentComponent(){return this.parentComponent}setParentComponent(e){this.parentComponent=e}getSubMenuGui(){return this.eSubMenuGui}onItemSelected(e){this.menuItemComp.select?.(),this.params.action?this.beans.frameworkOverrides.wrapOutgoing(()=>this.params.action(this.gos.addCommon({...this.contextParams}))):this.openSubMenu(e&&"keydown"===e.type,e),this.params.subMenu&&!this.params.action||this.params.suppressCloseOnSelect||this.closeMenu(e)}closeMenu(e){let t={type:"closeMenu"};e&&(e instanceof MouseEvent?t.mouseEvent=e:t.keyboardEvent=e),this.dispatchLocalEvent(t)}onItemActivated(){this.dispatchLocalEvent({type:"menuItemActivated",menuItem:this})}cancelActivate(){this.activateTimeoutId&&(window.clearTimeout(this.activateTimeoutId),this.activateTimeoutId=0)}cancelDeactivate(){this.deactivateTimeoutId&&(window.clearTimeout(this.deactivateTimeoutId),this.deactivateTimeoutId=0)}onMouseEnter(){this.cancelDeactivate(),this.isAnotherSubMenuOpen()?this.activateTimeoutId=window.setTimeout(()=>this.activate(!0),this.ACTIVATION_DELAY):this.activate(!0)}onMouseLeave(){this.cancelActivate(),this.isSubMenuOpen()?this.deactivateTimeoutId=window.setTimeout(()=>this.deactivate(),this.ACTIVATION_DELAY):this.deactivate()}refreshRootElementGui(e){let t=this.menuItemComp.getGui(),{cssClassPrefix:i,params:{cssClasses:s,disabled:r}}=this,a=this.menuItemComp.getRootElement?.();if(a&&(e||t.classList.add("ag-menu-option-custom"),t=a),this.suppressRootStyles=!!e,!this.suppressRootStyles){for(let e of(t.classList.add(i),s??[]))t.classList.add(e);r&&t.classList.add(`${i}-disabled`)}return t}applyAriaProperties(e){let{params:{checked:t,subMenu:i,subMenuRole:s,disabled:r}}=this;(0,m._setAriaRole)(e,null!=t?"menuitemcheckbox":"menuitem"),i&&(0,m._setAriaHasPopup)(e,s??"menu"),r&&(0,m._setAriaDisabled)(e,!0)}configureDefaults(e){if(!this.menuItemComp)return void setTimeout(()=>this.configureDefaults(e));let{suppressRootStyles:t,suppressTooltip:i,suppressAria:s,suppressTabIndex:r,suppressFocus:a}=e||{},{params:{tooltip:l,disabled:n}}=this,o=this.eGui=this.refreshRootElementGui(!!t);this.suppressAria=!!s,s||this.applyAriaProperties(o),r||o.setAttribute("tabindex","-1"),i||this.refreshTooltip(l),n||this.addListeners(o,e),this.suppressFocus=!!a}refreshTooltip(e,t){if(this.tooltip=e,this.tooltipFeature=this.destroyBean(this.tooltipFeature),!e||!this.menuItemComp)return;let i=this.beans.registry.createDynamicBean("tooltipFeature",!1,{getGui:()=>this.getGui(),getTooltipValue:()=>this.tooltip,getLocation:()=>"menu",shouldDisplayTooltip:t});i&&(this.tooltipFeature=this.createBean(i))}destroy(){this.tooltipFeature=this.destroyBean(this.tooltipFeature),this.menuItemComp?.destroy?.(),super.destroy()}},tn=class extends m._AgTabGuardComp{constructor(e=0,t,i){super({tag:"div",cls:"ag-menu-list",role:"menu"}),this.level=e,this.menuActionParams=t,this.callbacks=i,this.menuItems=[]}postConstruct(){this.initialiseTabGuard({onTabKeyDown:e=>this.onTabKeyDown(e),handleKeyDown:e=>this.callbacks.preserveRangesWhile(this.beans,()=>this.handleKeyDown(e)),onFocusIn:e=>this.handleFocusIn(e),onFocusOut:e=>this.handleFocusOut(e)})}onTabKeyDown(e){let t=this.getParentComponent();t?.getGui()?.classList.contains("ag-focus-managed")||e.preventDefault(),e.shiftKey&&this.closeIfIsChild(e)}handleKeyDown(e){switch(e.key){case m.KeyCode.UP:case m.KeyCode.RIGHT:case m.KeyCode.DOWN:case m.KeyCode.LEFT:e.preventDefault(),this.handleNavKey(e.key);break;case m.KeyCode.ESCAPE:this.closeIfIsChild()&&this.callbacks.stopPropagationCallbacks.stopPropagation(e)}}handleFocusIn(e){let t=e.relatedTarget;!this.tabGuardFeature.getTabGuardCtrl().isTabGuard(t)&&(this.getGui().contains(t)||this.activeMenuItem?.getSubMenuGui()?.contains(t))||(this.activeMenuItem?this.activeMenuItem.activate():this.activateFirstItem())}handleFocusOut(e){let t=e.relatedTarget;!(!this.activeMenuItem||this.getGui().contains(t)||this.activeMenuItem.getSubMenuGui()?.contains(t))&&(this.activeMenuItem.isSubMenuOpening()||this.activeMenuItem.deactivate())}clearActiveItem(){this.activeMenuItem&&(this.activeMenuItem.deactivate(),this.activeMenuItem=null)}addMenuItems(e){null!=e&&m.AgPromise.all(e.map(e=>"separator"===e?m.AgPromise.resolve({eGui:this.createSeparator()}):"string"==typeof e?(this.callbacks.warnNoItem?.(e),m.AgPromise.resolve({eGui:null})):this.addItem(e))).then(e=>{for(let t of e??[])t?.eGui&&(this.appendChild(t.eGui),t.comp&&this.menuItems.push(t.comp))})}addItem(e){let t=this.createManagedBean(new tl(this.callbacks));return t.init({menuItemDef:e,isAnotherSubMenuOpen:()=>this.menuItems.some(e=>e.isSubMenuOpen()),level:this.level,contextParams:this.menuActionParams}).then(()=>(t.setParentComponent(this),this.addManagedListeners(t,{closeMenu:e=>{this.dispatchLocalEvent(e)},menuItemActivated:e=>{this.activeMenuItem&&this.activeMenuItem!==e.menuItem&&this.activeMenuItem.deactivate(),this.activeMenuItem=e.menuItem}}),{comp:t,eGui:t.getGui()}))}activateFirstItem(){let e=this.menuItems.filter(e=>!e.isDisabled())[0];e&&e.activate()}createSeparator(){let e={tag:"div",cls:"ag-menu-separator-part"};return(0,m._createAgElement)({tag:"div",cls:"ag-menu-separator",attrs:{"aria-hidden":"true"},children:[e,e,e,e]})}handleNavKey(e){switch(e){case m.KeyCode.UP:case m.KeyCode.DOWN:{let t=this.findNextItem(e===m.KeyCode.UP);t&&t!==this.activeMenuItem&&t.activate(!1,!0);return}}e===(this.gos.get("enableRtl")?m.KeyCode.RIGHT:m.KeyCode.LEFT)?this.closeIfIsChild():this.openChild()}closeIfIsChild(e){let t=this.getParentComponent();return!!t&&t instanceof tl&&(e&&e.preventDefault(),t.closeSubMenu(),t.getGui().focus(),!0)}openChild(){this.activeMenuItem&&this.activeMenuItem.openSubMenu(!0)}findNextItem(e){let t,i=[...this.menuItems];if(!i.length)return;if(!this.activeMenuItem)return e?(0,m._last)(i):i[0];e&&i.reverse();let s=!1;for(let e of i){if(!s){e===this.activeMenuItem&&(s=!0);continue}t=e;break}return s&&!t?i[0]:t||this.activeMenuItem}destroy(){this.clearActiveItem(),super.destroy()}},to=class extends m._AgBeanStub{constructor(e){super(),this.params=e,this.destroyLoadingSpinner=null,this.lastPromise=0}hideActiveMenu(){this.destroyBean(this.activeMenu)}showMenu(e,t,i){let{getMenuItems:s,shouldBlockMenuOpen:r}=this.params,a=s(e,t);if((0,m._isPromise)(a)){let s=this.lastPromise+1;return this.lastPromise=s,this.destroyLoadingSpinner||this.createLoadingIcon(t),a.then(a=>{if(this.lastPromise!==s)return;let{target:l}=t,n=!l;a?.length&&(n||(0,m._isVisible)(l))&&!r?.()&&this.createContextMenu({menuItems:a,menuActionParams:e,mouseEvent:t,anchorToElement:i}),this.destroyLoadingSpinner?.()}),!0}return!!a?.length&&(this.createContextMenu({menuItems:a,menuActionParams:e,mouseEvent:t,anchorToElement:i}),!0)}createLoadingIcon(e){let{beans:t}=this,i=this.getLocaleTextFunc(),s=t.iconSvc.createIconNoSpan("loadingMenuItems"),r=(0,m._createAgElement)({tag:"div",cls:"ag-context-menu-loading-icon"});r.appendChild(s);let a=(0,m._getRootNode)(t),l=(0,m._getPageBody)(t);if(!l)return;l.appendChild(r),t.ariaAnnounce?.announceValue(i("ariaLabelLoadingContextMenu","Loading Context Menu"),"contextmenu"),t.environment.applyThemeClasses(r),(0,m._anchorElementToMouseMoveEvent)(r,e,t);let n=e=>{(0,m._anchorElementToMouseMoveEvent)(r,e,t)};a.addEventListener("mousemove",n),this.destroyLoadingSpinner=()=>{a.removeEventListener("mousemove",n),r.remove(),this.destroyLoadingSpinner=null}}createContextMenu(e){let{mapMenuItems:t,menuItemCallbacks:i,beforeMenuOpen:s,onMenuClose:r,afterMenuDestroyed:a,onVisibleChanged:l,onMenuOpen:n}=this.params,{menuItems:o,menuActionParams:d,mouseEvent:h,anchorToElement:u}=e,c=this.beans.popupSvc,p=new td(t?e=>t(o,d,e):()=>o,d,i);this.createBean(p);let g=p.getGui();s?.(d);let m={additionalParams:i.getPostProcessPopupParams(d),type:"contextMenu",mouseEvent:h,ePopup:g,nudgeY:1},f=this.getLocaleTextFunc(),C=c?.addPopup({modal:!0,eChild:g,closeOnEsc:!0,closedCallback:e=>{i.preserveRangesWhile(this.beans,()=>{r?.(),this.destroyBean(p),a?.(),l?.(!1,void 0===e?"api":"ui")})},click:h,positionCallback:()=>{let e=this.gos.get("enableRtl");c?.positionPopupUnderMouseEvent({...m,nudgeX:e?-((g.offsetWidth+1)*1):1})},anchorToElement:u,ariaLabel:f("ariaLabelContextMenu","Context Menu")});C&&(n?.(),p.afterGuiAttached({container:"contextMenu",hidePopup:C.hideFunc})),this.activeMenu&&this.hideActiveMenu(),this.activeMenu=p,p.addEventListener("destroyed",()=>{this.activeMenu===p&&(this.activeMenu=null)}),C&&p.addEventListener("closeMenu",e=>C.hideFunc({mouseEvent:e.mouseEvent??void 0,keyboardEvent:e.keyboardEvent??void 0,forceHide:!0}));let v=h&&h instanceof MouseEvent&&"mousedown"===h.type;l?.(!0,v?"api":"ui")}destroy(){this.destroyLoadingSpinner?.(),super.destroy()}},td=class extends m._AgComponentStub{constructor(e,t,i){super({tag:"div",cls:"ag-menu",role:"presentation"}),this.getMenuItems=e,this.menuActionParams=t,this.callbacks=i,this.menuList=null}postConstruct(){let e=this.createManagedBean(new tn(0,this.menuActionParams,this.callbacks)),t=this.getMenuItems(()=>this.getGui());e.addMenuItems(t),this.appendChild(e),this.menuList=e,e.addEventListener("closeMenu",e=>this.dispatchLocalEvent(e))}afterGuiAttached({hidePopup:e}){e&&this.addDestroyFunc(e);let t=this.menuList;t&&this.callbacks.preserveRangesWhile(this.beans,()=>(0,m._focusInto)(t.getGui()))}},th=class extends m._AgComponentStub{constructor(e){super({tag:"div"}),this.callbacks=e}init(e){this.params=e,this.cssClassPrefix=this.params.cssClassPrefix??"ag-menu-option",this.addAriaAttributes(),this.addIcon(),this.addName(),this.addShortcut(),this.addSubMenu()}configureDefaults(){return!0}addAriaAttributes(){let{checked:e,subMenu:t}=this.params,i=this.getGui();e&&(0,m._setAriaChecked)(i,e),t&&(0,m._setAriaExpanded)(i,!1)}addIcon(){if(this.params.isCompact)return;let e=(0,m._createAgElement)({tag:"span",ref:"eIcon",cls:`${this.getClassName("part")} ${this.getClassName("icon")}`,role:"presentation"}),{checked:t,icon:i}=this.params;t?e.appendChild(this.beans.iconSvc.createIconNoSpan("check")):i&&((0,m._isNodeOrElement)(i)?e.appendChild(i):"string"==typeof i?e.innerHTML=i:this.callbacks?.warnNoIcon?.()),this.getGui().appendChild(e)}addName(){let e=(0,m._createAgElement)({tag:"span",ref:"eName",cls:`${this.getClassName("part")} ${this.getClassName("text")}`,children:this.params.name||""});this.getGui().appendChild(e)}addShortcut(){if(this.params.isCompact)return;let e=(0,m._createAgElement)({tag:"span",ref:"eShortcut",cls:`${this.getClassName("part")} ${this.getClassName("shortcut")}`,children:this.params.shortcut||""});this.getGui().appendChild(e)}addSubMenu(){let e=(0,m._createAgElement)({tag:"span",ref:"ePopupPointer",cls:`${this.getClassName("part")} ${this.getClassName("popup-pointer")}`}),t=this.getGui();if(this.params.subMenu){let t=this.gos.get("enableRtl")?"subMenuOpenRtl":"subMenuOpen";e.appendChild(this.beans.iconSvc.createIconNoSpan(t))}t.appendChild(e)}getClassName(e){return`${this.cssClassPrefix}-${e}`}};function tu(e,t){if(!t)return null;let i=(0,m._findFocusableElements)(e),s=i.indexOf(t);if(-1===s)return null;let r=-1;for(let e=s-1;e>=0;e--)if(i[e].classList.contains(m.TabGuardClassNames.TAB_GUARD_TOP)){r=e;break}return r<=0?null:i[r-1]}function tc(e,t){if(!t)return!1;let i=e.querySelectorAll(`.${m._FOCUS_MANAGED_CLASS}`);if(!i.length)return!1;for(let e=0;e<i.length;e++)if(i[e].contains(t))return!0;return!1}var tp=class extends m._AgTabGuardComp{constructor(e){super(function(e){return{tag:"div",cls:`ag-tabs ${e}`,children:[{tag:"div",ref:"eHeader"},{tag:"div",ref:"eBody",role:"presentation",cls:` ${e}-body`}]}}(e.cssClass)),this.eHeader=m.RefPlaceholder,this.eBody=m.RefPlaceholder,this.items=[],this.tabbedItemScrollMap=new Map,this.params=e}postConstruct(){if(this.setupHeader(),this.params.items)for(let e of this.params.items)this.addItem(e);this.initialiseTabGuard({onTabKeyDown:this.onTabKeyDown.bind(this),handleKeyDown:this.handleKeyDown.bind(this),focusInnerElement:this.focusInnerElement.bind(this),focusTrapActive:!0}),this.addDestroyFunc(()=>this.activeItem?.tabbedItem?.afterDetachedCallback?.())}setupHeader(){let{enableCloseButton:e,cssClass:t}=this.params,i=(e,i)=>{e.classList.add(`ag-tabs-${i}`),t&&e.classList.add(`${t}-${i}`)};e?(this.setupCloseButton(i),this.eTabHeader=(0,m._createAgElement)({tag:"div",role:"presentation"}),i(this.eHeader,"header-wrapper"),this.eHeader.appendChild(this.eTabHeader)):this.eTabHeader=this.eHeader,(0,m._setAriaRole)(this.eTabHeader,"tablist"),i(this.eTabHeader,"header")}setupCloseButton(e){let t=(0,m._createAgElement)({tag:"button"});e(t,"close-button");let i=this.beans.iconSvc.createIconNoSpan("close");(0,m._setAriaLabel)(t,this.params.closeButtonAriaLabel),t.appendChild(i),this.addManagedElementListeners(t,{click:()=>this.params.onCloseClicked?.()});let s=(0,m._createAgElement)({tag:"div",role:"presentation"});e(s,"close-button-wrapper"),s.appendChild(t),this.eHeader.appendChild(s),this.eCloseButton=t}handleKeyDown(e){switch(e.key){case m.KeyCode.RIGHT:case m.KeyCode.LEFT:{if(!this.eTabHeader.contains((0,m._getActiveDomElement)(this.beans)))return;let t=e.key===m.KeyCode.RIGHT,i=this.gos.get("enableRtl"),s=this.items.indexOf(this.activeItem),r=t!==i?Math.min(s+1,this.items.length-1):Math.max(s-1,0);if(s===r)return;e.preventDefault();let a=this.items[r];this.showItemWrapper(a),a.eHeaderButton.focus();break}case m.KeyCode.UP:case m.KeyCode.DOWN:e.stopPropagation()}}onTabKeyDown(e){if(e.defaultPrevented)return;let{beans:t,eHeader:i,eBody:s,activeItem:r,params:a}=this,{suppressTrapFocus:l,enableCloseButton:n}=a,o=(0,m._getActiveDomElement)(t),d=e.target,h=e.shiftKey;if(i.contains(o)){e.preventDefault(),n&&h&&!this.eCloseButton?.contains(o)?this.eCloseButton?.focus():l&&h?tu((0,m._getDocument)(t).body,d)?.focus():this.focusBody(e.shiftKey);return}let u=null;(tc(s,d)&&(h&&(u=tu(s,d)),u||l||(u=r.eHeaderButton)),!(!u&&s.contains(o))||(u=(0,m._findNextFocusableElement)(t,s,!1,h)))?u&&(e.preventDefault(),u.focus()):l&&!h?this.forceFocusOutOfContainer(h):n&&!h?(e.preventDefault(),this.eCloseButton?.focus()):(e.preventDefault(),this.focusHeader())}focusInnerElement(e){return e?this.focusBody(!0):(this.focusHeader(),!0)}focusHeader(e){this.activeItem.eHeaderButton.focus({preventScroll:e})}focusBody(e){return(0,m._focusInto)(this.eBody,e)}setAfterAttachedParams(e){this.afterAttachedParams=e}showFirstItem(){this.items.length>0&&this.showItemWrapper(this.items[0])}addItem(e){let t=(0,m._createAgElement)({tag:"span",cls:"ag-tab",role:"tab",attrs:{tabindex:"-1"}});t.appendChild(e.title),this.eTabHeader.appendChild(t),(0,m._setAriaLabel)(t,e.titleLabel);let i={tabbedItem:e,eHeaderButton:t};this.items.push(i),t.addEventListener("click",this.showItemWrapper.bind(this,i))}showItem(e){let t=this.items.find(t=>t.tabbedItem===e);t&&this.showItemWrapper(t)}showItemWrapper(e){let{tabbedItem:t,eHeaderButton:i}=e;(this.params.onItemClicked?.({item:t}),this.activeItem===e)?this.params.onActiveItemClicked?.():(this.lastScrollListener&&(this.lastScrollListener=this.lastScrollListener()),(0,m._clearElement)(this.eBody),t.bodyPromise.then(e=>{this.eBody.appendChild(e);let i=!(0,m._isKeyboardMode)();if(this.params.suppressFocusBodyOnOpen||(0,m._focusInto)(this.eBody,!1,i),t.afterAttachedCallback&&t.afterAttachedCallback(this.afterAttachedParams),this.params.keepScrollPosition){let i=t.getScrollableContainer?.()||e;[this.lastScrollListener]=this.addManagedElementListeners(i,{scroll:()=>{this.tabbedItemScrollMap.set(t.name,i.scrollTop)}});let s=this.tabbedItemScrollMap.get(t.name);void 0!==s&&setTimeout(()=>{i.scrollTop=s},0)}}),this.activeItem&&(this.activeItem.eHeaderButton.classList.remove("ag-tab-selected"),this.activeItem.tabbedItem.afterDetachedCallback?.()),i.classList.add("ag-tab-selected"),this.activeItem=e)}},tg=class extends m._AgComponentStub{constructor(e={}){super(function(e){let t=e.cssIdentifier||"default",i=e.direction||"vertical";return{tag:"div",cls:`ag-group ag-${t}-group`,role:"presentation",children:[{tag:"div",ref:"eToolbar",cls:`ag-group-toolbar ag-${t}-group-toolbar`,children:[{tag:"ag-checkbox",ref:"cbGroupEnabled"}]},{tag:"div",ref:"eContainer",cls:`ag-group-container ag-group-container-${i} ag-${t}-group-container`}]}}(e),[m.AgCheckboxSelector]),this.params=e,this.suppressEnabledCheckbox=!0,this.suppressToggleExpandOnEnableChange=!1,this.eToolbar=m.RefPlaceholder,this.cbGroupEnabled=m.RefPlaceholder,this.eContainer=m.RefPlaceholder,this.registerCSS(".ag-group{position:relative;width:100%}.ag-group-title-bar{align-items:center;display:flex;padding:var(--ag-spacing)}.ag-group-title{display:inline;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}:where(.ag-group-title-bar) .ag-group-title{cursor:default}.ag-group-toolbar{align-items:center;display:flex;padding:var(--ag-spacing)}.ag-group-container{display:flex}.ag-disabled .ag-group-container{pointer-events:none}.ag-disabled-group-container,.ag-disabled-group-title-bar{opacity:.5}.ag-group-container-horizontal{flex-flow:row wrap}.ag-group-container-vertical{flex-direction:column}.ag-group-title-bar-icon{cursor:pointer;flex:none}:where(.ag-ltr) .ag-group-title-bar-icon{margin-right:var(--ag-spacing)}:where(.ag-rtl) .ag-group-title-bar-icon{margin-left:var(--ag-spacing)}:where(.ag-group-item-alignment-stretch) .ag-group-item{align-items:stretch}:where(.ag-group-item-alignment-start) .ag-group-item{align-items:flex-start}:where(.ag-group-item-alignment-end) .ag-group-item{align-items:flex-end}");const{enabled:t,items:i,suppressEnabledCheckbox:s,expanded:r,suppressToggleExpandOnEnableChange:a,useToggle:l}=e;this.cssIdentifier=e.cssIdentifier||"default",this.enabled=null==t||t,this.items=i||[],this.useToggle=l??!1,this.alignItems=e.alignItems||"center",this.expanded=null==r||r,null!=s&&(this.suppressEnabledCheckbox=s),null!=a&&(this.suppressToggleExpandOnEnableChange=a)}postConstruct(){if(this.setupTitleBar(),this.items.length){let e=this.items;this.items=[],this.addItems(e)}let e=this.getLocaleTextFunc();this.cbGroupEnabled.setLabel(e("enabled","Enabled")),this.enabled&&this.setEnabled(this.enabled,void 0,!0),this.setAlignItems(this.alignItems);let{onEnableChange:t,onExpandedChange:i,suppressOpenCloseIcons:s}=this.params;this.hideEnabledCheckbox(this.suppressEnabledCheckbox),this.hideOpenCloseIcons(s??!1),this.refreshChildDisplay(),(0,m._setDisplayed)(this.eContainer,this.expanded),this.cbGroupEnabled.onValueChange(e=>{this.setEnabled(e,!0,this.suppressToggleExpandOnEnableChange),this.dispatchEnableChangeEvent(e)}),null!=t&&this.onEnableChange(t),null!=i&&this.onExpandedChange(i)}refreshChildDisplay(){(0,m._setDisplayed)(this.eToolbar,this.expanded&&!this.suppressEnabledCheckbox),this.eTitleBar?.refreshOnExpand(this.expanded)}isExpanded(){return this.expanded}setAlignItems(e){this.alignItems!==e&&this.removeCss(`ag-group-item-alignment-${this.alignItems}`),this.alignItems=e;let t=`ag-group-item-alignment-${this.alignItems}`;return this.addCss(t),this}toggleGroupExpand(e,t){if(this.eTitleBar?.isSuppressCollapse()&&!this.useToggle)e=!0,t=!0;else if(e=null!=e?e:!this.expanded,this.expanded===e)return this;return this.expanded=e,this.refreshChildDisplay(),(0,m._setDisplayed)(this.eContainer,e),t||this.dispatchLocalEvent({type:e?"expanded":"collapsed"}),this}addItems(e){for(let t of e)this.addItem(t)}prependItem(e){this.insertItem(e,!0)}addItem(e){this.insertItem(e,!1)}updateItems(e){let t=this.items,i=0;for(let s=0;s<t.length;++s){let r=t[s];if(r===e[i])i++;else{let e=(0,m._isComponent)(r)?r.getGui():r;(0,m._removeFromParent)(e)}}for(;i<e.length;)this.insertItem(e[i++]);this.items=e}insertItem(e,t){let i=this.eContainer,s=(0,m._isComponent)(e)?e.getGui():e;s.classList.add("ag-group-item",`ag-${this.cssIdentifier}-group-item`),t?(i.prepend(s),this.items.unshift(s)):(i.appendChild(s),this.items.push(s))}hideItem(e,t){let i=this.items[t];(0,m._setDisplayed)(i,!e)}getItemIndex(e){let t=(0,m._isComponent)(e)?e.getGui():e;return this.items.indexOf(t)}setTitle(e){return this.eTitleBar?.setTitle(e),this}addTitleBarWidget(e){return this.eTitleBar?.addWidget(e),this}addCssClassToTitleBar(e){this.eTitleBar?.addCss(e)}dispatchEnableChangeEvent(e){this.dispatchLocalEvent({type:"enableChange",enabled:e})}setEnabled(e,t,i){return this.enabled=e,this.refreshDisabledStyles(),i||this.toggleGroupExpand(e),t||(this.cbGroupEnabled.setValue(e),this.eToggle?.setValue(e)),this}isEnabled(){return this.enabled}onEnableChange(e){return this.addManagedListeners(this,{enableChange:t=>e(t.enabled)}),this}onExpandedChange(e){return this.addManagedListeners(this,{expanded:()=>e(!0),collapsed:()=>e(!1)}),this}hideEnabledCheckbox(e){return this.suppressEnabledCheckbox=e,this.refreshChildDisplay(),this.refreshDisabledStyles(),this}hideOpenCloseIcons(e){return this.eTitleBar?.hideOpenCloseIcons(e),this}refreshDisabledStyles(){let e=!this.enabled;this.eContainer.classList.toggle("ag-disabled",e),this.eTitleBar?.refreshDisabledStyles(this.suppressEnabledCheckbox&&e),this.eContainer.classList.toggle("ag-disabled-group-container",e)}setupTitleBar(){let e=this.useToggle?this.createToggleTitleBar():this.createDefaultTitleBar();this.eToolbar.insertAdjacentElement("beforebegin",e.getGui())}createDefaultTitleBar(){let e=this.createManagedBean(new tf(this.params));return this.eTitleBar=e,e.refreshOnExpand(this.expanded),this.addManagedListeners(e,{expandedChanged:e=>this.toggleGroupExpand(e.expanded)}),e}createToggleTitleBar(){let e=this.createManagedBean(new m.AgToggleButton({value:this.enabled,label:this.params.title,labelAlignment:"left",labelWidth:"flex",onValueChange:e=>{this.setEnabled(e,!0),this.dispatchEnableChangeEvent(e)}}));return e.addCss("ag-group-title-bar"),e.addCss(`ag-${this.params.cssIdentifier??"default"}-group-title-bar ag-unselectable`),this.eToggle=e,this.toggleGroupExpand(this.enabled),e}},tm="ag-disabled-group-title-bar",tf=class extends m._AgComponentStub{constructor(e={}){super(function(e){let t=e.cssIdentifier??"default";return{tag:"div",cls:`ag-group-title-bar ag-${t}-group-title-bar ag-unselectable`,role:e.suppressKeyboardNavigation?"presentation":"group",children:[{tag:"span",ref:"eGroupOpenedIcon",cls:`ag-group-title-bar-icon ag-${t}-group-title-bar-icon`,role:"presentation"},{tag:"span",ref:"eGroupClosedIcon",cls:`ag-group-title-bar-icon ag-${t}-group-title-bar-icon`,role:"presentation"},{tag:"span",ref:"eTitle",cls:`ag-group-title ag-${t}-group-title`}]}}(e)),this.suppressOpenCloseIcons=!1,this.suppressKeyboardNavigation=!1,this.eGroupOpenedIcon=m.RefPlaceholder,this.eGroupClosedIcon=m.RefPlaceholder,this.eTitle=m.RefPlaceholder;const{title:t,suppressOpenCloseIcons:i,suppressKeyboardNavigation:s}=e;t&&t.length>0&&(this.title=t),null!=i&&(this.suppressOpenCloseIcons=i),this.suppressKeyboardNavigation=s??!1}postConstruct(){this.setTitle(this.title),this.hideOpenCloseIcons(this.suppressOpenCloseIcons),this.setupExpandContract()}setupExpandContract(){let e=this.beans.iconSvc;this.eGroupClosedIcon.appendChild(e.createIconNoSpan("accordionClosed")),this.eGroupOpenedIcon.appendChild(e.createIconNoSpan("accordionOpen")),this.addManagedElementListeners(this.getGui(),{click:()=>this.dispatchExpandChanged(),keydown:e=>{switch(e.key){case m.KeyCode.ENTER:case m.KeyCode.SPACE:e.preventDefault(),this.dispatchExpandChanged();break;case m.KeyCode.RIGHT:case m.KeyCode.LEFT:e.preventDefault(),this.dispatchExpandChanged(e.key===m.KeyCode.RIGHT)}}})}refreshOnExpand(e){this.refreshAriaStatus(e),this.refreshOpenCloseIcons(e)}refreshAriaStatus(e){this.suppressOpenCloseIcons||(0,m._setAriaExpanded)(this.getGui(),e)}refreshOpenCloseIcons(e){let t=!this.suppressOpenCloseIcons;(0,m._setDisplayed)(this.eGroupOpenedIcon,t&&e),(0,m._setDisplayed)(this.eGroupClosedIcon,t&&!e)}isSuppressCollapse(){return this.suppressOpenCloseIcons}dispatchExpandChanged(e){this.dispatchLocalEvent({type:"expandedChanged",expanded:e})}setTitle(e){let t=this.getGui(),i=!!e&&e.length>0;e=i?e:void 0,this.eTitle.textContent=e??"",(0,m._setDisplayed)(t,i),e!==this.title&&(this.title=e);let s=t.classList.contains(tm);return this.refreshDisabledStyles(s),this}addWidget(e){return this.getGui().appendChild(e),this}hideOpenCloseIcons(e){return this.suppressOpenCloseIcons=e,e&&this.dispatchExpandChanged(!0),this}refreshDisabledStyles(e){let t=this.getGui();e?(t.classList.add(tm),t.removeAttribute("tabindex"),(0,m._setAriaRole)(t,"presentation")):(t.classList.remove(tm),"string"!=typeof this.title||this.suppressKeyboardNavigation?(t.removeAttribute("tabindex"),(0,m._setAriaRole)(t,"presentation")):(this.activateTabIndex([t]),(0,m._setAriaRole)(t,"group")))}},tC={selector:"AG-GROUP-COMPONENT",component:tg},tv="35.1.0",tb={moduleName:"EnterpriseCore",version:tv,beans:[w],icons:{accordionOpen:"tree-open",accordionClosed:"tree-closed",accordionIndeterminate:"tree-indeterminate",close:"cross",cancel:"cancel",maximize:"maximize",minimize:"minimize",columnDrag:"grip"},dependsOn:[],setLicenseKey:w.setLicenseKey},ty={ariaAdvancedFilterBuilderItem:e=>`${e[0]}. Level ${e[1]}. Press ENTER to edit`,ariaAdvancedFilterBuilderItemValidation:e=>`${e[0]}. Level ${e[1]}. ${e[2]} Press ENTER to edit`,ariaAdvancedFilterBuilderList:"Advanced Filter Builder List",ariaAdvancedFilterBuilderFilterItem:"Filter Condition",ariaAdvancedFilterBuilderGroupItem:"Filter Group",ariaAdvancedFilterBuilderColumn:"Column",ariaAdvancedFilterBuilderOption:"Option",ariaAdvancedFilterBuilderValue:"Value",ariaAdvancedFilterBuilderJoinOperator:"Join Operator",ariaAdvancedFilterInput:"Advanced Filter Input",ariaLabelAdvancedFilterAutocomplete:"Advanced Filter Autocomplete",advancedFilterContains:"contains",advancedFilterNotContains:"does not contain",advancedFilterTextEquals:"equals",advancedFilterTextNotEqual:"does not equal",advancedFilterStartsWith:"begins with",advancedFilterEndsWith:"ends with",advancedFilterBlank:"is blank",advancedFilterNotBlank:"is not blank",advancedFilterEquals:"=",advancedFilterNotEqual:"!=",advancedFilterGreaterThan:">",advancedFilterGreaterThanOrEqual:">=",advancedFilterLessThan:"<",advancedFilterLessThanOrEqual:"<=",advancedFilterTrue:"is true",advancedFilterFalse:"is false",advancedFilterAnd:"AND",advancedFilterOr:"OR",advancedFilterApply:"Apply",advancedFilterReset:"Reset",advancedFilterCancel:"Cancel",advancedFilterClear:"Clear",advancedFilterBuilder:"Builder",advancedFilterValidationMissingColumn:"Column is missing",advancedFilterValidationMissingOption:"Option is missing",advancedFilterValidationMissingValue:"Value is missing",advancedFilterValidationInvalidColumn:"Column not found",advancedFilterValidationInvalidOption:"Option not found",advancedFilterValidationMissingQuote:"Value is missing an end quote",advancedFilterValidationNotANumber:"Value is not a number",advancedFilterValidationNotABigInt:"Value is not a big integer",advancedFilterValidationInvalidDate:"Value is not a valid date",advancedFilterValidationMissingCondition:"Condition is missing",advancedFilterValidationJoinOperatorMismatch:"Join operators within a condition must be the same",advancedFilterValidationInvalidJoinOperator:"Join operator not found",advancedFilterValidationMissingEndBracket:"Missing end bracket",advancedFilterValidationExtraEndBracket:"Too many end brackets",advancedFilterValidationMessage:e=>`Expression has an error. ${e[0]} - ${e[1]}.`,advancedFilterValidationMessageAtEnd:e=>`Expression has an error. ${e[0]} at end of expression.`,advancedFilterBuilderTitle:"Advanced Filter",advancedFilterBuilderApply:"Apply",advancedFilterBuilderCancel:"Cancel",advancedFilterBuilderClear:"Clear",advancedFilterBuilderReset:"Reset",advancedFilterBuilderAddButtonTooltip:"Add Filter or Group",advancedFilterBuilderRemoveButtonTooltip:"Remove",advancedFilterBuilderMoveUpButtonTooltip:"Move Up",advancedFilterBuilderMoveDownButtonTooltip:"Move Down",advancedFilterBuilderAddJoin:"Add Group",advancedFilterBuilderAddCondition:"Add Filter",advancedFilterBuilderSelectColumn:"Select a column",advancedFilterBuilderSelectOption:"Select an option",advancedFilterBuilderEnterValue:"Enter a value...",advancedFilterBuilderValidationAlreadyApplied:"Current filter already applied.",advancedFilterBuilderValidationIncomplete:"Not all conditions are complete.",advancedFilterBuilderValidationSelectColumn:"Must select a column.",advancedFilterBuilderValidationSelectOption:"Must select an option.",advancedFilterBuilderValidationEnterValue:"Must enter a value."};function tw(e,t,i){if(!e)return"";let s=i-t;return s?e.slice(0,e.length-s):e}function tS(e,t,i,s,r,a,l){let n=i+(!e.length||l?0:1),o=0;return r&&(" "===e[n]?o=1:(s+=" ",a&&(s+='"'))),{updatedValue:e.slice(0,t)+s+e.slice(n),updatedPosition:t+s.length+o}}function tx(e,t,i,s){let r=t,a=!1;for(;r<e.length;){let t=e[r];if("("===t){s&&" "===e[r-1]?a=!0:r-=1;break}if(" "===t||i&&")"===t){r-=1;break}r++}return{endPosition:r,isEmpty:a}}function tF(e,t,i,s){i!==t&&(e.expression=tS(e.expression,s-t.length+1,s,i).updatedValue)}var tA=class{constructor(e,t){this.params=e,this.startPosition=t,this.type="column",this.valid=!0,this.hasStartChar=!1,this.hasEndChar=!1,this.colName=""}parse(e,t){if(e!==tT||this.colName)if(e===tP&&this.hasStartChar){if(this.parseColumn(!1,t))return this.hasEndChar=!0,!1;this.colName+=e}else this.colName+=e;else this.hasStartChar=!0}getDisplayValue(){return(this.hasStartChar?tT:"")+this.colName+(this.hasEndChar?tP:"")}getColId(){return this.colId}complete(e){this.parseColumn(!0,e)}getValidationError(){return this.valid?null:{message:this.params.advFilterExpSvc.translate("advancedFilterValidationInvalidColumn"),startPosition:this.startPosition,endPosition:this.endPosition??this.params.expression.length-1}}parseColumn(e,t){this.endPosition=t;let i=this.params.advFilterExpSvc.getColId(this.colName);return i&&this.hasStartChar&&(this.colId=i.colId,tF(this.params,this.colName,i.columnName,t-1),this.colName=i.columnName,this.column=this.params.colModel.getColDefCol(this.colId),this.column)?(this.baseCellDataType=this.params.dataTypeSvc?.getBaseDataType(this.column)??"text",!0):(e&&(this.valid=!1),this.baseCellDataType="text",!1)}},tM=class{constructor(e,t,i){this.params=e,this.startPosition=t,this.baseCellDataType=i,this.type="operator",this.valid=!0,this.expectedNumOperands=0,this.operator=""}parse(e,t){if(" "===e||")"===e){if(this.parseOperator(!1,t-1))return!0;this.operator+=e}else this.operator+=e}complete(e){this.parseOperator(!0,e)}getValidationError(){return this.valid?null:{message:this.params.advFilterExpSvc.translate("advancedFilterValidationInvalidOption"),startPosition:this.startPosition,endPosition:this.endPosition??this.params.expression.length-1}}getDisplayValue(){return this.operator}getOperatorKey(){return this.parsedOperator}parseOperator(e,t){let i=this.params.advFilterExpSvc.getDataTypeExpressionOperator(this.baseCellDataType),s=i.findOperator(this.operator);if(this.endPosition=t,s){this.parsedOperator=s;let e=i.operators[s];this.expectedNumOperands=e.numOperands;let r=e.displayValue;return tF(this.params,this.operator,r,t),this.operator=r,!0}return(e||null!==s)&&(this.valid=!1),!1}},tR=class{constructor(e,t,i,s){this.params=e,this.startPosition=t,this.baseCellDataType=i,this.column=s,this.type="operand",this.valid=!0,this.operand="",this.validationMessage=null,this.filterValidationSetters={number:()=>{(this.quotes||isNaN(this.modelValue))&&(this.valid=!1,this.validationMessage=this.params.advFilterExpSvc.translate("advancedFilterValidationNotANumber"))},bigint:()=>{(this.quotes||null===(0,m._parseBigIntOrNull)(this.modelValue))&&(this.valid=!1,this.validationMessage=this.params.advFilterExpSvc.translate("advancedFilterValidationNotABigInt"))},date:e=>{null==e&&(this.valid=!1,this.validationMessage=this.params.advFilterExpSvc.translate("advancedFilterValidationInvalidDate"))},dateString:(...e)=>this.filterValidationSetters.date(...e),dateTime:(...e)=>this.filterValidationSetters.date(...e),dateTimeString:(...e)=>this.filterValidationSetters.date(...e),boolean(){},object(){},text(){}}}parse(e,t){if(" "===e)if(!this.quotes)return this.parseOperand(!1,t),!0;else this.operand+=e;else if(")"===e)if("number"===this.baseCellDataType||!this.quotes)return this.parseOperand(!1,t-1),!0;else this.operand+=e;else if(this.operand||this.quotes||"'"!==e&&'"'!==e)if(this.quotes&&e===this.quotes)return this.parseOperand(!1,t),!1;else this.operand+=e;else this.quotes=e}complete(e){this.parseOperand(!0,e)}getValidationError(){return this.validationMessage?{message:this.validationMessage,startPosition:this.startPosition,endPosition:this.endPosition??this.params.expression.length-1}:null}getRawValue(){return this.operand}getModelValue(){return this.modelValue}parseOperand(e,t){let{advFilterExpSvc:i}=this.params;if(this.endPosition=t,this.modelValue=this.operand,e&&this.quotes)this.valid=!1,this.validationMessage=i.translate("advancedFilterValidationMissingQuote");else if(""===this.modelValue)this.valid=!1,this.validationMessage=i.translate("advancedFilterValidationMissingValue");else{let e=i.getOperandModelValue(this.operand,this.baseCellDataType,this.column);null!=e&&(this.modelValue=e),this.filterValidationSetters[this.baseCellDataType](e)}}},tT="[",tP="]",tI=class{constructor(e,t){this.params=e,this.startPosition=t,this.isAwaiting=!0,this.operandValueGetters={number:Number,bigint:e=>(0,m._parseBigIntOrNull)(e),date:e=>this.params.valueSvc.parseValue(this.columnParser.column,null,e,void 0),dateString:e=>this.operandValueGetters.date(e),dateTime:e=>this.operandValueGetters.date(e),dateTimeString:e=>this.operandValueGetters.date(e),boolean:e=>e,object:e=>e,text:e=>e}}parseExpression(){let e=this.startPosition,{expression:t}=this.params;for(;e<t.length;){let i=t[e];if(" "===i&&this.isAwaiting);else{if(this.isAwaiting=!1,!this.parser){let t;this.columnParser?this.operatorParser?(this.operandParser=new tR(this.params,e,this.columnParser.baseCellDataType,this.columnParser.column),t=this.operandParser):(this.operatorParser=new tM(this.params,e,this.columnParser.baseCellDataType),t=this.operatorParser):(this.columnParser=new tA(this.params,e),t=this.columnParser),this.parser=t}let t=this.parser.parse(i,e);if(null!=t){if(this.isComplete())return this.returnEndPosition(t?e-1:e,!0);this.parser=void 0,this.isAwaiting=!0}}e++}return this.parser?.complete?.(e-1),this.returnEndPosition(e)}isValid(){return this.isComplete()&&this.columnParser.valid&&this.operatorParser.valid&&(!this.operandParser||this.operandParser.valid)}getValidationError(){let e,t=this.columnParser?.getValidationError()??this.operatorParser?.getValidationError()??this.operandParser?.getValidationError();if(t)return t;let i=this.params.expression.length;return(this.columnParser?this.operatorParser?this.operatorParser.expectedNumOperands&&!this.operandParser&&(e="advancedFilterValidationMissingValue"):e="advancedFilterValidationMissingOption":e="advancedFilterValidationMissingColumn",e)?{message:this.params.advFilterExpSvc.translate(e),startPosition:i,endPosition:i}:null}getFunction(e){return this.getFunctionCommon(e,(e,t,i,s)=>(r,a,l)=>l.operators[t].evaluator(r.getValue(i,a),a,l.evaluatorParams[s],null==e?void 0:l.operands[e]))}getAutocompleteListParams(e){return this.isColumnPosition(e)?this.getColumnAutocompleteListParams(e):this.isOperatorPosition(e)?this.getOperatorAutocompleteListParams(e):this.isBeyondEndPosition(e)?void 0:{enabled:!1}}updateExpression(e,t,i){let{expression:s}=this.params;if(this.isColumnPosition(e))return tS(this.params.expression,this.startPosition,this.columnParser?.getColId()?this.columnParser.endPosition:tx(s,e).endPosition,this.params.advFilterExpSvc.getColumnValue(t),!0);if(this.isOperatorPosition(e)){let r,a=this.getBaseCellDataTypeFromOperatorAutocompleteType(i),l=this.hasOperand(a,t.key),n=l&&this.doesOperandNeedQuotes(a);if(this.operatorParser?.startPosition!=null&&e<this.operatorParser.startPosition)r=tS(s,e,e,t.displayValue??t.key,l,n);else{let i,a=!1;if(this.operatorParser?.getOperatorKey())i=this.operatorParser.endPosition;else{let{endPosition:t,isEmpty:r}=tx(s,e,!0,!0);i=t,a=r}r=tS(s,function(e,t,i){let s=t;for(;s<i&&" "===e[s];)s++;return s}(s,this.columnParser.endPosition+1,i),i,t.displayValue??t.key,l,n,a)}return{...r,hideAutocomplete:!l}}return null}getModel(){let e=this.columnParser.getColId(),t={filterType:this.columnParser.baseCellDataType,colId:e,type:this.operatorParser.getOperatorKey()};return this.operatorParser.expectedNumOperands&&(t.filter=this.operandParser.getModelValue()),t}getFunctionCommon(e,t){let i=this.columnParser.getColId(),s=this.operatorParser?.getOperatorKey(),{operators:r,evaluatorParams:a,operands:l}=e,n=this.params.advFilterExpSvc.getExpressionOperator(this.columnParser.baseCellDataType,s),o=this.addToListAndGetIndex(r,n),d=this.params.advFilterExpSvc.getExpressionEvaluatorParams(i),h=this.addToListAndGetIndex(a,d);return t(this.operatorParser?.expectedNumOperands===0?void 0:this.addToListAndGetIndex(l,this.getOperandValue()),o,i,h)}getOperandValue(){let{baseCellDataType:e,column:t}=this.columnParser,i=this.operandValueGetters[e](this.operandParser.getRawValue());return"dateString"===e||"dateTimeString"===e?this.params.dataTypeSvc?.getDateParserFunction(t)(i)??i:i}isComplete(){return!!(this.operatorParser&&(!this.operatorParser.expectedNumOperands||this.operatorParser.expectedNumOperands&&this.operandParser))}isColumnPosition(e){return this.columnParser?.endPosition==null||e<=this.columnParser.endPosition+1}isOperatorPosition(e){return this.operatorParser?.endPosition==null||e<=this.operatorParser.endPosition+1}isBeyondEndPosition(e){return this.isComplete()&&null!=this.endPosition&&e>this.endPosition+1&&this.endPosition+1<this.params.expression.length}returnEndPosition(e,t){return this.endPosition=t?e:e-1,e}getColumnAutocompleteListParams(e){return this.params.advFilterExpSvc.generateAutocompleteListParams(this.params.advFilterExpSvc.getColumnAutocompleteEntries(),"column",this.getColumnSearchString(e))}getColumnSearchString(e){let t=this.columnParser?.getDisplayValue()??"",i=tw(t,e,this.columnParser?.endPosition==null?this.params.expression.length:this.columnParser.endPosition+1),s=this.columnParser?.hasStartChar&&i.length>0,r=this.columnParser?.hasEndChar&&i.length===t.length+2;return s?i.slice(1,r?-1:void 0):i}getOperatorAutocompleteListParams(e){let t=this.columnParser?.column;if(!t)return{enabled:!1};let i=this.columnParser.baseCellDataType,s=this.operatorParser?.startPosition!=null&&e<this.operatorParser.startPosition?"":tw(this.operatorParser?.getDisplayValue()??"",e,this.operatorParser?.endPosition==null?this.params.expression.length:this.operatorParser.endPosition+1);return this.params.advFilterExpSvc.generateAutocompleteListParams(this.params.advFilterExpSvc.getOperatorAutocompleteEntries(t,i),`operator-${i}`,s)}getBaseCellDataTypeFromOperatorAutocompleteType(e){return e?.replace("operator-","")}hasOperand(e,t){return!e||!t||(this.params.advFilterExpSvc.getExpressionOperator(e,t)?.numOperands??0)>0}doesOperandNeedQuotes(e){return"number"!==e&&"bigint"!==e}addToListAndGetIndex(e,t){let i=e.length;return e.push(t),i}};function tE(e,t,i){let s=!1,r=e.toLocaleLowerCase(),a=r+" ",l=Object.keys(t).find(e=>{let l=i(t[e]).toLocaleLowerCase();return l.startsWith(a)&&(s=!0),l===r});return l||(s?null:void 0)}function tD(e,t){return(t??Object.keys(e)).map(t=>({key:t,displayValue:e[t].displayValue}))}var tk=class{constructor(e){this.params=e,this.initOperators()}getEntries(e){return tD(this.operators,e)}findOperator(e){return tE(e,this.operators,({displayValue:e})=>e)}initOperators(){let{translate:e}=this.params;this.operators={contains:{displayValue:e("advancedFilterContains"),evaluator:(e,t,i,s)=>this.evaluateExpression(e,t,i,s,!1,(e,t)=>e.includes(t)),numOperands:1},notContains:{displayValue:e("advancedFilterNotContains"),evaluator:(e,t,i,s)=>this.evaluateExpression(e,t,i,s,!0,(e,t)=>!e.includes(t)),numOperands:1},equals:{displayValue:e("advancedFilterTextEquals"),evaluator:(e,t,i,s)=>this.evaluateExpression(e,t,i,s,!1,(e,t)=>e===t),numOperands:1},notEqual:{displayValue:e("advancedFilterTextNotEqual"),evaluator:(e,t,i,s)=>this.evaluateExpression(e,t,i,s,!0,(e,t)=>e!=t),numOperands:1},startsWith:{displayValue:e("advancedFilterStartsWith"),evaluator:(e,t,i,s)=>this.evaluateExpression(e,t,i,s,!1,(e,t)=>e.startsWith(t)),numOperands:1},endsWith:{displayValue:e("advancedFilterEndsWith"),evaluator:(e,t,i,s)=>this.evaluateExpression(e,t,i,s,!1,(e,t)=>e.endsWith(t)),numOperands:1},blank:{displayValue:e("advancedFilterBlank"),evaluator:e=>null==e||"string"==typeof e&&0===e.trim().length,numOperands:0},notBlank:{displayValue:e("advancedFilterNotBlank"),evaluator:e=>null!=e&&("string"!=typeof e||e.trim().length>0),numOperands:0}}}evaluateExpression(e,t,i,s,r,a){return null==e?r:i.caseSensitive?a(i.valueConverter(e,t),s):a(i.valueConverter(e,t).toLocaleLowerCase(),s.toLocaleLowerCase())}},tL=class{constructor(e){this.params=e,this.initOperators()}getEntries(e){return tD(this.operators,e)}findOperator(e){return tE(e,this.operators,({displayValue:e})=>e)}initOperators(){let{translate:e,equals:t}=this.params;this.operators={equals:{displayValue:e("advancedFilterEquals"),evaluator:(e,i,s,r)=>this.evaluateSingleOperandExpression(e,i,s,r,!!s.includeBlanksInEquals,t),numOperands:1},notEqual:{displayValue:e("advancedFilterNotEqual"),evaluator:(e,i,s,r)=>this.evaluateSingleOperandExpression(e,i,s,r,!!s.includeBlanksInEquals,(e,i)=>!t(e,i)),numOperands:1},greaterThan:{displayValue:e("advancedFilterGreaterThan"),evaluator:(e,t,i,s)=>this.evaluateSingleOperandExpression(e,t,i,s,!!i.includeBlanksInGreaterThan,(e,t)=>e>t),numOperands:1},greaterThanOrEqual:{displayValue:e("advancedFilterGreaterThanOrEqual"),evaluator:(e,t,i,s)=>this.evaluateSingleOperandExpression(e,t,i,s,!!i.includeBlanksInGreaterThan,(e,t)=>e>=t),numOperands:1},lessThan:{displayValue:e("advancedFilterLessThan"),evaluator:(e,t,i,s)=>this.evaluateSingleOperandExpression(e,t,i,s,!!i.includeBlanksInLessThan,(e,t)=>e<t),numOperands:1},lessThanOrEqual:{displayValue:e("advancedFilterLessThanOrEqual"),evaluator:(e,t,i,s)=>this.evaluateSingleOperandExpression(e,t,i,s,!!i.includeBlanksInLessThan,(e,t)=>e<=t),numOperands:1},blank:{displayValue:e("advancedFilterBlank"),evaluator:e=>null==e,numOperands:0},notBlank:{displayValue:e("advancedFilterNotBlank"),evaluator:e=>null!=e,numOperands:0}}}evaluateSingleOperandExpression(e,t,i,s,r,a){return null==e?r:a(i.valueConverter(e,t),s)}},tN=class{constructor(e){this.params=e,this.initOperators()}getEntries(e){return tD(this.operators,e)}findOperator(e){return tE(e,this.operators,({displayValue:e})=>e)}initOperators(){let{translate:e}=this.params;this.operators={true:{displayValue:e("advancedFilterTrue"),evaluator:e=>!!e,numOperands:0},false:{displayValue:e("advancedFilterFalse"),evaluator:e=>!1===e,numOperands:0},blank:{displayValue:e("advancedFilterBlank"),evaluator:e=>null==e,numOperands:0},notBlank:{displayValue:e("advancedFilterNotBlank"),evaluator:e=>null!=e,numOperands:0}}}},tG=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="advFilterExpSvc",this.filterOperandGetters={number:e=>(0,m._toStringOrNull)(e.filter)??"",bigint:e=>(0,m._toStringOrNull)(e.filter)??"",date:e=>{let t=this.colModel.getColDefCol(e.colId);return t?this.valueSvc.formatValue(t,null,(0,m._parseDateTimeFromString)((0,m._toStringOrNull)(e.filter)??"")):null},dateTime:e=>this.filterOperandGetters.date(e),dateString:e=>{let t=this.colModel.getColDefCol(e.colId);if(!t)return null;let{filter:i}=e,s=this.dataTypeSvc?.getDateFormatterFunction(t),r=s?.((0,m._parseDateTimeFromString)((0,m._toStringOrNull)(e.filter)??"")??void 0)??i;return this.valueSvc.formatValue(t,null,r)},dateTimeString:e=>this.filterOperandGetters.dateString(e),boolean:()=>null,object:()=>null,text:()=>null},this.operandModelValueGetters={number:e=>(0,m._exists)(e)?Number(e):null,bigint:e=>e,date:(e,t,i)=>(0,m._serialiseDate)(this.valueSvc.parseValue(t,null,e,void 0),!!this.dataTypeSvc?.getDateIncludesTimeFlag(i)),dateTime:(...e)=>this.operandModelValueGetters.date(...e),dateString:(e,t,i)=>{let s=this.valueSvc.parseValue(t,null,e,void 0);return this.dataTypeSvc?(0,m._serialiseDate)(this.dataTypeSvc.getDateParserFunction(t)(s)??null,this.dataTypeSvc.getDateIncludesTimeFlag(i)):s},dateTimeString:(...e)=>this.operandModelValueGetters.dateString(...e),boolean:e=>e,object:e=>e,text:e=>e},this.columnNameToIdMap={},this.columnAutocompleteEntries=null,this.expressionEvaluatorParams={}}wireBeans(e){this.valueSvc=e.valueSvc,this.colModel=e.colModel,this.colNames=e.colNames,this.dataTypeSvc=e.dataTypeSvc}postConstruct(){this.expressionJoinOperators=this.generateExpressionJoinOperators(),this.expressionOperators=this.generateExpressionOperators()}parseJoinOperator(e){let{type:t}=e;return this.expressionJoinOperators[t]??t}getColumnDisplayValue(e){let t,{colId:i}=e,s=this.getColumnAutocompleteEntries().find(({key:e})=>e===i);return s?(t=s.displayValue,this.columnNameToIdMap[t.toLocaleUpperCase()]={colId:i,columnName:t}):t=i,t}getOperatorDisplayValue(e){return this.getExpressionOperator(e.filterType,e.type)?.displayValue??e.type}getOperandModelValue(e,t,i){return this.operandModelValueGetters[t](e,i,t)}getOperandDisplayValue(e,t){let{filter:i,filterType:s}=e;if(null==i)return"";let r=this.filterOperandGetters[s](e);return"number"!==s&&"bigint"!==s&&(r??(r=(0,m._toStringOrNull)(i)??""),t||(r=`"${r}"`)),t?r:` ${r}`}parseColumnFilterModel(e){let t=this.getColumnDisplayValue(e)??"",i=this.getOperatorDisplayValue(e)??"",s=this.getOperandDisplayValue(e);return`[${t}] ${i}${s}`}updateAutocompleteCache(e,t){if("column"===t){let{key:t,displayValue:i}=e;this.columnNameToIdMap[e.displayValue.toLocaleUpperCase()]={colId:t,columnName:i}}}translate(e,t){let i=ty[e];return"function"==typeof i&&(i=i(t)),this.getLocaleTextFunc()(e,i,t)}generateAutocompleteListParams(e,t,i){return{enabled:!0,type:t,searchString:i,entries:e}}getColumnAutocompleteEntries(){if(this.columnAutocompleteEntries)return this.columnAutocompleteEntries;let e=this.colModel.getColDefCols()??[],t=[],i=this.gos.get("includeHiddenColumnsInAdvancedFilter");for(let s of e)s.getColDef().filter&&(i||s.isVisible()||s.isRowGroupActive())&&t.push({key:s.getColId(),displayValue:this.colNames.getDisplayNameForColumn(s,"advancedFilter")});return t.sort((e,t)=>{let i=e.displayValue??"",s=t.displayValue??"";return i<s?-1:+(s>i)}),t}getOperatorAutocompleteEntries(e,t){let i=this.getActiveOperators(e);return this.getDataTypeExpressionOperator(t).getEntries(i)}getJoinOperatorAutocompleteEntries(){return Object.entries(this.expressionJoinOperators).map(([e,t])=>({key:e,displayValue:t}))}getDefaultAutocompleteListParams(e){return this.generateAutocompleteListParams(this.getColumnAutocompleteEntries(),"column",e)}getDataTypeExpressionOperator(e){return this.expressionOperators[e]}getExpressionOperator(e,t){return this.getDataTypeExpressionOperator(e)?.operators?.[t]}getExpressionJoinOperators(){return this.expressionJoinOperators}getColId(e){let t=e.toLocaleUpperCase(),i=this.columnNameToIdMap[t];if(i)return i;let s=this.getColumnAutocompleteEntries().find(({displayValue:e})=>e.toLocaleUpperCase()===t);if(s){let{key:e,displayValue:i}=s,r={colId:e,columnName:i};return this.columnNameToIdMap[t]=r,r}return null}getExpressionEvaluatorParams(e){let t=this.expressionEvaluatorParams[e];if(t)return t;let i=this.colModel.getColDefCol(e);if(!i)return{valueConverter:e=>e};switch(this.dataTypeSvc?.getBaseDataType(i)){case"dateTimeString":case"dateString":t={valueConverter:this.dataTypeSvc?.getDateParserFunction(i)??(e=>e)};break;case"object":t=i.getColDef().filterValueGetter?{valueConverter:e=>e}:{valueConverter:(e,t)=>this.valueSvc.formatValue(i,t,e)??("function"==typeof e.toString?e.toString():"")};break;case"text":case void 0:t={valueConverter:e=>(0,m._toStringOrNull)(e)};break;default:t={valueConverter:e=>e}}let{filterParams:s}=i.getColDef();return s&&["caseSensitive","includeBlanksInEquals","includeBlanksInLessThan","includeBlanksInGreaterThan"].forEach(e=>{let i=s[e];i&&(t[e]=i)}),this.expressionEvaluatorParams[e]=t,t}getColumnDetails(e){let t=this.colModel.getColDefCol(e)??void 0,i=(t?this.dataTypeSvc?.getBaseDataType(t):void 0)??"text";return{column:t,baseCellDataType:i}}generateExpressionOperators(){let e=(e,t)=>this.translate(e,t),t={translate:e,equals:(e,t)=>e.getTime()===t.getTime()};return{text:new tk({translate:e}),boolean:new tN({translate:e}),object:new tk({translate:e}),number:new tL({translate:e,equals:(e,t)=>e===t}),bigint:new tL({translate:e,equals:(e,t)=>e===t}),date:new tL(t),dateString:new tL(t),dateTime:new tL(t),dateTimeString:new tL(t)}}getColumnValue({displayValue:e}){return`${tT}${e}${tP}`}generateExpressionJoinOperators(){return{AND:this.translate("advancedFilterAnd"),OR:this.translate("advancedFilterOr")}}getActiveOperators(e){let t=e.getColDef().filterParams?.filterOptions;if(t)return t.every(e=>"string"==typeof e)?t:void 0}resetColumnCaches(){this.columnAutocompleteEntries=null,this.columnNameToIdMap={},this.expressionEvaluatorParams={}}},tO={stopPropagationCallbacks:m._STOP_PROPAGATION_CALLBACKS,focusNextContainer:(e,t)=>(0,m._focusNextGridCoreContainer)(e,t),configureFocusableContainer:(e,t)=>{let i=e.ctrlsSvc.get("gridCtrl");i.addFocusableContainer(t),t.addDestroyFunc(()=>i.removeFocusableContainer(t))}},tB=class extends ts{constructor(e){super(e,tO)}},tV=".ag-autocomplete{align-items:center;display:flex;width:100%;>:where(.ag-text-field){flex:1 1 auto}}.ag-autocomplete-list-popup{background-color:var(--ag-background-color);border-radius:var(--ag-border-radius);box-shadow:var(--ag-dropdown-shadow);padding:0;position:absolute;-webkit-user-select:none;-moz-user-select:none;user-select:none}.ag-autocomplete-list{height:calc(var(--ag-row-height)*6.5);min-width:200px;position:relative;width:100%}.ag-autocomplete-virtual-list-item{cursor:default;display:flex;height:var(--ag-list-item-height);&:focus-visible:after{content:none}}.ag-autocomplete-virtual-list-item:hover{background-color:var(--ag-row-hover-color)}.ag-autocomplete-row{align-items:center;display:flex;flex:1 1 auto;overflow:hidden}.ag-autocomplete-row-label{margin:0 var(--ag-widget-container-horizontal-padding);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ag-autocomplete-row-selected{background-color:var(--ag-selected-row-background-color)}",t_=class extends e5{constructor(e){super(m._STOP_PROPAGATION_CALLBACKS,e)}},tz={tag:"div",cls:"ag-autocomplete-row",role:"presentation",children:[{tag:"div",cls:"ag-autocomplete-row-label"}]},tH=class extends m.Component{constructor(){super(tz),this.hasHighlighting=!1}setState(e,t){this.value=e,this.render(),this.updateSelected(t)}updateSelected(e){this.toggleCss("ag-autocomplete-row-selected",e)}setSearchString(e){let t=!1,{value:i}=this;if(i&&(0,m._exists)(e)){let s=i.toLocaleLowerCase().indexOf(e.toLocaleLowerCase());if(s>=0){t=!0,this.hasHighlighting=!0;let r=s+e.length,a=this.getGui().lastElementChild;(0,m._clearElement)(a),a.append(i.slice(0,s),(0,m._createElement)({tag:"b",children:i.slice(s,r)}),i.slice(r))}}!t&&this.hasHighlighting&&(this.hasHighlighting=!1,this.render())}render(){this.getGui().lastElementChild.textContent=this.value??""}},tU={tag:"div",cls:"ag-autocomplete-list-popup",children:[{tag:"div",ref:"eList",cls:"ag-autocomplete-list"}]},tW=class extends m.AgPopupComponent{constructor(e){super(tU),this.params=e,this.eList=m.RefPlaceholder,this.searchString="",this.lastAutoListHeight=null}postConstruct(){this.autocompleteEntries=this.params.autocompleteEntries,this.virtualList=this.createManagedBean(new t_({cssIdentifier:"autocomplete"})),this.virtualList.setComponentCreator(this.createRowComponent.bind(this)),this.eList.appendChild(this.virtualList.getGui()),this.virtualList.setModel({getRowCount:()=>this.autocompleteEntries.length,getRow:e=>this.autocompleteEntries[e]});let e=this.virtualList.getGui();this.addManagedListeners(e,{click:()=>this.params.onConfirmed(),mousemove:this.onMouseMove.bind(this),mousedown:e=>e.preventDefault()}),this.setSelectedValue(0),this.updateListHeight()}onNavigationKeyDown(e,t){e.preventDefault();let i=this.autocompleteEntries.indexOf(this.selectedValue),s=t===m.KeyCode.UP?i-1:i+1;this.checkSetSelectedValue(s)}setSearch(e){this.searchString=e,(0,m._exists)(e)?this.runSearch():(this.autocompleteEntries=this.params.autocompleteEntries,this.virtualList.refresh(),this.checkSetSelectedValue(0),this.updateListHeight()),this.updateSearchInList()}runContainsSearch(e,t){let i,s=!1,r=e.toLocaleLowerCase(),a=t.filter(e=>{let t=e.toLocaleLowerCase().indexOf(r),a=0===t,l=t>=0;return l&&(!i||!s&&a||s===a&&e.length<i.length)&&(i=e,s=a),l});return!i&&a.length&&(i=a[0]),{topMatch:i,allMatches:a}}runStartsWithSearch(e,t){let i=e.toLocaleLowerCase(),s=t.filter(e=>e.toLocaleLowerCase().startsWith(i));return{topMatch:s[0],allMatches:s}}runSearch(){let e,t,{autocompleteEntries:i,useFuzzySearch:s,useStartsWithSearch:r,forceLastSelection:a}=this.params,l=i.map(e=>e.displayValue??e.key);if(s)t=(e=(0,m._fuzzySuggestions)({inputValue:this.searchString,allSuggestions:l,hideIrrelevant:!0}).values).length?e[0]:void 0;else{let i=r?this.runStartsWithSearch(this.searchString,l):this.runContainsSearch(this.searchString,l);e=i.allMatches,t=i.topMatch}let n=i.filter(({key:t,displayValue:i})=>e.includes(i??t));if(!n.length&&this.selectedValue&&a?.(this.selectedValue,this.searchString)&&(n=[this.selectedValue]),this.autocompleteEntries=n,this.virtualList.refresh(),this.updateListHeight(),!t)return;let o=e.indexOf(t);this.checkSetSelectedValue(o)}updateSearchInList(){this.virtualList.forEachRenderedRow(e=>e.setSearchString(this.searchString))}updateListHeight(){if(!this.params.autoSizeList)return;let e=this.autocompleteEntries.length,t=this.virtualList.getRowHeight(),i=this.params.maxVisibleItems??e,s=Math.min(e,i)*t;0===e&&(s=t),this.lastAutoListHeight!==s&&(this.lastAutoListHeight=s,this.eList.style.height=`${s}px`,(0,m._isVisible)(this.eList)&&this.params.onListHeightChanged?.())}checkSetSelectedValue(e){e>=0&&e<this.autocompleteEntries.length&&this.setSelectedValue(e)}setSelectedValue(e){let t=this.autocompleteEntries[e];this.selectedValue!==t&&(this.selectedValue=t,this.virtualList.ensureIndexVisible(e),this.virtualList.forEachRenderedRow((t,i)=>{t.updateSelected(e===i)}))}createRowComponent(e){let t=new tH;return this.createBean(t),t.setState(e.displayValue??e.key,e===this.selectedValue),t}onMouseMove(e){let t=this.virtualList,i=t.getGui().getBoundingClientRect(),s=t.getScrollTop(),r=Math.floor((e.clientY-i.top+s)/t.getRowHeight());this.checkSetSelectedValue(r)}afterGuiAttached(){this.virtualList.refresh(),this.updateListHeight()}getSelectedValue(){return this.autocompleteEntries.length?this.selectedValue??null:null}},tK={tag:"div",cls:"ag-autocomplete",role:"presentation",children:[{tag:"ag-input-text-field",ref:"eAutocompleteInput"}]},t$={selector:"AG-AUTOCOMPLETE",component:class extends m.Component{constructor(){super(tK,[m.AgInputTextFieldSelector]),this.eAutocompleteInput=m.RefPlaceholder,this.isListOpen=!1,this.lastPosition=0,this.valid=!0,this.registerCSS(tV)}wireBeans(e){this.popupSvc=e.popupSvc}postConstruct(){this.eAutocompleteInput.onValueChange(e=>this.onValueChanged(e)),this.eAutocompleteInput.getInputElement().setAttribute("autocomplete","off"),this.addGuiEventListener("keydown",this.onKeyDown.bind(this)),this.addGuiEventListener("click",this.updatePositionAndList.bind(this)),this.addDestroyFunc(()=>{this.destroyBean(this.autocompleteList)}),this.addGuiEventListener("focusout",()=>this.onFocusOut())}onValueChanged(e){let t=(0,m._makeNull)(e);this.updateValue(t),this.updateAutocompleteList(t)}updateValue(e){this.updateLastPosition(),this.dispatchLocalEvent({type:"eventValueChanged",value:e}),this.validate(e)}updateAutocompleteList(e){let t=this.listGenerator?.(e,this.lastPosition)??{enabled:!1};(!t.type||t.type!==this.autocompleteListParams?.type)&&this.isListOpen&&this.closeList();let i=this.isListOpen;if(this.autocompleteListParams=t,t?.enabled){i||this.openList();let{searchString:e}=t;this.autocompleteList.setSearch(e??"")}else i&&this.closeList()}onKeyDown(e){let t=e.key;switch(this.updateLastPosition(),t){case m.KeyCode.ENTER:this.onEnterKeyDown(e);break;case m.KeyCode.TAB:this.onTabKeyDown(e);break;case m.KeyCode.DOWN:case m.KeyCode.UP:this.onUpDownKeyDown(e,t);break;case m.KeyCode.LEFT:case m.KeyCode.RIGHT:case m.KeyCode.PAGE_HOME:case m.KeyCode.PAGE_END:setTimeout(()=>{this.updatePositionAndList()});break;case m.KeyCode.ESCAPE:this.onEscapeKeyDown(e);break;case m.KeyCode.SPACE:e.ctrlKey&&!this.isListOpen&&(e.preventDefault(),this.forceOpenList())}}confirmSelection(){let e=this.autocompleteList?.getSelectedValue();e&&(this.closeList(),this.dispatchLocalEvent({type:"eventOptionSelected",value:this.getValue(),position:this.lastPosition,updateEntry:e,autocompleteType:this.autocompleteListParams.type}))}onTabKeyDown(e){this.isListOpen&&(e.preventDefault(),e.stopPropagation(),this.confirmSelection())}onEnterKeyDown(e){e.preventDefault(),this.isListOpen?this.confirmSelection():this.onCompleted()}onUpDownKeyDown(e,t){e.preventDefault(),this.isListOpen?this.autocompleteList?.onNavigationKeyDown(e,t):this.forceOpenList()}onEscapeKeyDown(e){this.isListOpen&&(e.preventDefault(),e.stopPropagation(),this.closeList(),this.setCaret(this.lastPosition,!0))}onFocusOut(){this.isListOpen&&this.closeList()}updatePositionAndList(){this.updateLastPosition(),this.updateAutocompleteList(this.eAutocompleteInput.getValue()??null)}setCaret(e,t){(t||(0,m._isNothingFocused)(this.beans))&&this.eAutocompleteInput.getFocusableElement().focus();let i=this.eAutocompleteInput.getInputElement();i.setSelectionRange(e,e),e===i.value.length&&(i.scrollLeft=i.scrollWidth)}forceOpenList(){this.onValueChanged(this.eAutocompleteInput.getValue())}updateLastPosition(){this.lastPosition=this.eAutocompleteInput.getInputElement().selectionStart??0}validate(e){if(!this.validator)return;let t=this.validationMessage=this.validator(e);this.eAutocompleteInput.getInputElement().setCustomValidity(t??""),this.valid=!t,this.dispatchLocalEvent({type:"eventValidChanged",isValid:this.valid,validationMessage:t})}openList(){this.isListOpen=!0,this.autocompleteList=this.createBean(new tW({autocompleteEntries:this.autocompleteListParams.entries,onConfirmed:()=>this.confirmSelection(),forceLastSelection:this.forceLastSelection}));let e=this.autocompleteList.getGui(),t={ePopup:e,type:"autocomplete",eventSource:this.getGui(),position:"under",alignSide:this.gos.get("enableRtl")?"right":"left",keepWithinBounds:!0},i=this.popupSvc.addPopup({eChild:e,anchorToElement:this.getGui(),positionCallback:()=>this.popupSvc.positionPopupByComponent(t),ariaLabel:this.listAriaLabel});this.hidePopup=i.hideFunc,this.autocompleteList.afterGuiAttached()}closeList(){this.isListOpen=!1,this.hidePopup(),this.destroyBean(this.autocompleteList),this.autocompleteList=null}onCompleted(){this.isListOpen&&this.closeList(),this.dispatchLocalEvent({type:"eventValueConfirmed",value:this.getValue(),isValid:this.isValid()})}getValue(){return(0,m._makeNull)(this.eAutocompleteInput.getValue())}setInputPlaceholder(e){return this.eAutocompleteInput.setInputPlaceholder(e),this}setInputAriaLabel(e){return this.eAutocompleteInput.setInputAriaLabel(e),this}setListAriaLabel(e){return this.listAriaLabel=e,this}setListGenerator(e){return this.listGenerator=e,this}setValidator(e){return this.validator=e,this}isValid(){return this.valid}setValue(e){let{value:t,position:i,silent:s,updateListOnlyIfOpen:r,restoreFocus:a}=e;this.eAutocompleteInput.setValue(t,!0),this.setCaret(i??this.lastPosition,a),s||this.updateValue(t),(!r||this.isListOpen)&&this.updateAutocompleteList(t)}setForceLastSelection(e){return this.forceLastSelection=e,this}setInputDisabled(e){return this.eAutocompleteInput.setDisabled(e),this}}},tj={buttons:["apply"],suppressBuilderButton:!1},tY={apply:"advancedFilterApply",clear:"advancedFilterClear",cancel:"advancedFilterCancel",reset:"advancedFilterReset"},tq={tag:"div",cls:"ag-advanced-filter",role:"presentation",attrs:{tabindex:"-1"},children:[{tag:"ag-autocomplete",ref:"eAutocomplete"},{tag:"ag-filter-button",ref:"eButtons",cls:"ag-advanced-filter-buttons"},{tag:"button",ref:"eBuilderFilterButton",cls:"ag-button ag-advanced-filter-builder-button",children:[{tag:"span",ref:"eBuilderFilterButtonIcon",attrs:{"aria-hidden":"true"}},{tag:"span",ref:"eBuilderFilterButtonLabel",cls:"ag-advanced-filter-builder-button-label"}]}]},tZ=class extends m.Component{constructor(){super(tq,[t$,m.AgFilterButtonSelector]),this.eAutocomplete=m.RefPlaceholder,this.eButtons=m.RefPlaceholder,this.eBuilderFilterButton=m.RefPlaceholder,this.eBuilderFilterButtonIcon=m.RefPlaceholder,this.eBuilderFilterButtonLabel=m.RefPlaceholder,this.expressionParser=null,this.isApplyDisabled=!0,this.builderOpen=!1}wireBeans(e){this.advFilterExpSvc=e.advFilterExpSvc,this.advancedFilter=e.advancedFilter,this.filterManager=e.filterManager,this.registry=e.registry}postConstruct(){this.tooltipFeature=this.createOptionalManagedBean(this.registry.createDynamicBean("tooltipFeature",!1,{getGui:()=>this.getGui(),getTooltipShowDelayOverride:()=>1e3,getLocation:()=>"advancedFilter"})),this.eAutocomplete.setListGenerator((e,t)=>this.generateAutocompleteListParams(t)).setValidator(()=>this.validateValue()).setForceLastSelection((e,t)=>this.forceLastSelection(e,t)).setInputAriaLabel(this.advFilterExpSvc.translate("ariaAdvancedFilterInput")).setListAriaLabel(this.advFilterExpSvc.translate("ariaLabelAdvancedFilterAutocomplete")),this.refresh(),this.addManagedListeners(this.eAutocomplete,{eventValueChanged:({value:e})=>this.onValueChanged(e),eventValueConfirmed:({isValid:e})=>this.onValueConfirmed(e),eventOptionSelected:({position:e,updateEntry:t,autocompleteType:i})=>this.onOptionSelected(e,t,i),eventValidChanged:({isValid:e,validationMessage:t})=>this.onValidChanged(e,t)});let{buttons:e,suppressBuilderButton:t}={...tj,...this.gos.get("advancedFilterParams")};this.setupButtons(e),this.setupBuilderButton(t),this.beans.gos.addManagedPropertyListener("advancedFilterParams",e=>{let t={...tj,...e.currentValue},i={...tj,...e.previousValue};if(t.buttons!==i.buttons){let e=t.buttons.map(e=>({type:e,label:this.advFilterExpSvc.translate(tY[e])}));this.eButtons.updateButtons(e)}t.suppressBuilderButton!==i.suppressBuilderButton&&(0,m._setDisplayed)(this.eBuilderFilterButton,!t.suppressBuilderButton)})}refresh(){let e=this.advancedFilter.getExpressionDisplayValue();this.eAutocomplete.setValue({value:e??"",position:e?.length,updateListOnlyIfOpen:!0})}setInputDisabled(e){this.eAutocomplete.setInputDisabled(e),this.eButtons.updateValidity(!e&&!this.isApplyDisabled&&!this.advancedFilter.isCurrentExpressionApplied())}setupButtons(e){let t=e.map(e=>({type:e,label:this.advFilterExpSvc.translate(tY[e])})),i=e=>()=>{this.updateModel(e)};this.eButtons.addManagedListeners(this.eButtons,{apply:i("apply"),clear:i("clear"),reset:i("reset"),cancel:i("cancel")}),this.eButtons.updateButtons(t)}updateModel(e){switch(e){case"apply":this.onValueConfirmed(this.eAutocomplete.isValid());break;case"reset":this.advancedFilter.setModel(null),this.filterManager?.onFilterChanged({source:"advancedFilter"});break;case"cancel":this.advancedFilter.setModel(this.advancedFilter.getModel()),this.filterManager?.onFilterChanged({source:"advancedFilter"});break;case"clear":this.eAutocomplete.setValue({value:"",restoreFocus:!0})}}setupBuilderButton(e){this.eBuilderFilterButtonIcon.appendChild((0,m._createIconNoSpan)("advancedFilterBuilder",this.beans)),this.eBuilderFilterButtonLabel.textContent=this.advFilterExpSvc.translate("advancedFilterBuilder"),this.activateTabIndex([this.eBuilderFilterButton]),this.addManagedElementListeners(this.eBuilderFilterButton,{click:()=>this.openBuilder()}),this.addManagedListeners(this.advancedFilter.getCtrl(),{advancedFilterBuilderClosed:()=>this.closeBuilder()}),(0,m._setDisplayed)(this.eBuilderFilterButton,!e)}onValueChanged(e){e=(0,m._makeNull)(e),this.advancedFilter.setExpressionDisplayValue(e),this.expressionParser=this.advancedFilter.createExpressionParser(e);let t=this.expressionParser?.parseExpression();t&&t!==e&&this.eAutocomplete.setValue({value:t,silent:!0,restoreFocus:!0})}onValueConfirmed(e){e&&!this.isApplyDisabled&&(this.eButtons?.updateValidity(!1),this.advancedFilter.applyExpression(),this.filterManager?.onFilterChanged({source:"advancedFilter"}))}onOptionSelected(e,t,i){let{updatedValue:s,updatedPosition:r,hideAutocomplete:a}=this.updateExpression(e,t,i);this.eAutocomplete.setValue({value:s,position:r,updateListOnlyIfOpen:a,restoreFocus:!0})}validateValue(){return this.expressionParser?.isValid()?null:this.expressionParser?.getValidationMessage()??null}onValidChanged(e,t){this.isApplyDisabled=!e||this.advancedFilter.isCurrentExpressionApplied(),this.eButtons.updateValidity(!this.isApplyDisabled),this.tooltipFeature?.setTooltipAndRefresh(t)}generateAutocompleteListParams(e){return this.expressionParser?this.expressionParser.getAutocompleteListParams(e):this.advFilterExpSvc.getDefaultAutocompleteListParams("")}updateExpression(e,t,i){return this.advFilterExpSvc.updateAutocompleteCache(t,i),this.expressionParser?.updateExpression(e,t,i)??this.advancedFilter.getDefaultExpression(t)}forceLastSelection({key:e,displayValue:t},i){return!!i.toLocaleLowerCase().match(`^${(t??e).toLocaleLowerCase()}\\s*$`)}openBuilder(){this.builderOpen||(this.builderOpen=!0,(0,m._setDisabled)(this.eBuilderFilterButton,!0),this.advancedFilter.getCtrl().toggleFilterBuilder({source:"ui",eventSource:this.eBuilderFilterButton}))}closeBuilder(){this.builderOpen&&(this.builderOpen=!1,(0,m._setDisabled)(this.eBuilderFilterButton,!1),this.eBuilderFilterButton.focus())}},tX={tag:"div",cls:"ag-advanced-filter-header",role:"row"},tJ=class extends m.Component{constructor(e){super(tX),this.enabled=e}wireBeans(e){this.colModel=e.colModel,this.focusSvc=e.focusSvc,this.ctrlsSvc=e.ctrlsSvc}postConstruct(){this.setupAdvancedFilter(this.enabled),this.addDestroyFunc(()=>this.destroyBean(this.eAdvancedFilter));let e=()=>{this.enabled&&this.setEnabledHeight()};this.addManagedEventListeners({gridColumnsChanged:()=>this.onGridColumnsChanged(),columnHeaderHeightChanged:e,stylesChanged:e}),this.addManagedPropertyListener("headerHeight",e),this.addManagedPropertyListener("floatingFiltersHeight",e),this.addGuiEventListener("keydown",e=>this.onKeyDown(e)),this.addGuiEventListener("focusout",e=>{this.getFocusableElement().contains(e.relatedTarget)||this.focusSvc.clearAdvancedFilterColumn()})}getFocusableElement(){return this.eAdvancedFilter?.getGui()??this.getGui()}setEnabled(e){e!==this.enabled&&this.setupAdvancedFilter(e)}refresh(){this.eAdvancedFilter?.refresh()}getHeight(){return this.height}setInputDisabled(e){this.eAdvancedFilter?.setInputDisabled(e)}setupAdvancedFilter(e){let t=this.getGui();if(e){this.eAdvancedFilter=this.createBean(new tZ);let e=this.eAdvancedFilter.getGui();this.eAdvancedFilter.addCss("ag-advanced-filter-header-cell"),this.setEnabledHeight(),this.setAriaRowIndex(),(0,m._setAriaRole)(e,"gridcell"),(0,m._setAriaColIndex)(e,1),this.setAriaColumnCount(e),t.appendChild(e)}else(0,m._clearElement)(t),this.destroyBean(this.eAdvancedFilter),this.height=0;(0,m._setDisplayed)(t,e),this.enabled=e}setEnabledHeight(){let e=this.getGui();this.height=(0,m._getFloatingFiltersHeight)(this.beans);let t=`${this.height}px`;e.style.height=t,e.style.minHeight=t}setAriaColumnCount(e){(0,m._setAriaColSpan)(e,this.colModel.getCols().length)}setAriaRowIndex(){(0,m._setAriaRowIndex)(this.getGui(),this.ctrlsSvc.getHeaderRowContainerCtrl()?.getRowCount()??0)}onGridColumnsChanged(){this.eAdvancedFilter&&(this.setAriaColumnCount(this.eAdvancedFilter.getGui()),this.setAriaRowIndex())}onKeyDown(e){switch(e.key){case m.KeyCode.ENTER:this.hasFocus()&&(0,m._focusInto)(this.getFocusableElement())&&e.preventDefault();break;case m.KeyCode.ESCAPE:this.hasFocus()||this.getFocusableElement().focus();break;case m.KeyCode.UP:this.navigateUpDown(!0,e);break;case m.KeyCode.DOWN:this.navigateUpDown(!1,e);break;case m.KeyCode.TAB:if(this.hasFocus())this.navigateLeftRight(e);else{let t=(0,m._findNextFocusableElement)(this.beans,this.getFocusableElement(),null,e.shiftKey);t?(e.preventDefault(),t.focus()):this.navigateLeftRight(e)}}}navigateUpDown(e,t){this.hasFocus()&&this.focusSvc.focusNextFromAdvancedFilter(e)&&t.preventDefault()}navigateLeftRight(e){(e.shiftKey?this.focusSvc.focusLastHeader():this.focusSvc.focusNextFromAdvancedFilter(!1,!0))&&e.preventDefault()}hasFocus(){return(0,m._getActiveDomElement)(this.beans)===this.getFocusableElement()}},tQ=class extends e3{},t0=class extends m.BeanStub{constructor(e,t){super(),this.comp=e,this.virtualList=t}postConstruct(){this.createManagedBean(new tQ(this.comp,this.virtualList,{dragSourceType:m.DragSourceType.AdvancedFilterBuilder,addListeners:(e,t,i)=>{e.addManagedListeners(this,{advancedFilterBuilderDragStarted:t,advancedFilterBuilderDragEnded:i})},getCurrentDragValue:e=>this.getCurrentDragValue(e),isMoveBlocked:()=>!1,getNumRows:e=>e.getNumItems(),moveItem:(e,t)=>this.moveItem(e,t)}))}getCurrentDragValue(e){return e.item}moveItem(e,t){this.comp.moveItem(e,t)}},t1={tag:"div",cls:"ag-pill",role:"option",children:[{tag:"span",ref:"eText",cls:"ag-pill-text"},{tag:"span",ref:"eButton",cls:"ag-button ag-pill-button",role:"presentation"}]},t2=class extends m.Component{constructor(e){super(t1),this.config=e,this.eText=m.RefPlaceholder,this.eButton=m.RefPlaceholder}postConstruct(){let{config:e,eButton:t}=this,{onKeyDown:i,onButtonClick:s}=e;this.getGui().setAttribute("tabindex",String(this.gos.get("tabIndex"))),this.addGuiEventListener("focus",()=>{this.eButton.focus()}),i&&this.addGuiEventListener("keydown",i),s&&this.addManagedElementListeners(t,{click:s})}toggleCloseButtonClass(e,t){this.eButton.classList.toggle(e,t)}setText(e){this.eText.textContent=e}getText(){return this.eText.textContent}},t5={tag:"div",cls:"ag-pill-container"},t4=class extends m.Component{constructor(){super(t5),this.pills=[]}init(e){this.params=e,this.getKey=e.valueFormatter??(e=>String(e)),this.refresh()}refresh(){this.clearPills();let{params:e,onPillKeyDown:t,getKey:i}=this,s=e.getValue();if(!Array.isArray(s)){if(null==s)return;s=[s]}let r=e.valueFormatter??(e=>String(e)),a=s.length;(0,m._setAriaRole)(this.getGui(),0===a?"presentation":"listbox");for(let l=0;l<a;l++){let n=s[l],o=this.createBean(new t2({onButtonClick:()=>this.onPillButtonClick(o),onKeyDown:t.bind(this)})),d=o.getGui();(0,m._setAriaPosInSet)(d,l+1),(0,m._setAriaSetSize)(d,a),e.onPillMouseDown&&o.addGuiEventListener("mousedown",e.onPillMouseDown),e.announceItemFocus&&o.addGuiEventListener("focus",e.announceItemFocus),o.setText(r(n)??""),o.toggleCloseButtonClass("ag-icon-cancel",!0),this.appendChild(d),this.pills.push({key:i(n)??l.toString(),pill:o})}}onNavigationKeyDown(e){let{key:t}=e;if(!this.pills.length||t!==m.KeyCode.LEFT&&t!==m.KeyCode.RIGHT)return;e.preventDefault();let{params:i,beans:s}=this,r=(0,m._getActiveDomElement)(s),a=this.getGui();if(a.contains(r)){let e=(0,m._findNextFocusableElement)(s,a,!1,t===m.KeyCode.LEFT);e?e.focus():i.eWrapper&&i.eWrapper.focus()}else{let e=(0,m._findFocusableElements)(a);e.length>0&&e[t===m.KeyCode.RIGHT?0:e.length-1].focus()}}clearPills(){let e=this.getGui();e.contains((0,m._getActiveDomElement)(this.beans))&&this.params.eWrapper&&this.params.eWrapper.focus(),(0,m._clearElement)(e),this.destroyBeans(this.pills.map(({pill:e})=>e)),this.pills=[]}onPillButtonClick(e){this.deletePill(e)}onPillKeyDown(e){let t=e.key;if(t!==m.KeyCode.DELETE&&t!==m.KeyCode.BACKSPACE)return;e.preventDefault();let i=(0,m._getDocument)(this.beans),s=this.pills.findIndex(({pill:e})=>e.getGui().contains(i.activeElement));if(-1===s)return;let r=this.pills[s];r?.pill&&this.deletePill(r.pill,s)}deletePill(e,t){let{getKey:i,pills:s,params:r}=this,a=(s[t??-1]??s.find(({pill:t})=>t===e))?.key,l=(r.getValue()||[]).filter(e=>i(e)!==a);if(r.setValue(l),!l.length&&r.eWrapper)r.eWrapper.focus();else if(null!=t){let{pill:e}=s[Math.min(t,s.length-1)];e&&e.getFocusableElement().focus()}}destroy(){this.clearPills(),super.destroy()}},t3={tag:"div",cls:"ag-rich-select-row",role:"presentation"},t6=class extends m.Component{constructor(e){super(t3),this.params=e}wireBeans(e){this.userCompFactory=e.userCompFactory,this.registry=e.registry}postConstruct(){this.tooltipFeature=this.createOptionalManagedBean(this.registry.createDynamicBean("highlightTooltipFeature",!1,{getGui:()=>this.getGui(),shouldDisplayTooltip:()=>this.shouldDisplayTooltip?.()??!0},this))}setState(e){let{params:t}=this,i=t.valueFormatter?.(e)??"";this.populateWithRenderer(e,i)||this.populateWithoutRenderer(e,i),this.value=e}highlightString(e){let{parsedValue:t,params:i}=this;if(i.cellRenderer||!(0,m._exists)(t))return;let s=(0,m._exists)(e);if(s){let i=t?.toLocaleLowerCase().indexOf(e.toLocaleLowerCase());if(i>=0){let s=i+e.length,r=this.getGui().querySelector("span");r&&((0,m._clearElement)(r),r.append(t.slice(0,i),(0,m._createElement)({tag:"span",cls:"ag-rich-select-row-text-highlight",children:t.slice(i,s)}),t.slice(s)))}else s=!1}s||this.renderValueWithoutRenderer(t)}updateSelected(e){let t=this.getGui();(0,m._setAriaSelected)(t.parentElement,e),this.toggleCss("ag-rich-select-row-selected",e)}getValue(){return this.value}toggleHighlighted(e){this.toggleCss("ag-rich-select-row-highlighted",e),this.dispatchLocalEvent({type:"itemHighlighted",highlighted:e})}populateWithoutRenderer(e,t){let i=this.getGui(),s=(0,m._createElement)({tag:"span"});s.style.overflow="hidden",s.style.textOverflow="ellipsis";let r=(0,m._toString)((0,m._exists)(t)?t:e);this.parsedValue=(0,m._exists)(r)?r:null,i.appendChild(s),this.renderValueWithoutRenderer(r),this.shouldDisplayTooltip=(0,m._isElementOverflowingCallback)(()=>s),this.tooltipFeature?.setTooltipAndRefresh(this.parsedValue)}renderValueWithoutRenderer(e){let t=this.getGui().querySelector("span");t&&(t.textContent=(0,m._exists)(e)?e:"")}populateWithRenderer(e,t){let i,s,{cellRenderer:r,cellRendererParams:a}=this.params;if(r){let i=this.getParentComponent()?.getParentComponent();s=(0,m._getEditorRendererDetails)(this.userCompFactory,this.params,(0,m._addGridCommonParams)(this.gos,{value:e,valueFormatted:t,cellRendererParams:a,getValue:()=>i?.getValue(),setValue:e=>{i?.setValue(e,!0)},setTooltip:(e,t)=>{this.gos.assertModuleRegistered("Tooltip",3),this.shouldDisplayTooltip=t,this.tooltipFeature?.setTooltipAndRefresh(e)}}))}return s&&(i=s.newAgStackInstance()),i&&is(i,this.getGui()),!!i&&(i.then(e=>{this.addDestroyFunc(()=>{this.destroyBean(e)})}),!0)}},t8="ag-rich-select-list",t7="ag-rich-select-row",t9=class extends t_{constructor(e,t,i){super({cssIdentifier:"rich-select"}),this.params=e,this.richSelectWrapper=t,this.getSearchString=i,this.lastRowHovered=-1,this.selectedItems=new Set,this.loadingState=3,this.params=e,this.setComponentCreator(this.createRowComponent.bind(this)),this.setComponentUpdater(()=>{})}postConstruct(){super.postConstruct();let e=this.getLocaleTextFunc();this.loadingLabel=e("loadingOoo","Loading..."),this.noMatchesLabel=e("noMatches","No matches to show"),this.eLoadingIcon=(0,m._createIconNoSpan)("richSelectLoading",this.beans,null),this.eStateCompLabel=(0,m._createElement)({tag:"span",cls:"ag-loading-text",children:this.loadingLabel}),this.eStateComp=(0,m._createElement)({tag:"div",cls:"ag-rich-select-loading",children:[{tag:"span",cls:"ag-loading-icon",children:[this.eLoadingIcon?()=>this.eLoadingIcon:void 0]},{tag:"span",cls:"ag-loading-text",children:[()=>this.eStateCompLabel]}]}),this.appendChild(this.eStateComp);let{cellRowHeight:t,pickerAriaLabelKey:i,pickerAriaLabelValue:s}=this.params;t&&this.setRowHeight(t);let r=this.getGui(),a=this.getAriaElement();this.addManagedListeners(r,{mousemove:this.onMouseMove.bind(this),mouseout:this.onMouseOut.bind(this),mousedown:this.onMouseDown.bind(this),click:this.onClick.bind(this)}),r.classList.add(t8);let l=`${t8}-${this.getCompId()}`;a.setAttribute("id",l);let n=this.getLocaleTextFunc()(i,s);(0,m._setAriaLabel)(a,n),(0,m._setAriaControlsAndLabel)(this.richSelectWrapper,a)}setIsLoading(){this.setLoadingState(0)}setLoadingState(e){this.loadingState=e,this.toggleStateComp(),this.toggleVisibility()}toggleStateComp(){let{eStateComp:e,eStateCompLabel:t,eLoadingIcon:i,loadingState:s,loadingLabel:r,noMatchesLabel:a,params:l}=this;if(e){if(0===s){t.textContent=r,i&&(0,m._setDisplayed)(i,!0),(0,m._setDisplayed)(e,!0);return}if(2===s&&l.allowNoResultsCopy){t.textContent=a,i&&(0,m._setDisplayed)(i,!1),(0,m._setDisplayed)(e,!0);return}(0,m._setDisplayed)(e,!1)}}shouldBeVisible(){return 2===this.loadingState?!!this.params.allowNoResultsCopy:3!==this.loadingState}toggleVisibility(e){let t=this.getGui();void 0===e?(0,m._setDisplayed)(t,this.shouldBeVisible()):(0,m._setDisplayed)(t,e)}navigateToPage(e){let t=super.navigateToPage(e,this.lastRowHovered);return null!=t&&(0,m._requestAnimationFrame)(this.beans,()=>{if(!this.isAlive())return null;this.highlightIndex(t)}),t}drawVirtualRows(e){super.drawVirtualRows(e),this.refreshSelectedItems()}highlightFilterMatch(e){this.forEachRenderedRow(t=>{t.highlightString(e)})}onNavigationKeyDown(e,t){(0,m._requestAnimationFrame)(this.beans,()=>{if(!this.currentList||!this.isAlive())return;let i=this.currentList.length,s=this.lastRowHovered,r=e===m.KeyCode.DOWN?1:-1,a=Math.min(Math.max(-1===s?0:s+r,0),i-1);this.highlightIndex(a),t()})}selectValue(e){if(!this.currentList||null==e)return!1;let t=this.getIndicesForValues(e),i=t.length>0;return i&&(this.refresh(),this.ensureIndexVisible(t[0]),this.refresh(!0)),this.selectListItems(Array.isArray(e)?e:[e]),i}selectListItems(e,t=!1){t||this.selectedItems.clear();for(let t=0;t<e.length;t++){let i=e[t];void 0===this.findItemInSelected(i)&&this.selectedItems.add(i)}this.refreshSelectedItems()}getCurrentList(){return this.currentList}setCurrentList(e){var t;let i=(t=e)?t.length?1:2:3;this.setLoadingState(i),e||(e=[]),this.currentList=e,this.setModel({getRowCount:()=>e.length,getRow:t=>e[t],areRowsEqual:(e,t)=>e===t})}getSelectedItems(){return this.selectedItems}getLastItemHovered(){return this.currentList?.[this.lastRowHovered]}highlightIndex(e,t){this.currentList&&(e<0||e>=this.currentList.length?this.lastRowHovered=-1:(this.lastRowHovered=e,this.ensureIndexVisible(e,!t)&&!t&&this.refresh(!0)),this.forEachRenderedRow((t,i)=>{let s=e===i;if(t.toggleHighlighted(s),s){let e=`${t7}-${t.getCompId()}`;(0,m._setAriaActiveDescendant)(this.richSelectWrapper,e),this.richSelectWrapper.setAttribute("data-active-option",e)}}))}getIndicesForValues(e){let{currentList:t}=this;if(!t||0===t.length||null==e||(Array.isArray(e)||(e=[e]),0===e.length))return[];let{valueFormatter:i}=this.params,s=[],r="object"==typeof e[0],a=t.map(i);for(let l of e){let e=-1;(e=r?a.indexOf(i(l)):t.indexOf(l))>=0&&s.push(e)}return s}toggleListItemSelection(e){let t=this.findItemInSelected(e);void 0!==t?this.selectedItems.delete(t):this.selectedItems.add(e),this.refreshSelectedItems(),this.dispatchValueSelected()}refreshSelectedItems(){this.forEachRenderedRow(e=>{let t=void 0!==this.findItemInSelected(e.getValue());e.updateSelected(t)})}findItemInSelected(e){if("object"!=typeof e)return this.selectedItems.has(e)?e:void 0;{let t=this.params.valueFormatter,i=t(e);for(let e of this.selectedItems)if(t(e)===i)return e}}createRowComponent(e,t){let i=new t6(this.params);t.setAttribute("id",`${t7}-${i.getCompId()}`),i.setParentComponent(this),this.createBean(i),i.setState(e);let{highlightMatch:s,searchType:r="fuzzy"}=this.params;return s&&"fuzzy"!==r&&i.highlightString(this.getSearchString()),i}getRowForMouseEvent(e){if(!this.model)return -1;let t=this.getGui().getBoundingClientRect(),i=this.getScrollTop();return Math.min(Math.floor((e.clientY-t.top+i)/this.getRowHeight()),this.model.getRowCount()-1)}onMouseMove(e){let t=this.getRowForMouseEvent(e);-1!==t&&t!=this.lastRowHovered&&(this.lastRowHovered=t,this.highlightIndex(t,!0))}onMouseDown(e){e.preventDefault()}onMouseOut(e){this.getGui().contains(e.relatedTarget)||this.highlightIndex(-1)}onClick(e){let{multiSelect:t}=this.params;if(!this.currentList?.length)return;let i=this.getRowForMouseEvent(e),s=this.currentList[i];t?this.toggleListItemSelection(s):(this.selectListItems([s]),this.dispatchValueSelected())}dispatchValueSelected(){this.dispatchLocalEvent({type:"richSelectListRowSelected",fromEnterKey:!1,value:this.selectedItems})}destroy(){super.destroy(),this.eStateComp=void 0}},ie={tag:"div",cls:"ag-picker-field",role:"presentation",children:[{tag:"div",ref:"eLabel"},{tag:"div",ref:"eWrapper",cls:"ag-wrapper ag-picker-field-wrapper ag-rich-select-value ag-picker-collapsed",children:[{tag:"span",ref:"eDisplayField",cls:"ag-picker-field-display"},{tag:"ag-input-text-field",ref:"eInput",cls:"ag-rich-select-field-input"},{tag:"span",ref:"eDeselect",cls:"ag-rich-select-deselect-button ag-picker-field-icon",role:"presentation"},{tag:"span",ref:"eIcon",cls:"ag-picker-field-icon",attrs:{"aria-hidden":"true"}}]}]},it=class extends m.AgPickerField{constructor(e){super({pickerAriaLabelKey:"ariaLabelRichSelectField",pickerAriaLabelValue:"Rich Select Field",pickerType:"ag-list",className:"ag-rich-select",pickerIcon:"richSelectOpen",ariaRole:"combobox",template:e?.template??ie,agComponents:[m.AgInputTextFieldSelector],modalPicker:!1,...e,maxPickerHeight:e?.maxPickerHeight??"calc(var(--ag-row-height) * 6.5)"}),this.searchString="",this.searchStringCreator=null,this.eInput=m.RefPlaceholder,this.eDeselect=m.RefPlaceholder,this.skipWrapperAnnouncement=!1;const{value:t,valueList:i,searchStringCreator:s,onSearch:r}=e||{};void 0!==t&&(this.value=t),s&&(this.searchStringCreator=s),null!=i&&this.setValueList({valueList:i,isInitial:!0});const{searchDebounceDelay:a=300}=this.config;r&&(this.onSearchCallbackDebounced=(0,m._debounce)(this,r,a)),this.registerCSS(".ag-rich-select{cursor:default;height:100%}.ag-rich-select-value{align-items:center;background-color:var(--ag-picker-button-background-color);display:flex;height:100%;padding:var(--ag-spacing);:where(.ag-picker-field-display){overflow:hidden;text-overflow:ellipsis;&:where(.ag-display-as-placeholder){opacity:.5}}}.ag-virtual-list-viewport.ag-rich-select-list{background-color:var(--ag-picker-list-background-color);border:var(--ag-picker-list-border);border-radius:var(--ag-input-border-radius);box-shadow:var(--ag-dropdown-shadow);height:auto;position:relative;width:100%;:where(.ag-rich-select-loading){display:flex;padding:var(--ag-widget-container-vertical-padding) var(--ag-widget-container-horizontal-padding)}}.ag-rich-select-row{align-items:center;display:flex;flex:1 1 auto;height:100%;overflow:hidden;padding:0 var(--ag-spacing);white-space:nowrap}.ag-rich-select-row-selected{background-color:var(--ag-selected-row-background-color)}.ag-rich-select-row-highlighted,.ag-rich-select-row:hover{background-image:linear-gradient(var(--ag-row-hover-color),var(--ag-row-hover-color))}.ag-rich-select-row-text-highlight{font-weight:700}.ag-rich-select-field-input{flex:1 1 auto;:where(.ag-input-field-input){border:none!important;box-shadow:none!important;padding:0!important;text-overflow:ellipsis;&::-moz-placeholder{opacity:.8}&::placeholder{opacity:.8}}}:where(.ag-ltr) .ag-rich-select-field-input{left:var(--ag-spacing)}:where(.ag-rtl) .ag-rich-select-field-input{right:var(--ag-spacing)}:where(.ag-popup-editor) .ag-rich-select-value{height:var(--ag-row-height);min-width:200px}.ag-rich-select-virtual-list-item{cursor:default;height:var(--ag-list-item-height)}.ag-pill-container{display:flex;flex-wrap:nowrap;gap:.25rem}.ag-pill{align-items:center;background:var(--ag-select-cell-background-color);border:var(--ag-select-cell-border);border-radius:var(--ag-border-radius);display:flex;padding:0 .25rem;white-space:nowrap}.ag-pill-button{border:none;padding:0}:where(.ag-ltr) .ag-pill-button{margin-left:var(--ag-spacing)}:where(.ag-rtl) .ag-pill-button{margin-right:var(--ag-spacing)}.ag-pill-button:hover{color:var(--ag-accent-color);cursor:pointer}")}wireBeans(e){this.userCompFactory=e.userCompFactory,this.ariaAnnounce=e.ariaAnnounce,this.registry=e.registry}postConstruct(){this.tooltipFeature=this.createOptionalManagedBean(this.registry.createDynamicBean("tooltipFeature",!1,{getGui:()=>this.getGui(),shouldDisplayTooltip:()=>this.shouldDisplayTooltip?.()??!0})),super.postConstruct(),this.createListComponent(),this.eDeselect.appendChild((0,m._createIconNoSpan)("richSelectRemove",this.beans));let{allowTyping:e,placeholder:t,suppressDeselectAll:i}=this.config;this.eDeselect.classList.add("ag-hidden"),e?(this.eInput.setAutoComplete(!1).setInputPlaceholder(t),this.eDisplayField.classList.add("ag-hidden")):this.eInput.setDisplayed(!1),this.setupAriaProperties();let{searchDebounceDelay:s=300}=this.config;this.clearSearchString=(0,m._debounce)(this,this.clearSearchString.bind(this),s),this.renderSelectedValue(),e&&this.eInput.onValueChange(e=>this.searchTextFromString(e)),this.addManagedElementListeners(this.eWrapper,{focus:this.onWrapperFocus.bind(this)}),this.addManagedElementListeners(this.eWrapper,{focusout:this.onWrapperFocusOut.bind(this)}),i||this.addManagedElementListeners(this.eDeselect,{mousedown:this.onDeselectAllMouseDown.bind(this),click:this.onDeselectAllClick.bind(this)})}setupAriaProperties(){let{eWrapper:e,gos:t}=this;e.tabIndex=t.get("tabIndex");let i=this.getLocaleTextFunc();this.ariaDeleteSelection=i("ariaLabelRichSelectDeleteSelection","Press DELETE to deselect item"),this.ariaDeselectAllItems=i("ariaLabelRichSelectDeselectAllItems","Press DELETE to deselect all items"),this.ariaToggleSelection=i("ariaLabelRichSelectToggleSelection","Press SPACE to toggle selection")}createListComponent(){this.listComponent=this.createBean(new t9(this.config,this.getFocusableElement(),()=>this.searchString)),this.listComponent.setParentComponent(this),this.addManagedListeners(this.listComponent,{richSelectListRowSelected:e=>{this.onListValueSelected(e.value,e.fromEnterKey)}})}renderSelectedValue(e){let t,i,{value:s,eDisplayField:r,config:a,gos:l}=this,{allowTyping:n,cellRenderer:o,cellRendererParams:d,initialInputValue:h,multiSelect:u,suppressDeselectAll:c,suppressMultiSelectPillRenderer:p,valueFormatter:g,onSearch:f}=a,C=ii(s,g);if(n)return void this.eInput.setValue(h??C,!!e&&!!f);if(u&&!c){let e=null==s||Array.isArray(s)&&0===s.length;this.eDeselect.classList.toggle("ag-hidden",e)}if(u&&!p)return void this.createOrUpdatePillContainer(r);if(o&&(t=(0,m._getEditorRendererDetails)(this.userCompFactory,a,(0,m._addGridCommonParams)(this.gos,{value:s,valueFormatted:C,cellRendererParams:d,getValue:()=>this.getValue(),setValue:e=>{this.setValue(e,!0)},setTooltip:(e,t)=>{l.assertModuleRegistered("Tooltip",3),this.shouldDisplayTooltip=t,this.tooltipFeature?.setTooltipAndRefresh(e)}}))),t&&(i=t.newAgStackInstance()),i)(0,m._clearElement)(r),is(i,r),i.then(e=>{this.addDestroyFunc(()=>this.destroyBean(e))});else{if((0,m._exists)(this.value))r.innerText=C,r.classList.remove("ag-display-as-placeholder");else{let{placeholder:e}=a;(0,m._exists)(e)?(r.textContent=e,r.classList.add("ag-display-as-placeholder")):(0,m._clearElement)(r)}this.shouldDisplayTooltip=(0,m._isElementOverflowingCallback)(()=>this.eDisplayField),this.tooltipFeature?.setTooltipAndRefresh(C??null)}}createPickerComponent(){let{values:e}=this;return e&&this.setValueList({valueList:e}),this.listComponent}setSearchStringCreator(e){this.searchStringCreator=e}setValueListInternal(e){let{listComponent:t,isPickerDisplayed:i,value:s}=this,{valueList:r,refresh:a,isInitial:l}=e;l&&this.setValues(r),!t||(this.listComponent?.setCurrentList(r),a&&(this.values?t.refresh(!0):i&&(t.selectValue(s)||t.refresh()),this.alignPickerToComponent()))}setValueList(e){let{valueList:t}=e;!t||Array.isArray(t)?this.setValueListInternal(e):(this.listComponent?.setIsLoading(),t.then(t=>{t&&this.setValueListInternal({...e,valueList:t})}))}setValues(e){this.values=e,this.searchStrings=this.getSearchStringsFromValues(e||[])}showPicker(){let{listComponent:e,value:t}=this;if(!e)return;super.showPicker();let i=t;void 0===t&&(i=null),e.selectValue(i);let s=e.getIndicesForValues(Array.isArray(i)?i:[i])[0];null!=s?(this.tooltipFeature?.attemptToHideTooltip(),e.highlightIndex(s)):e.refresh()}createOrUpdatePillContainer(e){if(!this.pillContainer){let t=this.pillContainer=this.createBean(new t4);this.addDestroyFunc(()=>{this.destroyBean(this.pillContainer),this.pillContainer=null}),(0,m._clearElement)(e),e.appendChild(t.getGui());let{config:i,eWrapper:s,ariaDeleteSelection:r}=this,{valueFormatter:a}=i;t.init({eWrapper:s,valueFormatter:a,onPillMouseDown:e=>{e.stopImmediatePropagation()},announceItemFocus:()=>{this.announceAriaValue(r)},getValue:()=>this.getValue(),setValue:e=>this.setValue(e,!0)})}this.doWhileBlockingAnnouncement(()=>this.pillContainer?.refresh())}doWhileBlockingAnnouncement(e){this.skipWrapperAnnouncement=!0,e(),this.skipWrapperAnnouncement=!1}onWrapperFocus(){let{eInput:e,config:t}=this,{allowTyping:i,multiSelect:s,suppressDeselectAll:r}=t;if(i){let t=e.getFocusableElement();t.focus(),t.select()}else!s||r||this.skipWrapperAnnouncement||this.announceAriaValue(this.ariaDeselectAllItems)}onWrapperFocusOut(e){this.eWrapper.contains(e.relatedTarget)||this.hidePicker()}onDeselectAllMouseDown(e){e.stopImmediatePropagation()}onDeselectAllClick(){this.setValue([],!0)}buildSearchStringFromKeyboardEvent(e){let{key:t}=e;if(t===m.KeyCode.BACKSPACE)this.searchString=this.searchString.slice(0,-1),t="";else if(!(0,m._isEventFromPrintableCharacter)(e))return;e.preventDefault(),this.searchTextFromCharacter(t)}searchTextFromCharacter(e){this.searchString+=e,this.runSearch(),this.clearSearchString()}searchTextFromString(e){null==e&&(e=""),this.searchString=e,this.runSearch()}getSearchStringsFromValues(e){let{config:{valueFormatter:t}}=this;return"object"==typeof e[0]&&this.searchStringCreator?this.searchStringCreator(e):e.map(e=>ii(e,t))}filterListModel(e){let{filterList:t}=this.config;t&&this.setValueList({valueList:e,refresh:!0})}runSearch(){if(!this.listComponent)return;if(this.onSearchCallbackDebounced)return void this.onSearchCallbackDebounced(this.searchString);let e=this.searchStrings;if(!e)return void this.listComponent.highlightIndex(-1);let{suggestions:t,filteredValues:i}=this.getSuggestionsAndFilteredValues(this.searchString,e),{filterList:s,highlightMatch:r,searchType:a="fuzzy"}=this.config,l=!!(s&&""!==this.searchString);this.filterListModel(l?i:this.values||[]),this.highlightEmptyValue()||this.highlightListValue(t,i,l),r&&"fuzzy"!==a&&this.listComponent?.highlightFilterMatch(this.searchString),this.listComponent?.toggleVisibility()}highlightEmptyValue(){if(""===this.searchString){let e=this.searchStrings?.indexOf("");if(void 0!==e&&-1!==e)return this.listComponent?.highlightIndex(e),!0}return!1}highlightListValue(e,t,i){if(e.length){let t=i?0:this.searchStrings?.indexOf(e[0]);void 0!==t&&this.listComponent?.highlightIndex(t)}else if(this.listComponent?.highlightIndex(-1),!i||t.length)this.listComponent?.ensureIndexVisible(0);else if(i){this.getAriaElement().removeAttribute("data-active-option");let e=this.listComponent?.getAriaElement();e&&(0,m._setAriaActiveDescendant)(e,null)}}getSuggestionsAndFilteredValues(e,t){let i=[],s=[];if(!e.length)return{suggestions:i,filteredValues:s};let{searchType:r="fuzzy",filterList:a}=this.config,l=this.values||[];if("fuzzy"===r){let r=(0,m._fuzzySuggestions)({inputValue:e,allSuggestions:t,hideIrrelevant:!0});i=r.values;let n=r.indices;if(a&&n.length)for(let e=0;e<n.length;e++)s.push(l[n[e]])}else i=t.filter((e,t)=>{let i=e.toLocaleLowerCase(),n=this.searchString.toLocaleLowerCase(),o="match"===r?i.startsWith(n):i.includes(n);return a&&o&&s.push(l[t]),o});return{suggestions:i,filteredValues:s}}clearSearchString(){this.searchString=""}setValue(e,t,i,s){if(this.value===e)return this;let r=Array.isArray(e);if(null!=e){if(!r){let t=this.listComponent?.getCurrentList();if(-1===(t?t.indexOf(e):-1))return this}i||this.listComponent?.selectValue(e)}return super.setValue(e,t),s||this.renderSelectedValue(i),this}onNavigationKeyDown(e,t,i){e.preventDefault();let s=t===m.KeyCode.DOWN;!this.isPickerDisplayed&&s?this.showPicker():this.listComponent?.onNavigationKeyDown(t,i)}onEnterKeyDown(e){if(this.isPickerDisplayed&&(e.preventDefault(),this.listComponent?.getCurrentList())){let e=this.listComponent.getLastItemHovered();this.config.multiSelect||void 0===e?this.dispatchPickerEventAndHidePicker(this.value,!0):this.onListValueSelected(new Set([e]),!0)}}onDeleteKeyDown(e){let{eWrapper:t,beans:i}=this;(0,m._getActiveDomElement)(i)===t&&(e.preventDefault(),this.setValue([],!0))}onTabKeyDown(){let{config:e,isPickerDisplayed:t,listComponent:i}=this,{multiSelect:s}=e;if(t&&i){if(s){let e=this.getValueFromSet(i.getSelectedItems());e&&this.setValue(e,!1,!0,!0)}else{let e=i.getLastItemHovered();void 0!==e&&this.setValue(e,!1,!0)}this.hidePicker()}}getValueFromSet(e){let{multiSelect:t}=this.config,i=null;for(let s of e){if(1===e.size&&!t){i=s;break}i||(i=[]),i.push(s)}return Array.isArray(i)&&i.sort(),i}onListValueSelected(e,t){let i=this.getValueFromSet(e);this.setValue(i,!1,!0),this.config.multiSelect||this.dispatchPickerEventAndHidePicker(i,t)}dispatchPickerEventAndHidePicker(e,t){this.dispatchLocalEvent({type:"fieldPickerValueSelected",fromEnterKey:t,value:e}),this.hidePicker()}getFocusableElement(){let{allowTyping:e}=this.config;return e?this.eInput.getFocusableElement():super.getFocusableElement()}onKeyDown(e){let{key:t,isComposing:i}=e,{isPickerDisplayed:s,config:{allowTyping:r,multiSelect:a,suppressDeselectAll:l},listComponent:n,pickerComponent:o}=this;switch(t){case m.KeyCode.LEFT:case m.KeyCode.RIGHT:(!r||this.pillContainer)&&(e.preventDefault(),this.pillContainer&&(this.listComponent?.highlightIndex(-1),this.pillContainer.onNavigationKeyDown(e)));break;case m.KeyCode.PAGE_HOME:case m.KeyCode.PAGE_END:if(r){e.preventDefault();let i=this.eInput.getInputElement(),s=t===m.KeyCode.PAGE_HOME?0:i.value.length;i.setSelectionRange(s,s);break}case m.KeyCode.PAGE_UP:case m.KeyCode.PAGE_DOWN:e.preventDefault(),o&&n?.navigateToPage(t);break;case m.KeyCode.DOWN:case m.KeyCode.UP:i||this.onNavigationKeyDown(e,t,()=>{a&&(this.doWhileBlockingAnnouncement(()=>this.eWrapper.focus()),this.announceAriaValue(this.ariaToggleSelection))});break;case m.KeyCode.ESCAPE:s&&((0,m._isVisible)(this.listComponent.getGui())&&(e.preventDefault(),(0,m._stopPropagationForAgGrid)(e)),this.hidePicker());break;case m.KeyCode.ENTER:i?e.preventDefault():this.onEnterKeyDown(e);break;case m.KeyCode.SPACE:if((!r||i)&&e.preventDefault(),!i&&s&&a&&n){let e=n.getLastItemHovered();void 0!==e&&n.toggleListItemSelection(e)}break;case m.KeyCode.TAB:this.onTabKeyDown();break;case m.KeyCode.DELETE:a&&!l&&this.onDeleteKeyDown(e);break;default:r||this.buildSearchStringFromKeyboardEvent(e)}}announceAriaValue(e){this.ariaAnnounce?.announceValue(e,"richSelect")}destroy(){this.listComponent&&(this.listComponent=this.destroyBean(this.listComponent)),this.searchStrings=void 0,super.destroy()}},ii=(e,t)=>t?.(e)??String(e??"");function is(e,t){e.then(e=>{let i=e.getGui();null!=i&&t.appendChild(i)})}var ir={tag:"div",cls:"ag-picker-field",role:"presentation",children:[{tag:"div",ref:"eLabel"},{tag:"div",ref:"eWrapper",cls:"ag-wrapper ag-picker-collapsed",children:[{tag:"div",ref:"eDisplayField",cls:"ag-picker-field-display"},{tag:"ag-input-text-field",ref:"eInput",cls:"ag-rich-select-field-input"},{tag:"span",ref:"eDeselect",cls:"ag-rich-select-deselect-button ag-picker-field-icon",role:"presentation"},{tag:"div",ref:"eIcon",cls:"ag-picker-field-icon",attrs:{"aria-hidden":"true"}}]}]},ia=class extends it{constructor(e){super({...e,template:ir,agComponents:[m.AgInputTextFieldSelector]}),this.params=e}showPicker(){setTimeout(()=>super.showPicker())}hidePicker(){setTimeout(()=>super.hidePicker())}postConstruct(){super.postConstruct();let{wrapperClassName:e,ariaLabel:t}=this.params;(0,m._setDisplayed)(this.eDisplayField,!1),e&&this.eWrapper.classList.add(e),(0,m._setAriaLabelledBy)(this.eWrapper,""),(0,m._setAriaLabel)(this.eWrapper,t)}onEnterKeyDown(e){(0,m._stopPropagationForAgGrid)(e),this.isPickerDisplayed?super.onEnterKeyDown(e):(e.preventDefault(),this.showPicker())}},il=class extends m.BeanStub{constructor(e,t,i){super(),this.eGui=e,this.focusWrapper=t,this.eFocusableComp=i}postConstruct(){this.addManagedElementListeners(this.eGui,{keydown:e=>{switch(e.key){case m.KeyCode.TAB:e.defaultPrevented||(0,m._stopPropagationForAgGrid)(e);break;case m.KeyCode.UP:case m.KeyCode.DOWN:(0,m._stopPropagationForAgGrid)(e);break;case m.KeyCode.ESCAPE:if((0,m._isStopPropagationForAgGrid)(e))return;this.eGui.contains((0,m._getActiveDomElement)(this.beans))&&(e.preventDefault(),(0,m._stopPropagationForAgGrid)(e),this.focusWrapper.focus())}}});let e="ag-advanced-filter-builder-virtual-list-item-highlight";this.addManagedListeners(this.focusWrapper,{keydown:e=>{e.key===m.KeyCode.ENTER&&((0,m._isStopPropagationForAgGrid)(e)||(0,m._getActiveDomElement)(this.beans)===this.focusWrapper&&(e.preventDefault(),(0,m._stopPropagationForAgGrid)(e),this.eFocusableComp.getFocusableElement().focus()))},focusin:()=>{this.focusWrapper.classList.add(e)},focusout:t=>{this.focusWrapper.contains(t.relatedTarget)||this.focusWrapper.classList.remove(e)}})}};function io(e,t){return{pickerAriaLabelKey:"ariaLabelAdvancedFilterBuilderAddField",pickerAriaLabelValue:"Advanced Filter Builder Add Field",pickerType:"ag-list",valueList:[{key:"condition",displayValue:e("advancedFilterBuilderAddCondition")},{key:"join",displayValue:e("advancedFilterBuilderAddJoin")}],valueFormatter:e=>null==e?"":e.displayValue??e.key,pickerIcon:"advancedFilterBuilderAdd",maxPickerWidth:`${t??120}px`,wrapperClassName:"ag-advanced-filter-builder-item-button",ariaLabel:e("advancedFilterBuilderAddButtonTooltip")}}var id={tag:"div",cls:"ag-advanced-filter-builder-item-wrapper",role:"presentation",children:[{tag:"div",ref:"eItem",cls:"ag-advanced-filter-builder-item",role:"presentation",children:[{tag:"div",cls:"ag-advanced-filter-builder-item-tree-lines",attrs:{"aria-hidden":"true"},children:[{tag:"div",cls:"ag-advanced-filter-builder-item-tree-line ag-advanced-filter-builder-item-tree-line-vertical-top ag-advanced-filter-builder-item-tree-line-horizontal"}]}]}]},ih=class extends m.Component{constructor(e,t){super(id),this.item=e,this.focusWrapper=t,this.eItem=m.RefPlaceholder}wireBeans(e){this.advFilterExpSvc=e.advFilterExpSvc,this.registry=e.registry}postConstruct(){(0,m._setAriaLevel)(this.focusWrapper,2);let e=io(e=>this.advFilterExpSvc.translate(e),this.gos.get("advancedFilterBuilderParams")?.addSelectWidth),t=this.createManagedBean(new ia(e));this.addManagedListeners(t,{fieldPickerValueSelected:({value:e})=>{this.dispatchLocalEvent({type:"advancedFilterBuilderAdded",item:this.item,isJoin:"join"===e.key})}}),this.eItem.appendChild(t.getGui()),this.createOptionalManagedBean(this.registry.createDynamicBean("tooltipFeature",!1,{getGui:()=>t.getGui(),getLocation:()=>"advancedFilter",getTooltipValue:()=>this.advFilterExpSvc.translate("advancedFilterBuilderAddButtonTooltip")})),this.createManagedBean(new il(this.getGui(),this.focusWrapper,t)),(0,m._setAriaLabel)(this.focusWrapper,this.advFilterExpSvc.translate("ariaAdvancedFilterBuilderItem",[this.advFilterExpSvc.translate("advancedFilterBuilderAddButtonTooltip"),`${this.item.level+1}`]))}afterAdd(){}},iu=class extends m.Component{constructor(){super({tag:"div",cls:"ag-advanced-filter-builder-item-condition",role:"presentation"}),this.validationMessage=null}wireBeans(e){this.advFilterExpSvc=e.advFilterExpSvc}init(e){let{item:t,createPill:i}=e;this.item=t,this.createPill=i,this.filterModel=t.filterModel,this.setupColumnCondition(this.filterModel),this.validate(),this.addDestroyFunc(()=>this.destroyBeans([this.eColumnPill,this.eOperatorPill,this.eOperandPill]))}getDragName(){return this.filterModel.colId?this.advFilterExpSvc.parseColumnFilterModel(this.filterModel):this.getDefaultColumnDisplayValue()}getAriaLabel(){return`${this.advFilterExpSvc.translate("ariaAdvancedFilterBuilderFilterItem")} ${this.getDragName()}`}getValidationMessage(){return this.validationMessage}getFocusableElement(){return this.eColumnPill.getFocusableElement()}setupColumnCondition(e){let t=this.advFilterExpSvc.getColumnDetails(e.colId);this.baseCellDataType=t.baseCellDataType,this.column=t.column,this.numOperands=this.getNumOperands(this.getOperatorKey()),this.eColumnPill=this.createPill({key:this.getColumnKey(),displayValue:this.getColumnDisplayValue()??this.getDefaultColumnDisplayValue(),cssClass:"ag-advanced-filter-builder-column-pill",isSelect:!0,getEditorParams:()=>({values:this.advFilterExpSvc.getColumnAutocompleteEntries()}),update:e=>this.setColumnKey(e),pickerAriaLabelKey:"ariaLabelAdvancedFilterBuilderColumnSelectField",pickerAriaLabelValue:"Advanced Filter Builder Column Select Field",ariaLabel:this.advFilterExpSvc.translate("ariaAdvancedFilterBuilderColumn")}),this.getGui().appendChild(this.eColumnPill.getGui()),(0,m._exists)(this.getColumnKey())&&(this.createOperatorPill(),this.hasOperand()&&this.createOperandPill())}createOperatorPill(){this.eOperatorPill=this.createPill({key:this.getOperatorKey(),displayValue:this.getOperatorDisplayValue()??this.getDefaultOptionSelectValue(),cssClass:"ag-advanced-filter-builder-option-pill",isSelect:!0,getEditorParams:()=>({values:this.getOperatorAutocompleteEntries()}),update:e=>this.setOperatorKey(e),pickerAriaLabelKey:"ariaLabelAdvancedFilterBuilderOptionSelectField",pickerAriaLabelValue:"Advanced Filter Builder Option Select Field",ariaLabel:this.advFilterExpSvc.translate("ariaAdvancedFilterBuilderOption")}),this.eColumnPill.getGui().insertAdjacentElement("afterend",this.eOperatorPill.getGui())}createOperandPill(){let{filter:e}=this.filterModel,t=("number"==typeof e||"bigint"==typeof e?(0,m._toStringOrNull)(e):e)??"";this.eOperandPill=this.createPill({key:t,valueFormatter:e=>this.advFilterExpSvc.getOperandDisplayValue({...this.filterModel,filter:e},!0),baseCellDataType:this.baseCellDataType,cssClass:"ag-advanced-filter-builder-value-pill",isSelect:!1,update:e=>this.setOperand(e),ariaLabel:this.advFilterExpSvc.translate("ariaAdvancedFilterBuilderValue")}),this.getGui().appendChild(this.eOperandPill.getGui())}getColumnKey(){return this.filterModel.colId}getColumnDisplayValue(){return this.advFilterExpSvc.getColumnDisplayValue(this.filterModel)}getOperatorKey(){return this.filterModel.type}getOperatorDisplayValue(){return this.advFilterExpSvc.getOperatorDisplayValue(this.filterModel)}getOperandDisplayValue(){return this.advFilterExpSvc.getOperandDisplayValue(this.filterModel,!0)}hasOperand(){return this.numOperands>0}getOperatorAutocompleteEntries(){return this.column?this.advFilterExpSvc.getOperatorAutocompleteEntries(this.column,this.baseCellDataType):[]}setColumnKey(e){this.eOperatorPill||this.createOperatorPill();let t=this.advFilterExpSvc.getColumnDetails(e);this.column=t.column;let i=t.baseCellDataType;this.baseCellDataType!==i&&(this.baseCellDataType=i,this.setOperatorKey(void 0),this.eOperatorPill&&((0,m._removeFromParent)(this.eOperatorPill.getGui()),this.destroyBean(this.eOperatorPill),this.createOperatorPill()),this.validate()),this.filterModel.colId=e,this.filterModel.filterType=this.baseCellDataType}setOperatorKey(e){let t=this.getNumOperands(e);t!==this.numOperands&&(this.numOperands=t,0===t?this.destroyOperandPill():(this.createOperandPill(),"number"!==this.baseCellDataType&&this.setOperand(""))),this.filterModel.type=e,this.validate()}setOperand(e){let t=e;"number"===this.baseCellDataType&&(t=(0,m._exists)(e)?Number(e):""),this.filterModel.filter=t,this.validate()}getNumOperands(e){return this.advFilterExpSvc.getExpressionOperator(this.baseCellDataType,e)?.numOperands??0}destroyOperandPill(){delete this.filterModel.filter,this.eOperandPill?.getGui().remove(),this.destroyBean(this.eOperandPill),this.eOperandPill=void 0}validate(){let e=null;(0,m._exists)(this.getColumnKey())?(0,m._exists)(this.getOperatorKey())?this.numOperands>0&&!(0,m._exists)(this.getOperandDisplayValue())&&(e=this.advFilterExpSvc.translate("advancedFilterBuilderValidationEnterValue")):e=this.advFilterExpSvc.translate("advancedFilterBuilderValidationSelectOption"):e=this.advFilterExpSvc.translate("advancedFilterBuilderValidationSelectColumn"),this.item.valid=!e,e!==this.validationMessage&&(this.validationMessage=e,this.dispatchLocalEvent({type:"advancedFilterBuilderValidChanged"}))}getDefaultColumnDisplayValue(){return this.advFilterExpSvc.translate("advancedFilterBuilderSelectColumn")}getDefaultOptionSelectValue(){return this.advFilterExpSvc.translate("advancedFilterBuilderSelectOption")}},ic={number:[m.AgInputNumberField],bigint:[m.AgInputTextField],boolean:[m.AgInputTextField],object:[m.AgInputTextField],text:[m.AgInputTextField],date:[m.AgInputDateField],dateString:[m.AgInputDateField],dateTime:[m.AgInputDateField,e=>e.setIncludeTime(!0)],dateTimeString:[m.AgInputDateField,e=>e.setIncludeTime(!0)]},ip={tag:"div",cls:"ag-advanced-filter-builder-pill-wrapper",role:"presentation",children:[{tag:"div",ref:"ePill",cls:"ag-advanced-filter-builder-pill",role:"button",children:[{tag:"span",ref:"eLabel",cls:"ag-advanced-filter-builder-pill-display"}]}]},ig=class extends m.Component{constructor(e){super(ip),this.params=e,this.ePill=m.RefPlaceholder,this.eLabel=m.RefPlaceholder;const{value:t,valueFormatter:i}=e;this.value=t,this.displayValue=i(t)}wireBeans(e){this.advFilterExpSvc=e.advFilterExpSvc}postConstruct(){let{cssClass:e,ariaLabel:t}=this.params;this.ePill.classList.add(e),this.activateTabIndex([this.ePill]),this.eLabel.id=`${this.getCompId()}`,(0,m._setAriaDescribedBy)(this.ePill,this.eLabel.id),(0,m._setAriaLabel)(this.ePill,t),this.renderValue(),this.addManagedListeners(this.ePill,{click:e=>{e.preventDefault(),this.showEditor()},keydown:e=>{e.key===m.KeyCode.ENTER&&(e.preventDefault(),(0,m._stopPropagationForAgGrid)(e),this.showEditor())}}),this.addDestroyFunc(()=>this.destroyBean(this.eEditor))}getFocusableElement(){return this.ePill}showEditor(){if(this.eEditor)return;(0,m._setDisplayed)(this.ePill,!1),this.eEditor=this.createEditorComp(this.params.type),this.eEditor.setValue(this.value);let e=this.eEditor.getGui();this.eEditor.addManagedElementListeners(e,{keydown:e=>{switch(e.key){case m.KeyCode.ENTER:e.preventDefault(),(0,m._stopPropagationForAgGrid)(e),this.updateValue(!0);break;case m.KeyCode.ESCAPE:e.preventDefault(),(0,m._stopPropagationForAgGrid)(e),this.hideEditor(!0)}},focusout:()=>this.updateValue(!1)}),this.getGui().appendChild(e),this.eEditor.getFocusableElement().focus()}createEditorComp(e){let[t,i]=ic[e],s=this.createBean(new t);return i?.(s),s}hideEditor(e){let{eEditor:t}=this;t&&(this.eEditor=void 0,t.getGui().remove(),this.destroyBean(t),(0,m._setDisplayed)(this.ePill,!0),e&&this.ePill.focus())}renderValue(){let e,{displayValue:t,eLabel:i,params:s}=this,{type:r}=s,{classList:a}=i;a.remove("ag-advanced-filter-builder-value-empty","ag-advanced-filter-builder-value-number","ag-advanced-filter-builder-value-text"),(0,m._exists)(t)?"number"===r||"bigint"===r?(e=t,a.add("ag-advanced-filter-builder-value-number")):(e=`"${t}"`,a.add("ag-advanced-filter-builder-value-text")):(e=this.advFilterExpSvc.translate("advancedFilterBuilderEnterValue"),a.add("ag-advanced-filter-builder-value-empty")),i.textContent=e}updateValue(e){if(!this.eEditor)return;let t=this.eEditor.getValue()??"";this.dispatchLocalEvent({type:"fieldValueChanged",value:t}),this.value=t,this.displayValue=this.params.valueFormatter(t),this.renderValue(),this.hideEditor(e)}},im=class extends m.Component{wireBeans(e){this.advFilterExpSvc=e.advFilterExpSvc}constructor(){super({tag:"div",cls:"ag-advanced-filter-builder-item-condition",role:"presentation"})}init(e){let{item:t,createPill:i}=e,s=t.filterModel;this.filterModel=s,this.ePill=i({key:s.type,displayValue:this.advFilterExpSvc.parseJoinOperator(s),cssClass:"ag-advanced-filter-builder-join-pill",isSelect:!0,getEditorParams:()=>({values:this.advFilterExpSvc.getJoinOperatorAutocompleteEntries()}),update:e=>s.type=e,pickerAriaLabelKey:"ariaLabelAdvancedFilterBuilderJoinSelectField",pickerAriaLabelValue:"Advanced Filter Builder Join Operator Select Field",ariaLabel:this.advFilterExpSvc.translate("ariaAdvancedFilterBuilderJoinOperator")}),this.getGui().appendChild(this.ePill.getGui()),this.addDestroyFunc(()=>this.destroyBean(this.ePill))}getDragName(){return this.advFilterExpSvc.parseJoinOperator(this.filterModel)}getAriaLabel(){return`${this.advFilterExpSvc.translate("ariaAdvancedFilterBuilderGroupItem")} ${this.getDragName()}`}getValidationMessage(){return null}getFocusableElement(){return this.ePill.getFocusableElement()}},iC={tag:"div",cls:"ag-picker-field ag-advanced-filter-builder-pill-wrapper",role:"presentation",children:[{tag:"div",ref:"eLabel"},{tag:"div",ref:"eWrapper",cls:"ag-wrapper ag-advanced-filter-builder-pill ag-picker-collapsed",children:[{tag:"div",ref:"eDisplayField",cls:"ag-picker-field-display ag-advanced-filter-builder-pill-display"},{tag:"ag-input-text-field",ref:"eInput",cls:"ag-rich-select-field-input"},{tag:"span",ref:"eDeselect",cls:"ag-rich-select-deselect-button ag-picker-field-icon",role:"presentation"},{tag:"div",ref:"eIcon",cls:"ag-picker-field-icon",attrs:{"aria-hidden":"true"}}]}]},iv=class extends it{constructor(e){super({...e,template:iC,agComponents:[m.AgInputTextFieldSelector]}),this.params=e}getFocusableElement(){return this.eWrapper}showPicker(){setTimeout(()=>super.showPicker())}hidePicker(){setTimeout(()=>super.hidePicker())}postConstruct(){super.postConstruct();let{wrapperClassName:e,ariaLabel:t}=this.params;this.eWrapper.classList.add(e),(0,m._setAriaLabelledBy)(this.eWrapper,""),(0,m._setAriaLabel)(this.eWrapper,t)}createPickerComponent(){if(!this.values){let{values:e}=this.params.getEditorParams();this.values=e;let t=this.value.key,i=e.find(e=>e.key===t)??{key:t,displayValue:this.value.displayValue};this.value=i}return super.createPickerComponent()}onEnterKeyDown(e){(0,m._stopPropagationForAgGrid)(e),this.isPickerDisplayed?super.onEnterKeyDown(e):(e.preventDefault(),this.showPicker())}},ib={tag:"div",cls:"ag-advanced-filter-builder-item-wrapper",role:"presentation",children:[{tag:"div",cls:"ag-advanced-filter-builder-item",role:"presentation",children:[{tag:"div",ref:"eTreeLines",cls:"ag-advanced-filter-builder-item-tree-lines",attrs:{"aria-hidden":"true"}},{tag:"span",ref:"eDragHandle",cls:"ag-drag-handle",attrs:{"aria-hidden":"true"}},{tag:"span",ref:"eValidation",cls:"ag-advanced-filter-builder-item-button ag-advanced-filter-builder-invalid",attrs:{"aria-hidden":"true"}}]},{tag:"div",ref:"eButtons",cls:"ag-advanced-filter-builder-item-buttons",children:[{tag:"span",ref:"eMoveUpButton",cls:"ag-advanced-filter-builder-item-button",role:"button"},{tag:"span",ref:"eMoveDownButton",cls:"ag-advanced-filter-builder-item-button",role:"button"},{tag:"div",ref:"eAddButton",role:"presentation"},{tag:"span",ref:"eRemoveButton",cls:"ag-advanced-filter-builder-item-button",role:"button"}]}]},iy=class extends m.TabGuardComp{constructor(e,t,i){super(ib),this.item=e,this.dragFeature=t,this.focusWrapper=i,this.eTreeLines=m.RefPlaceholder,this.eDragHandle=m.RefPlaceholder,this.eButtons=m.RefPlaceholder,this.eValidation=m.RefPlaceholder,this.eMoveUpButton=m.RefPlaceholder,this.eMoveDownButton=m.RefPlaceholder,this.eAddButton=m.RefPlaceholder,this.eRemoveButton=m.RefPlaceholder,this.moveUpDisabled=!1,this.moveDownDisabled=!1}wireBeans(e){this.dragAndDrop=e.dragAndDrop,this.advFilterExpSvc=e.advFilterExpSvc,this.registry=e.registry}postConstruct(){let{filterModel:e,level:t,showMove:i}=this.item,s="join"===e.filterType;if(this.ePillWrapper=this.createManagedBean(s?new im:new iu),this.ePillWrapper.init({item:this.item,createPill:e=>this.createPill(e)}),this.eDragHandle.insertAdjacentElement("afterend",this.ePillWrapper.getGui()),0===t){let e=(0,m._createElement)({tag:"div",cls:"ag-advanced-filter-builder-item-tree-line ag-advanced-filter-builder-item-tree-line-vertical-bottom ag-advanced-filter-builder-item-tree-line-root"});this.eTreeLines.appendChild(e),(0,m._setDisplayed)(this.eDragHandle,!1),(0,m._setDisplayed)(this.eButtons,!1),(0,m._setAriaExpanded)(this.focusWrapper,!0)}else this.setupTreeLines(t),this.eDragHandle.appendChild((0,m._createIconNoSpan)("advancedFilterBuilderDrag",this.beans)),this.setupValidation(),this.setupMoveButtons(i),this.setupAddButton(),this.setupRemoveButton(),this.setupDragging(),this.updateAriaExpanded();(0,m._setAriaLevel)(this.focusWrapper,t+1),this.initialiseTabGuard({}),this.createManagedBean(new il(this.getGui(),this.focusWrapper,this.ePillWrapper)),this.updateAriaLabel(),this.addManagedListeners(this.ePillWrapper,{advancedFilterBuilderValueChanged:()=>this.dispatchLocalEvent({type:"advancedFilterBuilderValueChanged"}),advancedFilterBuilderValidChanged:()=>this.updateValidity()})}setState(e){let{level:t}=this.item;if(0===t)return;let{showMove:i}=this.item,{disableMoveUp:s,disableMoveDown:r,treeLines:a,showStartTreeLine:l}=e;this.updateTreeLines(a,l),this.updateAriaExpanded(),i&&(this.moveUpDisabled=!!s,this.moveDownDisabled=!!r,this.eMoveUpButton.classList.toggle("ag-advanced-filter-builder-item-button-disabled",s),this.eMoveDownButton.classList.toggle("ag-advanced-filter-builder-item-button-disabled",r),(0,m._setAriaDisabled)(this.eMoveUpButton,!!s),(0,m._setAriaDisabled)(this.eMoveDownButton,!!r),this.moveUpTooltipFeature?.refreshTooltip(),this.moveDownTooltipFeature?.refreshTooltip())}focusMoveButton(e){(e?this.eMoveUpButton:this.eMoveDownButton).focus()}afterAdd(){this.ePillWrapper.getFocusableElement().focus()}setupTreeLines(e){for(let t=0;t<e;t++)this.eTreeLines.appendChild((0,m._createElement)({tag:"div",cls:"ag-advanced-filter-builder-item-tree-line"}))}updateTreeLines(e,t){let i=e.length-1,{children:s}=this.eTreeLines;for(let t=0;t<i;t++){let i=s.item(t);i&&i.classList.toggle("ag-advanced-filter-builder-item-tree-line-vertical",!e[t])}let r=s.item(i);if(r){r.classList.add("ag-advanced-filter-builder-item-tree-line-horizontal");let t=e[i];r.classList.toggle("ag-advanced-filter-builder-item-tree-line-vertical-top",t),r.classList.toggle("ag-advanced-filter-builder-item-tree-line-vertical",!t)}this.eDragHandle.classList.toggle("ag-advanced-filter-builder-item-tree-line-vertical-bottom",t)}setupValidation(){this.eValidation.appendChild((0,m._createIconNoSpan)("advancedFilterBuilderInvalid",this.beans)),this.validationTooltipFeature=this.createOptionalManagedBean(this.registry.createDynamicBean("tooltipFeature",!1,{getGui:()=>this.eValidation,getLocation:()=>"advancedFilter",getTooltipValue:()=>this.ePillWrapper.getValidationMessage(),getTooltipShowDelayOverride:()=>1e3})),this.updateValidity()}setupAddButton(){let e=io(e=>this.advFilterExpSvc.translate(e),this.gos.get("advancedFilterBuilderParams")?.addSelectWidth),t=this.createManagedBean(new ia(e));this.addManagedListeners(t,{fieldPickerValueSelected:({value:e})=>this.dispatchLocalEvent({type:"advancedFilterBuilderAdded",item:this.item,isJoin:"join"===e.key})}),this.eAddButton.appendChild(t.getGui()),this.createOptionalManagedBean(this.registry.createDynamicBean("tooltipFeature",!1,{getGui:()=>this.eAddButton,getLocation:()=>"advancedFilter",getTooltipValue:()=>this.advFilterExpSvc.translate("advancedFilterBuilderAddButtonTooltip")}))}setupRemoveButton(){this.eRemoveButton.appendChild((0,m._createIconNoSpan)("advancedFilterBuilderRemove",this.beans)),this.addManagedListeners(this.eRemoveButton,{click:()=>this.removeItem(),keydown:e=>{e.key===m.KeyCode.ENTER&&(e.preventDefault(),(0,m._stopPropagationForAgGrid)(e),this.removeItem())}}),this.createOptionalManagedBean(this.registry.createDynamicBean("tooltipFeature",!1,{getGui:()=>this.eRemoveButton,getLocation:()=>"advancedFilter",getTooltipValue:()=>this.advFilterExpSvc.translate("advancedFilterBuilderRemoveButtonTooltip")})),(0,m._setAriaLabel)(this.eRemoveButton,this.advFilterExpSvc.translate("advancedFilterBuilderRemoveButtonTooltip")),this.activateTabIndex([this.eRemoveButton])}setupMoveButtons(e){e?(this.eMoveUpButton.appendChild((0,m._createIconNoSpan)("advancedFilterBuilderMoveUp",this.beans)),this.addManagedListeners(this.eMoveUpButton,{click:()=>this.moveItem(!0),keydown:e=>{e.key===m.KeyCode.ENTER&&(e.preventDefault(),(0,m._stopPropagationForAgGrid)(e),this.moveItem(!0))}}),this.moveUpTooltipFeature=this.createOptionalManagedBean(this.registry.createDynamicBean("tooltipFeature",!1,{getGui:()=>this.eMoveUpButton,getLocation:()=>"advancedFilter",getTooltipValue:()=>this.moveUpDisabled?null:this.advFilterExpSvc.translate("advancedFilterBuilderMoveUpButtonTooltip")})),(0,m._setAriaLabel)(this.eMoveUpButton,this.advFilterExpSvc.translate("advancedFilterBuilderMoveUpButtonTooltip")),this.eMoveDownButton.appendChild((0,m._createIconNoSpan)("advancedFilterBuilderMoveDown",this.beans)),this.addManagedListeners(this.eMoveDownButton,{click:()=>this.moveItem(!1),keydown:e=>{e.key===m.KeyCode.ENTER&&(e.preventDefault(),(0,m._stopPropagationForAgGrid)(e),this.moveItem(!1))}}),this.moveDownTooltipFeature=this.createOptionalManagedBean(this.registry.createDynamicBean("tooltipFeature",!1,{getGui:()=>this.eMoveDownButton,getLocation:()=>"advancedFilter",getTooltipValue:()=>this.moveDownDisabled?null:this.advFilterExpSvc.translate("advancedFilterBuilderMoveDownButtonTooltip")})),(0,m._setAriaLabel)(this.eMoveDownButton,this.advFilterExpSvc.translate("advancedFilterBuilderMoveDownButtonTooltip")),this.activateTabIndex([this.eMoveUpButton,this.eMoveDownButton])):((0,m._setDisplayed)(this.eMoveUpButton,!1),(0,m._setDisplayed)(this.eMoveDownButton,!1))}updateValidity(){(0,m._setVisible)(this.eValidation,!this.item.valid),this.validationTooltipFeature?.refreshTooltip(),this.updateAriaLabel()}createPill(e){let{key:t,cssClass:i,update:s,ariaLabel:r}=e,a=e=>{null!=e&&(s(e),this.dispatchLocalEvent({type:"advancedFilterBuilderValueChanged"}))};if(e.isSelect){let{getEditorParams:s,pickerAriaLabelKey:l,pickerAriaLabelValue:n,displayValue:o}=e,d=this.gos.get("advancedFilterBuilderParams"),h=`${d?.pillSelectMinWidth??140}px`,u=`${d?.pillSelectMaxWidth??200}px`,c=this.createBean(new iv({pickerAriaLabelKey:l,pickerAriaLabelValue:n,pickerType:"ag-list",value:{key:t,displayValue:o},valueFormatter:e=>null==e?"":e.displayValue??e.key,variableWidth:!0,minPickerWidth:h,maxPickerWidth:u,getEditorParams:s,wrapperClassName:i,ariaLabel:r,pickerIcon:"advancedFilterBuilderSelectOpen"}));return this.addManagedListeners(c,{fieldPickerValueSelected:({value:e})=>a(e?.key)}),c}{let{baseCellDataType:s,valueFormatter:l}=e,n=this.createBean(new ig({value:t,valueFormatter:l,cssClass:i,type:s,ariaLabel:r}));return this.addManagedListeners(n,{fieldValueChanged:({value:e})=>a(e)}),n}}setupDragging(){let e={type:m.DragSourceType.AdvancedFilterBuilder,eElement:this.eDragHandle,dragItemName:()=>this.ePillWrapper.getDragName(),getDefaultIconName:()=>"notAllowed",getDragItem:()=>({}),onDragStarted:()=>this.dragFeature.dispatchLocalEvent({type:"advancedFilterBuilderDragStarted",item:this.item}),onDragStopped:()=>this.dragFeature.dispatchLocalEvent({type:"advancedFilterBuilderDragEnded"})};this.dragAndDrop.addDragSource(e,!0),this.addDestroyFunc(()=>this.dragAndDrop.removeDragSource(e))}updateAriaLabel(){let e,t=this.ePillWrapper.getAriaLabel(),i=`${this.item.level+1}`,s=this.ePillWrapper.getValidationMessage();e=s?this.advFilterExpSvc.translate("ariaAdvancedFilterBuilderItemValidation",[t,i,s]):this.advFilterExpSvc.translate("ariaAdvancedFilterBuilderItem",[t,i]),(0,m._setAriaLabel)(this.focusWrapper,e)}updateAriaExpanded(){(0,m._removeAriaExpanded)(this.focusWrapper);let{filterModel:e}=this.item;e?.filterType==="join"&&e.conditions.length&&(0,m._setAriaExpanded)(this.focusWrapper,!0)}removeItem(){this.dispatchLocalEvent({type:"advancedFilterBuilderRemoved",item:this.item})}moveItem(e){this.dispatchLocalEvent({type:"advancedFilterBuilderMoved",item:this.item,backwards:e})}},iw={apply:"advancedFilterBuilderApply",clear:"advancedFilterBuilderClear",cancel:"advancedFilterBuilderCancel",reset:"advancedFilterBuilderReset"},iS={tag:"div",cls:"ag-advanced-filter-builder",role:"presentation",attrs:{tabindex:"-1"},children:[{tag:"div",ref:"eList",cls:"ag-advanced-filter-builder-list",role:"presentation"}]},ix=class extends m.Component{constructor(){super(iS),this.eList=m.RefPlaceholder}wireBeans(e){this.filterManager=e.filterManager,this.advancedFilter=e.advancedFilter,this.advFilterExpSvc=e.advFilterExpSvc}postConstruct(){let e=this.gos.get("advancedFilterBuilderParams");this.params={buttons:["apply","cancel"],...e},this.addManagedPropertyListener("advancedFilterBuilderParams",({currentValue:e})=>{this.params.showMoveButtons=!!e?.showMoveButtons,this.params.buttons=e?.buttons??["apply","cancel"],this.refreshList(!1)}),this.filterModel=this.setupFilterModel(),this.setupVirtualList(),this.dragFeature=this.createManagedBean(new t0(this,this.virtualList)),this.resetButtonsPanel(this.params.buttons)}refresh(){let e=this.virtualList,t=e.getLastFocusedRow();this.setupFilterModel(),this.validateItems(),this.refreshList(!1),null!=t&&(e.getComponentAt(t)||(t=0),e.focusRow(t))}getNumItems(){return this.items.length}moveItem(e,t){t&&e&&this.moveItemToIndex(e,t.rowIndex,t.position)}afterGuiAttached(){this.virtualList.awaitStable(()=>this.virtualList.focusRow(0))}setupVirtualList(){let e=this.virtualList=this.createManagedBean(new t_({cssIdentifier:"advanced-filter-builder",ariaRole:"tree",listName:this.advFilterExpSvc.translate("ariaAdvancedFilterBuilderList"),moveItemCallback:this.virtualListMoveItemCallback.bind(this)}));e.setComponentCreator(this.createItemComponent.bind(this)),e.setComponentUpdater(this.updateItemComponent.bind(this)),e.setRowHeight(40),this.eList.appendChild(e.getGui()),e.setModel({getRowCount:()=>this.items?.length||0,getRow:e=>this.items[e],areRowsEqual:(e,t)=>e===t}),this.buildList(),e.refresh()}resetButtonsPanel(e){let t=e&&e.length>0,i=this.eButtons;if(t){let t=e.map(e=>({type:e,label:this.advFilterExpSvc.translate(iw[e])}));if(!i){i=this.createBean(new m.FilterButtonComp),this.appendChild(i.getGui());let e=e=>({event:t})=>{this.updateModel(e),this.afterAction(e,t)};i.addManagedListeners(i,{apply:e("apply"),clear:e("clear"),reset:e("reset"),cancel:e("cancel")}),this.eButtons=i}i.updateButtons(t);let s=i.getApplyButton();if(s){let e=e=>this.toggleCss("ag-advanced-filter-builder-validation",e);this.addManagedElementListeners(s,{mouseenter:()=>e(!0),mouseleave:()=>e(!1)})}}else i&&((0,m._removeFromParent)(i.getGui()),this.eButtons=this.destroyBean(i))}updateModel(e){switch(e){case"apply":this.advancedFilter.setModel(this.filterModel),this.filterManager?.onFilterChanged({source:"advancedFilter"});break;case"reset":this.advancedFilter.setModel(null),this.filterManager?.onFilterChanged({source:"advancedFilter"});break;case"cancel":break;case"clear":this.filterModel=this.formatFilterModel(null),this.refreshList(!1)}}afterAction(e,t){switch(e){case"apply":t?.preventDefault(),this.close();break;case"reset":case"cancel":this.close()}}removeItemFromParent(e){let t=e.parent.conditions.indexOf(e.filterModel);return e.parent.conditions.splice(t,1),t}moveItemToIndex(e,t,i){let s,r=this.items[t],a=r.filterModel?.filterType==="join"&&"bottom"===i,l=a?r.filterModel:r.parent;!l||this.isChildOrSelf(l,e.filterModel)||r===e||(this.removeItemFromParent(e),a?s=0:-1===(s=l.conditions.indexOf(r.filterModel))?s=l.conditions.length:"bottom"===i&&(s+=1),l.conditions.splice(s,0,e.filterModel),this.refreshList(!1))}isChildOrSelf(e,t){return e===t||"join"===t.filterType&&t.conditions.some(t=>this.isChildOrSelf(e,t))}setupFilterModel(){let e=this.formatFilterModel(this.advancedFilter.getModel());return this.stringifiedModel=JSON.stringify(e),e}formatFilterModel(e){return"join"!==(e=e??{filterType:"join",type:"AND",conditions:[]}).filterType&&(e={filterType:"join",type:"AND",conditions:[e]}),e}buildList(){let e=(t,i,s,r)=>{if(i.push({filterModel:t,level:s,parent:r,valid:!0,showMove:this.params.showMoveButtons}),"join"===t.filterType){for(let r of t.conditions)e(r,i,s+1,t);0===s&&i.push({filterModel:null,level:s+1,parent:t,valid:!0})}};this.items=[],e(this.filterModel,this.items,0)}refreshList(e){if(!e){let e=[];for(let t of this.items)t.valid||e.push(t.filterModel);if(this.buildList(),e.length)for(let t of this.items)t.filterModel&&e.includes(t.filterModel)&&(t.valid=!1)}this.virtualList.refresh(e),this.validate()}updateItemComponent(e,t){let i=this.items.indexOf(e),s=(e,t)=>{let i=this.items.find(t=>t.filterModel===e),r=i?.parent;if(r){let{conditions:i}=r;s(r,t),t.push(i[i.length-1]===e)}},r=[],{filterModel:a}=e;a&&(s(a,r),r[0]=!1);let l=a?.filterType==="join"&&!!a.conditions.length;t.setState({disableMoveUp:1===i,disableMoveDown:!this.canMoveDown(e,i),treeLines:r,showStartTreeLine:l})}createItemComponent(e,t){let i=this.createBean(e.filterModel?new iy(e,this.dragFeature,t):new ih(e,t));return i.addManagedListeners(i,{advancedFilterBuilderRemoved:({item:e})=>this.removeItem(e),advancedFilterBuilderValueChanged:()=>this.validate(),advancedFilterBuilderAdded:({item:e,isJoin:t})=>this.addItem(e,t),advancedFilterBuilderMoved:({item:e,backwards:t})=>this.moveItemUpDown(e,t)}),i instanceof iy&&this.updateItemComponent(e,i),i}addItem(e,t){let{parent:i,level:s,filterModel:r}=e,a=r?.filterType==="join",l=t?{filterType:"join",type:"AND",conditions:[]}:{},n=a?r:i,o=a?0:n.conditions.indexOf(r);o>=0?(a||(o+=1),n.conditions.splice(o,0,l)):n.conditions.push(l);let d=this.items.indexOf(e),h=d>=0;if(h){e.filterModel&&d++;let i=[{filterModel:l,level:a?s+1:s,parent:n,valid:t,showMove:this.params.showMoveButtons}];this.items.splice(d,0,...i)}this.refreshList(h),h&&this.virtualList.getComponentAt(d)?.afterAdd()}removeItem(e){let t=e.parent,{filterModel:i}=e,s=t.conditions.indexOf(i);t.conditions.splice(s,1);let r=e.filterModel?.filterType==="join",a=this.items.indexOf(e),l=!r&&a>=0;l&&this.items.splice(a,1),this.refreshList(l),a>=0&&this.virtualList.focusRow(a)}moveItemUpDown(e,t,i){let s=this.items.indexOf(e),r=t?s-1:s+1;if(0===r||!t&&!this.canMoveDown(e,s))return;let a=this.items[r],l=this.removeItemFromParent(e),{level:n,filterModel:o,parent:d}=e,{level:h,filterModel:u,parent:c}=a;if(t)if(h===n&&"join"===u.filterType)u.conditions.push(o);else if(h<=n){let e=c.conditions.indexOf(u);c.conditions.splice(e,0,o)}else d.conditions[l-1].conditions.push(o);else if(h===n)if("join"===u.filterType)u.conditions.splice(0,0,o);else{let e=c.conditions.indexOf(u);c.conditions.splice(e+1,0,o)}else if(l<d.conditions.length)d.conditions.splice(l+1,0,o);else{let e=this.items.find(e=>e.filterModel===d),t=e.parent.conditions.indexOf(e.filterModel)+1;e.parent.conditions.splice(t,0,o)}this.refreshList(!1);let p=this.items.findIndex(({filterModel:e})=>e===o);if(p<0)return;let g=this.virtualList.getComponentAt(p);g instanceof iy&&(i||g.focusMoveButton(t))}virtualListMoveItemCallback(e,t){let i=e.item,s=this.items.indexOf(i);s<=0||s===this.items.length-1||(!t||1!==s)&&(t||this.canMoveDown(i,s))&&(this.moveItemUpDown(i,t,!0),this.virtualList.focusRow(s+(t?-1:1)))}canMoveDown(e,t){return(1!==e.level||t!==this.items.length-2)&&(1!==e.level||e.parent.conditions[e.parent.conditions.length-1]!==e.filterModel)}close(){this.advancedFilter.getCtrl().toggleFilterBuilder({source:"ui"})}validate(){let e=this.items.every(({valid:e})=>e),t=null;e?(e=JSON.stringify(this.filterModel)!==this.stringifiedModel)||(t=this.advFilterExpSvc.translate("advancedFilterBuilderValidationAlreadyApplied")):t=this.advFilterExpSvc.translate("advancedFilterBuilderValidationIncomplete"),this.eButtons?.updateValidity(e,t)}validateItems(){let e=e=>{e.type=void 0},t=e=>{delete e.filter};for(let i of this.items){if(!i.valid||!i.filterModel||"join"===i.filterModel.filterType)continue;let{filterModel:s}=i,{colId:r}=s,a=this.advFilterExpSvc.getColumnAutocompleteEntries().find(({key:e})=>e===r),l=this.advFilterExpSvc.getColumnDetails(s.colId);if(!a||!l.column){i.valid=!1,s.colId=void 0,e(s),t(s);continue}let n=this.advFilterExpSvc.getDataTypeExpressionOperator(l.baseCellDataType).operators[s.type];if(!n){i.valid=!1,e(s),t(s);continue}n.numOperands>0&&!(0,m._exists)(s.filter)&&(i.valid=!1)}}},iF=class extends m.BeanStub{constructor(e){super(),this.enabled=e}wireBeans(e){this.ctrlsSvc=e.ctrlsSvc,this.popupSvc=e.popupSvc,this.advFilterExpSvc=e.advFilterExpSvc,this.environment=e.environment}postConstruct(){this.hasAdvancedFilterParent=!!this.gos.get("advancedFilterParent"),this.ctrlsSvc.whenReady(this,()=>this.setAdvancedFilterComp()),this.addManagedEventListeners({advancedFilterEnabledChanged:({enabled:e})=>this.onEnabledChanged(e)}),this.addManagedPropertyListener("advancedFilterParent",()=>this.updateComps()),this.addManagedPropertyListener("advancedFilterBuilderParams",e=>{e.currentValue?.suppressFullScreenButton!==e.previousValue?.suppressFullScreenButton&&this.eBuilderDialog?.setMaximizable(e.currentValue?.suppressFullScreenButton??!0)}),this.addDestroyFunc(()=>{this.destroyAdvancedFilterComp(),this.destroyBean(this.eBuilderComp),this.eBuilderDialog?.isAlive()&&this.destroyBean(this.eBuilderDialog)})}setupHeaderComp(e){this.eHeaderComp&&(this.eHeaderComp?.getGui().remove(),this.destroyBean(this.eHeaderComp)),this.eHeaderComp=this.createManagedBean(new tJ(this.enabled&&!this.hasAdvancedFilterParent)),e.insertAdjacentElement("beforebegin",this.eHeaderComp.getGui())}focusHeaderComp(){return!!this.eHeaderComp&&(this.eHeaderComp.getFocusableElement().focus(),!0)}refreshComp(){this.eFilterComp?.refresh(),this.eHeaderComp?.refresh()}refreshBuilderComp(){this.eBuilderComp?.refresh()}getHeaderHeight(){return this.eHeaderComp?.getHeight()??0}setInputDisabled(e){this.eFilterComp?.setInputDisabled(e),this.eHeaderComp?.setInputDisabled(e)}toggleFilterBuilder(e){let{source:t,force:i,eventSource:s}=e;if(i&&this.eBuilderDialog||!1===i&&!this.eBuilderDialog)return;if(this.eBuilderDialog){this.builderDestroySource=t,this.destroyBean(this.eBuilderDialog);return}this.setInputDisabled(!0);let{width:r,height:a,minWidth:l}=this.getBuilderDialogSize(),{suppressFullScreenButton:n}={suppressFullScreenButton:!1,...this.gos.get("advancedFilterBuilderParams")};this.eBuilderComp=this.createBean(new ix),this.eBuilderDialog=this.createBean(new tB({title:this.advFilterExpSvc.translate("advancedFilterBuilderTitle"),component:this.eBuilderComp,width:r,height:a,resizable:!0,movable:!0,maximizable:!n,centered:!0,closable:!0,minWidth:l,afterGuiAttached:()=>this.eBuilderComp?.afterGuiAttached(),postProcessPopupParams:{type:"advancedFilterBuilder",eventSource:s}})),this.dispatchFilterBuilderVisibleChangedEvent(t,!0),this.eBuilderDialog.addEventListener("destroyed",()=>{this.destroyBean(this.eBuilderComp),this.eBuilderComp=void 0,this.eBuilderDialog=void 0,this.setInputDisabled(!1),this.dispatchLocalEvent({type:"advancedFilterBuilderClosed"}),this.dispatchFilterBuilderVisibleChangedEvent(this.builderDestroySource??"ui",!1),this.builderDestroySource=void 0})}dispatchFilterBuilderVisibleChangedEvent(e,t){this.eventSvc.dispatchEvent({type:"advancedFilterBuilderVisibleChanged",source:e,visible:t})}getBuilderDialogSize(){let e=this.gos.get("advancedFilterBuilderParams")?.minWidth??500,t=this.popupSvc.getPopupParent();return{width:Math.min(Math.max(700,e),Math.round((0,m._getAbsoluteWidth)(t))-2),height:Math.min(600,Math.round(.75*(0,m._getAbsoluteHeight)(t))-2),minWidth:e}}onEnabledChanged(e){this.enabled=e,this.updateComps()}updateComps(){this.setAdvancedFilterComp(),this.setHeaderCompEnabled(),this.eventSvc.dispatchEvent({type:"headerHeightChanged"})}setAdvancedFilterComp(){if(this.destroyAdvancedFilterComp(),!this.enabled)return;let e=this.gos.get("advancedFilterParent");if(this.hasAdvancedFilterParent=!!e,e){let t=this.createBean(new tZ),i=t.getGui();this.environment.applyThemeClasses(i),i.classList.add(this.gos.get("enableRtl")?"ag-rtl":"ag-ltr"),e.appendChild(i),this.eFilterComp=t}}setHeaderCompEnabled(){this.eHeaderComp?.setEnabled(this.enabled&&!this.hasAdvancedFilterParent)}destroyAdvancedFilterComp(){this.eFilterComp&&((0,m._removeFromParent)(this.eFilterComp.getGui()),this.destroyBean(this.eFilterComp))}},iA=class{constructor(e){this.params=e,this.operators=[],this.operatorStartPositions=[],this.operatorEndPositions=[],this.activeOperator=0,this.validationError=null}parseExpression(e){this.operators.push(""),this.operatorStartPositions.push(e),this.operatorEndPositions.push(void 0);let{expression:t}=this.params;for(;e<t.length;){let i=t[e];if(" "===i){if(this.parseOperator(e-1))return this.activeOperator++,e-1;this.operators[this.activeOperator]+=i}else this.operators[this.activeOperator]+=i;e++}return this.parseOperator(e-1),e}isValid(){return!this.validationError&&(!this.operators.length||!!this.parsedOperator)}getValidationError(){return this.validationError}getFunction(){return"OR"===this.parsedOperator?"||":"&&"}getModel(){return"OR"===this.parsedOperator?"OR":"AND"}getAutocompleteListParams(e,t){let i;if(null==t)i="";else{let s=this.operators[t],r=this.operatorEndPositions[t];i=tw(s,e,null==r?this.params.expression.length:r+1)}let s=this.params.advFilterExpSvc.getJoinOperatorAutocompleteEntries();return(t||null==t&&this.activeOperator)&&(s=s.filter(({key:e})=>e===this.parsedOperator)),this.params.advFilterExpSvc.generateAutocompleteListParams(s,"join",i)}updateExpression(e,t,i){let{expression:s}=this.params,r=t.displayValue??t.key;if(0===i)for(let e=this.operatorEndPositions.length-1;e>0;e--){let t=this.operatorEndPositions[e];null!=t&&(s=tS(s,this.operatorStartPositions[e],t,r).updatedValue)}let a=this.operatorStartPositions.length>i?this.operatorStartPositions[i]:e,l=(this.operatorEndPositions.length>i?this.operatorEndPositions[i]:void 0)??tx(s,e,!0).endPosition;return tS(s,a,l,r,!0)}getNumOperators(){return this.operators.length}getLastOperatorEndPosition(){return this.operatorEndPositions[this.operatorEndPositions.length-1]}parseOperator(e){let t=this.operators.length>this.activeOperator?this.operators[this.activeOperator]:"",i=this.params.advFilterExpSvc.getExpressionJoinOperators(),s=tE(t,i,e=>e);if(s){this.operatorEndPositions[this.activeOperator]=e;let r=i[s];if(this.activeOperator){if(s!==this.parsedOperator)return this.validationError||(this.validationError={message:this.params.advFilterExpSvc.translate("advancedFilterValidationJoinOperatorMismatch"),startPosition:e-t.length+1,endPosition:e}),!1}else this.parsedOperator=s;return t!==r&&(tF(this.params,t,r,e),this.operators[this.activeOperator]=r),!0}return null!==s&&(this.validationError||(this.validationError={message:this.params.advFilterExpSvc.translate("advancedFilterValidationInvalidJoinOperator"),startPosition:e-t.length+1,endPosition:e}),!0)}},iM=class e{constructor(e,t){this.params=e,this.startPosition=t,this.expectingExpression=!0,this.expectingOperator=!1,this.expressionParsers=[],this.operatorParser=new iA(this.params),this.missingEndBracket=!1,this.extraEndBracket=!1}parseExpression(){let t=this.startPosition,{expression:i}=this.params;for(;t<i.length;){let s=i[t];if("("!==s||this.expectingOperator)if(")"===s)return this.endPosition=t-1,0===this.startPosition&&(this.extraEndBracket=!0),t;else if(" "===s);else if(this.expectingExpression){let e=new tI(this.params,t);t=e.parseExpression(),this.expressionParsers.push(e),this.expectingExpression=!1,this.expectingOperator=!0}else this.expectingOperator&&(t=this.operatorParser.parseExpression(t),this.expectingOperator=!1,this.expectingExpression=!0);else{let i=new e(this.params,t+1);t=i.parseExpression(),this.expressionParsers.push(i),this.expectingExpression=!1,this.expectingOperator=!0}t++}return this.startPosition>0&&(this.missingEndBracket=!0),t}isValid(){return!this.missingEndBracket&&!this.extraEndBracket&&this.expressionParsers.length===this.operatorParser.getNumOperators()+1&&this.operatorParser.isValid()&&this.expressionParsers.every(e=>e.isValid())}getValidationError(){let e,t=this.operatorParser.getValidationError();for(let e=0;e<this.expressionParsers.length;e++){let i=this.expressionParsers[e].getValidationError();if(i)return t&&t.startPosition<i.startPosition?t:i}return t||(this.extraEndBracket?{message:this.params.advFilterExpSvc.translate("advancedFilterValidationExtraEndBracket"),startPosition:this.endPosition+1,endPosition:this.endPosition+1}:(this.expressionParsers.length===this.operatorParser.getNumOperators()?e="advancedFilterValidationMissingCondition":this.missingEndBracket&&(e="advancedFilterValidationMissingEndBracket"),e)?{message:this.params.advFilterExpSvc.translate(e),startPosition:this.params.expression.length,endPosition:this.params.expression.length}:null)}getFunction(e){let t=this.operatorParser.getFunction(),i=this.expressionParsers.map(t=>t.getFunction(e)),s="&&"===t?"every":"some";return(e,t,r)=>i[s](i=>i(e,t,r))}getAutocompleteListParams(e){if(null!=this.endPosition&&e>this.endPosition+1)return;if(!this.expressionParsers.length)return this.getColumnAutocompleteListParams();let t=this.getExpressionParserIndex(e);if(null==t)return"("===this.params.expression[e]?{enabled:!1}:this.getColumnAutocompleteListParams();let i=this.expressionParsers[t].getAutocompleteListParams(e);if(!i){if(t<this.expressionParsers.length-1)return this.operatorParser.getAutocompleteListParams(e,t);if(this.expressionParsers.length===this.operatorParser.getNumOperators()){let t=this.operatorParser.getLastOperatorEndPosition();return null==t||e<=t+1?this.operatorParser.getAutocompleteListParams(e,this.operatorParser.getNumOperators()-1):this.getColumnAutocompleteListParams()}return")"===this.params.expression[e-1]?{enabled:!1}:this.operatorParser.getAutocompleteListParams(e)}return i}updateExpression(e,t,i){let s=this.params.expression,r=this.getExpressionParserIndex(e);if(null==r){let e="column"===i?this.params.advFilterExpSvc.getColumnValue(t):t.displayValue??t.key;return tS(s,this.startPosition,this.startPosition,e,!0)}let a=this.expressionParsers[r].updateExpression(e,t,i);if(null==a)if("column"===i)return tS(s,e,s.length-1,this.params.advFilterExpSvc.getColumnValue(t),!0);else if(null!=this.endPosition&&e>this.endPosition+1)return null;else return this.operatorParser.updateExpression(e,t,r);return a}getModel(){return this.expressionParsers.length>1?{filterType:"join",type:this.operatorParser.getModel(),conditions:this.expressionParsers.map(e=>e.getModel())}:this.expressionParsers[0].getModel()}getColumnAutocompleteListParams(){return this.params.advFilterExpSvc.generateAutocompleteListParams(this.params.advFilterExpSvc.getColumnAutocompleteEntries(),"column","")}getExpressionParserIndex(e){let t;for(let i=0;i<this.expressionParsers.length&&!(this.expressionParsers[i].startPosition>e);i++)t=i;return t}},iR=class{constructor(e){this.params=e,this.valid=!1}parseExpression(){this.joinExpressionParser=new iM(this.params,0);let e=this.joinExpressionParser.parseExpression();return this.valid=e>=this.params.expression.length-1&&this.joinExpressionParser.isValid(),this.params.expression}isValid(){return this.valid}getValidationMessage(){let e=this.joinExpressionParser.getValidationError();if(!e)return null;let{message:t,startPosition:i,endPosition:s}=e;return i<this.params.expression.length?this.params.advFilterExpSvc.translate("advancedFilterValidationMessage",[t,this.params.expression.slice(i,s+1).trim()]):this.params.advFilterExpSvc.translate("advancedFilterValidationMessageAtEnd",[t])}getFunction(){let e=this.createFunctionParams();return{expressionFunction:this.joinExpressionParser.getFunction(e),params:e}}getAutocompleteListParams(e){return this.joinExpressionParser.getAutocompleteListParams(e)??{enabled:!1}}updateExpression(e,t,i){return this.joinExpressionParser.updateExpression(e,t,i)}getModel(){return this.isValid()?this.joinExpressionParser.getModel():null}createFunctionParams(){return{operands:[],operators:[],evaluatorParams:[]}}},iT={moduleName:"AdvancedFilter",version:tv,beans:[class extends m.BeanStub{constructor(){super(...arguments),this.beanName="advancedFilter",this.appliedExpression=null,this.expression=null,this.isValid=!0}wireBeans(e){this.valueSvc=e.valueSvc,this.colModel=e.colModel,this.dataTypeSvc=e.dataTypeSvc,this.advFilterExpSvc=e.advFilterExpSvc,this.filterValueSvc=e.filterValueSvc,this.filterManager=e.filterManager}postConstruct(){this.setEnabled(this.gos.get("enableAdvancedFilter"),!0),this.ctrl=this.createManagedBean(new iF(this.enabled)),this.expressionProxy={getValue:(e,t)=>{let i=this.colModel.getColDefCol(e);return i?this.filterValueSvc.getValue(i,t):void 0}},this.addManagedPropertyListener("enableAdvancedFilter",e=>this.setEnabled(!!e.currentValue)),this.addManagedEventListeners({newColumnsLoaded:e=>this.onNewColumnsLoaded(e)}),this.addManagedPropertyListener("includeHiddenColumnsInAdvancedFilter",()=>{this.updateValidity()&&this.filterManager?.onFilterChanged({source:"advancedFilter"})})}isEnabled(){return this.enabled}isFilterPresent(){return!!this.expressionFunction}doesFilterPass(e){return this.expressionFunction(this.expressionProxy,e,this.expressionParams)}getModel(){let e=this.createExpressionParser(this.appliedExpression);return e?.parseExpression(),e?.getModel()??null}setModel(e){let t=(e,i)=>{if("join"!==e.filterType)return this.advFilterExpSvc.parseColumnFilterModel(e);{let s=this.advFilterExpSvc.parseJoinOperator(e),r=e.conditions.map(e=>t(e)).filter(e=>(0,m._exists)(e)).join(` ${s} `);return i||e.conditions.length<=1?r:`(${r})`}},i=e?t(e,!0):null;this.setExpressionDisplayValue(i),this.applyExpression(),this.ctrl.refreshComp(),this.ctrl.refreshBuilderComp()}getExpressionDisplayValue(){return this.expression}setExpressionDisplayValue(e){this.expression=e}isCurrentExpressionApplied(){return this.appliedExpression===this.expression}createExpressionParser(e){return e?new iR({expression:e,colModel:this.colModel,dataTypeSvc:this.dataTypeSvc,valueSvc:this.valueSvc,advFilterExpSvc:this.advFilterExpSvc}):null}getDefaultExpression(e){let t=this.advFilterExpSvc.getColumnValue(e)+" ";return{updatedValue:t,updatedPosition:t.length}}isHeaderActive(){return!this.gos.get("advancedFilterParent")}getCtrl(){return this.ctrl}setEnabled(e,t){let i=this.enabled,s=(0,m._isClientSideRowModel)(this.gos)||(0,m._isServerSideRowModel)(this.gos);e&&!s&&(0,m._warn)(123),this.enabled=e&&s,t||this.enabled===i||this.eventSvc.dispatchEvent({type:"advancedFilterEnabledChanged",enabled:this.enabled})}applyExpression(){let e=this.createExpressionParser(this.expression);e?.parseExpression(),this.applyExpressionFromParser(e)}getAppliedExpressionDisplayValue(){return this.appliedExpression}applyExpressionFromParser(e){if(this.isValid=!e||e.isValid(),!e||!this.isValid){this.expressionFunction=null,this.expressionParams=null,this.appliedExpression=null;return}let{expressionFunction:t,params:i}=e.getFunction();this.expressionFunction=t,this.expressionParams=i,this.appliedExpression=this.expression}updateValidity(){this.advFilterExpSvc.resetColumnCaches();let e=this.createExpressionParser(this.expression);e?.parseExpression();let t=(!e||e.isValid())!==this.isValid;return this.applyExpressionFromParser(e),this.ctrl.refreshComp(),this.ctrl.refreshBuilderComp(),t}onNewColumnsLoaded(e){if("gridInitializing"!==e.source||!this.dataTypeSvc?.isPendingInference)return;this.ctrl.setInputDisabled(!0);let[t]=this.addManagedEventListeners({dataTypesInferred:()=>{t?.(),this.ctrl.setInputDisabled(!1)}})}},tG],icons:{advancedFilterBuilder:"group",advancedFilterBuilderDrag:"grip",advancedFilterBuilderInvalid:"not-allowed",advancedFilterBuilderMoveUp:"up",advancedFilterBuilderMoveDown:"down",advancedFilterBuilderAdd:"plus",advancedFilterBuilderRemove:"minus",advancedFilterBuilderSelectOpen:"small-down",richSelectRemove:"cancel",richSelectLoading:"loading"},apiFunctions:{getAdvancedFilterModel:function(e){return e.filterManager?.getAdvFilterModel()??null},setAdvancedFilterModel:function(e,t){e.filterManager?.setAdvFilterModel(t)},showAdvancedFilterBuilder:function(e){e.filterManager?.toggleAdvFilterBuilder(!0,"api")},hideAdvancedFilterBuilder:function(e){e.filterManager?.toggleAdvFilterBuilder(!1,"api")}},dependsOn:[tb,m._FilterCoreModule,m._SharedDragAndDropModule,m._PopupModule,m._FilterValueModule,m.TooltipModule],css:['.ag-advanced-filter-header{align-items:center;background-color:var(--ag-header-background-color);border-bottom:var(--ag-header-row-border);display:flex;position:relative}.ag-advanced-filter{align-items:center;display:flex;width:100%}.ag-advanced-filter-buttons{display:contents}.ag-advanced-filter-header-cell{height:100%;padding-left:var(--ag-cell-horizontal-padding);padding-right:var(--ag-cell-horizontal-padding)}.ag-advanced-filter-apply-button,.ag-advanced-filter-builder-button{align-items:center;background-color:unset;border:0;display:flex;font-size:var(--ag-font-size);font-weight:600;line-height:normal;padding:var(--ag-spacing);white-space:nowrap;&:where(.ag-standard-button):where(:not(:disabled)){cursor:pointer;&:where(.ag-standard-button):hover{background-color:var(--ag-row-hover-color)}}}:where(.ag-ltr) .ag-advanced-filter-apply-button,:where(.ag-ltr) .ag-advanced-filter-builder-button{margin-left:calc(var(--ag-spacing)*2)}:where(.ag-rtl) .ag-advanced-filter-apply-button,:where(.ag-rtl) .ag-advanced-filter-builder-button{margin-right:calc(var(--ag-spacing)*2)}:where(.ag-ltr) .ag-advanced-filter-builder-button-label{margin-left:var(--ag-spacing)}:where(.ag-rtl) .ag-advanced-filter-builder-button-label{margin-right:var(--ag-spacing)}.ag-advanced-filter-builder{display:flex;flex-direction:column;-webkit-user-select:none;-moz-user-select:none;user-select:none;width:100%}.ag-advanced-filter-builder-list{flex:1;overflow:auto}.ag-advanced-filter-builder-button-panel{border-top:var(--ag-advanced-filter-builder-button-bar-border);display:flex;justify-content:flex-end;padding:var(--ag-widget-container-vertical-padding) var(--ag-widget-container-horizontal-padding)}:where(.ag-ltr) .ag-advanced-filter-builder-apply-button,:where(.ag-ltr) .ag-advanced-filter-builder-cancel-button{margin-left:calc(var(--ag-spacing)*2)}:where(.ag-rtl) .ag-advanced-filter-builder-apply-button,:where(.ag-rtl) .ag-advanced-filter-builder-cancel-button{margin-right:calc(var(--ag-spacing)*2)}.ag-advanced-filter-builder-item-wrapper{align-items:center;display:flex;flex:1 1 auto;justify-content:space-between;overflow:hidden}:where(.ag-ltr) .ag-advanced-filter-builder-item-wrapper{padding-left:calc(var(--ag-icon-size)/2);padding-right:var(--ag-icon-size)}:where(.ag-rtl) .ag-advanced-filter-builder-item-wrapper{padding-left:var(--ag-icon-size);padding-right:calc(var(--ag-icon-size)/2)}:where(.ag-virtual-list-viewport) .ag-advanced-filter-builder-item-wrapper .ag-tab-guard{position:absolute}.ag-advanced-filter-builder-item-tree-line{width:var(--ag-advanced-filter-builder-indent-size)}.ag-advanced-filter-builder-item-tree-line-root{width:var(--ag-icon-size)}.ag-advanced-filter-builder-item-tree-line-root:before{height:50%;top:50%}.ag-advanced-filter-builder-item-tree-line-horizontal,.ag-advanced-filter-builder-item-tree-line-vertical,.ag-advanced-filter-builder-item-tree-line-vertical-bottom,.ag-advanced-filter-builder-item-tree-line-vertical-top{align-items:center;display:flex;height:100%;position:relative}.ag-advanced-filter-builder-item-tree-line-horizontal:after,.ag-advanced-filter-builder-item-tree-line-horizontal:before,.ag-advanced-filter-builder-item-tree-line-vertical-bottom:after,.ag-advanced-filter-builder-item-tree-line-vertical-bottom:before,.ag-advanced-filter-builder-item-tree-line-vertical-top:after,.ag-advanced-filter-builder-item-tree-line-vertical-top:before,.ag-advanced-filter-builder-item-tree-line-vertical:after,.ag-advanced-filter-builder-item-tree-line-vertical:before{content:"";height:100%;position:absolute}.ag-advanced-filter-builder-item-tree-line-horizontal:after{border-bottom:var(--ag-border-width) solid var(--ag-border-color);height:50%;top:0;width:calc(var(--ag-advanced-filter-builder-indent-size) - var(--ag-icon-size))}:where(.ag-ltr) .ag-advanced-filter-builder-item-tree-line-horizontal:after{left:calc(var(--ag-icon-size)/2)}:where(.ag-rtl) .ag-advanced-filter-builder-item-tree-line-horizontal:after{right:calc(var(--ag-icon-size)/2)}.ag-advanced-filter-builder-item-tree-line-vertical:before{top:0;width:calc(var(--ag-advanced-filter-builder-indent-size) - var(--ag-icon-size)/2)}:where(.ag-ltr) .ag-advanced-filter-builder-item-tree-line-vertical:before{border-left:var(--ag-border-width) solid var(--ag-border-color);left:calc(var(--ag-icon-size)/2)}:where(.ag-rtl) .ag-advanced-filter-builder-item-tree-line-vertical:before{border-right:var(--ag-border-width) solid var(--ag-border-color);right:calc(var(--ag-icon-size)/2)}.ag-advanced-filter-builder-item-tree-line-vertical-top:before{height:50%;top:0;width:calc(var(--ag-advanced-filter-builder-indent-size) - var(--ag-icon-size)/2)}:where(.ag-ltr) .ag-advanced-filter-builder-item-tree-line-vertical-top:before{border-left:var(--ag-border-width) solid var(--ag-border-color);left:calc(var(--ag-icon-size)/2)}:where(.ag-rtl) .ag-advanced-filter-builder-item-tree-line-vertical-top:before{border-right:var(--ag-border-width) solid var(--ag-border-color);right:calc(var(--ag-icon-size)/2)}.ag-advanced-filter-builder-item-tree-line-vertical-bottom:before{height:calc(50% - var(--ag-icon-size)*1.5/2);top:calc(50% + var(--ag-icon-size)*1.5/2);width:calc(var(--ag-icon-size)/2)}:where(.ag-ltr) .ag-advanced-filter-builder-item-tree-line-vertical-bottom:before{border-left:var(--ag-border-width) solid var(--ag-border-color);left:calc(var(--ag-icon-size)/2)}:where(.ag-rtl) .ag-advanced-filter-builder-item-tree-line-vertical-bottom:before{border-right:var(--ag-border-width) solid var(--ag-border-color);right:calc(var(--ag-icon-size)/2)}.ag-advanced-filter-builder-item-condition{padding-bottom:var(--ag-spacing);padding-top:var(--ag-spacing)}.ag-advanced-filter-builder-item,.ag-advanced-filter-builder-item-buttons,.ag-advanced-filter-builder-item-condition,.ag-advanced-filter-builder-item-tree-lines,.ag-advanced-filter-builder-pill,.ag-advanced-filter-builder-pill-wrapper{align-items:center;display:flex;height:100%}.ag-advanced-filter-builder-pill-wrapper{margin:0 var(--ag-spacing)}.ag-advanced-filter-builder-pill{border-radius:var(--ag-border-radius);min-height:calc(100% - var(--ag-spacing)*3);min-width:calc(var(--ag-spacing)*2);padding:var(--ag-spacing) calc(var(--ag-spacing)*2);position:relative}:where(.ag-advanced-filter-builder-pill){.ag-advanced-filter-builder-value-number{font-family:monospace;font-weight:700}.ag-advanced-filter-builder-value-empty{color:var(--ag-subtle-text-color)}}:where(.ag-ltr) :where(.ag-advanced-filter-builder-pill){.ag-picker-field-display{margin-right:var(--ag-spacing)}}:where(.ag-rtl) :where(.ag-advanced-filter-builder-pill){.ag-picker-field-display{margin-left:var(--ag-spacing)}}.ag-advanced-filter-builder-pill-display{font-weight:500;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ag-advanced-filter-builder-join-pill{background-color:var(--ag-advanced-filter-builder-join-pill-color);cursor:pointer}.ag-advanced-filter-builder-column-pill{background-color:var(--ag-advanced-filter-builder-column-pill-color);cursor:pointer}.ag-advanced-filter-builder-option-pill{background-color:var(--ag-advanced-filter-builder-option-pill-color);cursor:pointer}.ag-advanced-filter-builder-value-pill{background-color:var(--ag-advanced-filter-builder-value-pill-color);cursor:text;max-width:140px;:where(.ag-advanced-filter-builder-pill-display){display:block}}.ag-advanced-filter-builder-item-buttons{display:flex;gap:var(--ag-spacing);padding:0 calc(var(--ag-spacing)*.5)}.ag-advanced-filter-builder-item-button{color:var(--ag-subtle-text-color);cursor:pointer;position:relative}.ag-advanced-filter-builder-item-button,.ag-advanced-filter-builder-pill{&:focus-visible{box-shadow:var(--ag-focus-shadow)}}.ag-advanced-filter-builder-item-button-disabled{cursor:default;opacity:.5}.ag-advanced-filter-builder-virtual-list-container{top:var(--ag-spacing)}.ag-advanced-filter-builder-virtual-list-item{cursor:default;display:flex;height:var(--ag-list-item-height)}.ag-advanced-filter-builder-virtual-list-item:hover{background-color:var(--ag-row-hover-color);:where(.ag-advanced-filter-builder-item-button){opacity:1}}.ag-advanced-filter-builder-invalid{color:var(--ag-subtle-text-color);cursor:default;margin:0 var(--ag-spacing)}:where(.ag-advanced-filter-builder-validation) .ag-advanced-filter-builder-invalid{color:var(--ag-invalid-color)}:where(.ag-advanced-filter-builder-virtual-list-item-highlight) .ag-advanced-filter-builder-item-button:focus-visible{opacity:1}']},iP=class{constructor(e){this._defs={},this._nullable=!1,this.description=e}_collectNestedDefs(e){let t={...this._defs};for(let i of e)i&&"object"==typeof i&&"$defs"in i&&(Object.assign(t,i.$defs),delete i.$defs);return t}_toJSON(e={}){let t={type:this._nullable?[this.type,"null"]:this.type,description:this.description,...e};return Object.keys(this._defs).length>0&&(t.$defs=this._defs),t}nullable(){return this._nullable=!0,this}define(e,t){return this._defs[e]=t,this}},iI=class extends iP{constructor(e){super("string"==typeof e?e:e?.description),this.type="string","object"==typeof e&&e&&(this._pattern=e.pattern,this._format=e.format)}pattern(e){return this._pattern=e,this}format(e){return this._format=e,this}toJSON(){return this._toJSON({pattern:this._pattern,format:this._format})}},iE=class extends iP{constructor(e){super("string"==typeof e?e:e?.description),this.type="number","object"==typeof e&&e&&(this._minimum=e.minimum,this._maximum=e.maximum,this._exclusiveMinimum=e.exclusiveMinimum,this._exclusiveMaximum=e.exclusiveMaximum,this._multipleOf=e.multipleOf)}minimum(e){return this._minimum=e,this}exclusiveMinimum(e){return this._exclusiveMinimum=e,this}maximum(e){return this._maximum=e,this}exclusiveMaximum(e){return this._exclusiveMaximum=e,this}multipleOf(e){return this._multipleOf=e,this}toJSON(){return this._toJSON({minimum:this._minimum,exclusiveMinimum:this._exclusiveMinimum,maximum:this._maximum,exclusiveMaximum:this._exclusiveMaximum,multipleOf:this._multipleOf})}},iD=class extends iP{constructor(e,t){super(t),this._enum=e,this.type="string"}toJSON(){return this._toJSON({enum:this._enum})}},ik=class extends iD{constructor(e,t){super([e],t)}},iL=class extends iP{constructor(e){super(e),this.type="boolean"}toJSON(){return this._toJSON()}},iN=class extends iP{constructor(e,t){super("string"==typeof t?t:t?.description),this.items=e,this.type="array","object"==typeof t&&t&&(this._minItems=t.minItems,this._maxItems=t.maxItems)}minItems(e){return this._minItems=e,this}maxItems(e){return this._maxItems=e,this}toJSON(){let e=this.items.toJSON(),t=this._collectNestedDefs([e]);return this._defs=t,this._toJSON({items:e,minItems:this._minItems,maxItems:this._maxItems})}},iG=class extends iP{constructor(e,t){super(t),this.properties=e,this.type="object"}toJSON(){let e=Object.fromEntries(Object.keys(this.properties).map(e=>[e,this.properties[e].toJSON()])),t=this._collectNestedDefs(Object.values(e));return this._defs=t,this._toJSON({required:Object.keys(this.properties),additionalProperties:!1,properties:e})}},iO=class{constructor(e,t){this.schemas=e,this._nullable=!1,this._defs={},this.description=t}nullable(){return this._nullable=!0,this}define(e,t){return this._defs[e]=t,this}_collectNestedDefs(e){let t=this._defs;for(let i of e)i&&"object"==typeof i&&"$defs"in i&&(Object.assign(t,i.$defs),delete i.$defs);return t}toJSON(){let e=this.schemas.map(e=>e.toJSON()),t=this._collectNestedDefs(e),i={anyOf:this._nullable?[...e,{type:"null"}]:e};return this.description&&(i.description=this.description),Object.keys(t).length>0&&(i.$defs=t),i}},iB=class{constructor(e){this.id=e}nullable(){return this}toJSON(){return{$ref:`#/$defs/${this.id}`}}},iV=e=>new iI(e),i_=e=>new iE(e),iz=(e,t)=>new iD(e,t),iH=(e,t)=>new iN(e,t),iU=(e,t)=>new iG(e,t),iW=(e,t)=>new iO(e,t),iK=(e,t)=>new ik(e,t),i$=e=>new iB(e),ij={boolean:e=>iU({filterType:iK("boolean","Filter type identifier for boolean column filters"),colId:iz(e,"Column identifier for the boolean column to filter"),type:iz(["true","false"],"Boolean value to filter by")}),object:e=>iU({filterType:iK("object","Filter type identifier for object column filters"),colId:iz(e,"Column identifier for the object column to filter"),filter:iV("Filter value to compare against object column values").nullable(),type:iz(["equals","notEqual","contains","notContains","startsWith","endsWith","blank","notBlank"],"Object filter operation type")}),date:e=>iU({filterType:iK("date","Filter type identifier for date column filters"),colId:iz(e,"Column identifier for the date column to filter"),filter:iV({pattern:"^\\d{4}-\\d{2}-\\d{2}$",description:"Date value in YYYY-MM-DD format"}).nullable(),type:iz(["equals","notEqual","lessThan","lessThanOrEqual","greaterThan","greaterThanOrEqual","blank","notBlank"],"Date filter operation type")}),dateString:e=>iU({filterType:iK("date","Filter type identifier for date string column filters"),colId:iz(e,"Column identifier for the date string column to filter"),filter:iV({pattern:"^\\d{4}-\\d{2}-\\d{2}$",description:"Date value in YYYY-MM-DD format"}).nullable(),type:iz(["equals","notEqual","lessThan","lessThanOrEqual","greaterThan","greaterThanOrEqual","blank","notBlank"],"Date string filter operation type")}),dateTime:e=>iU({filterType:iK("dateTime","Filter type identifier for datetime column filters"),colId:iz(e,"Column identifier for the datetime column to filter"),filter:iV({pattern:"^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$",description:"DateTime value in YYYY-MM-DDTHH:mm:ss format"}).nullable(),type:iz(["equals","notEqual","lessThan","lessThanOrEqual","greaterThan","greaterThanOrEqual","blank","notBlank"],"DateTime filter operation type")}),dateTimeString:e=>iU({filterType:iK("dateTimeString","Filter type identifier for datetime string column filters"),colId:iz(e,"Column identifier for the datetime string column to filter"),filter:iV({pattern:"^\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2}$",description:"DateTime value in YYYY-MM-DD HH:mm:ss format"}).nullable(),type:iz(["equals","notEqual","lessThan","lessThanOrEqual","greaterThan","greaterThanOrEqual","blank","notBlank"],"DateTime string filter operation type")}),number:e=>iU({filterType:iK("number","Filter type identifier for number column filters"),colId:iz(e,"Column identifier for the number column to filter"),filter:i_("Numeric value to filter by").nullable(),type:iz(["equals","notEqual","lessThan","lessThanOrEqual","greaterThan","greaterThanOrEqual","blank","notBlank"],"Number filter operation type")}),bigint:e=>iU({filterType:iK("bigint","Filter type identifier for bigint column filters"),colId:iz(e,"Column identifier for the bigint column to filter"),filter:iV({pattern:"^-?\\d+$",description:"BigInt value to filter by"}).nullable(),type:iz(["equals","notEqual","lessThan","lessThanOrEqual","greaterThan","greaterThanOrEqual","blank","notBlank"],"BigInt filter operation type")}),text:e=>iU({filterType:iK("text","Filter type identifier for text column filters"),colId:iz(e,"Column identifier for the text column to filter"),filter:iV("Text value to filter by").nullable(),type:iz(["equals","notEqual","contains","notContains","startsWith","endsWith","blank","notBlank"],"Text filter operation type")})},iY="agNumberColumnFilter",iq="agDateColumnFilter",iZ=["agTextColumnFilter",iY,iq];function iX(e,t,i,s){let r;if("string"==typeof e?r=e:"object"==typeof e&&"string"==typeof e.component?r=e.component:(!0===e||"object"==typeof e&&!0===e.component)&&(r=i),!r)return null;if(iZ.includes(r)){let e=t?.maxNumConditions;return iJ(r,{maxConditions:e,filterOptions:t?.filterOptions?t.filterOptions.map(e=>"string"==typeof e?e:"object"==typeof e&&e.displayKey?e.displayKey:null).filter(Boolean):void 0,useIsoSeparator:t?.useIsoSeparator||!1})}return"agSetColumnFilter"===r?i5(s):"agMultiColumnFilter"===r?i4(t.filters,i,s):null}var iJ=(e,t)=>e===iq?i2(t):e===iY?i1(t):i0(t),iQ=(e,t,i=2)=>1===i?e:iU({filterType:iK(t,`Filter type identifier for ${t} filters with multiple conditions`),operator:iz(["AND","OR"],"Logical operator to combine multiple filter conditions. Must be included even with a single filter to adhere to the API."),conditions:iH(e,"Array of filter conditions to be combined").minItems(2).maxItems(i)}),i0=e=>{let t=e.filterOptions??["contains","notContains","equals","notEqual","startsWith","endsWith","blank","notBlank"];return iQ(iU({filterType:iK("text","Filter type identifier for text filters"),type:iz(t,"Text filter operation type"),filter:iV("Primary filter value").nullable(),filterTo:iV("Secondary filter value for range operations").nullable()}),"text",e.maxConditions)},i1=e=>{let t=e.filterOptions??["equals","notEqual","greaterThan","greaterThanOrEqual","lessThan","lessThanOrEqual","inRange","blank","notBlank"];return iQ(iU({filterType:iK("number","Filter type identifier for number filters"),type:iz(t,"Number filter operation type"),filter:i_("Primary filter value").nullable(),filterTo:i_("Secondary filter value for range operations").nullable()}),"number",e.maxConditions)},i2=e=>{let t=e.filterOptions??["equals","notEqual","lessThan","greaterThan","inRange","blank","notBlank"],i=e.useIsoSeparator?"^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$":"^\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2}$";return iQ(iU({filterType:iK("date","Filter type identifier for date filters"),type:iz(t,"Date filter operation type"),dateFrom:iV({pattern:i,description:"Primary date filter value in YYYY-MM-DD HH:mm:ss format"}).nullable(),dateTo:iV({pattern:i,description:"Secondary date filter value for range operations in YYYY-MM-DD HH:mm:ss format"}).nullable()}),"date",e.maxConditions)},i5=e=>{let t=e?e().filter(Boolean):[];return iU({filterType:iK("set","Filter type identifier for set filters"),values:iH(t.length>0?iz(t,"Available values to filter by"):iV("Filter values"),"Array of values to include in the filter")})},i4=(e,t,i=()=>[])=>iU({filterType:iK("multi","Filter type identifier for multi-condition filters"),filterModels:iH(iW(e.map((e,s)=>iX(e.filter,e.filterParams,t,()=>i(!0,s))),"Union of different filter types that can be combined").nullable(),"Array of filter conditions to be combined with AND/OR logic")}),i3={aggregation:e=>{let{aggFuncSvc:t}=e;if(!t)return;let i=e.colModel.getCols().filter(e=>e.isAllowValue()&&t.getFuncNames(e).length>0);if(0!==i.length)return iU({aggregationModel:iH(iW(i.map(t=>iU({colId:iK(t.getColId(),"Column identifier"),aggFunc:iz(e.aggFuncSvc?.getFuncNames(t)||[],"Aggregation function")}))),"Array of column aggregations")},"Aggregation configuration for the grid").nullable()},filter:(e,t)=>{let{advancedFilter:i}=e;return i?.isEnabled()?(({colModel:e,dataTypeSvc:t})=>{if(!t)return;let i=e.getCols(),s={boolean:[],object:[],date:[],dateString:[],dateTime:[],dateTimeString:[],number:[],bigint:[],text:[]};for(let e of i){let i=t.getBaseDataType(e);i&&s[i].push(e.colId)}let r=[],a={};for(let e of Object.keys(s))if(s[e].length>0){let t=`${e}AdvancedFilterModel`,i=ij[e];a[t]=i(s[e]),r.push({$ref:`#/$defs/${t}`})}return a.joinAdvancedFilterModel=iU({filterType:iK("join","Filter type identifier for joining multiple advanced filter conditions"),type:iz(["AND","OR"],"Logical operator to combine multiple advanced filter conditions"),conditions:iH(i$("advancedFilterModel"),"Array of advanced filter conditions to be combined")}),a.advancedFilterModel={anyOf:[...r,{$ref:"#/$defs/joinAdvancedFilterModel"}]},iU({advancedFilterModel:i$("advancedFilterModel")},"Advanced filter configuration for the grid").nullable()})(e):((e,t)=>{let{gos:i,colFilter:s,colModel:r}=e;if(!s)return;let a=r.getCols().filter(e=>e.isFilterAllowed());if(0===a.length)return;let l={},n=i.get("enableFilterHandlers");for(let e of a){let i=t?.columns?t.columns[e.getColId()]:void 0,r=e.getColDef(),a=s.getDefaultFilter(e),o=i?.includeSetValues??!1,d=iX(r.filter,r.filterParams,a,(t=!1,i=0)=>{let r;return o?(t?n&&(r=s.getHandler(e,!0).getHandler(i)):r=s.getHandler(e,!0),r)?r.getFilterKeys():[]:[]});d&&(l[e.colId]=d.nullable())}return iU({filterModel:iU(l)}).nullable()})(e,t)},sort:e=>{let{sortSvc:t}=e;if(!t)return;let i=e.colModel.getCols().filter(e=>e.isSortable());if(0!==i.length)return iU({sortModel:iH(iU({colId:iz(i.map(e=>e.getColId()),"Column ID that supports sorting"),sort:iz(["asc","desc"],"Sort direction: ascending or descending"),type:iz(["default","absolute"],"Sort type: default or absolute values")}),"Array of sort configurations")},"Sort configuration for the grid").nullable()},pivot:e=>{let t=e.colModel.getCols().filter(e=>e.isAllowPivot()).map(e=>e.getColId());if(0!==t.length)return iU({pivotMode:new iL("Whether pivot mode is enabled"),pivotColIds:iH(iz(t,"Column ID that supports pivoting"),"Array of column IDs to use as pivot columns")},"Pivot configuration for the grid").nullable()},columnVisibility:()=>iU({hiddenColIds:iH(i$("allColumnIds"),"Array of column IDs to hide")},"Column visibility configuration for the grid").nullable(),columnSizing:e=>{let t=e.colModel.getCols().filter(e=>e.isResizable());if(0===t.length)return;let i=t.map(e=>e.getColId());return iU({columnSizingModel:iH(iW([iU({colId:i$("resizableColumnId"),width:i_("Fixed width in pixels").minimum(20)}),iU({colId:i$("resizableColumnId"),flex:i_("Flex sizing ratio").minimum(0)})]),"Array of column sizing configurations")},"Column sizing configuration for the grid").define("resizableColumnId",iz(i,"Column ID that supports resizing"))},rowGroup:e=>{let t=e.colModel.getCols().filter(e=>e.isAllowRowGroup());if(0!==t.length)return iU({groupColIds:iH(iz(t.map(e=>e.getColId()),"Column ID that supports row grouping"),"Array of column IDs to group by")},"Row grouping configuration for the grid")}},i6={moduleName:"AiToolkit",version:tv,beans:[],dependsOn:[tb,m.ColumnApiModule],apiFunctions:{getStructuredSchema:function(e,t){let i=e.colModel.getCols().map(e=>e.getColId()),s={};for(let i of m.STRUCTURED_SCHEMA_FEATURES){if(t?.exclude?.includes(i))continue;let r=(0,i3[i])(e,t);r&&(s[i]=r.nullable())}let r=t?.columns??{},a=i.map(e=>r[e]?.description?`${e}: ${r[e].description}`:e).filter(Boolean).join("\n");return iU(s).define("allColumnIds",iz(i,a)).toJSON()}}},i8={tag:"div",cls:"ag-side-button",role:"presentation",children:[{tag:"button",ref:"eToggleButton",cls:"ag-button ag-side-button-button",role:"tab",attrs:{type:"button",tabindex:"-1","aria-expanded":"false"},children:[{tag:"div",ref:"eIconWrapper",cls:"ag-side-button-icon-wrapper",attrs:{"aria-hidden":"true"}},{tag:"span",ref:"eLabel",cls:"ag-side-button-label"}]}]},i7=class extends m.Component{constructor(e){super(),this.toolPanelDef=e,this.eToggleButton=m.RefPlaceholder,this.eIconWrapper=m.RefPlaceholder,this.eLabel=m.RefPlaceholder}getToolPanelId(){return this.toolPanelDef.id}postConstruct(){this.setTemplate(i8,[]),this.setLabel(),this.setIcon(),this.addManagedElementListeners(this.eToggleButton,{click:this.onButtonPressed.bind(this)}),this.eToggleButton.setAttribute("id",`ag-${this.getCompId()}-button`)}setLabel(){let e=this.toolPanelDef,t=this.getLocaleTextFunc()(e.labelKey,e.labelDefault);this.eLabel.textContent=t}setIcon(){this.eIconWrapper.insertAdjacentElement("afterbegin",(0,m._createIconNoSpan)(this.toolPanelDef.iconKey,this.beans))}onButtonPressed(){this.dispatchLocalEvent({type:"toggleButtonClicked"})}setSelected(e){this.toggleCss("ag-selected",e),(0,m._setAriaExpanded)(this.eToggleButton,e)}},i9={tag:"div",cls:"ag-side-buttons",role:"tablist"},se={selector:"AG-SIDE-BAR-BUTTONS",component:class extends m.Component{constructor(){super(i9),this.buttonComps=[]}postConstruct(){this.addManagedElementListeners(this.getFocusableElement(),{keydown:this.handleKeyDown.bind(this)})}handleKeyDown(e){if(e.key===m.KeyCode.TAB&&e.shiftKey){if((0,m._focusNextGridCoreContainer)(this.beans,!0))return void e.preventDefault();(0,m._stopPropagationForAgGrid)(e)}}setActiveButton(e){for(let t of this.buttonComps)t.setSelected(e===t.getToolPanelId())}addButtonComp(e){let t=this.createBean(new i7(e));return this.buttonComps.push(t),this.appendChild(t),t.addEventListener("toggleButtonClicked",()=>{this.dispatchLocalEvent({type:"sideBarButtonClicked",toolPanelId:e.id})}),t}clearButtons(){this.buttonComps=this.destroyBeans(this.buttonComps),(0,m._clearElement)(this.getGui())}destroy(){this.clearButtons(),super.destroy()}}},st={id:"columns",labelDefault:"Columns",labelKey:"columns",iconKey:"columnsToolPanel",toolPanel:"agColumnsToolPanel"},si={id:"filters",labelDefault:"Filters",labelKey:"filters",iconKey:"filtersToolPanel",toolPanel:"agFiltersToolPanel"},ss={columns:st,filters:si,"filters-new":{id:"filters-new",labelDefault:"Filters",labelKey:"filters",iconKey:"filtersToolPanel",toolPanel:"agNewFiltersToolPanel"}};function sr(e){if(e){var t;let i;if(!0===e)return{toolPanels:[st,si],defaultToolPanel:"columns"};if("string"==typeof e)return sr([e]);if(Array.isArray(e)){let t=[];for(let i of e){let e=ss[i];if(!e){(0,m._warn)(215,{key:i,defaultByKey:ss});continue}t.push(e)}if(0===t.length)return;return{toolPanels:t,defaultToolPanel:t[0].id}}return{toolPanels:(t=e.toolPanels,i=[],t&&t.forEach(e=>{let t=sa(e);t&&i.push(t)}),i),defaultToolPanel:e.defaultToolPanel,hiddenByDefault:e.hiddenByDefault,position:e.position,hideButtons:e.hideButtons}}}function sa(e){return"string"!=typeof e?e:ss[e]?ss[e]:((0,m._warn)(215,{key:e,defaultByKey:ss}),null)}var sl=class extends m.Component{constructor(){super({tag:"div",cls:"ag-tool-panel-horizontal-resize"}),this.minWidth=100,this.maxWidth=null}postConstruct(){let e=this.beans.horizontalResizeSvc.addResizeBar({eResizeBar:this.getGui(),dragStartPixels:1,onResizeStart:this.onResizeStart.bind(this),onResizing:this.onResizing.bind(this),onResizeEnd:this.onResizeEnd.bind(this)});this.addDestroyFunc(e),this.inverted=this.gos.get("enableRtl")}dispatchResizeEvent(e,t,i){this.eventSvc.dispatchEvent({type:"toolPanelSizeChanged",width:i,started:e,ended:t})}onResizeStart(){this.startingWidth=this.elementToResize.offsetWidth,this.dispatchResizeEvent(!0,!1,this.startingWidth)}onResizeEnd(e){return this.onResizing(e,!0)}onResizing(e,t=!1){let i=this.inverted?-1:1,s=Math.max(this.minWidth,Math.floor(this.startingWidth-e*i));null!=this.maxWidth&&(s=Math.min(this.maxWidth,s)),this.elementToResize.style.width=`${s}px`,this.dispatchResizeEvent(!1,t,s)}},sn={name:"toolPanel",optionalMethods:["refresh","getState"]},so={tag:"div",cls:"ag-tool-panel-wrapper",role:"tabpanel"},sd=class extends m.Component{constructor(){super(so)}postConstruct(){let e=this.getGui(),t=this.resizeBar=this.createManagedBean(new sl);e.setAttribute("id",`ag-${this.getCompId()}`),t.elementToResize=e,this.appendChild(t)}getToolPanelId(){return this.toolPanelId}setToolPanelDef(e,t){var i;let{id:s,minWidth:r,maxWidth:a,width:l}=e;this.toolPanelId=s,this.width=l;let n=(i=this.beans.userCompFactory,i.getCompDetails(e,sn,void 0,t,!0));if(null==n)return!1;let o=n.newAgStackInstance();this.params=n.params,o.then(this.setToolPanelComponent.bind(this));let d=this.resizeBar;return null!=r&&(d.minWidth=r),null!=a&&(d.maxWidth=a),!0}setToolPanelComponent(e){this.toolPanelCompInstance=e,this.appendChild(e.getGui()),this.addDestroyFunc(()=>{this.destroyBean(e)});let t=this.width;t&&(this.getGui().style.width=`${t}px`)}getToolPanelInstance(){return this.toolPanelCompInstance}setResizerSizerSide(e){let t=this.gos.get("enableRtl"),i="left"===e;this.resizeBar.inverted=t?i:!i}refresh(){this.toolPanelCompInstance?.refresh(this.params)}},sh={tag:"div",cls:"ag-side-bar ag-unselectable",children:[{tag:"ag-side-bar-buttons",ref:"sideBarButtons"}]};function su(e){return"agFiltersToolPanel"===e||"agNewFiltersToolPanel"===e}var sc={selector:"AG-SIDE-BAR",component:class extends m.Component{constructor(){super(sh,[se]),this.sideBarButtons=m.RefPlaceholder,this.toolPanelWrappers=[],this.registerCSS('.ag-tool-panel-wrapper{display:flex;overflow:hidden auto;-webkit-user-select:none;-moz-user-select:none;user-select:none;width:var(--ag-side-bar-panel-width)}.ag-tool-panel-external{display:flex;flex-direction:row}:where(.ag-tool-panel-external) .ag-tool-panel-wrapper{flex-grow:1}.ag-select-agg-func-item{align-items:center;display:flex;flex:1 1 auto;flex-flow:row nowrap;height:100%;overflow:hidden;position:relative;text-overflow:ellipsis;white-space:nowrap}.ag-tool-panel-horizontal-resize{cursor:ew-resize;height:100%;position:absolute;top:0;width:5px;z-index:1}.ag-side-bar{background-color:var(--ag-side-bar-background-color);display:flex;flex-direction:row-reverse;position:relative}:where(.ag-ltr) :where(.ag-side-bar-left) .ag-tool-panel-horizontal-resize{right:-3px}:where(.ag-rtl) :where(.ag-side-bar-left) .ag-tool-panel-horizontal-resize{left:-3px}:where(.ag-ltr) :where(.ag-side-bar-right) .ag-tool-panel-horizontal-resize{left:-3px}:where(.ag-rtl) :where(.ag-side-bar-right) .ag-tool-panel-horizontal-resize{right:-3px}.ag-side-bar-left{flex-direction:row;order:-1}.ag-side-buttons{background-color:var(--ag-side-button-bar-background-color);padding-top:var(--ag-side-button-bar-top-padding);position:relative}.ag-side-button{background-color:var(--ag-side-button-background-color);border-bottom:var(--ag-side-button-border);border-top:var(--ag-side-button-border);color:var(--ag-side-button-text-color);margin-top:-1px;position:relative}.ag-side-button:before{background-color:transparent;bottom:0;content:"";display:block;position:absolute;top:0;transition:background-color var(--ag-side-button-selected-underline-transition-duration);width:var(--ag-side-button-selected-underline-width)}:where(.ag-ltr) .ag-side-button:before{left:0}:where(.ag-rtl) .ag-side-button:before{right:0}.ag-side-button:hover{background-color:var(--ag-side-button-hover-background-color);color:var(--ag-side-button-hover-text-color)}.ag-side-button.ag-selected{background-color:var(--ag-side-button-selected-background-color);border-bottom:var(--ag-side-button-selected-border);border-top:var(--ag-side-button-selected-border);color:var(--ag-side-button-selected-text-color)}.ag-side-button.ag-selected:before{background-color:var(--ag-side-button-selected-underline-color)}.ag-side-button-button{align-items:center;display:flex;flex-direction:column;gap:var(--ag-spacing);position:relative;white-space:nowrap;width:100%;&:focus{box-shadow:none}}:where(.ag-ltr) .ag-side-button-button{padding:var(--ag-side-button-vertical-padding) var(--ag-side-button-right-padding) var(--ag-side-button-vertical-padding) var(--ag-side-button-left-padding)}:where(.ag-rtl) .ag-side-button-button{padding:var(--ag-side-button-vertical-padding) var(--ag-side-button-left-padding) var(--ag-side-button-vertical-padding) var(--ag-side-button-right-padding)}.ag-side-button-button:focus-visible{box-shadow:inset var(--ag-focus-shadow)}.ag-side-button-label{writing-mode:vertical-lr}@media (resolution <= 1.5x){.ag-side-button-label{font-family:"Segoe UI",var(--ag-font-family)}:where(.ag-ltr) .ag-side-button-label{transform:rotate(.05deg)}:where(.ag-rtl) .ag-side-button-label{transform:rotate(-.05deg)}}:where(.ag-ltr) .ag-side-bar-left,:where(.ag-rtl) .ag-side-bar-right{border-right:var(--ag-side-panel-border);:where(.ag-tool-panel-wrapper){border-left:var(--ag-side-panel-border)}}:where(.ag-ltr) .ag-side-bar-right,:where(.ag-rtl) .ag-side-bar-left{border-left:var(--ag-side-panel-border);:where(.ag-tool-panel-wrapper){border-right:var(--ag-side-panel-border)}}')}postConstruct(){this.sideBarButtons.addEventListener("sideBarButtonClicked",this.onToolPanelButtonClicked.bind(this));let{beans:e,gos:t}=this,{sideBar:i}=t.get("initialState")??{};this.setSideBarDef({sideBarDef:sr(t.get("sideBar")),sideBarState:i}),this.addManagedPropertyListener("sideBar",()=>this.setState()),e.sideBar.comp=this;let s=this.getFocusableElement();this.createManagedBean(new m.ManagedFocusFeature(s,{onTabKeyDown:this.onTabKeyDown.bind(this),handleKeyDown:this.handleKeyDown.bind(this)})),(0,m._addFocusableContainerListener)(e,this,s),this.addManagedPropertyListener("enableAdvancedFilter",this.onAdvancedFilterChanged.bind(this))}onTabKeyDown(e){if(e.defaultPrevented)return;let{beans:t,sideBarButtons:i}=this,s=this.getGui(),r=i.getGui(),a=(0,m._getActiveDomElement)(t),l=s.querySelector(".ag-tool-panel-wrapper:not(.ag-hidden)"),n=e.target,o=e.shiftKey;if(!l)return(0,m._focusNextGridCoreContainer)(t,o)?(e.preventDefault(),!0):(0,m._focusNextGridCoreContainer)(t,o,!0);if(r.contains(a)){(0,m._focusInto)(l,o)&&e.preventDefault();return}if(!o)return;let d=null;l.contains(a)?d=(0,m._findNextFocusableElement)(t,l,void 0,!0):tc(l,n)&&(d=tu(l,n)),d||(d=r.querySelector(".ag-selected button"),d=(0,m._isVisible)(d)?d:null),d&&d!==e.target&&(e.preventDefault(),d.focus())}handleKeyDown(e){let t=(0,m._getActiveDomElement)(this.beans),i=this.sideBarButtons;if(!i.getGui().contains(t))return;let s=i.getGui(),r=Array.prototype.slice.call(s.querySelectorAll(".ag-side-button")),a=r.findIndex(e=>e.contains(t)),l=null;switch(e.key){case m.KeyCode.LEFT:case m.KeyCode.UP:l=Math.max(0,a-1);break;case m.KeyCode.RIGHT:case m.KeyCode.DOWN:l=Math.min(a+1,r.length-1)}if(null===l)return;let n=r[l].querySelector("button");n&&(n.focus(),e.preventDefault())}onToolPanelButtonClicked(e){let t=e.toolPanelId;this.openedItem()===t?this.openToolPanel(void 0,"sideBarButtonClicked"):this.openToolPanel(t,"sideBarButtonClicked")}clearDownUi(){this.sideBarButtons.clearButtons(),this.destroyToolPanelWrappers()}setSideBarDef({sideBarDef:e,sideBarState:t,existingToolPanelWrappers:i}){if(this.setDisplayed(!1),this.sideBar=e,e&&this.sideBarButtons.setDisplayed(!e.hideButtons),e?.toolPanels){let s=e.toolPanels;if(this.createToolPanelsAndSideButtons(s,t,i),!this.toolPanelWrappers.length)return;let r=t?t.visible:!e.hiddenByDefault;if(this.setDisplayed(r),this.setSideBarPosition(t?t.position:e.position),r)if(t){let{openToolPanel:e}=t;e&&this.openToolPanel(e,"sideBarInitializing")}else this.openToolPanel(e.defaultToolPanel,"sideBarInitializing")}}getDef(){return this.sideBar}setSideBarPosition(e){e||(e="right"),this.position=e;let t="left"===e,i=t?"right":"left";for(let e of(this.toggleCss("ag-side-bar-left",t),this.toggleCss("ag-side-bar-right",!t),this.toolPanelWrappers))e.setResizerSizerSide(i);return this.dispatchSideBarUpdated(),this}setDisplayed(e,t){super.setDisplayed(e,t),this.dispatchSideBarUpdated()}getState(){let e={};for(let t of this.toolPanelWrappers)e[t.getToolPanelId()]=t.getToolPanelInstance()?.getState?.();return{visible:this.isDisplayed(),position:this.position,openToolPanel:this.openedItem(),toolPanels:e}}createToolPanelsAndSideButtons(e,t,i){for(let s of e)this.createToolPanelAndSideButton(s,t?.toolPanels?.[s.id],i?.[s.id])}validateDef(e){let{id:t,toolPanel:i}=e;return null==t?((0,m._warn)(212),!1):!(su(i)&&this.beans.filterManager?.isAdvFilterEnabled())||((0,m._warn)(213),!1)}createToolPanelAndSideButton(e,t,i){let s;if(!this.validateDef(e))return void this.destroyBean(i);if(i)s=i;else if(!(s=this.createBean(new sd)).setToolPanelDef(e,(0,m._addGridCommonParams)(this.gos,{initialState:t,onStateUpdated:()=>this.dispatchSideBarUpdated()})))return;s.setDisplayed(!1);let r=s.getGui(),a=e.parent instanceof HTMLElement?e.parent:this;a===e.parent&&(this.beans.environment.applyThemeClasses(a,["ag-external","ag-tool-panel-external"]),r.classList.add(this.gos.get("enableRtl")?"ag-rtl":"ag-ltr")),a.appendChild(r),this.toolPanelWrappers.push(s);let l=this.sideBarButtons.addButtonComp(e);(0,m._setAriaControlsAndLabel)(l.eToggleButton,r)}refresh(){for(let e of this.toolPanelWrappers)e.refresh()}renderToolPanelUnderParent(e,t){let i=this.sideBar?.toolPanels?.find(t=>("string"==typeof t?t:t.id)===e);if(i){let s=sa(i);if(s){let i=this.gos.get("initialState")?.sideBar?.toolPanels?.[s.id];s.parent=t;let r=this.toolPanelWrappers.find(t=>t.getToolPanelId()===e);this.createToolPanelAndSideButton(s,i,r)}}}openToolPanel(e,t="api",i){i&&e&&this.renderToolPanelUnderParent(e,i);let s=this.openedItem();if(s!==e){for(let t of this.toolPanelWrappers){let i=e===t.getToolPanelId();t.setDisplayed(i)}s!==this.openedItem()&&(this.sideBarButtons.setActiveButton(e),this.raiseToolPanelVisibleEvent(e,s??void 0,t))}}getToolPanelInstance(e){let t=this.toolPanelWrappers.filter(t=>t.getToolPanelId()===e)[0];return t?t.getToolPanelInstance():void(0,m._warn)(214,{key:e})}raiseToolPanelVisibleEvent(e,t,i){let s=!!e&&!!t,r=this.eventSvc;t&&r.dispatchEvent({type:"toolPanelVisibleChanged",source:i,key:t,visible:!1,switchingToolPanel:s}),e&&r.dispatchEvent({type:"toolPanelVisibleChanged",source:i,key:e,visible:!0,switchingToolPanel:s})}close(e="api"){this.openToolPanel(void 0,e)}isToolPanelShowing(){return!!this.openedItem()}openedItem(){let e=null;for(let t of this.toolPanelWrappers)t.isDisplayed()&&(e=t.getToolPanelId());return e}setState(e){let t=sr(this.gos.get("sideBar")),i={};t&&this.sideBar&&t.toolPanels?.forEach(t=>{let{id:s}=t;if(!s)return;let r=this.sideBar.toolPanels?.find(e=>e.id===s);if(!r||t.toolPanel!==r.toolPanel)return;let a=this.toolPanelWrappers.find(e=>e.getToolPanelId()===s);if(!a)return;let l=(0,m._addGridCommonParams)(this.gos,{...t.toolPanelParams??{},initialState:e?.toolPanels?.[s],onStateUpdated:()=>this.dispatchSideBarUpdated()});!0===a.getToolPanelInstance()?.refresh(l)&&(this.toolPanelWrappers=this.toolPanelWrappers.filter(e=>e!==a),(0,m._removeFromParent)(a.getGui()),i[s]=a)}),this.clearDownUi(),this.setSideBarDef({sideBarDef:t,sideBarState:e,existingToolPanelWrappers:i})}dispatchSideBarUpdated(){this.eventSvc.dispatchEvent({type:"sideBarUpdated"})}destroyToolPanelWrappers(){for(let e of this.toolPanelWrappers)(0,m._removeFromParent)(e.getGui()),this.destroyBean(e);this.toolPanelWrappers.length=0}onAdvancedFilterChanged(){this.sideBar?.toolPanels?.some(e=>su("string"==typeof e?e:e.toolPanel))&&this.setState()}destroy(){this.destroyToolPanelWrappers(),super.destroy()}}},sp={moduleName:"SideBar",version:tv,beans:[class extends m.BeanStub{constructor(){super(...arguments),this.beanName="sideBar"}getSelector(){return sc}}],apiFunctions:{isSideBarVisible:function(e){return e.sideBar?.comp.isDisplayed()??!1},setSideBarVisible:function(e,t){e.sideBar?.comp.setDisplayed(t)},setSideBarPosition:function(e,t){e.sideBar?.comp.setSideBarPosition(t)},openToolPanel:function(e,t,i){e.sideBar?.comp.openToolPanel(t,"api",i)},closeToolPanel:function(e){e.sideBar?.comp.close("api")},getOpenedToolPanel:function(e){return e.sideBar?.comp.openedItem()??null},refreshToolPanel:function(e){e.sideBar?.comp.refresh()},isToolPanelShowing:function(e){return e.sideBar?.comp.isToolPanelShowing()??!1},getToolPanelInstance:function(e,t){let i=e.sideBar?.comp.getToolPanelInstance(t);return(0,m._unwrapUserComp)(i)},getSideBar:function(e){return e.sideBar?.comp.getDef()}},dependsOn:[tb,m._HorizontalResizeModule]},sg=class extends th{constructor(){super({warnNoIcon:()=>(0,m._warn)(227)})}},sm={moduleName:"MenuItem",version:tv,userComponents:{agMenuItem:sg},icons:{check:"tick",subMenuOpen:"small-right",subMenuOpenRtl:"small-left"},css:['.ag-menu-list{cursor:default;display:table;padding:var(--ag-spacing) 0;width:100%}.ag-menu-option,.ag-menu-separator{display:table-row}.ag-menu-option-part,.ag-menu-separator-part{display:table-cell;vertical-align:middle}.ag-menu-option{cursor:pointer;font-weight:500}:where(.ag-ltr) :where(.ag-menu-option-popup-pointer) .ag-icon{text-align:right}:where(.ag-rtl) :where(.ag-menu-option-popup-pointer) .ag-icon{text-align:left}.ag-menu-option-text{white-space:nowrap}.ag-menu-option-custom{display:contents}.ag-compact-menu-option{display:flex;flex-wrap:nowrap;width:100%}.ag-compact-menu-option-text{flex:1 1 auto;white-space:nowrap}.ag-menu-separator{height:calc(var(--ag-spacing)*2 + 1px)}.ag-menu-separator-part:after{border-top:solid var(--ag-border-width) var(--ag-menu-separator-color);content:"";display:block}.ag-compact-menu-option-active,.ag-menu-option-active{background-color:var(--ag-row-hover-color)}.ag-compact-menu-option-part,.ag-menu-option-part{line-height:var(--ag-icon-size);padding:calc(var(--ag-spacing) + 2px) 0}.ag-compact-menu-option-disabled,.ag-menu-option-disabled{cursor:not-allowed;opacity:.5}.ag-compact-menu-option-icon,.ag-menu-option-icon{width:var(--ag-icon-size)}:where(.ag-ltr) .ag-compact-menu-option-icon,:where(.ag-ltr) .ag-menu-option-icon{padding-left:calc(var(--ag-spacing)*2)}:where(.ag-rtl) .ag-compact-menu-option-icon,:where(.ag-rtl) .ag-menu-option-icon{padding-right:calc(var(--ag-spacing)*2)}.ag-compact-menu-option-text,.ag-menu-option-text{padding-left:calc(var(--ag-spacing)*2);padding-right:calc(var(--ag-spacing)*2)}:where(.ag-ltr) .ag-compact-menu-option-shortcut,:where(.ag-ltr) .ag-menu-option-shortcut{padding-right:var(--ag-spacing)}:where(.ag-rtl) .ag-compact-menu-option-shortcut,:where(.ag-rtl) .ag-menu-option-shortcut{padding-left:var(--ag-spacing)}:where(.ag-ltr) .ag-compact-menu-option-popup-pointer,:where(.ag-ltr) .ag-menu-option-popup-pointer{padding-right:var(--ag-spacing)}:where(.ag-rtl) .ag-compact-menu-option-popup-pointer,:where(.ag-rtl) .ag-menu-option-popup-pointer{padding-left:var(--ag-spacing)}.ag-menu-column-select-wrapper{height:265px;overflow:auto;:where(.ag-column-select){height:100%}}.ag-menu:where(.ag-tabs){min-width:290px}.ag-context-menu-loading-icon{pointer-events:none;position:absolute}']},sf={tag:"div",cls:"ag-column-select-header",role:"presentation",children:[{tag:"div",ref:"eExpand",cls:"ag-column-select-header-icon"},{tag:"ag-checkbox",ref:"eSelect",cls:"ag-column-select-header-checkbox"},{tag:"ag-input-text-field",ref:"eFilterTextField",cls:"ag-column-select-header-filter-wrapper"}]},sC={selector:"AG-PRIMARY-COLS-HEADER",component:class extends m.Component{constructor(){super(sf,[m.AgCheckboxSelector,m.AgInputTextFieldSelector]),this.eExpand=m.RefPlaceholder,this.eSelect=m.RefPlaceholder,this.eFilterTextField=m.RefPlaceholder}postConstruct(){this.createExpandIcons(),this.addManagedListeners(this.eExpand,{click:this.onExpandClicked.bind(this),keydown:e=>{e.key===m.KeyCode.SPACE&&(e.preventDefault(),this.onExpandClicked())}}),this.addManagedElementListeners(this.eSelect.getInputElement(),{click:this.onSelectClicked.bind(this)}),this.addManagedPropertyListener("functionsReadOnly",()=>this.onFunctionsReadOnlyPropChanged()),this.eFilterTextField.setAutoComplete(!1).onValueChange(()=>this.onFilterTextChanged()),this.addManagedEventListeners({newColumnsLoaded:this.showOrHideOptions.bind(this)});let e=this.getLocaleTextFunc();this.eSelect.setInputAriaLabel(e("ariaColumnSelectAll","Toggle All Columns Visibility")),this.eFilterTextField.setInputAriaLabel(e("ariaFilterColumnsInput","Filter Columns Input")),this.activateTabIndex([this.eExpand])}onFunctionsReadOnlyPropChanged(){let e=this.gos.get("functionsReadOnly");this.eSelect.setReadOnly(e),this.eSelect.toggleCss("ag-column-select-column-readonly",e)}init(e){this.params=e;let t=this.gos.get("functionsReadOnly");this.eSelect.setReadOnly(t),this.eSelect.toggleCss("ag-column-select-column-readonly",t),this.beans.colModel.ready&&this.showOrHideOptions()}createExpandIcons(){let e=this.beans;this.eExpand.appendChild(this.eExpandChecked=(0,m._createIconNoSpan)("columnSelectOpen",e)),this.eExpand.appendChild(this.eExpandUnchecked=(0,m._createIconNoSpan)("columnSelectClosed",e)),this.eExpand.appendChild(this.eExpandIndeterminate=(0,m._createIconNoSpan)("columnSelectIndeterminate",e)),this.setExpandState(0)}showOrHideOptions(){let e=this.params,t=!e.suppressColumnFilter,i=!e.suppressColumnSelectAll,s=!e.suppressColumnExpandAll,r=!!this.beans.colModel.colDefCols?.treeDepth,a=this.getLocaleTextFunc();this.eFilterTextField.setInputPlaceholder(a("searchOoo","Search...")),(0,m._setDisplayed)(this.eFilterTextField.getGui(),t),(0,m._setDisplayed)(this.eSelect.getGui(),i),(0,m._setDisplayed)(this.eExpand,s&&r)}onFilterTextChanged(){this.onFilterTextChangedDebounced||(this.onFilterTextChangedDebounced=(0,m._debounce)(this,()=>{let e=this.eFilterTextField.getValue();this.dispatchLocalEvent({type:"filterChanged",filterText:e})},300)),this.onFilterTextChangedDebounced()}onSelectClicked(){this.dispatchLocalEvent({type:this.selectState?"unselectAll":"selectAll"})}onExpandClicked(){this.dispatchLocalEvent({type:0===this.expandState?"collapseAll":"expandAll"})}setExpandState(e){this.expandState=e,(0,m._setDisplayed)(this.eExpandChecked,0===e),(0,m._setDisplayed)(this.eExpandUnchecked,1===e),(0,m._setDisplayed)(this.eExpandIndeterminate,2===e)}setSelectionState(e){this.selectState=e,this.eSelect.setValue(this.selectState)}}};function sv(e){return!!e&&void 0!==e.children}function sb(e){return sv(e)?e.groupId:e.colId}function sy(e,t){let i=[],s=(t,r)=>{if(sv(t)){let e=void 0!==t.groupId?t.groupId:t.headerName,i=new m.AgProvidedColumnGroup(t,e,!1,r),a=[];for(let e of t.children){let t=s(e,r+1);t&&a.push(t)}return i.setChildren(a),i}{let s=t.colId?t.colId:t.field,r=e.getColDefCol(s);return r||i.push(t),r}},r=[];for(let e of t){let t=s(e,0);t&&r.push(t)}return i.length>0&&(0,m._warn)(217,{invalidColIds:i}),r}function sw(e,t){var i;let s;t(function(e){let t=(e,t)=>sv(e)&&sv(t)&&sb(e)===sb(t),i=(e,t)=>{if(!sv(t)||t.children&&t.groupId&&function e(t,i,s){let r,a,l;if(!sv(t))return!0;if(r=t.children.map(sb).includes(sb(s)),l=(a=(0,m._last)(t.children))&&sb(a)!==sb(s),r&&l||t.groupId===i&&!t.children.map(sb).includes(sb(s)))return t.children.push(s),!0;for(let r=t.children.length-1;r>=0&&!e(t.children[r],i,s);r--);return!1}(e,t.groupId,t.children[0]))return e;for(let s of t.children)i(e,s);return e},s=[];for(let r=1;r<=e.length;r++){let a=e[r-1],l=e[r];t(a,l)?e[r]=i(a,l):s.push(a)}return s}((i=e,s=(e,t)=>{let i;if((0,m.isProvidedColumnGroup)(e))if(e.isPadding())i=t;else{let s=Object.assign({},e.getColGroupDef());s.groupId=e.getGroupId(),s.children=[t],i=s}else{let t=Object.assign({},e.getColDef());t.colId=e.getColId(),i=t}let r=e.getOriginalParent();return r?s(r,i):i},i.getCols().filter(e=>{let t=e.getColDef();return e.isPrimary()&&!t.showRowGroup}).map(e=>s(e,e.getColDef())))))}var sS=class{constructor(e,t,i,s=!1,r){this.displayName=e,this.depth=i,this.group=s,this.localEventService=new m.LocalEventService,s?(this.columnGroup=t,this._expanded=r,this.children=[]):this.column=t}get expanded(){return!!this._expanded}set expanded(e){e!==this._expanded&&(this._expanded=e,this.localEventService.dispatchEvent({type:"expandedChanged"}))}addEventListener(e,t){this.localEventService.addEventListener(e,t)}removeEventListener(e,t){this.localEventService.removeEventListener(e,t)}};function sx(e,t,i,s){var r,a,l,n,o,d,h,u;let c,p;e.colModel.isPivotMode()?(r=e,a=t,l=i,n=s,o=r,d=a,h=l,u=n,c=[],p=h?e=>{if(!e.isAnyFunctionActive())if(e.isAllowValue()){let t="string"==typeof e.getAggFunc()?e.getAggFunc():o.aggFuncSvc?.getDefaultAggFunc(e);c.push({colId:e.getId(),aggFunc:t})}else e.isAllowRowGroup()?c.push({colId:e.getId(),rowGroup:!0}):e.isAllowPivot()&&c.push({colId:e.getId(),pivot:!0})}:e=>{(e.isPivotActive()||e.isRowGroupActive()||e.isValueActive())&&c.push({colId:e.getId(),pivot:!1,rowGroup:!1,aggFunc:null})},d.forEach(p),c.length>0&&(0,m._applyColumnState)(o,{state:c},u)):function(e,t,i,s){let r=[];for(let e of t)e.getColDef().lockVisible||e.isVisible()!=i&&r.push({colId:e.getId(),hide:!i});r.length>0&&(0,m._applyColumnState)(e,{state:r},s)}(e,t,i,s)}function sF(e){let t=[],i=e=>{for(let s of e)s.passesFilter&&(s.group?i(s.children):t.push(s.column))};return i(e),t}function sA(e,t){let{columns:i,visibleState:s,pivotState:r,eventType:a}=t,l=i.map(t=>{let i=t.getColId();if(!e.colModel.isPivotMode())return{colId:i,hide:!s?.[i]};{let e=r?.[i];return{colId:i,pivot:e?.pivot,rowGroup:e?.rowGroup,aggFunc:e?.aggFunc}}});(0,m._applyColumnState)(e,{state:l},a)}function sM(e){return{pivot:e.isPivotActive(),rowGroup:e.isRowGroupActive(),aggFunc:e.isValueActive()?e.getAggFunc():void 0}}function sR(e,t,i,s){let r=t.getCol(i),a=e._groupData;a||(e._groupData=a={});let l=r.getColId(),n=a[l];n!==s&&(a[l]=s,e.dispatchCellChangedEvent(r,s,n))}function sT(e,t,i){e.group!==i&&(e.group&&!i&&(e.expanded=!1),e.group=i,e.updateHasChildren(),t.selectionSvc?.updateRowSelectable(e),e.dispatchRowEvent("groupChanged"))}function sP(e,t){let{gos:i,rowGroupColsSvc:s}=t;if(!s||!e)return!1;let r=i.get("groupLockGroupColumns");return!!e.isRowGroupActive()&&0!==r&&(-1===r||r>s.columns.findIndex(t=>t.getColId()===e.getColId()))}function sI(e,t,i){let s="groupBy"===t?"Group by":"Un-Group by",r=e(t,`${s} ${i}`,[i]);return r.indexOf(i)>=0?r:`${r} ${i}`}var sE={name:"menuItem",optionalMethods:["setActive","select","setExpanded","configureDefaults"]},sD={getMenuItemComp:(e,t,i)=>{let s=e.userCompFactory.getCompDetails(t,sE,"agMenuItem",(0,m._addGridCommonParams)(e.gos,i),!0);return s?.newAgStackInstance()??m.AgPromise.resolve()},getPostProcessPopupParams:({column:e,node:t})=>({column:e,rowNode:t}),preserveRangesWhile:function(e,t){if(!e.gos.get("enableCellTextSelection")||!(0,m._isBrowserFirefox)()&&!(0,m._isBrowserSafari)())return t();let{selection:i,ranges:s}=function(e){let t=(0,m._getRootNode)(e),i="getSelection"in t?t.getSelection():null,s=[];for(let e=0;e<(i?.rangeCount??0);e++){let t=i?.getRangeAt(e);t&&s.push(t)}return{selection:i,ranges:s}}(e);for(let e of(t(),i?.removeAllRanges(),s))i?.addRange(e)},stopPropagationCallbacks:m._STOP_PROPAGATION_CALLBACKS,warnNoItem:e=>{(0,m._warn)(228,{menuItemOrString:e})}},sk=class extends tl{constructor(){super(sD)}},sL=class extends tn{constructor(e,t={column:null,node:null,value:null}){super(e,t,sD)}},sN=class extends m.Component{constructor(e,t,i){super({tag:"div",cls:"ag-menu"}),this.column=e,this.mouseEventOrTouch=t,this.parentEl=i,this.displayName=null}postConstruct(){let e,{column:t,beans:{colNames:i}}=this;if(this.initializeProperties(t),e=(0,m.isColumn)(t)?i.getDisplayNameForColumn(t,"columnToolPanel"):i.getDisplayNameForProvidedColumnGroup(null,t,"columnToolPanel"),this.displayName=e,this.buildMenuItemMap(),this.isActive()){let e=this.mouseEventOrTouch;"preventDefault"in e&&e.preventDefault();let t=this.getMappedMenuItems();if(0===t.length)return;this.displayContextMenu(t)}}initializeProperties(e){let t;t=(0,m.isProvidedColumnGroup)(e)?e.getLeafColumns():[e],this.columns=t;let i=this.beans.colModel.isPivotMode();this.allowScrollIntoView=!i&&t.some(this.isColumnValidForScrollIntoView),this.allowGrouping=t.some(e=>e.isPrimary()&&e.isAllowRowGroup()),this.allowValues=t.some(e=>e.isPrimary()&&e.isAllowValue()),this.allowPivoting=i&&t.some(e=>e.isPrimary()&&e.isAllowPivot())}buildMenuItemMap(){let e=this.getLocaleTextFunc(),{beans:t,displayName:i}=this,{rowGroupColsSvc:s,valueColsSvc:r,pivotColsSvc:a,colModel:l}=t,n=new Map;this.menuItemMap=n;let o=l.isPivotMode();n.set("scrollIntoView",{allowedFunction:e=>!e.isPinned()&&!o&&this.isColumnValidForScrollIntoView(e),activeFunction:()=>!1,activateLabel:()=>e("scrollColumnIntoView",`Scroll ${i} into View`,[i]),activateFunction:()=>{let e=this.columns.find(this.isColumnValidForScrollIntoView);e&&this.beans.ctrlsSvc.getScrollFeature().ensureColumnVisible(e)},deActivateFunction:()=>{},addIcon:"ensureColumnVisible"});let d=e=>e.isPrimary()&&e.isAllowRowGroup()&&!sP(e,t);n.set("rowGroup",{allowedFunction:d,activeFunction:e=>e.isRowGroupActive(),activateLabel:()=>sI(e,"groupBy",i),deactivateLabel:()=>sI(e,"ungroupBy",i),activateFunction:()=>s?.setColumns(this.addColumnsToList(s.columns,d),"toolPanelUi"),deActivateFunction:()=>s?.setColumns(this.removeColumnsFromList(s.columns,d),"toolPanelUi"),addIcon:"menuAddRowGroup",removeIcon:"menuRemoveRowGroup"});let h=e=>e.isPrimary()&&e.isAllowValue();n.set("value",{allowedFunction:h,activeFunction:e=>e.isValueActive(),activateLabel:()=>e("addToValues",`Add ${i} to values`,[i]),deactivateLabel:()=>e("removeFromValues",`Remove ${i} from values`,[i]),activateFunction:()=>r?.setColumns(this.addColumnsToList(r.columns,h),"toolPanelUi"),deActivateFunction:()=>r?.setColumns(this.removeColumnsFromList(r.columns,h),"toolPanelUi"),addIcon:"valuePanel",removeIcon:"valuePanel"});let u=e=>o&&e.isPrimary()&&e.isAllowPivot();n.set("pivot",{allowedFunction:u,activeFunction:e=>e.isPivotActive(),activateLabel:()=>e("addToLabels",`Add ${i} to labels`,[i]),deactivateLabel:()=>e("removeFromLabels",`Remove ${i} from labels`,[i]),activateFunction:()=>a?.setColumns(this.addColumnsToList(a.columns,u),"toolPanelUi"),deActivateFunction:()=>a?.setColumns(this.removeColumnsFromList(a.columns,u),"toolPanelUi"),addIcon:"pivotPanel",removeIcon:"pivotPanel"})}isColumnValidForScrollIntoView(e){if(!e.isVisible())return!1;let t=e.getParent();return!t||(t.getDisplayedChildren()?.includes(e)??!0)}addColumnsToList(e,t){return[...e].concat(this.columns.filter(i=>t(i)&&!e.includes(i)))}removeColumnsFromList(e,t){return e.filter(e=>t(e)&&!this.columns.includes(e))}displayContextMenu(e){let t=this.getGui(),i=this.createBean(new sL),s=this.getLocaleTextFunc(),r=()=>{};t.appendChild(i.getGui()),i.addMenuItems(e),i.addManagedListeners(i,{closeMenu:()=>{this.parentEl.focus(),r()}});let a=this.beans.popupSvc,l=a.addPopup({modal:!0,eChild:t,closeOnEsc:!0,afterGuiAttached:()=>(0,m._focusInto)(i.getGui()),ariaLabel:s("ariaLabelContextMenu","Context Menu"),closedCallback:e=>{e instanceof KeyboardEvent&&this.parentEl.focus(),this.destroyBean(i)}});l&&(r=l.hideFunc),a.positionPopupUnderMouseEvent({type:"columnContextMenu",mouseEvent:this.mouseEventOrTouch,ePopup:t})}isActive(){return this.allowScrollIntoView||this.allowGrouping||this.allowValues||this.allowPivoting}getMappedMenuItems(){let e=[],{menuItemMap:t,columns:i,displayName:s,beans:r}=this;for(let a of t.values()){let t=i.some(e=>a.allowedFunction(e)&&!a.activeFunction(e)),l=i.some(e=>a.allowedFunction(e)&&a.activeFunction(e));t&&e.push({name:a.activateLabel(s),icon:(0,m._createIconNoSpan)(a.addIcon,r,null),action:()=>a.activateFunction()}),l&&a.removeIcon&&a.deactivateLabel&&e.push({name:a.deactivateLabel(s),icon:(0,m._createIconNoSpan)(a.removeIcon,r,null),action:()=>a.deActivateFunction?.()})}return e}},sG={tag:"div",cls:"ag-column-select-column-group",children:[{tag:"span",ref:"eColumnGroupIcons",cls:"ag-column-group-icons",children:[{tag:"span",ref:"eGroupClosedIcon",cls:"ag-column-group-closed-icon"},{tag:"span",ref:"eGroupOpenedIcon",cls:"ag-column-group-opened-icon"}]},{tag:"ag-checkbox",ref:"cbSelect",cls:"ag-column-select-checkbox"},{tag:"span",ref:"eLabel",cls:"ag-column-select-column-label"}]},sO=class extends m.Component{constructor(e,t,i,s){super(),this.modelItem=e,this.allowDragging=t,this.eventType=i,this.focusWrapper=s,this.cbSelect=m.RefPlaceholder,this.eLabel=m.RefPlaceholder,this.eGroupOpenedIcon=m.RefPlaceholder,this.eGroupClosedIcon=m.RefPlaceholder,this.eColumnGroupIcons=m.RefPlaceholder,this.processingColumnStateChange=!1;const{columnGroup:r,depth:a,displayName:l}=e;this.columnGroup=r,this.columnDepth=a,this.displayName=l}postConstruct(){this.setTemplate(sG,[m.AgCheckboxSelector]);let{beans:e,cbSelect:t,eLabel:i,displayName:s,columnDepth:r,modelItem:a,focusWrapper:l,columnGroup:n}=this,{registry:o,gos:d}=e,h=(0,m._createIconNoSpan)("columnDrag",e);this.eDragHandle=h,h.classList.add("ag-drag-handle","ag-column-select-column-group-drag-handle");let u=t.getGui(),c=t.getInputElement();u.after(h),c.setAttribute("tabindex","-1"),i.textContent=s??"",this.setupExpandContract(),this.addCss("ag-column-select-indent-"+r),this.getGui().style.setProperty("--ag-indentation-level",String(r)),this.tooltipFeature=this.createOptionalManagedBean(o.createDynamicBean("tooltipFeature",!1,{getGui:()=>this.focusWrapper,getLocation:()=>"columnToolPanelColumnGroup",shouldDisplayTooltip:(0,m._getShouldDisplayTooltip)(d,()=>i)})),this.addManagedEventListeners({columnPivotModeChanged:this.onColumnStateChanged.bind(this)}),this.addManagedElementListeners(i,{click:this.onLabelClicked.bind(this)}),this.addManagedListeners(t,{fieldValueChanged:this.onCheckboxChanged.bind(this)}),this.addManagedListeners(a,{expandedChanged:this.onExpandChanged.bind(this)});let p=new m.TouchListener(this.getGui(),!1);for(let e of(this.addManagedListeners(p,{longTap:e=>this.onContextMenu(e.touchStart)}),this.addDestroyFunc(p.destroy.bind(p)),this.addManagedListeners(l,{keydown:this.handleKeyDown.bind(this),contextmenu:this.onContextMenu.bind(this)}),this.setOpenClosedIcons(),this.setupDragging(),this.onColumnStateChanged(),this.addVisibilityListenersToAllChildren(),this.refreshAriaExpanded(),this.refreshAriaLabel(),this.setupTooltip(),(0,m._getToolPanelClassesFromColDef)(n.getColGroupDef(),d,null,n)))this.toggleCss(e,!0)}getColumns(){return this.columnGroup.getLeafColumns()}setupTooltip(){let e=this.columnGroup.getColGroupDef();if(!e)return;let t=()=>this.tooltipFeature?.setTooltipAndRefresh(e.headerTooltip);t(),this.addManagedEventListeners({newColumnsLoaded:t})}handleKeyDown(e){switch(e.key){case m.KeyCode.LEFT:e.preventDefault(),this.modelItem.expanded=!1;break;case m.KeyCode.RIGHT:e.preventDefault(),this.modelItem.expanded=!0;break;case m.KeyCode.SPACE:e.preventDefault(),this.isSelectable()&&this.onSelectAllChanged(!this.isSelected())}}onContextMenu(e){let{columnGroup:t,gos:i}=this;if(i.get("functionsReadOnly"))return;let s=this.createBean(new sN(t,e,this.focusWrapper));this.addDestroyFunc(()=>{s.isAlive()&&this.destroyBean(s)})}addVisibilityListenersToAllChildren(){let e=this.onColumnStateChanged.bind(this);for(let t of this.columnGroup.getLeafColumns())this.addManagedListeners(t,{visibleChanged:e,columnValueChanged:e,columnPivotChanged:e,columnRowGroupChanged:e})}setupDragging(){if(!this.allowDragging)return void(0,m._setDisplayed)(this.eDragHandle,!1);let e=this.beans,{gos:t,eventSvc:i,dragAndDrop:s}=e,r=!t.get("suppressDragLeaveHidesColumns"),a={type:m.DragSourceType.ToolPanel,eElement:this.eDragHandle,dragItemName:this.displayName,getDefaultIconName:()=>r?"hide":"notAllowed",getDragItem:()=>this.createDragItem(),onDragStarted:()=>{r=!t.get("suppressDragLeaveHidesColumns"),i.dispatchEvent({type:"columnPanelItemDragStart",column:this.columnGroup})},onDragStopped:()=>{i.dispatchEvent({type:"columnPanelItemDragEnd"})},onGridEnter:t=>{r&&sA(e,{columns:this.columnGroup.getLeafColumns(),visibleState:t?.visibleState,pivotState:t?.pivotState,eventType:this.eventType})},onGridExit:()=>{r&&this.onChangeCommon(!1)}};s.addDragSource(a,!0),this.addDestroyFunc(()=>s.removeDragSource(a))}createDragItem(){let e=this.columnGroup.getLeafColumns(),t={},i={};for(let s of e){let e=s.getId();t[e]=s.isVisible(),i[e]=sM(s)}return{columns:e,visibleState:t,pivotState:i}}setupExpandContract(){let{beans:e,eGroupClosedIcon:t,eGroupOpenedIcon:i,eColumnGroupIcons:s}=this;t.appendChild((0,m._createIcon)("columnSelectClosed",e,null)),i.appendChild((0,m._createIcon)("columnSelectOpen",e,null));let r=this.onExpandOrContractClicked.bind(this);this.addManagedElementListeners(t,{click:r}),this.addManagedElementListeners(i,{click:r});let a=new m.TouchListener(s,!0);this.addManagedListeners(a,{tap:r}),this.addDestroyFunc(a.destroy.bind(a))}onLabelClicked(){let e=!this.cbSelect.getValue();this.onChangeCommon(e)}onCheckboxChanged(e){this.onChangeCommon(e.selected)}getVisibleLeafColumns(){let e=[],t=i=>{for(let s of i)s.passesFilter&&(s.group?t(s.children):e.push(s.column))};return t(this.modelItem.children),e}onChangeCommon(e){if(this.refreshAriaLabel(),!this.processingColumnStateChange){var t,i,s;t=this.beans,i=this.modelItem.children,s=this.eventType,sx(t,sF(i),e,s)}}refreshAriaLabel(){let{cbSelect:e,focusWrapper:t,displayName:i}=this,s=this.getLocaleTextFunc(),r=s("ariaColumnGroup","Column Group"),a=e.getValue(),l=void 0===a?s("ariaIndeterminate","indeterminate"):a?s("ariaVisible","visible"):s("ariaHidden","hidden"),n=s("ariaToggleVisibility","Press SPACE to toggle visibility");(0,m._setAriaLabel)(t,`${i} ${r}`),e.setInputAriaLabel(`${n} (${l})`),(0,m._setAriaDescribedBy)(t,e.getInputElement().id)}onColumnStateChanged(){let e=this.workOutSelectedValue(),t=this.workOutReadOnlyValue();this.processingColumnStateChange=!0;let i=this.cbSelect;i.setValue(e),i.setReadOnly(t),this.toggleCss("ag-column-select-column-group-readonly",t),this.processingColumnStateChange=!1}workOutSelectedValue(){let e=this.beans.colModel.isPivotMode(),t=this.getVisibleLeafColumns(),i=0,s=0;for(let r of t)(e||!r.getColDef().lockVisible)&&(this.isColumnChecked(r,e)?i++:s++);if(!(i>0)||!(s>0))return i>0}workOutReadOnlyValue(){let e=this.beans.colModel.isPivotMode(),t=0;for(let i of this.columnGroup.getLeafColumns())e?i.isAnyFunctionAllowed()&&t++:!i.getColDef().lockVisible&&t++;return 0===t}isColumnChecked(e,t){if(t){let t=e.isPivotActive(),i=e.isRowGroupActive(),s=e.isValueActive();return t||i||s}return e.isVisible()}onExpandOrContractClicked(){let e=this.modelItem,t=e.expanded;e.expanded=!t}onExpandChanged(){this.setOpenClosedIcons(),this.refreshAriaExpanded()}setOpenClosedIcons(){let e=this.modelItem.expanded;(0,m._setDisplayed)(this.eGroupClosedIcon,!e),(0,m._setDisplayed)(this.eGroupOpenedIcon,e)}refreshAriaExpanded(){(0,m._setAriaExpanded)(this.focusWrapper,this.modelItem.expanded)}getDisplayName(){return this.displayName}onSelectAllChanged(e){let t=this.cbSelect,i=t.getValue();t.isReadOnly()||(!e||i)&&(e||!i)||t.toggle()}isSelected(){return this.cbSelect.getValue()}isSelectable(){return!this.cbSelect.isReadOnly()}setSelected(e){this.cbSelect.setValue(e,!0)}},sB=e=>(0,m.isProvidedColumnGroup)(e)?e.getLeafColumns():e?[e]:[],sV=(e,t,i)=>!!(e.get("suppressMovableColumns")||t.colModel.isPivotMode())||!!i.find(({colDef:e})=>!!e.suppressMovable||!!e.lockPosition),s_=(e,t,i)=>{if(!i)return;let{component:s}=i,r=null,a="top"===i.position;if(s instanceof sO?(r=s.getColumns()[0],a=!0):s&&(r=s.column),!r)return;let l=((e,t,i,s)=>{if(!i||!t)return null;let r=e.colModel.getCols(),a=r.indexOf(i),l=s?a:a+1,n=((e,t,i)=>{if(!t)return 0;let s=t[0],r=t.length;return e.indexOf(s)<i?r:0})(r,t,l);return l-n})(e,t,r,a);null!=l&&e.colMoves?.moveColumns(t,l,"toolPanelUi")},sz={tag:"div",cls:"ag-column-select-column",children:[{tag:"ag-checkbox",ref:"cbSelect",cls:"ag-column-select-checkbox"},{tag:"span",ref:"eLabel",cls:"ag-column-select-column-label"}]},sH=class extends m.Component{constructor(e,t,i,s){super(),this.modelItem=e,this.allowDragging=t,this.groupsExist=i,this.focusWrapper=s,this.eLabel=m.RefPlaceholder,this.cbSelect=m.RefPlaceholder,this.processingColumnStateChange=!1;const{column:r,depth:a,displayName:l}=e;this.column=r,this.columnDepth=a,this.displayName=l}postConstruct(){this.setTemplate(sz,[m.AgCheckboxSelector]);let{beans:e,cbSelect:t,displayName:i,eLabel:s,columnDepth:r,groupsExist:a,column:l,gos:n,focusWrapper:o}=this,d=(0,m._createIconNoSpan)("columnDrag",e);this.eDragHandle=d,d.classList.add("ag-drag-handle","ag-column-select-column-drag-handle");let h=t.getGui(),u=t.getInputElement();h.after(d),u.setAttribute("tabindex","-1"),s.textContent=i,a&&this.addCss("ag-column-select-add-group-indent"),this.addCss(`ag-column-select-indent-${r}`),this.getGui().style.setProperty("--ag-indentation-level",String(r)),this.tooltipFeature=this.createOptionalManagedBean(e.registry.createDynamicBean("tooltipFeature",!1,{getGui:()=>this.focusWrapper,getLocation:()=>"columnToolPanelColumn",shouldDisplayTooltip:(0,m._getShouldDisplayTooltip)(n,()=>s),getAdditionalParams:()=>({colDef:l.getColDef()})})),this.setupDragging();let c=this.onColumnStateChanged.bind(this);this.addManagedEventListeners({columnPivotModeChanged:c}),this.addManagedListeners(l,{columnValueChanged:c,columnPivotChanged:c,columnRowGroupChanged:c,visibleChanged:c}),this.addManagedListeners(o,{keydown:this.handleKeyDown.bind(this),contextmenu:this.onContextMenu.bind(this)});let p=new m.TouchListener(o);for(let e of(this.addManagedListeners(p,{longTap:e=>this.onContextMenu(e.touchStart)}),this.addDestroyFunc(p.destroy.bind(p)),this.addManagedPropertyListener("functionsReadOnly",this.onColumnStateChanged.bind(this)),this.addManagedListeners(t,{fieldValueChanged:this.onCheckboxChanged.bind(this)}),this.addManagedElementListeners(s,{click:this.onLabelClicked.bind(this)}),this.onColumnStateChanged(),this.refreshAriaLabel(),this.setupTooltip(),(0,m._getToolPanelClassesFromColDef)(l.getColDef(),n,l,null)))this.toggleCss(e,!0)}getColumn(){return this.column}setupTooltip(){let e=()=>this.tooltipFeature?.setTooltipAndRefresh(this.column.getColDef().headerTooltip);e(),this.addManagedEventListeners({newColumnsLoaded:e})}onContextMenu(e){let{column:t,gos:i}=this;if(i.get("functionsReadOnly"))return;let s=this.createBean(new sN(t,e,this.focusWrapper));this.addDestroyFunc(()=>{s.isAlive()&&this.destroyBean(s)})}handleKeyDown(e){e.key===m.KeyCode.SPACE&&(e.preventDefault(),this.isSelectable()&&this.onSelectAllChanged(!this.isSelected()))}onLabelClicked(){if(this.gos.get("functionsReadOnly"))return;let e=!this.cbSelect.getValue();this.onChangeCommon(e)}onCheckboxChanged(e){this.onChangeCommon(e.selected)}onChangeCommon(e){this.cbSelect.isReadOnly()||(this.refreshAriaLabel(),this.processingColumnStateChange||sx(this.beans,[this.column],e,"toolPanelUi"))}refreshAriaLabel(){let{cbSelect:e,focusWrapper:t,displayName:i}=this,s=this.getLocaleTextFunc(),r=s("ariaColumn","Column"),a=e.getValue()?s("ariaVisible","visible"):s("ariaHidden","hidden"),l=s("ariaToggleVisibility","Press SPACE to toggle visibility");(0,m._setAriaLabel)(t,`${i} ${r}`),this.cbSelect.setInputAriaLabel(`${l} (${a})`),(0,m._setAriaDescribedBy)(t,e.getInputElement().id)}setupDragging(){let e=this.eDragHandle;if(!this.allowDragging)return void(0,m._setDisplayed)(e,!1);let t=this.beans,{gos:i,eventSvc:s,dragAndDrop:r}=t,a=!i.get("suppressDragLeaveHidesColumns"),l={type:m.DragSourceType.ToolPanel,eElement:e,dragItemName:this.displayName,getDefaultIconName:()=>a?"hide":"notAllowed",getDragItem:()=>this.createDragItem(),onDragStarted:()=>{a=!i.get("suppressDragLeaveHidesColumns"),s.dispatchEvent({type:"columnPanelItemDragStart",column:this.column})},onDragStopped:()=>{s.dispatchEvent({type:"columnPanelItemDragEnd"})},onGridEnter:e=>{a&&sA(t,{columns:[this.column],visibleState:e?.visibleState,pivotState:e?.pivotState,eventType:"toolPanelUi"})},onGridExit:()=>{a&&this.onChangeCommon(!1)}};r.addDragSource(l,!0),this.addDestroyFunc(()=>r.removeDragSource(l))}createDragItem(){let e=this.column.getColId(),t={[e]:this.column.isVisible()},i={[e]:sM(this.column)};return{columns:[this.column],visibleState:t,pivotState:i}}onColumnStateChanged(){this.processingColumnStateChange=!0;let e=this.beans.colModel.isPivotMode();if(e){let e=this.column.isAnyFunctionActive();this.cbSelect.setValue(e)}else this.cbSelect.setValue(this.column.isVisible());let t=!0,i=!0;if(e){let e=this.gos.get("functionsReadOnly"),s=!this.column.isAnyFunctionAllowed();i=t=!e&&!s}else{let{enableRowGroup:e,enableValue:s,lockPosition:r,suppressMovable:a,lockVisible:l}=this.column.getColDef();t=!l,i=!!e||!!s||!(r||a)}this.cbSelect.setReadOnly(!t),this.eDragHandle.classList.toggle("ag-column-select-column-readonly",!i),this.toggleCss("ag-column-select-column-readonly",!i&&!t),this.cbSelect.setPassive(!1),this.processingColumnStateChange=!1}getDisplayName(){return this.displayName}onSelectAllChanged(e){let t=this.cbSelect;e===t.getValue()||t.isReadOnly()||t.toggle()}isSelected(){return this.cbSelect.getValue()}isSelectable(){return!this.cbSelect.isReadOnly()}isExpandable(){return!1}setExpanded(e){(0,m._warn)(158)}},sU=class{constructor(e){this.items=e}getRowCount(){return this.items.length}getRow(e){return this.items[e]}},sW={selector:"AG-PRIMARY-COLS-LIST",component:class extends m.Component{constructor(){super({tag:"div",cls:"ag-column-select-list",role:"presentation"}),this.destroyColumnItemFuncs=[],this.hasLoadedInitialState=!1,this.isInitialState=!1,this.skipRefocus=!1}wireBeans(e){this.colModel=e.colModel}destroy(){this.destroyColumnTree(),super.destroy()}destroyColumnTree(){for(let e of(this.allColsTree=[],this.destroyColumnItemFuncs))e();this.destroyColumnItemFuncs=[]}init(e,t,i){this.params=e;let{suppressSyncLayoutWithGrid:s,contractColumnSelection:r,suppressColumnMove:a}=e;this.allowDragging=t,this.eventType=i,s||this.addManagedEventListeners({columnMoved:this.onColumnsChanged.bind(this)}),this.addManagedEventListeners({newColumnsLoaded:this.onColumnsChanged.bind(this)});let l=this.fireSelectionChangedEvent.bind(this);this.addManagedEventListeners({columnPivotChanged:l,columnPivotModeChanged:l,columnRowGroupChanged:l,columnValueChanged:l,columnVisible:l,newColumnsLoaded:l}),this.expandGroupsByDefault=!r;let n=a||s,o=this.createManagedBean(new t_({cssIdentifier:"column-select",ariaRole:"tree",moveItemCallback:(e,t)=>{n||this.moveItems(e,t)}}));this.virtualList=o,this.appendChild(o.getGui()),o.setComponentCreator((e,t)=>((0,m._setAriaLevel)(t,e.depth+1),this.createComponentFromItem(e,t))),this.colModel.ready&&this.onColumnsChanged(),n||this.createItemDragFeature()}createItemDragFeature(){let{gos:e,beans:t,virtualList:i}=this;this.createManagedBean(new tQ(this,i,{dragSourceType:m.DragSourceType.ToolPanel,addListeners:(e,t,i)=>{e.addManagedEventListeners({columnPanelItemDragStart:t,columnPanelItemDragEnd:i})},getCurrentDragValue:e=>e.column,isMoveBlocked:i=>sV(e,t,sB(i)),getNumRows:e=>e.getDisplayedColsList().length,moveItem:(e,i)=>s_(t,sB(e),i)}))}moveItems(e,t){let{gos:i,beans:s}=this,{modelItem:r}=e,{group:a,columnGroup:l,column:n,expanded:o}=r,d=sB(a?l:n);if(sV(i,s,d))return;let h=this.displayedColsList.indexOf(r),u=0;if(t){let t=e.columnDepth>0?n.getParent()?.getChildren():null;t?.length&&n===t[0]&&(u=-1)}else a&&(u=o?r.children.length:0);let c=Math.min(Math.max(h+u+(t?-1:1),0),this.displayedColsList.length-1);this.skipRefocus=!0,s_(s,d,{rowIndex:c,position:t?"top":"bottom",component:this.virtualList.getComponentAt(c)}),this.focusRowIfAlive(c-u).then(()=>{this.skipRefocus=!1})}createComponentFromItem(e,t){let i=this.allowDragging;if(e.group){let s=new sO(e,i,this.eventType,t);return this.createBean(s),s}let s=new sH(e,i,this.groupsExist,t);return this.createBean(s),s}onColumnsChanged(){let e=this.params;this.hasLoadedInitialState||(this.hasLoadedInitialState=!0,this.isInitialState=!!e.initialState);let t=this.getExpandedStates(),i=this.colModel.isPivotMode();e.suppressSyncLayoutWithGrid||i?this.buildTreeFromProvidedColumnDefs():this.buildTreeFromWhatGridIsDisplaying(),this.setExpandedStates(t),this.markFilteredColumns(),this.flattenAndFilterModel(),this.isInitialState=!1}getDisplayedColsList(){return this.displayedColsList}getExpandedStates(){let e={};if(this.isInitialState){let{expandedGroupIds:t}=this.params.initialState;for(let i of t)e[i]=!0;return e}return this.allColsTree?(this.forEachItem(t=>{if(!t.group)return;let i=t.columnGroup;i&&(e[i.getId()]=t.expanded)}),e):{}}setExpandedStates(e){if(!this.allColsTree)return;let{isInitialState:t}=this;this.forEachItem(i=>{if(!i.group)return;let s=i.columnGroup;if(s){let r=e[s.getId()];(null!=r||t)&&(i.expanded=!!r)}})}buildTreeFromWhatGridIsDisplaying(){sw(this.colModel,this.setColumnLayout.bind(this))}setColumnLayout(e){let t=sy(this.colModel,e);this.buildListModel(t),this.groupsExist=e.some(e=>e&&void 0!==e.children),this.markFilteredColumns(),this.flattenAndFilterModel()}buildTreeFromProvidedColumnDefs(){let e=this.colModel;this.buildListModel(e.getColDefColTree()),this.groupsExist=!!e.colDefCols?.treeDepth}buildListModel(e){let t=this.onColumnExpanded.bind(this),i=e=>{e.addEventListener("expandedChanged",t);let i=e.removeEventListener.bind(e,"expandedChanged",t);this.destroyColumnItemFuncs.push(i)},s=this.beans.colNames,r=(e,t,i)=>{for(let s of e)(0,m.isProvidedColumnGroup)(s)?a(s,t,i):l(s,t,i)},a=(e,t,a)=>{let l=e.getColGroupDef();if(l?.suppressColumnsToolPanel)return;if(e.isPadding())return void r(e.getChildren(),t,a);let n=new sS(s.getDisplayNameForProvidedColumnGroup(null,e,"columnToolPanel"),e,t,!0,this.expandGroupsByDefault);a.push(n),i(n),r(e.getChildren(),t+1,n.children)},l=(e,t,i)=>{if(e.getColDef()?.suppressColumnsToolPanel)return;let r=s.getDisplayNameForColumn(e,"columnToolPanel");i.push(new sS(r,e,t))};this.destroyColumnTree(),r(e,0,this.allColsTree)}onColumnExpanded(){this.flattenAndFilterModel()}flattenAndFilterModel(){this.displayedColsList=[];let e=t=>{t.passesFilter&&(this.displayedColsList.push(t),t.group&&t.expanded&&t.children.forEach(e))},t=this.virtualList;this.allColsTree.forEach(e),t.setModel(new sU(this.displayedColsList));let i=null;this.skipRefocus||(i=t.getLastFocusedRow()),t.refresh(),null!=i&&this.focusRowIfAlive(i),this.notifyListeners(),this.refreshAriaLabel()}refreshAriaLabel(){let e=this.getLocaleTextFunc(),t=e("ariaColumnPanelList","Column List"),i=e("columns","Columns"),s=this.displayedColsList.length;(0,m._setAriaLabel)(this.virtualList.getAriaElement(),`${t} ${s} ${i}`)}focusRowIfAlive(e){return -1===e?Promise.resolve():new Promise(t=>{window.setTimeout(()=>{this.isAlive()&&this.virtualList.focusRow(e),t()},0)})}forEachItem(e){let t=i=>{for(let s of i)e(s),s.group&&t(s.children)},i=this.allColsTree;i&&t(i)}doSetExpandedAll(e){this.forEachItem(t=>{t.group&&(t.expanded=e)})}setGroupsExpanded(e,t){if(!t)return void this.doSetExpandedAll(e);let i=[];this.forEachItem(s=>{if(!s.group)return;let r=s.columnGroup.getId();t.indexOf(r)>=0&&(s.expanded=e,i.push(r))});let s=t.filter(e=>!i.includes(e));s.length>0&&(0,m._warn)(157,{unrecognisedGroupIds:s})}getExpandState(){let e=0,t=0;return(this.forEachItem(i=>{i.group&&(i.expanded?e++:t++)}),e>0&&t>0)?2:+(t>0)}doSetSelectedAll(e){var t,i,s;t=this.beans,i=this.allColsTree,s=this.eventType,sx(t,sF(i),e,s)}getSelectionState(){let e=0,t=0,i=this.colModel.isPivotMode();if(this.forEachItem(s=>{let r;if(s.group||!s.passesFilter)return;let a=s.column,l=a.getColDef();if(i){if(!a.isAllowPivot()&&!a.isAllowRowGroup()&&!a.isAllowValue())return;r=a.isValueActive()||a.isPivotActive()||a.isRowGroupActive()}else{if(l.lockVisible)return;r=a.isVisible()}r?e++:t++}),!(e>0)||!(t>0))return!(0===e||t>0)}setFilterText(e){this.filterText=(0,m._exists)(e)?e.toLowerCase():null,this.markFilteredColumns(),this.flattenAndFilterModel()}markFilteredColumns(){let e=e=>{if(!(0,m._exists)(this.filterText))return!0;let t=e.displayName;return null==t||-1!==t.toLowerCase().indexOf(this.filterText)},t=(i,s)=>{let r=!1;if(i.group){let a=e(i);for(let e of i.children){let i=t(e,a||s);i&&(r=i)}}let a=!!s||!!r||e(i);return i.passesFilter=a,a};for(let e of this.allColsTree)t(e,!1)}notifyListeners(){this.fireGroupExpandedEvent(),this.fireSelectionChangedEvent()}fireGroupExpandedEvent(){let e=this.getExpandState();this.dispatchLocalEvent({type:"groupExpanded",state:e})}fireSelectionChangedEvent(){if(!this.allColsTree)return;let e=this.getSelectionState();this.dispatchLocalEvent({type:"selectionChanged",state:e})}getExpandedGroups(){let e=[];return this.allColsTree&&this.forEachItem(t=>{t.group&&t.expanded&&e.push(t.columnGroup.getId())}),e}}},sK={tag:"div",cls:"ag-column-select",children:[{tag:"ag-primary-cols-header",ref:"primaryColsHeaderPanel"},{tag:"ag-primary-cols-list",ref:"primaryColsListPanel"}]},s$=class extends m.Component{constructor(){super(sK,[sC,sW]),this.primaryColsHeaderPanel=m.RefPlaceholder,this.primaryColsListPanel=m.RefPlaceholder,this.registerCSS(".ag-column-select{display:flex;flex:3 1 0px;flex-direction:column;overflow:hidden;position:relative}.ag-column-select-header{flex:none;height:var(--ag-header-height);padding-left:var(--ag-widget-container-horizontal-padding);padding-right:var(--ag-widget-container-horizontal-padding)}.ag-column-select-column,.ag-column-select-column-group,.ag-column-select-header{align-items:center;display:flex;gap:var(--ag-widget-horizontal-spacing);position:relative}.ag-column-select-column,.ag-column-select-column-group{height:100%}:where(.ag-ltr) .ag-column-select-column,:where(.ag-ltr) .ag-column-select-column-group{padding-left:calc(var(--ag-indentation-level)*var(--ag-column-select-indent-size))}:where(.ag-rtl) .ag-column-select-column,:where(.ag-rtl) .ag-column-select-column-group{padding-right:calc(var(--ag-indentation-level)*var(--ag-column-select-indent-size))}.ag-column-select-column-group:where(:not(:last-child)),.ag-column-select-column:where(:not(:last-child)){margin-bottom:var(--ag-widget-vertical-spacing)}.ag-column-select-header-icon{border-radius:var(--ag-border-radius);cursor:pointer;height:var(--ag-icon-size);position:relative;width:var(--ag-icon-size);&:focus-visible{box-shadow:var(--ag-focus-shadow)}}.ag-column-select-header-filter-wrapper{flex:1 1 auto}.ag-column-select-header-filter{width:100%}.ag-column-select-list{flex:1 1 0px;overflow:hidden}:where(.ag-ltr) .ag-column-select-add-group-indent{margin-left:calc(var(--ag-icon-size) + var(--ag-spacing)*1.5)}:where(.ag-rtl) .ag-column-select-add-group-indent{margin-right:calc(var(--ag-icon-size) + var(--ag-spacing)*1.5)}.ag-column-select-column-group-readonly,.ag-column-select-column-readonly{opacity:.5;pointer-events:none;.ag-icon{opacity:.5}&.ag-icon-grip{opacity:.35}}.ag-column-select-column-readonly{&.ag-icon-grip,.ag-icon-grip{opacity:.35}}.ag-column-select-virtual-list-viewport{padding:calc(var(--ag-widget-container-vertical-padding)*.5) 0}.ag-column-select-virtual-list-item{padding:0 var(--ag-widget-container-horizontal-padding)}.ag-column-select-column-label{flex:1 1 auto;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ag-column-select-checkbox{display:flex}")}init(e,t,i){let{primaryColsHeaderPanel:s,primaryColsListPanel:r}=this;s.init(t);let a=t.suppressColumnFilter,l=t.suppressColumnSelectAll;t.suppressColumnExpandAll&&a&&l&&s.setDisplayed(!1),this.addManagedListeners(r,{groupExpanded:e=>{s.setExpandState(e.state),t.onStateUpdated()},selectionChanged:e=>s.setSelectionState(e.state)}),r.init(t,e,i),this.addManagedListeners(s,{expandAll:r.doSetExpandedAll.bind(r,!0),collapseAll:r.doSetExpandedAll.bind(r,!1),selectAll:r.doSetSelectedAll.bind(r,!0),unselectAll:r.doSetSelectedAll.bind(r,!1),filterChanged:e=>r.setFilterText(e.filterText)}),this.positionableFeature=this.createManagedBean(new m.PositionableFeature(this.getGui(),{minHeight:100}))}toggleResizable(e){this.positionableFeature.setResizable(!!e&&{bottom:!0})}expandGroups(e){this.primaryColsListPanel.setGroupsExpanded(!0,e)}collapseGroups(e){this.primaryColsListPanel.setGroupsExpanded(!1,e)}setColumnLayout(e){this.primaryColsListPanel.setColumnLayout(e)}syncLayoutWithGrid(){this.primaryColsListPanel.onColumnsChanged()}getExpandedGroups(){return this.primaryColsListPanel.getExpandedGroups()}},sj=class extends m.Component{constructor(){super({tag:"div",cls:"ag-column-panel"}),this.initialised=!1,this.childDestroyFuncs=[],this.registerCSS(".ag-column-panel{display:flex;flex:1 1 auto;flex-direction:column;overflow:hidden}.ag-pivot-mode-panel{display:flex;height:var(--ag-header-height)}.ag-pivot-mode-select{align-items:center;display:flex}:where(.ag-ltr) .ag-pivot-mode-select{margin-left:var(--ag-widget-container-horizontal-padding)}:where(.ag-rtl) .ag-pivot-mode-select{margin-right:var(--ag-widget-container-horizontal-padding)}.ag-column-panel-column-select{border-bottom:var(--ag-tool-panel-separator-border)}.ag-column-panel-column-select:where(:nth-child(n+2 of :not(.ag-hidden))){border-top:var(--ag-tool-panel-separator-border)}:where(.ag-column-panel) .ag-column-drop-vertical{flex:1 1 0px;min-height:50px}:where(.ag-column-panel) .ag-column-drop-vertical:where(:not(.ag-last-column-drop)){border-bottom:var(--ag-tool-panel-separator-border)}")}wireBeans(e){this.colToolPanelFactory=e.colToolPanelFactory}setVisible(e){super.setDisplayed(e),e&&!this.initialised&&this.init(this.params)}init(e){let t={...(0,m._addGridCommonParams)(this.gos,{suppressColumnMove:!1,suppressColumnSelectAll:!1,suppressColumnFilter:!1,suppressColumnExpandAll:!1,contractColumnSelection:!1,suppressPivotMode:!1,suppressRowGroups:!1,suppressValues:!1,suppressPivots:!1,suppressSyncLayoutWithGrid:!1}),...e};this.params=t;let{childDestroyFuncs:i,colToolPanelFactory:s,gos:r}=this,a=r.isModuleRegistered("SharedPivot"),l=a||r.isModuleRegistered("SharedRowGrouping");!t.suppressPivotMode&&s&&a&&(this.pivotModePanel=s.createPivotModePanel(this,i));let n=this.createBean(new s$);if(this.primaryColsPanel=n,i.push(()=>this.destroyBean(this.primaryColsPanel)),n.init(!0,t,"toolPanelUi"),n.addCss("ag-column-panel-column-select"),this.appendChild(n),s){!t.suppressRowGroups&&l&&(this.rowGroupDropZonePanel=s.createRowGroupPanel(this,i)),!t.suppressValues&&l&&(this.valuesDropZonePanel=s.createValuesPanel(this,i)),!t.suppressPivots&&a&&(this.pivotDropZonePanel=s.createPivotPanel(this,i)),this.setLastVisible();let[e]=this.addManagedEventListeners({columnPivotModeChanged:()=>{this.resetChildrenHeight(),this.setLastVisible()}});i.push(()=>e())}this.initialised=!0}setPivotModeSectionVisible(e){let t=this.colToolPanelFactory;t&&(this.pivotModePanel=t.setPanelVisible(this.pivotModePanel,e,t.createPivotModePanel.bind(t,this,this.childDestroyFuncs,!0)),this.setLastVisible())}setRowGroupsSectionVisible(e){let t=this.colToolPanelFactory;t&&(this.rowGroupDropZonePanel=t.setPanelVisible(this.rowGroupDropZonePanel,e,t.createRowGroupPanel.bind(t,this,this.childDestroyFuncs)),this.setLastVisible())}setValuesSectionVisible(e){let t=this.colToolPanelFactory;t&&(this.valuesDropZonePanel=t.setPanelVisible(this.valuesDropZonePanel,e,t.createValuesPanel.bind(t,this,this.childDestroyFuncs)),this.setLastVisible())}setPivotSectionVisible(e){let t=this.colToolPanelFactory;t&&(this.pivotDropZonePanel=t.setPanelVisible(this.pivotDropZonePanel,e,t.createPivotPanel.bind(t,this,this.childDestroyFuncs)),this.pivotDropZonePanel?.setDisplayed(e),this.setLastVisible())}setResizers(){for(let e of[this.primaryColsPanel,this.rowGroupDropZonePanel,this.valuesDropZonePanel,this.pivotDropZonePanel]){if(!e)continue;let t=e.getGui();e.toggleResizable(!t.classList.contains("ag-last-column-drop")&&!t.classList.contains("ag-hidden"))}}setLastVisible(){let e=this.getGui();for(let t of Array.prototype.slice.call(e.querySelectorAll(".ag-column-drop")))t.classList.remove("ag-last-column-drop");let t=e.querySelectorAll(".ag-column-drop:not(.ag-hidden)"),i=(0,m._last)(t);i&&i.classList.add("ag-last-column-drop"),this.setResizers()}resetChildrenHeight(){let e=this.getGui().children;for(let t=0;t<e.length;t++){let{style:i}=e[t];i.removeProperty("height"),i.removeProperty("flex")}}expandColumnGroups(e){this.primaryColsPanel.expandGroups(e)}collapseColumnGroups(e){this.primaryColsPanel.collapseGroups(e)}setColumnLayout(e){this.primaryColsPanel.setColumnLayout(e)}syncLayoutWithGrid(){this.primaryColsPanel.syncLayoutWithGrid()}destroyChildren(){let e=this.childDestroyFuncs;for(let t of e)t();e.length=0,(0,m._clearElement)(this.getGui())}refresh(e){return this.destroyChildren(),this.init(e),!0}getState(){return{expandedGroupIds:this.primaryColsPanel.getExpandedGroups()}}destroy(){this.destroyChildren(),super.destroy()}};function sY(e,t,i){null!=e&&null!=t&&e.splice(i,0,...t)}var sq={tag:"div",cls:"ag-unselectable",role:"presentation"},sZ=class extends m.Component{constructor(e){super(sq),this.horizontal=e,this.state="notDragging",this.guiDestroyFunctions=[],this.childPillComponents=[],this.resizeEnabled=!1,this.addElementClasses(this.getGui()),this.ePillDropList=(0,m._createElement)({tag:"div"}),this.addElementClasses(this.ePillDropList,"list"),this.registerCSS(".ag-column-drop{align-items:center;display:inline-flex;overflow:auto;position:relative;width:100%}.ag-column-drop-list{align-items:center;display:flex}.ag-column-drop-cell{align-items:center;background-color:var(--ag-column-drop-cell-background-color);border:var(--ag-column-drop-cell-border);border-radius:500px;color:var(--ag-column-drop-cell-text-color);display:flex;padding:calc(var(--ag-spacing)*.25);position:relative;&:focus-visible{box-shadow:var(--ag-focus-shadow)}:where(.ag-drag-handle){color:var(--ag-column-drop-cell-drag-handle-color)}}:where(.ag-ltr) .ag-column-drop-cell{padding-left:calc(var(--ag-spacing)*.75)}:where(.ag-rtl) .ag-column-drop-cell{padding-right:calc(var(--ag-spacing)*.75)}.ag-column-drop-cell-text{flex:1 1 auto;margin:0 var(--ag-spacing);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ag-column-drop-vertical{align-items:stretch;display:flex;flex-direction:column;min-height:75px;overflow:hidden}.ag-column-drop-vertical-title-bar{align-items:center;display:flex;flex:none;padding:var(--ag-widget-container-vertical-padding) calc(var(--ag-spacing)*2) 0}.ag-column-drop-vertical-list{align-items:stretch;flex-direction:column;flex-grow:1;overflow-x:auto;padding-bottom:var(--ag-spacing);padding-left:var(--ag-spacing);padding-right:var(--ag-spacing);position:relative}:where(.ag-column-drop-empty) .ag-column-drop-vertical-list{overflow:hidden}.ag-column-drop-cell-button{cursor:pointer;min-width:0;opacity:.75}:where(.ag-ltr) .ag-column-drop-cell-button{margin-right:calc(var(--ag-spacing)/4)}:where(.ag-rtl) .ag-column-drop-cell-button{margin-left:calc(var(--ag-spacing)/4)}.ag-column-drop-cell-button:hover{opacity:1}:where(.ag-ltr) .ag-column-drop-cell-drag-handle{margin-left:calc(var(--ag-spacing)/4)}:where(.ag-rtl) .ag-column-drop-cell-drag-handle{margin-right:calc(var(--ag-spacing)/4)}.ag-column-drop-wrapper{display:flex}.ag-column-drop-horizontal-half-width{width:50%!important}.ag-column-drop-cell-ghost{opacity:.5}.ag-column-drop-horizontal{background-color:var(--ag-header-background-color);border-bottom:var(--ag-header-row-border);gap:var(--ag-cell-widget-spacing);height:var(--ag-header-height);overflow:hidden;white-space:nowrap}:where(.ag-ltr) .ag-column-drop-horizontal{padding-left:var(--ag-cell-horizontal-padding)}:where(.ag-rtl) .ag-column-drop-horizontal{padding-right:var(--ag-cell-horizontal-padding)}.ag-column-drop-horizontal-list{gap:var(--ag-cell-widget-spacing)}.ag-column-drop-vertical-cell{margin-top:var(--ag-spacing)}:where(.ag-ltr) .ag-column-drop-vertical-icon{margin-right:var(--ag-widget-horizontal-spacing)}:where(.ag-rtl) .ag-column-drop-vertical-icon{margin-left:var(--ag-widget-horizontal-spacing)}.ag-select-agg-func-popup{background:var(--ag-background-color);border:solid var(--ag-border-width) var(--ag-border-color);border-radius:var(--ag-border-radius);box-shadow:var(--ag-dropdown-shadow);height:calc(var(--ag-spacing)*5*3.5);padding:0;position:absolute}.ag-select-agg-func-virtual-list-item{cursor:default}:where(.ag-ltr) .ag-select-agg-func-virtual-list-item{padding-left:calc(var(--ag-spacing)*2)}:where(.ag-rtl) .ag-select-agg-func-virtual-list-item{padding-right:calc(var(--ag-spacing)*2)}.ag-select-agg-func-virtual-list-item:hover{background-color:var(--ag-selected-row-background-color)}:where(.ag-ltr) .ag-column-drop-horizontal-half-width:where(:not(:last-child)){border-right:solid var(--ag-border-width) var(--ag-border-color)}:where(.ag-rtl) .ag-column-drop-horizontal-half-width:where(:not(:last-child)){border-left:solid var(--ag-border-width) var(--ag-border-color)}")}toggleResizable(e){this.positionableFeature.setResizable(!!e&&{bottom:!0}),this.resizeEnabled=e}isSourceEventFromTarget(e){let{dropZoneTarget:t,dragSource:i}=e;return t.contains(i.eElement)}destroy(){this.destroyGui(),super.destroy()}destroyGui(){for(let e of this.guiDestroyFunctions)e();this.guiDestroyFunctions.length=0,this.childPillComponents.length=0,(0,m._clearElement)(this.getGui()),(0,m._clearElement)(this.ePillDropList)}init(e){this.params=e??{},this.createManagedBean(new m.ManagedFocusFeature(this.getFocusableElement(),{onTabKeyDown:this.onTabKeyDown.bind(this),handleKeyDown:this.onKeyDown.bind(this)})),this.setupDropTarget(),this.positionableFeature=new m.PositionableFeature(this.getGui()),this.createManagedBean(this.positionableFeature),this.refreshGui(),(0,m._setAriaLabel)(this.ePillDropList,this.getAriaLabel())}onTabKeyDown(e){let t=(0,m._findFocusableElements)(this.getFocusableElement(),null,!0),i=t.length;if(0===i)return;let{shiftKey:s}=e,r=(0,m._getActiveDomElement)(this.beans),a=r===t[0],l=r===(0,m._last)(t);1===i||a&&s||l&&!s||t[s?0:i-1].focus()}onKeyDown(e){let{key:t}=e,i=!this.horizontal,s=t===m.KeyCode.DOWN,r=t===m.KeyCode.UP;if(!i){let e=this.gos.get("enableRtl");s=!e&&t===m.KeyCode.RIGHT||e&&t===m.KeyCode.LEFT,r=!e&&t===m.KeyCode.LEFT||e&&t===m.KeyCode.RIGHT}if(s||r)if(e.preventDefault(),e.shiftKey)this.moveFocusedItem(r);else{let e=(0,m._findNextFocusableElement)(this.beans,this.getFocusableElement(),!1,r);e&&e.focus()}}moveFocusedItem(e){let t=this.getFocusedItem();if(-1===t||!this.normalizeAndUpdateInsertIndex(t,t+(e?-1:1)))return;let i=this.childPillComponents[t];if(!i.isMovable())return;let s=i.getItem();this.focusItemAtIndex(this.insertIndex),this.rearrangeItems([s],!0)}addElementClasses(e,t){t=t?`-${t}`:"";let i=this.horizontal?"horizontal":"vertical";e.classList.add(`ag-column-drop${t}`,`ag-column-drop-${i}${t}`)}setupDropTarget(){this.dropTarget={getContainer:this.getGui.bind(this),getIconName:this.getIconName.bind(this),onDragging:this.onDragging.bind(this),onDragEnter:this.onDragEnter.bind(this),onDragLeave:this.onDragLeave.bind(this),onDragStop:this.onDragStop.bind(this),onDragCancel:this.onDragCancel.bind(this),isInterestedIn:this.isInterestedIn.bind(this)},this.beans.dragAndDrop?.addDropTarget(this.dropTarget)}minimumAllowedNewInsertIndex(){return 0}checkInsertIndex(e){let t=this.getNewInsertIndex(e);return!(t<0)&&this.normalizeAndUpdateInsertIndex(this.insertIndex,t)}normalizeAndUpdateInsertIndex(e,t){let i=Math.max(this.minimumAllowedNewInsertIndex(),t),s=i!==e;return s&&(this.insertIndex=i),s}getNewInsertIndex(e){let t=e.event,i=this.horizontal?t.clientX:t.clientY,s=this.childPillComponents.map(e=>e.getGui().getBoundingClientRect()),r=s.findIndex(e=>this.horizontal?e.right>i&&e.left<i:e.top<i&&e.bottom>i);if(-1===r){let e=this.gos.get("enableRtl");return s.every(e=>i>(this.horizontal?e.right:e.bottom))?e&&this.horizontal?0:this.childPillComponents.length:s.every(e=>i<(this.horizontal?e.left:e.top))?e&&this.horizontal?this.childPillComponents.length:0:this.insertIndex}return this.insertIndex<=r?r+1:r}checkDragStartedBySelf(e){"notDragging"===this.state&&(this.state="rearrangeItems",this.potentialDndItems=this.getItems(e.dragSource.getDragItem()),this.refreshGui(),this.checkInsertIndex(e),this.refreshGui())}onDragging(e){this.checkDragStartedBySelf(e),this.checkInsertIndex(e)&&this.refreshGui()}handleDragEnterEnd(e){}onDragEnter(e){let t=this.getItems(e.dragSource.getDragItem());this.state="newItemsIn";let i=t.filter(t=>this.isItemDroppable(t,e)),s=i.every(e=>-1!==this.childPillComponents.map(e=>e.getItem()).indexOf(e));if(0!==i.length){if(this.potentialDndItems=i,s){this.state="notDragging";return}this.handleDragEnterEnd(e),this.checkInsertIndex(e),this.refreshGui()}}isPotentialDndItems(){return!!this.potentialDndItems?.length}handleDragLeaveEnd(e){}onDragLeave(e){if("rearrangeItems"===this.state){let t=this.getItems(e.dragSource.getDragItem());this.removeItems(t)}this.isPotentialDndItems()&&(this.handleDragLeaveEnd(e),this.potentialDndItems=[],this.refreshGui()),this.state="notDragging"}onDragCancel(e){this.isPotentialDndItems()&&("newItemsIn"===this.state&&this.handleDragLeaveEnd(e),this.potentialDndItems=[],this.refreshGui()),this.state="notDragging"}onDragStop(){this.isPotentialDndItems()&&("newItemsIn"===this.state?this.addItems(this.potentialDndItems):this.rearrangeItems(this.potentialDndItems),this.potentialDndItems=[],this.refreshGui()),this.state="notDragging"}removeItems(e){let t=this.getExistingItems().filter(t=>!e.includes(t));this.updateItems(t)}addItems(e){if(!e)return;let t=this.getExistingItems().slice(),i=e.filter(e=>0>t.indexOf(e));sY(t,i,this.insertIndex),this.updateItems(t)}addItem(e){this.insertIndex=this.getExistingItems().length,this.addItems([e]),this.refreshGui()}rearrangeItems(e,t){let i;return sY(i=t?this.getExistingItems().filter(t=>-1===e.indexOf(t)):this.getNonGhostItems().slice(),e,this.insertIndex),!(0,m._areEqual)(i,this.getExistingItems())&&(this.updateItems(i),!0)}refreshGui(){let e=0;this.horizontal||(e=this.ePillDropList.scrollTop);let t=this.resizeEnabled,i=this.getFocusedItem(),{eGridDiv:s}=this.beans,r=(0,m._isKeyboardMode)(),a=null;r&&(a=(0,m._findNextFocusableElement)(this.beans,s)??(0,m._findNextFocusableElement)(this.beans,s,!1,!0)),this.toggleResizable(!1),this.destroyGui(),this.addIconAndTitleToGui(),this.addEmptyMessageToGui(),this.addItemsToGui(),0!==e&&(this.ePillDropList.scrollTop=e),t&&this.toggleResizable(t),r&&this.restoreFocus(i,a)}getFocusedItem(){let e=this.getGui(),t=(0,m._getActiveDomElement)(this.beans);return e.contains(t)?Array.from(e.querySelectorAll(".ag-column-drop-cell")).indexOf(t):-1}focusItemAtIndex(e){let t=Array.from(this.getGui().querySelectorAll(".ag-column-drop-cell"))[e];t&&t.focus({preventScroll:!0})}restoreFocus(e,t){let i=Array.from(this.getGui().querySelectorAll(".ag-column-drop-cell"));if(-1===e)return;0===i.length&&t.focus();let s=Math.min(i.length-1,e),r=i[s];r&&r.focus()}focusList(e){let t=e?this.childPillComponents.length-1:0;this.restoreFocus(t,this.getFocusableElement())}getNonGhostItems(){let e=this.getExistingItems();return this.isPotentialDndItems()?e.filter(e=>!this.potentialDndItems.includes(e)):e}addItemsToGui(){let e=this.getNonGhostItems().map(e=>this.createItemComponent(e,!1));if(this.isPotentialDndItems()){let t=this.potentialDndItems.map(e=>this.createItemComponent(e,!0));this.insertIndex>=e.length?e.push(...t):e.splice(this.insertIndex,0,...t)}this.appendChild(this.ePillDropList),e.forEach((e,t)=>{t>0&&this.addArrow(this.ePillDropList),this.ePillDropList.appendChild(e.getGui())}),this.addAriaLabelsToComponents()}addAriaLabelsToComponents(){let{childPillComponents:e,ePillDropList:t}=this,i=e.length;(0,m._setAriaRole)(t,0===i?"presentation":"listbox");for(let t=0;t<i;t++){let s=e[t].getGui();(0,m._setAriaPosInSet)(s,t+1),(0,m._setAriaSetSize)(s,i)}}createItemComponent(e,t){let i=this.createPillComponent(e,this.dropTarget,t,this.horizontal);return i.addEventListener("columnRemove",this.removeItems.bind(this,[e])),this.createBean(i),this.guiDestroyFunctions.push(()=>this.destroyBean(i)),t||this.childPillComponents.push(i),i}addIconAndTitleToGui(){let{title:e,icon:t}=this.params;if(!e||!t)return;let i=(0,m._createElement)({tag:"div"});if((0,m._setAriaHidden)(i,!0),this.addElementClasses(i,"title-bar"),this.addElementClasses(t,"icon"),this.toggleCss("ag-column-drop-empty",this.isExistingItemsEmpty()),i.appendChild(t),!this.horizontal){let t=(0,m._createElement)({tag:"span"});this.addElementClasses(t,"title"),t.textContent=e,i.appendChild(t)}this.appendChild(i)}isExistingItemsEmpty(){return 0===this.getExistingItems().length}addEmptyMessageToGui(){let{emptyMessage:e}=this.params;if(!e||!this.isExistingItemsEmpty()||this.isPotentialDndItems())return;let t=(0,m._createElement)({tag:"span"});t.textContent=e,this.addElementClasses(t,"empty-message"),this.ePillDropList.appendChild(t)}addArrow(e){if(this.horizontal){let t=this.gos.get("enableRtl"),i=(0,m._createIconNoSpan)(t?"panelDelimiterRtl":"panelDelimiter",this.beans);this.addElementClasses(i,"cell-separator"),e.appendChild(i)}}},sX={tag:"span",role:"option",children:[{tag:"span",ref:"eDragHandle",cls:"ag-drag-handle ag-column-drop-cell-drag-handle",role:"presentation"},{tag:"span",ref:"eText",cls:"ag-column-drop-cell-text",attrs:{"aria-hidden":"true"}},{tag:"span",ref:"eButton",cls:"ag-column-drop-cell-button",role:"presentation"}]},sJ=class extends m.Component{constructor(e,t,i,s,r){super(),this.dragSourceDropTarget=e,this.ghost=t,this.horizontal=i,this.template=s,this.agComponents=r,this.eText=m.RefPlaceholder,this.eDragHandle=m.RefPlaceholder,this.eButton=m.RefPlaceholder}postConstruct(){this.setTemplate(this.template??sX,this.agComponents);let e=this.getGui(),{beans:t,eDragHandle:i,eText:s,eButton:r}=this;this.addElementClasses(e),this.addElementClasses(i,"drag-handle"),this.addElementClasses(s,"text"),this.addElementClasses(r,"button"),i.appendChild((0,m._createIconNoSpan)("columnDrag",t)),r.appendChild((0,m._createIconNoSpan)("cancel",t)),this.tooltipFeature=this.createOptionalManagedBean(t.registry.createDynamicBean("tooltipFeature",!1,{getGui:()=>this.getGui()})),this.setupComponents(),!this.ghost&&this.isDraggable()&&this.addDragSource(),this.setupAria(),this.setupTooltip(),this.activateTabIndex(),this.refreshDraggable()}isDraggable(){return!0}refreshDraggable(){this.eDragHandle.classList.toggle("ag-column-select-column-readonly",!this.isDraggable())}setupAria(){let e=this.getLocaleTextFunc(),t=[this.getAriaDisplayName()];this.addAdditionalAriaInstructions(t,e),(0,m._setAriaLabel)(this.getGui(),t.join(". "))}addAdditionalAriaInstructions(e,t){if(this.isRemovable()){let i=t("ariaDropZoneColumnComponentDescription","Press DELETE to remove");e.push(i)}}setupTooltip(){let e=()=>this.tooltipFeature?.setTooltipAndRefresh(this.getTooltip());e(),this.addManagedEventListeners({newColumnsLoaded:e})}getDragSourceId(){}getDefaultIconName(){return"notAllowed"}addDragSource(){let{beans:{dragAndDrop:e},eDragHandle:t}=this,i=this.createGetDragItem(),s=this.getDefaultIconName(),r={type:this.getDragSourceType(),sourceId:this.getDragSourceId(),eElement:t,getDefaultIconName:()=>s,getDragItem:i,dragItemName:this.getDisplayName()};e?.addDragSource(r,!0),this.addDestroyFunc(()=>e?.removeDragSource(r))}setupComponents(){this.eText.textContent=this.getDisplayValue(),this.setupRemove(),this.ghost&&this.addCss("ag-column-drop-cell-ghost")}isRemovable(){return!0}refreshRemove(){(0,m._setDisplayed)(this.eButton,this.isRemovable())}setupRemove(){this.refreshRemove();let e={type:"columnRemove"};this.addGuiEventListener("keydown",e=>this.onKeyDown(e)),this.addManagedElementListeners(this.eButton,{click:t=>{this.dispatchLocalEvent(e),t.stopPropagation()}});let t=new m.TouchListener(this.eButton);this.addManagedListeners(t,{tap:()=>this.dispatchLocalEvent(e)}),this.addDestroyFunc(t.destroy.bind(t))}onKeyDown(e){e.key===m.KeyCode.DELETE&&this.isRemovable()&&(e.preventDefault(),this.dispatchLocalEvent({type:"columnRemove"}))}getDisplayValue(){return this.getDisplayName()}addElementClasses(e,t){t=t?`-${t}`:"";let i=this.horizontal?"horizontal":"vertical";e.classList.add(`ag-column-drop-cell${t}`,`ag-column-drop-${i}-cell${t}`)}destroy(){super.destroy(),this.dragSourceDropTarget=null}},sQ=class extends sJ{constructor(e,t,i,s,r){super(t,i,r),this.column=e,this.dropZonePurpose=s,this.eSortIndicator=m.RefPlaceholder,this.popupShowing=!1}postConstruct(){let{sortSvc:e,colNames:t}=this.beans;this.template={tag:"span",role:"option",children:[{tag:"span",ref:"eDragHandle",cls:"ag-drag-handle ag-column-drop-cell-drag-handle",role:"presentation"},{tag:"span",ref:"eText",cls:"ag-column-drop-cell-text",attrs:{"aria-hidden":"true"}},e?{tag:"ag-sort-indicator",ref:"eSortIndicator"}:void 0,{tag:"span",ref:"eButton",cls:"ag-column-drop-cell-button",role:"presentation"}]},e&&(this.agComponents=[e.getSortIndicatorSelector()]),this.displayName=t.getDisplayNameForColumn(this.column,"columnDrop"),super.postConstruct(),e&&(this.setupSort(),this.addManagedEventListeners({sortChanged:()=>{this.setupAria()}})),this.isGroupingZone()&&this.addManagedPropertyListener("groupLockGroupColumns",()=>{this.refreshRemove(),this.refreshDraggable(),this.setupAria()})}getItem(){return this.column}getDisplayName(){return this.displayName}getTooltip(){return this.column.getColDef().headerTooltip}addAdditionalAriaInstructions(e,t){let i=this.gos.get("rowGroupPanelSuppressSort"),s=this.gos.get("functionsReadOnly");if(this.isAggregationZone()&&!s){let i=t("ariaDropZoneColumnValueItemDescription","Press ENTER to change the aggregation type");e.push(i)}if(this.isGroupingZone()&&this.column.isSortable()&&!i){let i=t("ariaDropZoneColumnGroupItemDescription","Press ENTER to sort");e.push(i)}super.addAdditionalAriaInstructions(e,t)}isMovable(){return this.isDraggable()}isDraggable(){return this.isReadOnly()}isRemovable(){return this.isReadOnly()}isReadOnly(){return!this.isGroupingAndLocked()&&!this.gos.get("functionsReadOnly")}getAriaDisplayName(){let e=this.getLocaleTextFunc(),{name:t,aggFuncName:i}=this.getColumnAndAggFuncName(),s=e("ariaDropZoneColumnComponentAggFuncSeparator"," of "),r={asc:e("ariaDropZoneColumnComponentSortAscending","ascending"),desc:e("ariaDropZoneColumnComponentSortDescending","descending")},a=this.column.getSort(),l=this.gos.get("rowGroupPanelSuppressSort");return[i&&`${i}${s}`,t,this.isGroupingZone()&&!l&&a&&`, ${r[a]}`].filter(e=>!!e).join("")}getColumnAndAggFuncName(){let e=this.displayName,t="";if(this.isAggregationZone()){let e=this.column.getAggFunc(),i="string"==typeof e?e:"agg";t=this.getLocaleTextFunc()(i,i)}return{name:e,aggFuncName:t}}setupSort(){if(this.column.isSortable()&&this.isGroupingZone()&&!this.gos.get("rowGroupPanelSuppressSort")){this.eSortIndicator.setupSort(this.column,!0);let e=e=>{e.preventDefault(),this.beans.sortSvc.progressSortFromEvent(this.column,e)};this.addGuiEventListener("click",e),this.addGuiEventListener("keydown",t=>{t.key===m.KeyCode.ENTER&&this.isGroupingZone()&&e(t)})}}getDefaultIconName(){return"hide"}createGetDragItem(){let{column:e}=this;return()=>{let t={};return t[e.getId()]=e.isVisible(),{columns:[e],visibleState:t}}}setupComponents(){super.setupComponents(),this.isAggregationZone()&&!this.gos.get("functionsReadOnly")&&this.addGuiEventListener("click",this.onShowAggFuncSelection.bind(this))}onKeyDown(e){super.onKeyDown(e),e.key===m.KeyCode.ENTER&&this.isAggregationZone()&&!this.gos.get("functionsReadOnly")&&(e.preventDefault(),this.onShowAggFuncSelection())}getDisplayValue(){let{name:e,aggFuncName:t}=this.getColumnAndAggFuncName();return this.isAggregationZone()?`${t}(${e})`:e}onShowAggFuncSelection(){if(this.popupShowing)return;this.popupShowing=!0;let{aggFuncSvc:e,popupSvc:t}=this.beans,i=new t_({cssIdentifier:"select-agg-func"}),s=e.getFuncNames(this.column),r=this.getGui(),a=i.getGui();i.setModel({getRow:function(e){return s[e]},getRowCount:function(){return s.length}}),this.createBean(i);let l=(0,m._createElement)({tag:"div",cls:"ag-select-agg-func-popup"});l.style.top="0px",l.style.left="0px",l.appendChild(a),l.style.width=`${r.clientWidth}px`;let[n]=this.addManagedElementListeners(l,{focusout:e=>{!l.contains(e.relatedTarget)&&h&&h.hideFunc()}}),o=e=>{this.destroyBean(i),this.popupShowing=!1,e?.key==="Escape"&&r.focus(),n&&n()},d=this.getLocaleTextFunc(),h=t.addPopup({modal:!0,eChild:l,closeOnEsc:!0,closedCallback:o,ariaLabel:d("ariaLabelAggregationFunction","Aggregation Function")});h&&i.setComponentCreator(this.createAggSelect.bind(this,h.hideFunc)),i.addGuiEventListener("keydown",e=>{if(e.key===m.KeyCode.ENTER||e.key===m.KeyCode.SPACE){let e=i.getLastFocusedRow();if(null==e)return;let t=i.getComponentAt(e);t&&t.selectItem()}}),t.positionPopupByComponent({type:"aggFuncSelect",eventSource:r,ePopup:l,keepWithinBounds:!0,additionalParams:{column:this.column},position:"under"}),i.refresh();let u=s.findIndex(e=>e===this.column.getAggFunc());-1===u&&(u=0),i.focusRow(u)}createAggSelect(e,t){let i=()=>{e(),this.getGui().focus(),this.beans.valueColsSvc?.setColumnAggFunc?.(this.column,t,"toolPanelDragAndDrop")},s=this.getLocaleTextFunc(),r=t.toString();return new s0(i,s(r,r))}isGroupingAndLocked(){return this.isGroupingZone()&&sP(this.column,this.beans)}isAggregationZone(){return"aggregation"===this.dropZonePurpose}isGroupingZone(){return"rowGroup"===this.dropZonePurpose}getDragSourceType(){return m.DragSourceType.ToolPanel}destroy(){super.destroy(),this.column=null}},s0=class extends m.Component{constructor(e,t){super({tag:"div",cls:"ag-select-agg-func-item",children:t}),this.selectItem=e,this.addGuiEventListener("click",this.selectItem)}},s1=class extends sZ{constructor(e,t){super(e),this.dropZonePurpose=t,this.addElementClasses(this.getGui(),this.dropZonePurpose.toLowerCase())}init(e){super.init(e),this.addManagedEventListeners({newColumnsLoaded:this.refreshGui.bind(this)}),this.addManagedPropertyListeners(["functionsReadOnly","rowGroupPanelSuppressSort","groupLockGroupColumns"],this.refreshGui.bind(this))}getItems(e){return e.columns??[]}isInterestedIn(e){return e===m.DragSourceType.HeaderCell||e===m.DragSourceType.ToolPanel}minimumAllowedNewInsertIndex(){let{gos:e,rowGroupColsSvc:t}=this.beans,i=e.get("groupLockGroupColumns"),s=t?.columns.length??0;return -1===i?s:Math.min(i,s)}showOrHideColumnOnExit(e){return this.isRowGroupPanel()&&(0,m._shouldUpdateColVisibilityAfterGroup)(this.gos,!0)&&!e.fromNudge}handleDragEnterEnd(e){if(this.showOrHideColumnOnExit(e)){let t=e.dragSource.getDragItem().columns;this.setColumnsVisible(t,!1,"uiColumnDragged")}}handleDragLeaveEnd(e){if(this.showOrHideColumnOnExit(e)){let t=e.dragSource.getDragItem();this.setColumnsVisible(t.columns,!0,"uiColumnDragged")}}setColumnsVisible(e,t,i){if(e){let s=e.filter(e=>!e.getColDef().lockVisible);this.beans.colModel.setColsVisible(s,t,i)}}isRowGroupPanel(){return"rowGroup"===this.dropZonePurpose}createPillComponent(e,t,i,s){return new sQ(e,t,i,this.dropZonePurpose,s)}},s2=class extends s1{constructor(e){super(e,"pivot")}postConstruct(){let e=this.getLocaleTextFunc(),t=e("pivotColumnsEmptyMessage","Drag here to set column labels"),i=e("pivots","Column Labels");super.init({icon:(0,m._createIconNoSpan)("pivotPanel",this.beans,null),emptyMessage:t,title:i}),this.addManagedEventListeners({newColumnsLoaded:this.refresh.bind(this),columnPivotChanged:this.refresh.bind(this),columnPivotModeChanged:this.checkVisibility.bind(this)}),this.refresh()}getAriaLabel(){return this.getLocaleTextFunc()("ariaPivotDropZonePanelLabel","Column Labels")}refresh(){this.checkVisibility(),this.refreshGui()}checkVisibility(){let e=this.beans.colModel,t=e.isPivotMode();if(this.horizontal)switch(this.gos.get("pivotPanelShow")){case"always":this.setDisplayed(t);break;case"onlyWhenPivoting":{let i=e.isPivotActive();this.setDisplayed(t&&i);break}default:this.setDisplayed(!1)}else this.setDisplayed(t)}isItemDroppable(e,t){return!this.gos.get("functionsReadOnly")&&!!e.isPrimary()&&e.isAllowPivot()&&(!e.isPivotActive()||this.isSourceEventFromTarget(t))}updateItems(e){this.beans.pivotColsSvc?.setColumns(e,"toolPanelUi")}getIconName(){return this.isPotentialDndItems()?"pivot":"notAllowed"}getExistingItems(){return this.beans.pivotColsSvc?.columns??[]}},s5=class extends s1{constructor(e){super(e,"rowGroup")}postConstruct(){let e=this.getLocaleTextFunc(),t=e("rowGroupColumnsEmptyMessage","Drag here to set row groups"),i=e("groups","Row Groups");super.init({icon:(0,m._createIconNoSpan)("rowGroupPanel",this.beans,null),emptyMessage:t,title:i}),this.addManagedEventListeners({columnRowGroupChanged:this.refreshGui.bind(this)})}getAriaLabel(){return this.getLocaleTextFunc()("ariaRowGroupDropZonePanelLabel","Row Groups")}isItemDroppable(e,t){return!this.gos.get("functionsReadOnly")&&!!e.isPrimary()&&!e.colDef.showRowGroup&&e.isAllowRowGroup()&&(!e.isRowGroupActive()||this.isSourceEventFromTarget(t))}updateItems(e){this.beans.rowGroupColsSvc?.setColumns(e,"toolPanelUi")}getIconName(){return this.isPotentialDndItems()?"group":"notAllowed"}getExistingItems(){return this.beans.rowGroupColsSvc?.columns??[]}},s4=class extends s1{constructor(e){super(e,"aggregation")}postConstruct(){let e=this.getLocaleTextFunc(),t=e("valueColumnsEmptyMessage","Drag here to aggregate"),i=e("values","Values");super.init({icon:(0,m._createIconNoSpan)("valuePanel",this.beans,null),emptyMessage:t,title:i}),this.addManagedEventListeners({columnValueChanged:this.refreshGui.bind(this)})}getAriaLabel(){return this.getLocaleTextFunc()("ariaValuesDropZonePanelLabel","Values")}getIconName(){return this.isPotentialDndItems()?"aggregate":"notAllowed"}isItemDroppable(e,t){return!this.gos.get("functionsReadOnly")&&!!e.isPrimary()&&e.isAllowValue()&&(!e.isValueActive()||this.isSourceEventFromTarget(t))}updateItems(e){this.beans.valueColsSvc?.setColumns(e,"toolPanelUi")}getExistingItems(){return this.beans.valueColsSvc?.columns??[]}},s3={tag:"div",cls:"ag-pivot-mode-panel",children:[{tag:"ag-toggle-button",ref:"cbPivotMode",cls:"ag-pivot-mode-select"}]},s6=class extends m.Component{constructor(){super(...arguments),this.cbPivotMode=m.RefPlaceholder}postConstruct(){this.setTemplate(s3,[m.AgToggleButtonSelector]);let e=this.cbPivotMode,{colModel:t,ctrlsSvc:i,gos:s}=this.beans;e.setValue(t.isPivotMode());let r=this.getLocaleTextFunc();e.setLabel(r("pivotMode","Pivot Mode"));let a=()=>{let i=t.isPivotMode();e.setValue(i)};this.addManagedListeners(e,{fieldValueChanged:()=>{let r=!!e.getValue();if(r!==t.isPivotMode())for(let e of(s.updateGridOptions({options:{pivotMode:r},source:"toolPanelUi"}),i.getHeaderRowContainerCtrls()))e.refresh()}}),this.addManagedEventListeners({newColumnsLoaded:a,columnPivotModeChanged:a})}},s8={moduleName:"ColumnsToolPanel",version:tv,beans:[class extends m.BeanStub{constructor(){super(...arguments),this.beanName="colToolPanelFactory"}setPanelVisible(e,t,i){return e?e.setDisplayed(t):t&&(e=i()),e}createRowGroupPanel(e,t){return this.createPanel(e,t,new s5(!1))}createValuesPanel(e,t){return this.createPanel(e,t,new s4(!1))}createPivotPanel(e,t){return this.createPanel(e,t,new s2(!1))}createPivotModePanel(e,t,i){return this.createPanel(e,t,new s6,i)}createPanel(e,t,i,s){return i=e.createBean(i),t.push(()=>e.destroyBean(i)),s?e.prependChild(i):e.appendChild(i),i}}],userComponents:{agColumnsToolPanel:sj},icons:{ensureColumnVisible:"column-arrow",columnsToolPanel:"columns",menuAddRowGroup:"group",menuRemoveRowGroup:"group",pivotPanel:"pivot",rowGroupPanel:"group",valuePanel:"aggregation",columnSelectClosed:"tree-closed",columnSelectOpen:"tree-open",columnSelectIndeterminate:"tree-indeterminate"},dependsOn:[tb,sp,m._ColumnMoveModule,m._SharedDragAndDropModule,m._PopupModule,sm]},s7=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="chartMenuItemMapper"}getChartItems(e){let t=this.beans,i=t.chartSvc;if(!i)return null;let s=this.getLocaleTextFunc.bind(this),r="pivotChart"===e?new s9(t,i,s):new re(t,i,s),a=i.isEnterprise(),l=r.getMenuItem();if(l?.subMenu&&!a){let e=t=>({...t,subMenu:t.subMenu?.filter(e=>!e._enterprise).map(t=>e(t))});l=e(l)}let n=this.gos.get("chartToolPanelsDef")?.settingsPanel?.chartGroupsDef;return n&&(l=this.filterAndOrderChartMenu(l,n,r.getConfigLookup())),this.cleanInternals(l)}cleanInternals(e){if(!e)return e;let t=e=>{for(let i of(delete e?._key,delete e?._enterprise,e?.subMenu??[]))t(i);return e};return t(e)}buildLookup(e){let t={},i=e=>{if(t[e._key]=e,e.subMenu)for(let t of e.subMenu)i(t)};return i(e),t}filterAndOrderChartMenu(e,t,i){let s=this.buildLookup(e),r={...e,subMenu:[]};for(let e of Object.keys(t)){let a=t[e],l=i[e];if(null===l)continue;if(void 0==l){(0,m._warn)(173,{group:e});continue}let n=s[l._key];if(n)if(n.subMenu){let t=a.map(t=>{let i=l[t];return void 0==i?void(0,m._warn)(174,{group:e,chartType:t}):s[i]}).filter(e=>void 0!==e);t.length>0&&(n.subMenu=t,r.subMenu?.push(n))}else r.subMenu?.push(n)}return r.subMenu?.length==0?null:r}},s9=class{constructor(e,t,i){this.beans=e,this.chartSvc=t,this.getLocaleTextFunc=i}getMenuItem(){let e=this.getLocaleTextFunc(),t=(t,i,s,r,a=!1)=>({name:e(t,i+""),action:()=>this.chartSvc.createPivotChart({chartType:s}),_key:r,_enterprise:a});return{name:e("pivotChart","Pivot Chart"),_key:"pivotChart",subMenu:[{_key:"pivotColumnChart",name:e("columnChart","Column"),subMenu:[t("groupedColumn","Grouped","groupedColumn","pivotGroupedColumn"),t("stackedColumn","Stacked","stackedColumn","pivotStackedColumn"),t("normalizedColumn","100% Stacked","normalizedColumn","pivotNormalizedColumn")]},{_key:"pivotBarChart",name:e("barChart","Bar"),subMenu:[t("groupedBar","Grouped","groupedBar","pivotGroupedBar"),t("stackedBar","Stacked","stackedBar","pivotStackedBar"),t("normalizedBar","100% Stacked","normalizedBar","pivotNormalizedBar")]},{_key:"pivotPieChart",name:e("pieChart","Pie"),subMenu:[t("pie","Pie","pie","pivotPie"),t("donut","Donut","donut","pivotDonut")]},{_key:"pivotLineChart",name:e("lineChart","Line"),subMenu:[t("lineChart","Line","line","pivotLineChart"),t("stackedLine","Stacked","stackedLine","pivotStackedLine"),t("normalizedLine","100% Stacked","normalizedLine","pivotNormalizedLine")]},{_key:"pivotAreaChart",name:e("areaChart","Area"),subMenu:[t("areaChart","Area","area","pivotArea"),t("stackedArea","Stacked","stackedArea","pivotStackedArea"),t("normalizedArea","100% Stacked","normalizedArea","pivotNormalizedArea")]},{_key:"pivotXYChart",name:e("xyChart","X Y (Scatter)"),subMenu:[t("scatter","Scatter","scatter","pivotScatter"),t("bubble","Bubble","bubble","pivotBubble")]},{_key:"pivotStatisticalChart",_enterprise:!1,name:e("statisticalChart","Statistical"),subMenu:[t("histogramChart","Histogram","histogram","pivotHistogram",!1)]},{_key:"pivotHierarchicalChart",_enterprise:!0,name:e("hierarchicalChart","Hierarchical"),subMenu:[t("treemapChart","Treemap","treemap","pivotTreemap",!0),t("sunburstChart","Sunburst","sunburst","pivotSunburst",!0)]},{_key:"pivotFunnel",name:e("funnel","Funnel"),subMenu:[t("funnel","Funnel","funnel","pivotFunnel"),t("coneFunnel","Cone Funnel","coneFunnel","pivotConeFunnel"),t("pyramid","Pyramid","pyramid","pivotPyramid")]},{_key:"pivotCombinationChart",name:e("combinationChart","Combination"),subMenu:[t("columnLineCombo","Column & Line","columnLineCombo","pivotColumnLineCombo"),t("AreaColumnCombo","Area & Column","areaColumnCombo","pivotAreaColumnCombo")]}],icon:(0,m._createIconNoSpan)("chart",this.beans,void 0)}}getConfigLookup(){return{columnGroup:{_key:"pivotColumnChart",column:"pivotGroupedColumn",stackedColumn:"pivotStackedColumn",normalizedColumn:"pivotNormalizedColumn"},barGroup:{_key:"pivotBarChart",bar:"pivotGroupedBar",stackedBar:"pivotStackedBar",normalizedBar:"pivotNormalizedBar"},pieGroup:{_key:"pivotPieChart",pie:"pivotPie",donut:"pivotDonut",doughnut:"pivotDonut"},lineGroup:{_key:"pivotLineChart",line:"pivotLineChart",stackedLine:"pivotStackedLine",normalizedLine:"pivotNormalizedLine"},areaGroup:{_key:"pivotAreaChart",area:"pivotArea",stackedArea:"pivotStackedArea",normalizedArea:"pivotNormalizedArea"},scatterGroup:{_key:"pivotXYChart",bubble:"pivotBubble",scatter:"pivotScatter"},combinationGroup:{_key:"pivotCombinationChart",columnLineCombo:"pivotColumnLineCombo",areaColumnCombo:"pivotAreaColumnCombo",customCombo:null},hierarchicalGroup:{_key:"pivotHierarchicalChart",treemap:"pivotTreemap",sunburst:"pivotSunburst"},statisticalGroup:{_key:"pivotStatisticalChart",histogram:"pivotHistogram",rangeBar:null,rangeArea:null,boxPlot:null},funnelGroup:{_key:"pivotFunnel",funnel:"pivotFunnel",coneFunnel:"pivotConeFunnel",pyramid:"pivotPyramid"},polarGroup:null,specializedGroup:null}}},re=class{constructor(e,t,i){this.beans=e,this.chartSvc=t,this.getLocaleTextFunc=i}getMenuItem(){let e=this.getLocaleTextFunc(),t=(t,i,s,r,a=!1)=>({name:e(t,i),action:()=>this.chartSvc.createChartFromCurrentRange(s),_key:r,_enterprise:a});return{name:e("chartRange","Chart Range"),_key:"chartRange",subMenu:[{name:e("columnChart","Column"),subMenu:[t("groupedColumn","Grouped","groupedColumn","rangeGroupedColumn"),t("stackedColumn","Stacked","stackedColumn","rangeStackedColumn"),t("normalizedColumn","100% Stacked","normalizedColumn","rangeNormalizedColumn")],_key:"rangeColumnChart"},{name:e("barChart","Bar"),subMenu:[t("groupedBar","Grouped","groupedBar","rangeGroupedBar"),t("stackedBar","Stacked","stackedBar","rangeStackedBar"),t("normalizedBar","100% Stacked","normalizedBar","rangeNormalizedBar")],_key:"rangeBarChart"},{name:e("pieChart","Pie"),subMenu:[t("pie","Pie","pie","rangePie"),t("donut","Donut","donut","rangeDonut")],_key:"rangePieChart"},{name:e("lineChart","Line"),subMenu:[t("lineChart","Line","line","rangeLineChart"),t("stackedLine","Stacked","stackedLine","rangeStackedLine"),t("normalizedLine","100% Stacked","normalizedLine","rangeNormalizedLine")],_key:"rangeLineChart"},{name:e("areaChart","Area"),subMenu:[t("areaChart","Area","area","rangeArea"),t("stackedArea","Stacked","stackedArea","rangeStackedArea"),t("normalizedArea","100% Stacked","normalizedArea","rangeNormalizedArea")],_key:"rangeAreaChart"},{name:e("xyChart","X Y (Scatter)"),subMenu:[t("scatter","Scatter","scatter","rangeScatter"),t("bubble","Bubble","bubble","rangeBubble")],_key:"rangeXYChart"},{name:e("polarChart","Polar"),subMenu:[t("radarLine","Radar Line","radarLine","rangeRadarLine"),t("radarArea","Radar Area","radarArea","rangeRadarArea"),t("nightingale","Nightingale","nightingale","rangeNightingale"),t("radialColumn","Radial Column","radialColumn","rangeRadialColumn"),t("radialBar","Radial Bar","radialBar","rangeRadialBar")],_key:"rangePolarChart",_enterprise:!0},{name:e("statisticalChart","Statistical"),subMenu:[t("boxPlot","Box Plot","boxPlot","rangeBoxPlot",!0),t("histogramChart","Histogram","histogram","rangeHistogram",!1),t("rangeBar","Range Bar","rangeBar","rangeRangeBar",!0),t("rangeArea","Range Area","rangeArea","rangeRangeArea",!0)],_key:"rangeStatisticalChart",_enterprise:!1},{name:e("hierarchicalChart","Hierarchical"),subMenu:[t("treemap","Treemap","treemap","rangeTreemap"),t("sunburst","Sunburst","sunburst","rangeSunburst")],_key:"rangeHierarchicalChart",_enterprise:!0},{name:e("specializedChart","Specialized"),subMenu:[t("heatmap","Heatmap","heatmap","rangeHeatmap"),t("waterfall","Waterfall","waterfall","rangeWaterfall")],_key:"rangeSpecializedChart",_enterprise:!0},{name:e("funnel","Funnel"),subMenu:[t("funnel","Funnel","funnel","rangeFunnel"),t("coneFunnel","Cone Funnel","coneFunnel","rangeConeFunnel"),t("pyramid","Pyramid","pyramid","rangePyramid")],_key:"rangeFunnel",_enterprise:!0},{name:e("combinationChart","Combination"),subMenu:[t("columnLineCombo","Column & Line","columnLineCombo","rangeColumnLineCombo"),t("AreaColumnCombo","Area & Column","areaColumnCombo","rangeAreaColumnCombo")],_key:"rangeCombinationChart"}],icon:(0,m._createIconNoSpan)("chart",this.beans,void 0)}}getConfigLookup(){return{columnGroup:{_key:"rangeColumnChart",column:"rangeGroupedColumn",stackedColumn:"rangeStackedColumn",normalizedColumn:"rangeNormalizedColumn"},barGroup:{_key:"rangeBarChart",bar:"rangeGroupedBar",stackedBar:"rangeStackedBar",normalizedBar:"rangeNormalizedBar"},pieGroup:{_key:"rangePieChart",pie:"rangePie",donut:"rangeDonut",doughnut:"rangeDonut"},lineGroup:{_key:"rangeLineChart",line:"rangeLineChart",stackedLine:"rangeStackedLine",normalizedLine:"rangeNormalizedLine"},areaGroup:{_key:"rangeAreaChart",area:"rangeArea",stackedArea:"rangeStackedArea",normalizedArea:"rangeNormalizedArea"},scatterGroup:{_key:"rangeXYChart",bubble:"rangeBubble",scatter:"rangeScatter"},polarGroup:{_key:"rangePolarChart",radarLine:"rangeRadarLine",radarArea:"rangeRadarArea",nightingale:"rangeNightingale",radialColumn:"rangeRadialColumn",radialBar:"rangeRadialBar"},statisticalGroup:{_key:"rangeStatisticalChart",boxPlot:"rangeBoxPlot",histogram:"rangeHistogram",rangeBar:"rangeRangeBar",rangeArea:"rangeRangeArea"},hierarchicalGroup:{_key:"rangeHierarchicalChart",treemap:"rangeTreemap",sunburst:"rangeSunburst"},specializedGroup:{_key:"rangeSpecializedChart",heatmap:"rangeHeatmap",waterfall:"rangeWaterfall"},funnelGroup:{_key:"rangeFunnel",funnel:"rangeFunnel",coneFunnel:"rangeConeFunnel",pyramid:"rangePyramid"},combinationGroup:{_key:"rangeCombinationChart",columnLineCombo:"rangeColumnLineCombo",areaColumnCombo:"rangeAreaColumnCombo",customCombo:null}}}},rt=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="colChooserFactory"}createColumnSelectPanel(e,t,i,s){let r=e.createManagedBean(new s$),{contractColumnSelection:a,suppressColumnExpandAll:l,suppressColumnFilter:n,suppressColumnSelectAll:o,suppressSyncLayoutWithGrid:d,columnLayout:h}=s??t?.getColDef().columnChooserParams??{};return r.init(!!i,(0,m._addGridCommonParams)(this.gos,{suppressColumnMove:!1,suppressValues:!1,suppressPivots:!1,suppressRowGroups:!1,suppressPivotMode:!1,contractColumnSelection:!!a,suppressColumnExpandAll:!!l,suppressColumnFilter:!!n,suppressColumnSelectAll:!!o,suppressSyncLayoutWithGrid:!!h||!!d,onStateUpdated:()=>{}}),"columnMenu"),h&&r.setColumnLayout(h),r}showColumnChooser({column:e,chooserParams:t,eventSource:i,headerPosition:s}){this.hideActiveColumnChooser();let r=this.createColumnSelectPanel(this,e,!0,t),a=this.getLocaleTextFunc(),l=this.beans,{visibleCols:n,focusSvc:o,menuUtils:d}=l,h=n.allCols.indexOf(e),u=e?o.focusedHeader??s??null:null;this.activeColumnChooserDialog=this.createBean(new tB({title:a("chooseColumns","Choose Columns"),component:r,width:300,height:300,resizable:!0,movable:!0,centered:!0,closable:!0,afterGuiAttached:()=>{(0,m._findNextFocusableElement)(l,r.getGui())?.focus({preventScroll:!0}),this.dispatchVisibleChangedEvent(!0,e)},closedCallback:t=>{let s=this.activeColumnChooser.getGui();this.destroyBean(this.activeColumnChooser),this.activeColumnChooser=void 0,this.activeColumnChooserDialog=void 0,this.dispatchVisibleChangedEvent(!1,e),e&&d.restoreFocusOnClose({column:e,headerPosition:u,columnIndex:h,eventSource:i},s,t,!0)},postProcessPopupParams:{type:"columnChooser",column:e,eventSource:i}})),this.activeColumnChooser=r}hideActiveColumnChooser(){this.destroyBean(this.activeColumnChooserDialog)}dispatchVisibleChangedEvent(e,t){this.eventSvc.dispatchEvent({type:"columnMenuVisibleChanged",visible:e,switchingTab:!1,key:"columnChooser",column:t??null})}},ri={pinSubMenu:"PinnedColumn",pinLeft:"PinnedColumn",pinRight:"PinnedColumn",clearPinned:"PinnedColumn",pinRowSubMenu:"PinnedRow",pinBottom:"PinnedRow",pinTop:"PinnedRow",unpinRow:"PinnedRow",valueAggSubMenu:"SharedAggregation",autoSizeThis:"ColumnAutoSize",autoSizeAll:"ColumnAutoSize",rowGroup:"SharedRowGrouping",rowUnGroup:"SharedRowGrouping",resetColumns:"CommunityCore",expandAll:["ClientSideRowModelHierarchy","ServerSideRowModel"],contractAll:["ClientSideRowModelHierarchy","ServerSideRowModel"],copy:"Clipboard",copyWithHeaders:"Clipboard",copyWithGroupHeaders:"Clipboard",cut:"Clipboard",paste:"Clipboard",export:["CsvExport","ExcelExport"],csvExport:"CsvExport",excelExport:"ExcelExport",separator:"CommunityCore",pivotChart:"IntegratedCharts",chartRange:"IntegratedCharts",columnFilter:"ColumnFilter",columnChooser:"ColumnMenu",sortAscending:"Sort",sortDescending:"Sort",sortAbsoluteAscending:"Sort",sortAbsoluteDescending:"Sort",sortUnSort:"Sort"},rs="separator";function rr(e,t){if(e)for(let i=e.length-2;i>=0;i--){let s=e[i]===t,r=e[i+1]===t;s&&r&&e.splice(i+1,1)}}var ra={sortAscending:{fallback:"Sort Ascending",getSortDef:()=>({type:"default",direction:"asc"})},sortDescending:{fallback:"Sort Descending",getSortDef:()=>({type:"default",direction:"desc"})},sortAbsoluteAscending:{fallback:"Sort Absolute Ascending",getSortDef:()=>({type:"absolute",direction:"asc"})},sortAbsoluteDescending:{fallback:"Sort Absolute Descending",getSortDef:()=>({type:"absolute",direction:"desc"})},sortUnSort:{fallback:"Clear Sort",getSortDef:e=>({type:(0,m._normalizeSortType)(e.getSortDef()?.type),direction:null})}},rl=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="colMenuFactory"}createMenu(e,t,i,s){let r=e.createManagedBean(new sL(0,{column:i??null,node:null,value:null})),a=this.beans.menuItemMapper.mapWithStockItems(t,i??null,null,s,"columnMenu");return r.addMenuItems(a),r}getMenuItems(e=null,t=null){let i,s=this.getDefaultMenuOptions(e),r=(e?.getColDef()??t?.getColGroupDef())?.mainMenuItems;if(Array.isArray(r))i=r;else if("function"==typeof r)i=r((0,m._addGridCommonParams)(this.gos,{column:e,columnGroup:t,defaultItems:s}));else{let r=this.gos.getCallback("getMainMenuItems");i=r?r({column:e,columnGroup:t,defaultItems:s}):s}return rr(i,rs),i}getDefaultMenuOptions(e){let t=[],{beans:i,gos:s}=this,{colChooserFactory:r,rowGroupColsSvc:a,colModel:l,expansionSvc:n,sortSvc:o,menuSvc:d,pinnedCols:h,aggFuncSvc:u,colAutosize:c}=i,p=(0,m._isLegacyMenuEnabled)(s),g=()=>{!p&&r&&t.push("columnChooser"),t.push("resetColumns")};if(!e)return g(),t;let{colDef:f}=e,C=h&&!f.lockPinned,v=a?.columns.length??0,b=(0,m._getGrandTotalRow)(s),y=s.get("treeData"),w=e.isPrimary(),S=!w||u&&e.isAllowValue()&&(v>0||b||y);if(o&&!p&&e.isSortable()){let{isDefaultSortAllowed:s,isAbsoluteSortAllowed:r,isAbsoluteSort:a,isDefaultSort:l,isAscending:n,isDescending:o,direction:d}=(0,m._getDisplaySortForColumn)(e,i);s&&!(n&&l)&&t.push("sortAscending"),s&&!(o&&l)&&t.push("sortDescending"),r&&!(n&&a)&&t.push("sortAbsoluteAscending"),r&&!(o&&a)&&t.push("sortAbsoluteDescending"),d&&t.push("sortUnSort"),t.push(rs)}if(d?.isFilterMenuItemEnabled(e)&&(t.push("columnFilter"),t.push(rs)),C&&t.push("pinSubMenu"),S&&t.push("valueAggSubMenu"),(C||S)&&t.push(rs),c&&(f.suppressAutoSize||t.push("autoSizeThis"),t.push("autoSizeAll"),t.push(rs)),a&&s.isModuleRegistered("SharedRowGrouping")){let s=t.length;f.showRowGroup?t.push("rowUnGroup"):e.isAllowRowGroup()&&w&&(e.isRowGroupActive()?sP(e,i)||t.push("rowUnGroup"):t.push("rowGroup")),t.length>s&&t.push(rs)}return g(),n&&((0,m._isClientSideRowModel)(s)||s.get("ssrmExpandAllAffectsAllRows"))&&(y||v>+!!l.isPivotMode())&&(t.push("expandAll"),t.push("contractAll")),t}},rn="ag-context-menu-open",ro=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="contextMenuSvc",this.focusedCell=null}postConstruct(){this.menu=this.createManagedBean(new to({menuItemCallbacks:sD,getMenuItems:this.getMenuItems.bind(this),mapMenuItems:this.mapWithStockItems.bind(this),beforeMenuOpen:this.beforeMenuOpen.bind(this),onMenuOpen:this.onMenuOpen.bind(this),onMenuClose:this.onMenuClose.bind(this),afterMenuDestroyed:this.afterMenuDestroyed.bind(this),onVisibleChanged:this.dispatchVisibleChangedEvent.bind(this),shouldBlockMenuOpen:()=>!!this.beans.overlays?.exclusive}))}hideActiveMenu(){this.menu.hideActiveMenu()}getMenuItems(e,t){let{column:i,node:s,value:r}=e,a=[],{clipboardSvc:l,chartSvc:n,csvCreator:o,excelCreator:d,colModel:h,rangeSvc:u,gos:c}=this.beans;if((0,m._exists)(s)&&l&&i&&(c.get("suppressCutToClipboard")||a.push("cut"),a.push("copy","copyWithHeaders","copyWithGroupHeaders","paste","separator")),c.get("enableCharts")&&n&&(h.isPivotMode()&&a.push("pivotChart"),u&&!u.isEmpty()&&a.push("chartRange")),(0,m._exists)(s)){let e=c.get("enableRowPinning"),t=c.get("isRowPinnable");if(e){let e=s.level>-1&&s.footer,i=-1===s.level&&s.footer,r=(0,m._getGrandTotalRow)(c);(i&&"pinnedBottom"!==r&&"pinnedTop"!==r||!i&&!e)&&(t?.(s)??!0)&&a.push("pinRowSubMenu")}let i=c.get("suppressExcelExport")||!d,r=c.get("suppressCsvExport")||!o;(0,m._isIOSUserAgent)()||i&&r||a.push("export")}let p=a.length?a:void 0,g=i?.getColDef().contextMenuItems;if(Array.isArray(g))return g;if("function"==typeof g)return g((0,m._addGridCommonParams)(c,{column:i,node:s,value:r,defaultItems:p,event:t}));let f=c.getCallback("getContextMenuItems");return f?.({column:i,node:s,value:r,defaultItems:p,event:t})??a}getContextMenuPosition(e,t){let i=this.getRowCtrl(e),s=this.getCellGui(i,t);if(!s)return{x:0,y:i?.getRowYPosition()??0};let r=s.getBoundingClientRect();return{x:r.x+r.width/2,y:r.y+r.height/2}}showContextMenu(e){let t=e.rowNode??null,i=e.column??null,{anchorToElement:s,value:r,source:a}=e;t&&i&&null==r&&(r=this.beans.valueSvc.getValueForDisplay({column:i,node:t,from:"edit"}).value),null==s&&(s=this.getContextMenuAnchorElement(t,i)),this.beans.menuUtils.onContextMenu({mouseEvent:e.mouseEvent??null,touchEvent:e.touchEvent??null,showMenuCallback:e=>this.menu.showMenu({node:t,column:i,value:r},e,s),source:a})}handleContextMenuMouseEvent(e,t,i,s){let r=s?.rowNode??i?.rowNode??null,a=s?.column??i?.findFullWidthInfoForEvent(e||t)?.column??null,{valueSvc:l,ctrlsSvc:n}=this.beans,o=a?l.getValue(a,r,"edit"):null,d=n.getGridBodyCtrl(),h=s?s.eGui:d.eGridBody;this.showContextMenu({mouseEvent:e,touchEvent:t,rowNode:r,column:a,value:o,anchorToElement:h,source:"ui"})}beforeMenuOpen(e){e.column||this.beans.focusSvc.clearFocusedCell()}onMenuOpen(){let{ctrlsSvc:e,focusSvc:t}=this.beans;e.getGridBodyCtrl().eGridBody.classList.add(rn),this.focusedCell=t.getFocusedCell()}onMenuClose(){this.beans.ctrlsSvc.getGridBodyCtrl().eGridBody.classList.remove(rn)}afterMenuDestroyed(){let{beans:e,focusedCell:t}=this;(0,m._attemptToRestoreCellFocus)(e,t)}dispatchVisibleChangedEvent(e,t){this.eventSvc.dispatchEvent({type:"contextMenuVisibleChanged",visible:e,source:t})}getRowCtrl(e){let{rowIndex:t,rowPinned:i}=e||{};if(null!=t)return this.beans.rowRenderer.getRowByPosition({rowIndex:t,rowPinned:i})||void 0}getCellGui(e,t){if(!e||!t)return;let i=e.getCellCtrl(t);return i?.eGui||void 0}getContextMenuAnchorElement(e,t){let i=this.beans.ctrlsSvc.getGridBodyCtrl().eGridBody,s=this.getRowCtrl(e);if(!s)return i;let r=this.getCellGui(s,t);return r||(s.isFullWidth()?s.getFullWidthElement():i)}mapWithStockItems(e,t,i){let{column:s,node:r}=t;return this.beans.menuItemMapper.mapWithStockItems(e,s,r,i,"contextMenu")}},rd="filterMenuTab",rh="generalMenuTab",ru="columnsMenuTab",rc=[rh,rd,ru],rp=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="enterpriseMenuFactory"}hideActiveMenu(){this.destroyBean(this.activeMenu)}showMenuAfterMouseEvent(e,t,i,s,r){let{column:a,columnGroup:l}=this.splitColumnOrGroup(e),n=r?"filterMenuTab":void 0;this.showMenu(a,l,e=>{let s=e.getGui();this.beans.popupSvc.positionPopupUnderMouseEvent({type:i,additionalParams:{column:a},mouseEvent:t,ePopup:s}),n&&e.showTab?.(n),this.dispatchVisibleChangedEvent(!0,!1,a,l,n)},i,n,void 0,t.target,s)}splitColumnOrGroup(e){let t=e&&(0,m.isColumn)(e);return{column:t?e:void 0,columnGroup:t?void 0:e}}showMenuAfterButtonClick(e,t,i,s,r){let a=-1,l="left";this.gos.get("enableRtl")&&(a=1,l="right");let n=r?"filterMenuTab":void 0,o=n?[n]:void 0,d=(0,m._isLegacyMenuEnabled)(this.gos),h=(d?9:4)*a,u=d?-23:4,{column:c,columnGroup:p}=this.splitColumnOrGroup(e);this.showMenu(c,p,e=>{let s=e.getGui();this.beans.popupSvc.positionPopupByComponent({type:i,additionalParams:{column:c},eventSource:t,ePopup:s,alignSide:l,nudgeX:h,nudgeY:u,position:"under",keepWithinBounds:!0}),n&&e.showTab?.(n),this.dispatchVisibleChangedEvent(!0,!1,c,p,n)},i,n,o,t,s)}showMenu(e,t,i,s,r,a,l,n){let o=this.getMenuParams(e,t,a,l);if(!o)return;let{menu:d,eMenuGui:h,anchorToElement:u,restoreFocusParams:c}=o,p=[],{menuUtils:g,popupSvc:f}=this.beans;p.push(t=>{let i=d.getGui();this.destroyBean(d),e&&((0,m._setColMenuVisible)(e,!1,"contextMenu"),g.restoreFocusOnClose(c,i,t)),n?.()});let C=this.getLocaleTextFunc();if(f.addPopup({modal:!0,eChild:h,closeOnEsc:!0,closedCallback:i=>{for(let e of p)e(i);this.dispatchVisibleChangedEvent(!1,!1,e,t,r)},afterGuiAttached:e=>d.afterGuiAttached(Object.assign({},{container:s},e)),positionCallback:r?()=>i(d):void 0,ariaLabel:C("ariaLabelColumnMenu","Column Menu")}),r||(d.showTabBasedOnPreviousSelection?.(),i(d)),(0,m._isColumnMenuAnchoringEnabled)(this.gos)){let t=f.setPopupPositionRelatedToElement(h,u);t&&e&&this.addStopAnchoring(t,e,p)}d.addEventListener("tabSelected",t=>{this.dispatchVisibleChangedEvent(!1,!0,e),this.lastSelectedTab=t.key,this.dispatchVisibleChangedEvent(!0,!0,e)}),e&&(0,m._setColMenuVisible)(e,!0,"contextMenu"),this.activeMenu=d,d.addEventListener("destroyed",()=>{this.activeMenu===d&&(this.activeMenu=null)})}addStopAnchoring(e,t,i){e.then(e=>{t.__addEventListener("leftChanged",e),t.__addEventListener("visibleChanged",e),i.push(()=>{t.__removeEventListener("leftChanged",e),t.__removeEventListener("visibleChanged",e)})})}getMenuParams(e,t,i,s){let{focusSvc:r,visibleCols:a,ctrlsSvc:l}=this.beans,n={column:e,headerPosition:r.focusedHeader,columnIndex:a.allCols.indexOf(e),eventSource:s},o=this.createMenu(e,t,n,i,s);return o?{menu:o,eMenuGui:o.getGui(),anchorToElement:s||l.getGridBodyCtrl().eGridBody,restoreFocusParams:n}:void 0}createMenu(e,t,i,s,r){if((0,m._isLegacyMenuEnabled)(this.gos))return this.createBean(new rg(e,i,this.lastSelectedTab,s,r));{let s=this.beans.colMenuFactory.getMenuItems(e,t);return s.length?this.createBean(new rm(s,e,i,r)):void 0}}dispatchVisibleChangedEvent(e,t,i,s,r){this.eventSvc.dispatchEvent({type:"columnMenuVisibleChanged",visible:e,switchingTab:t,key:this.lastSelectedTab??r??((0,m._isLegacyMenuEnabled)(this.gos)?rh:"columnMenu"),column:i??null,columnGroup:s??null})}isMenuEnabled(e){if(!(0,m._isLegacyMenuEnabled)(this.gos))return!0;let t=!this.beans.filterManager?.isFilterAllowed(e),i=e.getColDef().menuTabs??rc;return(t&&i.includes(rd)?i.length-1:i.length)>0}showMenuAfterContextMenuEvent(e,t,i){this.beans.menuUtils.onContextMenu({mouseEvent:t,touchEvent:i,source:"ui",showMenuCallback:t=>(this.showMenuAfterMouseEvent(e,t,"columnMenu"),!0)})}},rg=class extends m.BeanStub{constructor(e,t,i,s,r){super(),this.column=e,this.restoreFocusParams=t,this.initialSelection=i,this.restrictTo=s,this.sourceElement=r,this.tabFactories={},this.includeChecks={};const{tabFactories:a,includeChecks:l}=this;a[rh]=this.createMainPanel.bind(this),a[rd]=this.createFilterPanel.bind(this),a[ru]=this.createColumnsPanel.bind(this),l[rh]=()=>!0,l[rd]=()=>!!e&&!!this.beans.filterManager?.isFilterAllowed(e),l[ru]=()=>!0}postConstruct(){let e=new tp({items:this.getTabsToCreate().map(e=>this.createTab(e)),cssClass:"ag-menu",onActiveItemClicked:this.onHidePopup.bind(this),onItemClicked:this.onTabItemClicked.bind(this)});this.tabbedLayout=this.createBean(e),this.mainMenuList?.setParentComponent(e),this.addDestroyFunc(()=>this.destroyBean(e))}getTabsToCreate(){return this.restrictTo?this.restrictTo:(this.column?.getColDef().menuTabs??rc).filter(e=>this.isValidMenuTabItem(e)&&this.isNotSuppressed(e))}isValidMenuTabItem(e){let t=!0,i=rc;return null!=this.restrictTo&&(t=this.restrictTo.indexOf(e)>-1,i=this.restrictTo),(t=t&&rc.indexOf(e)>-1)||(0,m._warn)(175,{menuTabName:e,itemsToConsider:i}),t}isNotSuppressed(e){return this.includeChecks[e]()}createTab(e){return this.tabFactories[e]()}showTabBasedOnPreviousSelection(){this.showTab(this.initialSelection)}showTab(e){let{tabItemColumns:t,tabbedLayout:i,tabItemFilter:s,tabItemGeneral:r}=this;t&&e===ru?i.showItem(t):s&&e===rd?i.showItem(s):r&&e===rh?i.showItem(r):i.showFirstItem()}onTabItemClicked(e){let t=null;switch(e.item){case this.tabItemColumns:t=ru;break;case this.tabItemFilter:t=rd;break;case this.tabItemGeneral:t=rh}t&&this.activateTab(t)}activateTab(e){this.dispatchLocalEvent({type:"tabSelected",key:e})}createMainPanel(){let{beans:e,column:t}=this,i=e.colMenuFactory,s=i.createMenu(this,i.getMenuItems(t),this.column,()=>this.sourceElement??this.getGui());this.mainMenuList=s,s.addEventListener("closeMenu",this.onHidePopup.bind(this));let r={title:(0,m._createIconNoSpan)("legacyMenu",e,t),titleLabel:rh.replace("MenuTab",""),bodyPromise:m.AgPromise.resolve(s.getGui()),name:rh};return this.tabItemGeneral=r,r}onHidePopup(e){this.beans.menuUtils.closePopupAndRestoreFocusOnSelect(this.hidePopupFunc,this.restoreFocusParams,e)}createFilterPanel(){let e=this.column?this.createBean(new m.FilterComp(this.column,"COLUMN_MENU")):null;return this.filterComp=e,e?.hasFilter()||(0,m._error)(119),this.tabItemFilter={title:(0,m._createIconNoSpan)("filterTab",this.beans,this.column),titleLabel:rd.replace("MenuTab",""),bodyPromise:m.AgPromise.resolve(e?.getGui()),afterAttachedCallback:t=>e?.afterGuiAttached(t),afterDetachedCallback:()=>e?.afterGuiDetached(),name:rd},this.tabItemFilter}createColumnsPanel(){let e=(0,m._createElement)({tag:"div",cls:"ag-menu-column-select-wrapper"}),{beans:t,column:i}=this,s=t.colChooserFactory.createColumnSelectPanel(this,i).getGui();s.classList.add("ag-menu-column-select"),e.appendChild(s);let r={title:(0,m._createIconNoSpan)("columns",t,i),titleLabel:ru.replace("MenuTab",""),bodyPromise:m.AgPromise.resolve(e),name:ru};return this.tabItemColumns=r,r}afterGuiAttached(e){let{container:t,hidePopup:i}=e;this.tabbedLayout.setAfterAttachedParams({container:t,hidePopup:i}),i&&(this.hidePopupFunc=i,this.addDestroyFunc(i))}getGui(){return this.tabbedLayout.getGui()}destroy(){super.destroy(),this.destroyBean(this.filterComp)}},rm=class extends m.Component{constructor(e,t,i,s){super({tag:"div",ref:"eColumnMenu",cls:"ag-menu ag-column-menu",role:"presentation"}),this.menuItems=e,this.column=t,this.restoreFocusParams=i,this.sourceElement=s,this.eColumnMenu=m.RefPlaceholder}postConstruct(){let e=this.beans.colMenuFactory.createMenu(this,this.menuItems,this.column,()=>this.sourceElement??this.getGui());this.mainMenuList=e,e.addEventListener("closeMenu",this.onHidePopup.bind(this)),this.eColumnMenu.appendChild(e.getGui())}onHidePopup(e){this.beans.menuUtils.closePopupAndRestoreFocusOnSelect(this.hidePopupFunc,this.restoreFocusParams,e)}afterGuiAttached({hidePopup:e}){e&&(this.hidePopupFunc=e,this.addDestroyFunc(e)),(0,m._focusInto)(this.mainMenuList.getGui())}},rf={moduleName:"MenuCore",version:tv,beans:[class extends m.BeanStub{constructor(){super(...arguments),this.beanName="menuItemMapper"}mapWithStockItems(e,t,i,s,r){if(!e)return[];let a=[],l=this.getLocaleTextFunc(),{beans:n,gos:o}=this,{pinnedCols:d,colAutosize:h,aggFuncSvc:u,rowGroupColsSvc:c,colNames:p,colModel:g,clipboardSvc:f,expansionSvc:C,focusSvc:v,csvCreator:b,excelCreator:y,menuSvc:w,colChooserFactory:S,sortSvc:x,chartMenuItemMapper:F,valueColsSvc:A,pinnedRowModel:M}=n,R=(e,t,s,r)=>{let a;switch((a=ri[e])&&o.assertModuleRegistered(a,`menu item '${e}'`),e){case"pinSubMenu":return d&&t?{name:l("pinColumn","Pin Column"),icon:(0,m._createIconNoSpan)("menuPin",n,null),subMenu:["clearPinned","pinLeft","pinRight"]}:null;case"pinLeft":return d&&t?{name:l("pinLeft","Pin Left"),action:()=>d.setColsPinned([t],"left",r),checked:!!t&&t.isPinnedLeft()}:null;case"pinRight":return d&&t?{name:l("pinRight","Pin Right"),action:()=>d.setColsPinned([t],"right",r),checked:!!t&&t.isPinnedRight()}:null;case"clearPinned":return d&&t?{name:l("noPin","No Pin"),action:()=>d.setColsPinned([t],null,r),checked:!!t&&!t.isPinned()}:null;case"pinRowSubMenu":{let e=o.get("enableRowPinning"),s=[],r=i?.rowPinned??i?.pinnedSibling?.rowPinned;return r&&s.push("unpinRow"),e&&"bottom"!==e&&"top"!=r&&s.push("pinTop"),e&&"top"!==e&&"bottom"!=r&&s.push("pinBottom"),M?.isManual()?{name:l("pinRow","Pin Row"),icon:(0,m._createIconNoSpan)("rowPin",n,t),subMenu:s}:null}case"pinTop":return M?.isManual()?{name:l("pinTop","Pin to Top"),icon:(0,m._createIconNoSpan)("rowPinTop",n,t),action:({node:e,column:t})=>e&&M.pinRow(e,"top",t)}:null;case"pinBottom":return M?.isManual()?{name:l("pinBottom","Pin to Bottom"),icon:(0,m._createIconNoSpan)("rowPinBottom",n,t),action:({node:e,column:t})=>e&&M.pinRow(e,"bottom",t)}:null;case"unpinRow":return M?.isManual()?{name:l("unpinRow","Unpin Row"),icon:(0,m._createIconNoSpan)("rowUnpin",n,t),action:({node:e,column:t})=>e&&M.pinRow(e,null,t)}:null;case"valueAggSubMenu":if(u&&A&&(t?.isPrimary()||t?.getColDef().pivotValueColumn))return{name:l("valueAggregation","Value Aggregation"),icon:(0,m._createIconNoSpan)("menuValue",n,null),subMenu:function(e,t,i,s){let r;if(e.isPrimary())r=e;else{let t=e.getColDef().pivotValueColumn;r=(0,m._exists)(t)?t:void 0}let a=[];if(r){let e=r.isValueActive(),l=t.getFuncNames(r);for(let n of(a.push({name:s("noAggregation","None"),action:()=>{i.removeColumns([r],"contextMenu"),i.setColumnAggFunc(r,void 0,"contextMenu")},checked:!e}),l))a.push({name:s(n,t.getDefaultFuncLabel(n)),action:()=>{i.setColumnAggFunc(r,n,"contextMenu"),i.addColumns([r],"contextMenu")},checked:e&&r.getAggFunc()===n})}return a}(t,u,A,l),disabled:o.get("functionsReadOnly")};return null;case"autoSizeThis":return h?{name:l("autosizeThisColumn","Autosize This Column"),action:()=>t&&h.autoSizeColumn(t,r,o.get("skipHeaderOnAutoSize"))}:null;case"autoSizeAll":return h?{name:l("autosizeAllColumns","Autosize All Columns"),action:()=>h.autoSizeAllColumns({source:r,skipHeader:o.get("skipHeaderOnAutoSize")})}:null;case"rowGroup":return c?{name:sI(l,"groupBy",p.getDisplayNameForColumn(t,"header")),disabled:o.get("functionsReadOnly")||t?.isRowGroupActive()||!t?.getColDef().enableRowGroup,action:()=>c.addColumns([t],r),icon:(0,m._createIconNoSpan)("menuAddRowGroup",n,null)}:null;case"rowUnGroup":if(!(c&&o.isModuleRegistered("SharedRowGrouping")))return null;{let e,i,s,a=t?.getColDef().showRowGroup,d=o.get("groupLockGroupColumns");if(!0===a)e=l("ungroupAll","Un-Group All"),i=o.get("functionsReadOnly")||-1===d||d>=(c.columns.length??0),s=()=>c.setColumns(c.columns.slice(0,d),r);else if("string"==typeof a){let t=g.getColDefCol(a);e=sI(l,"ungroupBy",null!=t?p.getDisplayNameForColumn(t,"header"):a),i=o.get("functionsReadOnly")||sP(t,n),s=()=>{c.removeColumns([a],r)}}else e=sI(l,"ungroupBy",p.getDisplayNameForColumn(t,"header")),i=o.get("functionsReadOnly")||!t?.isRowGroupActive()||!t?.getColDef().enableRowGroup||sP(t,n),s=()=>c.removeColumns([t],r);return{name:e,disabled:i,action:s,icon:(0,m._createIconNoSpan)("menuRemoveRowGroup",n,null)}}case"resetColumns":return{name:l("resetColumns","Reset Columns"),action:()=>(0,m._resetColumnState)(n,r)};case"expandAll":return C?{name:l("expandAll","Expand All Row Groups"),action:()=>C.expandAll(!0)}:null;case"contractAll":return C?{name:l("collapseAll","Collapse All Row Groups"),action:()=>C.expandAll(!1)}:null;case"copy":return f?{name:l("copy","Copy"),shortcut:l("ctrlC","Ctrl+C"),icon:(0,m._createIconNoSpan)("clipboardCopy",n,null),action:()=>f.copyToClipboard()}:null;case"copyWithHeaders":return f?{name:l("copyWithHeaders","Copy with Headers"),icon:(0,m._createIconNoSpan)("clipboardCopy",n,null),action:()=>f.copyToClipboard({includeHeaders:!0})}:null;case"copyWithGroupHeaders":return f?{name:l("copyWithGroupHeaders","Copy with Group Headers"),icon:(0,m._createIconNoSpan)("clipboardCopy",n,null),action:()=>f.copyToClipboard({includeHeaders:!0,includeGroupHeaders:!0})}:null;case"cut":if(!f)return null;{let e=v.getFocusedCell(),t=e?(0,m._getRowNode)(n,e):null,i=!!t&&e?.column.isCellEditable(t);return{name:l("cut","Cut"),shortcut:l("ctrlX","Ctrl+X"),icon:(0,m._createIconNoSpan)("clipboardCut",n,null),disabled:!i||o.get("suppressCutToClipboard"),action:()=>f.cutToClipboard(void 0,"contextMenu")}}case"paste":if(!f)return null;{let e=o.get("suppressClipboardApi")||o.get("suppressClipboardPaste")||!t||!i||!t.isCellEditable(i)||t.isSuppressPaste(i);return{name:l("paste","Paste"),shortcut:l("ctrlV","Ctrl+V"),icon:(0,m._createIconNoSpan)("clipboardPaste",n,null),disabled:e,action:()=>f.pasteFromClipboard()}}case"export":{let e=[];return!o.get("suppressCsvExport")&&b&&e.push("csvExport"),!o.get("suppressExcelExport")&&y&&e.push("excelExport"),e.length?{name:l("export","Export"),subMenu:e,icon:(0,m._createIconNoSpan)("save",n,null)}:null}case"csvExport":return b?{name:l("csvExport","CSV Export"),icon:(0,m._createIconNoSpan)("csvExport",n,null),action:()=>b.exportDataAsCsv()}:null;case"excelExport":return y?{name:l("excelExport","Excel Export"),icon:(0,m._createIconNoSpan)("excelExport",n,null),action:()=>y.exportDataAsExcel()}:null;case"separator":return e;case"pivotChart":case"chartRange":return F.getChartItems(e);case"columnFilter":return w&&t?{name:l("columnFilter","Column Filter"),icon:(0,m._createIconNoSpan)("filter",n,null),action:()=>w.showFilterMenu({column:t,buttonElement:s(),containerType:"columnFilter",positionBy:"button"})}:null;case"columnChooser":{let e=v.focusedHeader;return S?{name:l("columnChooser","Choose Columns"),icon:(0,m._createIconNoSpan)("columns",n,null),action:()=>S.showColumnChooser({column:t,eventSource:s(),headerPosition:e})}:null}case"sortUnSort":case"sortAscending":case"sortDescending":case"sortAbsoluteAscending":case"sortAbsoluteDescending":{if(!x||!t)return null;let{fallback:i,getSortDef:s}=ra[e];return{name:l(e,i),icon:(0,m._createIconNoSpan)(e,n,null),action:()=>x.setSortForColumn(t,s(t),!1,r)}}default:return(0,m._warn)(176,{key:e}),null}};for(let l of e){let e;if(!(e="string"==typeof l?R(l,t,s,r):{...l}))continue;let{subMenu:n}=e;n&&n instanceof Array&&(e.subMenu=this.mapWithStockItems(n,t,i,s,r)),null!=e&&a.push(e)}return rr(a,rs),a}},s7,class extends m.BeanStub{constructor(){super(...arguments),this.beanName="menuUtils"}restoreFocusOnClose(e,t,i,s){let{eventSource:r}=e,a=i instanceof KeyboardEvent;if(!s&&!a||!r)return;let l=(0,m._getActiveDomElement)(this.beans);(t.contains(l)||(0,m._isNothingFocused)(this.beans))&&this.focusHeaderCell(e)}closePopupAndRestoreFocusOnSelect(e,t,i){let s;i?.keyboardEvent&&(s=i.keyboardEvent),e(s&&{keyboardEvent:s});let r=this.beans,a=r.focusSvc,l=a.getFocusedCell();if((0,m._isNothingFocused)(r))if(l){let{rowIndex:e,rowPinned:t,column:i}=l;a.setFocusedCell({rowIndex:e,column:i,rowPinned:t,forceBrowserFocus:!0,preventScrollOnBrowserFocus:!0})}else this.focusHeaderCell(t)}onContextMenu(e){let{mouseEvent:t,touchEvent:i,showMenuCallback:s,source:r}=e;if(this.gos.get("allowContextMenuWithControlKey")||!t||!t.ctrlKey&&!t.metaKey){if((t&&this.blockMiddleClickScrollsIfNeeded(t),!("ui"===r&&this.gos.get("suppressContextMenu")))&&s(t??i.touches[0])){let e=t??i;e?.cancelable&&e.preventDefault()}}}async focusHeaderCell(e){let{column:t,columnIndex:i,headerPosition:s,eventSource:r}=e,{visibleCols:a,headerNavigation:l,focusSvc:n}=this.beans,o=await a.allCols.some(e=>e===t);if(this.isAlive()){if(t?.isAlive()&&o&&r&&(0,m._isVisible)(r)){let e=(0,m._findTabbableParent)(r);e&&(l?.scrollToColumn(t),e.focus())}else if(s&&-1!==i){let e=a.allCols,t=e[i]||(0,m._last)(e);t&&n.focusHeaderPosition({headerPosition:{headerRowIndex:s.headerRowIndex,column:t}})}}}blockMiddleClickScrollsIfNeeded(e){this.gos.get("suppressMiddleClickScrolls")&&2===e.which&&e.preventDefault()}}],icons:{chart:"chart",columns:"columns",loadingMenuItems:"loading",menuPin:"pin",menuValue:"aggregation",menuAddRowGroup:"group",menuRemoveRowGroup:"group",clipboardCopy:"copy",clipboardCut:"cut",clipboardPaste:"paste",save:"save",csvExport:"csv",excelExport:"excel",sortAscending:"asc",sortDescending:"desc",sortAbsoluteAscending:"aasc",sortAbsoluteDescending:"adesc",sortUnSort:"none"},dependsOn:[tb,m._PopupModule,m._SharedMenuModule,sm]},rC={moduleName:"ColumnMenu",version:tv,beans:[rp,rl,rt],icons:{ensureColumnVisible:"column-arrow",legacyMenu:"menu",filterTab:"filter",columnSelectClosed:"tree-closed",columnSelectOpen:"tree-open",columnSelectIndeterminate:"tree-indeterminate"},apiFunctions:{showColumnChooser:function(e,t){e.colChooserFactory?.showColumnChooser({chooserParams:t})},hideColumnChooser:function(e){e.colChooserFactory?.hideActiveColumnChooser()}},dependsOn:[rf,m._SharedDragAndDropModule,m._ColumnMoveModule]},rv=class extends m.AgAbstractCellEditor{constructor(){super({tag:"div",cls:"ag-cell-edit-wrapper"}),this.currentSearchRequest=0,this.onSearchCallback=e=>{let t=++this.currentSearchRequest,i=this.eEditor;i.setValueList({refresh:!0,valueList:void 0});let s=this.params;if(s.search=e,!s.search)return;if("function"!=typeof s.values){this.isFullAsync()&&(0,m._warn)(294);return}let r=s.values(s);if(Array.isArray(r)){this.isFullAsync()&&(0,m._warn)(294),i.setValueList({refresh:!0,valueList:r});return}i.setValueList({valueList:r.then(e=>{if(t===this.currentSearchRequest)return e}),refresh:!0})}}initialiseEditor(e){let{cellStartedEdit:t,values:i,eventKey:s}=this.params;(0,m._missing)(i)&&(0,m._warn)(180);let{params:r,valueList:a}=this.buildRichSelectParams(),l=this.createManagedBean(new it(r));this.eEditor=l,l.addCss("ag-cell-editor"),this.appendChild(l),this.isFullAsync()&&l.showPicker(),this.eEditor.setValueList({valueList:a,refresh:!0,isInitial:!0}),a&&!Array.isArray(a)&&a.then(e=>{let t=this.getSearchStringCallback(e);t&&l.setSearchStringCreator(t),this.processEventKey(s)}),this.addManagedListeners(l,{fieldPickerValueSelected:this.onEditorPickerValueSelected.bind(this)}),this.focusAfterAttached=t}onEditorPickerValueSelected(e){"fullRow"!==this.gos.get("editType")&&setTimeout(()=>this.params.stopEditing(!e.fromEnterKey))}getPlaceholderText(){let{valuePlaceholder:e}=this.params;if(void 0!==e)return e;let t=this.getLocaleTextFunc();return this.isFullAsync()?t("typeToSearchOoo","Type to search..."):t("advancedFilterBuilderSelectOption","Select an option...")}isFullAsync(){let{allowTyping:e,filterListAsync:t,values:i}=this.params;return"function"!=typeof i&&t&&(0,m._warn)(294),!!(e&&t&&"function"==typeof i)}getInitialValueList(){let e=this.params,{values:t}=e,i=this.isFullAsync(),s=Array.isArray(t)||!t,r="function"==typeof t;return s?t??[]:r?i?void 0:t({...e}):[]}buildRichSelectParams(){let e=this.params,{cellRenderer:t,cellRendererParams:i,cellHeight:s,value:r,values:a,formatValue:l,searchDebounceDelay:n,valueListGap:o,valueListMaxHeight:d,valueListMaxWidth:h,allowTyping:u,filterList:c,searchType:p,highlightMatch:g,eventKey:f,multiSelect:C,suppressDeselectAll:v,suppressMultiSelectPillRenderer:b}=e,y={value:r,cellRenderer:t,cellRendererParams:i,cellRowHeight:s,searchDebounceDelay:n,valueFormatter:l,pickerAriaLabelKey:"ariaLabelRichSelectField",pickerAriaLabelValue:"Rich Select Field",pickerType:"virtual-list",pickerGap:o,allowTyping:u,filterList:c,searchType:p,highlightMatch:g,maxPickerHeight:d,maxPickerWidth:h,placeholder:this.getPlaceholderText(),initialInputValue:f?.length===1?f:f===m.KeyCode.BACKSPACE?"":void 0,multiSelect:C,suppressDeselectAll:v,suppressMultiSelectPillRenderer:b},w=this.getInitialValueList(),S=this.isFullAsync(),x=Array.isArray(a),F="function"==typeof a;return x?(y.valueList=w,y.searchStringCreator=this.getSearchStringCallback(w)):F&&S&&(y.onSearch=this.onSearchCallback,y.allowNoResultsCopy=!0,y.filterList=!0),C&&u&&(e.allowTyping=!1,y.allowTyping=!1,(0,m._warn)(181)),{params:y,valueList:w}}getSearchStringCallback(e){if("object"!=typeof e[0])return;let t=this.params,{colDef:i,formatValue:s}=t;if(i.cellEditorParams?.formatValue)return e=>e.map(s);let{keyCreator:r}=i;if(r){(0,m._warn)(266);let{column:e,node:s,data:a}=t;return t=>t.map(t=>r((0,m._addGridCommonParams)(this.gos,{value:t,colDef:i,column:e,node:s,data:a})))}return e=>e.map(s)}afterGuiAttached(){let{focusAfterAttached:e,params:t}=this;setTimeout(()=>{if(!this.isAlive())return;let i=this.eEditor,{allowTyping:s,eventKey:r,cellStartedEdit:a}=t;if(e){let e=i.getFocusableElement();e.focus(),s&&(!r||1!==r.length)&&e.select()}a&&i.showPicker(),this.processEventKey(r)})}processEventKey(e){e&&(e===m.KeyCode.BACKSPACE?this.eEditor.searchTextFromString(null):e?.length===1&&this.eEditor.searchTextFromString(e))}focusIn(){this.eEditor.getFocusableElement().focus()}getValue(){let{params:e}=this,t=this.eEditor.getValue();return e.parseValue?.(t)??t}isPopup(){return!1}getValidationElement(){return this.eEditor.getAriaElement()}getValidationErrors(){let{params:e}=this,{getValidationErrors:t}=e;return t?t({value:this.getValue(),internalErrors:null,cellEditorParams:e}):null}},rb={moduleName:"RichSelect",version:tv,beans:[],userComponents:{agRichSelect:rv,agRichSelectCellEditor:rv},icons:{richSelectOpen:"small-down",richSelectRemove:"cancel",richSelectLoading:"loading"},dependsOn:[tb,m._EditCoreModule]},ry="__AG_SELECT_ALL__",rw="__AG_ADD_SELECTION_TO_FILTER__",rS=class{constructor(e,t,i,s,r){this.valueSvc=e,this.getValueFormatter=t,this.formatter=i,this.column=s,this.getUseFormatterFromColumn=r,this.displayedKeys=[]}updateDisplayedValuesToAllAvailable(e,t,i){this.displayedKeys=Array.from(i)}updateDisplayedValuesToMatchMiniFilter(e,t,i,s,r){this.displayedKeys=[];let a=this.getValueFormatter();for(let t of i)if(null==t)r&&this.displayedKeys.push(t);else{let i=e(t),r=this.valueSvc.formatValue(this.column,null,i,a,this.getUseFormatterFromColumn());s(this.formatter(r))&&this.displayedKeys.push(t)}}getDisplayedValueCount(){return this.displayedKeys.length}getDisplayedItem(e){return this.displayedKeys[e]}getSelectAllItem(){return ry}getAddSelectionToFilterItem(){return rw}getDisplayedKeys(){return this.displayedKeys}forEachDisplayedKey(e){this.displayedKeys.forEach(e)}someDisplayedKey(e){return this.displayedKeys.some(e)}hasGroups(){return!1}refresh(){}},rx={tag:"div",cls:"ag-set-filter-item",attrs:{"aria-hidden":"true"},children:[{tag:"span",cls:"ag-set-filter-group-icons",children:[{tag:"span",ref:"eGroupClosedIcon",cls:"ag-set-filter-group-closed-icon"},{tag:"span",ref:"eGroupOpenedIcon",cls:"ag-set-filter-group-opened-icon"},{tag:"span",ref:"eGroupIndeterminateIcon",cls:"ag-set-filter-group-indeterminate-icon"}]},{tag:"ag-checkbox",ref:"eCheckbox",cls:"ag-set-filter-item-checkbox"}]},rF={tag:"div",cls:"ag-set-filter-item",children:[{tag:"ag-checkbox",ref:"eCheckbox",cls:"ag-set-filter-item-checkbox"}]},rA=class extends m.Component{constructor(e){super(e.isGroup?rx:rF,[m.AgCheckboxSelector]),this.eCheckbox=m.RefPlaceholder,this.eGroupOpenedIcon=m.RefPlaceholder,this.eGroupClosedIcon=m.RefPlaceholder,this.eGroupIndeterminateIcon=m.RefPlaceholder,this.formattedValue=null,this.focusWrapper=e.focusWrapper,this.value=e.value,this.params=e.params,this.translate=e.translate,this.valueFormatter=e.valueFormatter,this.useFormatterFromColumn=e.shouldUseFormatterFromColumn,this.item=e.item,this.isSelected=e.isSelected,this.isTree=e.isTree,this.depth=e.depth??0,this.isGroup=e.isGroup,this.groupsExist=e.groupsExist,this.isExpanded=e.isExpanded,this.hasIndeterminateExpandState=e.hasIndeterminateExpandState}postConstruct(){this.tooltipFeature=this.createOptionalManagedBean(this.beans.registry.createDynamicBean("tooltipFeature",!1,{getGui:()=>this.focusWrapper,getLocation:()=>"setFilterValue",shouldDisplayTooltip:()=>this.shouldDisplayTooltip?.()??!0,getAdditionalParams:()=>{let{colDef:e,column:t}=this.params,i={colDef:e,column:t,valueFormatted:this.formattedValue??void 0};return this.isTree&&(i.level=this.depth),i}})),this.addDestroyFunc(()=>this.destroyCellRendererComponent?.()),this.render(),this.eCheckbox.setLabelEllipsis(!0).setValue(this.isSelected,!0).setDisabled(!!this.params.readOnly).getInputElement().setAttribute("tabindex","-1"),this.refreshVariableAriaLabels(),this.isTree&&(this.depth>0&&(this.addCss("ag-set-filter-indent-"+this.depth),this.getGui().style.setProperty("--ag-indentation-level",String(this.depth))),this.isGroup?this.setupExpansion():this.groupsExist&&this.addCss("ag-set-filter-add-group-indent"),(0,m._setAriaLevel)(this.getAriaElement(),this.depth+1)),this.refreshAriaChecked(),this.params.readOnly||this.eCheckbox.onValueChange(e=>this.onCheckboxChanged(!!e))}getFocusableElement(){return this.focusWrapper}setupExpansion(){let{eGroupClosedIcon:e,eGroupOpenedIcon:t,eGroupIndeterminateIcon:i,hasIndeterminateExpandState:s,beans:r}=this;e.appendChild((0,m._createIcon)("setFilterGroupClosed",r,null)),t.appendChild((0,m._createIcon)("setFilterGroupOpen",r,null));let a=this.onExpandOrContractClicked.bind(this);this.addManagedElementListeners(e,{click:a}),this.addManagedElementListeners(t,{click:a}),s&&(i.appendChild((0,m._createIcon)("setFilterGroupIndeterminate",r,null)),this.addManagedElementListeners(i,{click:a})),this.setExpandedIcons(),this.refreshAriaExpanded()}onExpandOrContractClicked(){this.setExpanded(!this.isExpanded)}setExpanded(e,t){if(this.isGroup&&e!==this.isExpanded){this.isExpanded=e;let i={type:"expandedChanged",isExpanded:!!e,item:this.item};t||this.dispatchLocalEvent(i),this.setExpandedIcons(),this.refreshAriaExpanded()}}setExpandedIcons(){let{isExpanded:e,hasIndeterminateExpandState:t,eGroupClosedIcon:i,eGroupOpenedIcon:s,eGroupIndeterminateIcon:r}=this;(0,m._setDisplayed)(i,t?!1===e:!e),(0,m._setDisplayed)(s,!0===e),t&&(0,m._setDisplayed)(r,void 0===e)}onCheckboxChanged(e){this.isSelected=e;let t={type:"selectionChanged",isSelected:e,item:this.item};this.dispatchLocalEvent(t),this.refreshVariableAriaLabels(),this.refreshAriaChecked()}toggleSelected(){this.params.readOnly||this.setSelected(!this.isSelected)}setSelected(e,t){this.isSelected=e,this.eCheckbox.setValue(e,t),this.refreshAriaChecked()}refreshVariableAriaLabels(){if(!this.isTree)return;let e=this.getLocaleTextFunc(),t=this.eCheckbox.getValue(),i=void 0===t?e("ariaIndeterminate","indeterminate"):t?e("ariaVisible","visible"):e("ariaHidden","hidden"),s=e("ariaToggleVisibility","Press SPACE to toggle visibility");(0,m._setAriaLabelledBy)(this.eCheckbox.getInputElement(),void 0),this.eCheckbox.setInputAriaLabel(`${s} (${i})`)}setupFixedAriaLabels(e){if(!this.isTree)return;let t=this.getLocaleTextFunc()("ariaFilterValue","Filter Value"),i=this.getAriaElement();(0,m._setAriaLabel)(i,`${e} ${t}`),(0,m._setAriaDescribedBy)(i,this.eCheckbox.getInputElement().id)}refreshAriaChecked(){let e=this.getAriaElement();(0,m._setAriaChecked)(e,this.eCheckbox.getValue())}refreshAriaExpanded(){(0,m._setAriaExpanded)(this.getAriaElement(),!!this.isExpanded)}refresh(e,t,i){this.item=e,t!==this.isSelected&&this.setSelected(t,!0),this.setExpanded(i,!0);let{cellRendererComponent:s,cellRendererParams:r,beans:a,params:l}=this;if(this.valueFunction){let e=this.valueFunction();this.setTooltipAndCellRendererParams(e,e),s||this.renderCellWithoutCellRenderer()}if(s){let e=(0,m._getCellRendererDetails)(a.userCompFactory,l,r);s.refresh?.(e?.params??r)||(this.renderCell(),this.destroyBean(s))}}render(){let{params:{column:e}}=this,{value:t}=this,i=null;"function"==typeof t?(this.valueFunction=t,t=i=this.valueFunction()):i=this.isTree?(0,m._toStringOrNull)(t):this.getFormattedValue(e,t),this.formattedValue=i,this.setTooltipAndCellRendererParams(t,i),this.renderCell()}setTooltipAndCellRendererParams(e,t){let i=this.gos;if(this.params.showTooltips&&(!(0,m._isShowTooltipWhenTruncated)(i)||!this.params.cellRenderer)){let s=null!=t?t:(0,m._toStringOrNull)(e);this.shouldDisplayTooltip=(0,m._getShouldDisplayTooltip)(i,()=>this.eCheckbox.getGui().querySelector(".ag-label")),this.tooltipFeature?.setTooltipAndRefresh(s)}this.cellRendererParams=(0,m._addGridCommonParams)(i,{value:e,valueFormatted:t,colDef:this.params.colDef,column:this.params.column,setTooltip:(e,t)=>{i.assertModuleRegistered("Tooltip",3),this.shouldDisplayTooltip=t,this.tooltipFeature?.setTooltipAndRefresh(e)}})}getFormattedValue(e,t){return this.beans.valueSvc.formatValue(e,null,t,this.valueFormatter,!!this.useFormatterFromColumn)}renderCell(){let e=(0,m._getCellRendererDetails)(this.beans.userCompFactory,this.params,this.cellRendererParams),t=e?.newAgStackInstance();null==t?this.renderCellWithoutCellRenderer():t.then(e=>{e&&(this.cellRendererComponent=e,this.eCheckbox.setLabel(e.getGui()),this.destroyCellRendererComponent=()=>this.destroyBean(e))})}renderCellWithoutCellRenderer(){let{valueFormatted:e,value:t}=this.cellRendererParams,i=(null==e?t:e)??this.translate("blanks");"string"!=typeof i&&((0,m._warn)(208),i=""),this.eCheckbox.setLabel(i),this.setupFixedAriaLabels(i)}getComponentHolder(){return this.params.column.getColDef()}},rM={loadingOoo:"Loading...",blanks:"(Blanks)",searchOoo:"Search...",selectAll:"(Select All)",selectAllSearchResults:"(Select All Search Results)",addCurrentSelectionToFilter:"Add current selection to filter",noMatches:"No matches.",ariaSearchFilterValues:"Search filter values",ariaFilterList:"Filter List",filterSummaryListInactive:"is (All)",filterSummaryListSeparator:", ",filterSummaryListShort:e=>`is (${e[0]})`,filterSummaryListLong:e=>`is (${e[0]}) and ${e[1]} more`};function rR(e,t,i){let s=e;return s?(s=s.map(e=>(0,m._toStringOrNull)((0,m._makeNull)(e))),!t&&i&&s.some(e=>null==e))?null==(0,m._last)(s)?null:s.filter(e=>null!=e):s:null}function rT(e,t,i){return(0,m._translate)(e,rM,t,i)}var rP=class{constructor(e,t,i,s){this.formatter=e,this.treeListPathGetter=t,this.treeListFormatter=i,this.treeDataOrGrouping=s,this.allDisplayedItemsTree=new Map,this.activeDisplayedItemsFlat=[],this.selectAllItem={depth:0,filterPasses:!0,available:!0,treeKey:ry,children:this.allDisplayedItemsTree,expanded:!0,key:ry,parentTreeKeys:[]},this.addSelectionToFilterItem={depth:0,filterPasses:!0,available:!0,treeKey:rw,expanded:!0,key:rw,parentTreeKeys:[]}}updateParams(e,t){this.treeListPathGetter=e,this.treeListFormatter=t}updateDisplayedValuesToAllAvailable(e,t,i,s){"reload"===s?this.generateItemTree(e,t,i):"otherFilter"===s?(this.updateAvailable(i),this.updateExpandAll()):"miniFilter"===s&&(this.resetFilter(),this.updateExpandAll()),this.flattenItems()}updateDisplayedValuesToMatchMiniFilter(e,t,i,s,r,a){"reload"===a?this.generateItemTree(e,t,i):"otherFilter"===a&&this.updateAvailable(i),this.updateFilter(s,r),this.updateExpandAll(),this.flattenItems()}generateItemTree(e,t,i){let s=new Map;this.allDisplayedItemsTree=s;let r=!1,a=this.getTreeListPathGetter(e,i);for(let l of t){let t,n=a(e(l))??[null],o=n.length;o>1&&(r=!0);let d=i.has(l),h=s,u=[];for(let e=0;e<o;e++){let i=n[e];h||(h=new Map,t.children=h);let s=i?.toUpperCase()??null;(t=h.get(s))||(t={treeKey:i,depth:e,filterPasses:!0,expanded:!1,available:d,parentTreeKeys:u},e===n.length-1&&(t.key=l),h.set(s,t)),h=t.children,u=[...u,i]}}this.groupsExist=r,this.updateAvailable(i),this.selectAllItem.children=s,this.selectAllItem.expanded=!1}getTreeListPathGetter(e,t){if(this.treeListPathGetter)return this.treeListPathGetter;if(this.treeDataOrGrouping)return e=>e;let i=!1;for(let s of t){let t=e(s);if(t instanceof Date){i=!0;break}if(null!=t)break}return i?e=>(0,m._getDateParts)(e,!1):((0,m._warn)(211),e=>[String(e)])}flattenItems(){this.activeDisplayedItemsFlat=[];let e=t=>{for(let i of t.values())i.filterPasses&&i.available&&(this.activeDisplayedItemsFlat.push(i),i.children&&i.expanded&&e(i.children))};e(this.allDisplayedItemsTree)}resetFilter(){let e=t=>{let i=t.children;if(i)for(let t of i.values())e(t);t.filterPasses=!0};for(let t of this.allDisplayedItemsTree.values())e(t)}updateFilter(e,t){let i=i=>!!i.available&&(null==i.treeKey?t:e(this.formatter(this.treeListFormatter?this.treeListFormatter(i.treeKey,i.depth,i.parentTreeKeys):i.treeKey)));for(let e of this.allDisplayedItemsTree.values())this.recursiveItemCheck(e,!1,i,"filterPasses")}getDisplayedValueCount(){return this.activeDisplayedItemsFlat.length}getDisplayedItem(e){return this.activeDisplayedItemsFlat[e]}getSelectAllItem(){return this.selectAllItem}getAddSelectionToFilterItem(){return this.addSelectionToFilterItem}getDisplayedKeys(){let e=[];return this.forEachDisplayedKey(t=>e.push(t)),e}forEachDisplayedKey(e){let t=(i,s)=>{let r=i.children;if(r){if(!i.expanded||!s)for(let e of r.values())e.filterPasses&&t(e,!1)}else e(i.key)};for(let e of this.activeDisplayedItemsFlat)t(e,!0)}someDisplayedKey(e){let t=(i,s)=>{let r=i.children;if(!r)return e(i.key);if(!i.expanded||!s){for(let e of r.values())if(e.filterPasses&&t(e,!1))return!0}return!1};return this.activeDisplayedItemsFlat.some(e=>t(e,!0))}hasGroups(){return this.groupsExist}refresh(){this.updateExpandAll(),this.flattenItems()}updateExpandAll(){let e=(t,i,s)=>{for(let r of t.values()){if(!r.filterPasses||!r.available||!r.children)continue;if(i=i||!!r.expanded,s=s||!r.expanded,i&&s)return;let t=e(r.children,i,s);if(void 0===t)return;t?i=!0:s=!0}return i&&s?void 0:i},t=this.getSelectAllItem();t.expanded=e(t.children,!1,!1)}recursiveItemCheck(e,t,i,s){let r=!1,a=e.children;if(a)for(let l of a.values()){let a=this.recursiveItemCheck(l,t||i(e),i,s);r=r||a}let l=t||r||i(e);return e[s]=l,l}updateAvailable(e){let t=t=>e.has(t.key);for(let e of this.allDisplayedItemsTree.values())this.recursiveItemCheck(e,!1,t,"available")}},rI=class extends m.ProvidedFilter{constructor(){super("setFilter","set-filter"),this.filterType="set",this.eMiniFilter=m.RefPlaceholder,this.eFilterLoading=m.RefPlaceholder,this.eFilterLoadingIcon=m.RefPlaceholder,this.eSetFilterList=m.RefPlaceholder,this.eFilterNoMatches=m.RefPlaceholder,this.hardRefreshVirtualList=!1,this.miniFilterText=null,this.addCurrentSelectionToFilter=!1,this.selectedKeys=new Set}setParams(e){super.setParams(e);let t=this.updateHandler(e.getHandler()),{column:i,textFormatter:s,treeList:r,treeListPathGetter:a,treeListFormatter:l}=e;this.formatter=s??(e=>e??null),this.displayValueModel=r?new rP(this.formatter,a,l,t.isTreeDataOrGrouping()):new rS(this.beans.valueSvc,()=>this.handler.valueFormatter,this.formatter,i,()=>this.handler.shouldUseValueFormatterFromColumn()),t.valueModel.allKeys.then(e=>{this.isAlive()&&(this.updateDisplayedValues("reload",e??[]),this.resetSelectionState(e??[]))}),t.valueModel.isLoading()&&this.setIsLoading(!0),this.initialiseFilterBodyUi()}refresh(e){return this.params.treeList===e.treeList&&(this.updateHandler(e.getHandler()),super.refresh(e))}updateParams(e,t){super.updateParams(e,t),this.updateMiniFilter(),e.suppressSelectAll!==t.suppressSelectAll&&this.createVirtualListModel(e);let{textFormatter:i,treeListPathGetter:s,treeListFormatter:r}=e;this.formatter=i??(e=>e??null),this.displayValueModel instanceof rP&&this.displayValueModel.updateParams(s,r),this.handler.refreshFilterValues(!0)}updateHandler(e){if(this.handler!==e){for(let e of this.handlerDestroyFuncs??[])e();this.handlerDestroyFuncs=[...this.addManagedListeners(e,{anyFilterChanged:t=>{e.valueModel.allKeys.then(e=>{this.isAlive()&&(this.updateDisplayedValues("otherFilter",e??[]),t.updated&&(this.checkAndRefreshVirtualList(),this.showOrHideResults()))})},dataChanged:({hardRefresh:t})=>{e.valueModel.allKeys.then(e=>{this.isAlive()&&(this.updateDisplayedValues("reload",e??[]),this.setSelectedModel(this.state.model?.values??null),t&&(this.hardRefreshVirtualList=!0),this.checkAndRefreshVirtualList())})}}),...this.addManagedListeners(e.valueModel,{loadingStart:()=>this.setIsLoading(!0),loadingEnd:()=>this.setIsLoading(!1)})],this.handler=e}return e}updateUiVisibility(){}createBodyTemplate(){return{tag:"div",cls:"ag-set-filter",children:[{tag:"div",ref:"eFilterLoading",cls:"ag-filter-loading ag-loading ag-hidden",children:[{tag:"span",ref:"eFilterLoadingIcon",cls:"ag-loading-icon"},{tag:"span",cls:"ag-loading-text",children:rT(this,"loadingOoo")}]},{tag:"ag-input-text-field",ref:"eMiniFilter",cls:"ag-mini-filter"},{tag:"div",ref:"eFilterNoMatches",cls:"ag-filter-no-matches ag-hidden",children:rT(this,"noMatches")},{tag:"div",ref:"eSetFilterList",cls:"ag-set-filter-list",role:"presentation"}]}}getAgComponents(){return[m.AgInputTextFieldSelector]}handleKeyDown(e){if(super.handleKeyDown(e),e.defaultPrevented)return;let t=()=>{if(!this.eSetFilterList.contains((0,m._getActiveDomElement)(this.beans)))return;let t=this.virtualList.getLastFocusedRow();if(null==t)return;let i=this.virtualList.getComponentAt(t);if(null==i)return;e.preventDefault();let{readOnly:s}=this.params;if(!s)return i};switch(e.key){case m.KeyCode.SPACE:t()?.toggleSelected();break;case m.KeyCode.ENTER:this.handleKeyEnter(e);break;case m.KeyCode.LEFT:t()?.setExpanded(!1);break;case m.KeyCode.RIGHT:t()?.setExpanded(!0)}}handleKeyEnter(e){e.preventDefault();let{excelMode:t,readOnly:i}=this.params;t&&!i&&(this.params.onAction("apply",void 0,e),"mac"===this.params.excelMode&&this.eMiniFilter.getInputElement().select())}setModelAndRefresh(e){return this.setSelectedModel(e).then(()=>{this.isAlive()&&this.checkAndRefreshVirtualList()})}setModelIntoUi(e){this.setMiniFilter(this.params.state.state?.miniFilterValue??null,!0);let t=null==e?null:e.values;return this.setModelAndRefresh(t)}getModelFromUi(){let e=this.getSelectedModel();return e?{values:e,filterType:this.filterType}:null}areNonNullModelsEqual(e,t){return(0,m._areEqual)(e.values,t.values)}setIsLoading(e){(0,m._setDisplayed)(this.eFilterLoading,e),e||(this.hardRefreshVirtualList=!0)}initialiseFilterBodyUi(){this.initVirtualList(),this.initMiniFilter(),this.initLoading()}initLoading(){let e=(0,m._createIconNoSpan)("setFilterLoading",this.beans,this.params.column);e&&this.eFilterLoadingIcon.appendChild(e)}initVirtualList(){let e=rT(this,"ariaFilterList"),t=!!this.params.treeList,i=this.virtualList=this.createBean(new t_({cssIdentifier:"filter",ariaRole:t?"tree":"listbox",listName:e})),s=this.eSetFilterList;t&&s.classList.add("ag-set-filter-tree-list"),s.appendChild(i.getGui());let{cellHeight:r}=this.params;null!=r&&i.setRowHeight(r);let a=(e,i)=>this.createSetListItem(e,t,i);i.setComponentCreator(a);let l=(e,t)=>this.updateSetListItem(e,t);i.setComponentUpdater(l),this.createVirtualListModel(this.params)}createVirtualListModel(e){let t;t=e.suppressSelectAll?new rE(this.displayValueModel):new rD(this.displayValueModel,this.showAddCurrentSelectionToFilter.bind(this)),e.treeList&&(t=new rk(t)),this.virtualList.setModel(t)}getSelectAllLabel(){return rT(this,null!=this.miniFilterText&&this.params.excelMode?"selectAllSearchResults":"selectAll")}getAddSelectionToFilterLabel(){return rT(this,"addCurrentSelectionToFilter")}createSetListItem(e,t,i){let s=this.displayValueModel.hasGroups(),{isSelected:r,isExpanded:a}=this.isSelectedExpanded(e),{value:l,depth:n,isGroup:o,hasIndeterminateExpandState:d,selectedListener:h,expandedListener:u}=this.newSetListItemAttributes(e),c={focusWrapper:i,value:l,params:this.params,translate:e=>rT(this,e),valueFormatter:this.handler.valueFormatter,shouldUseFormatterFromColumn:this.handler.shouldUseValueFormatterFromColumn(),item:e,isSelected:r,isTree:t,depth:n,groupsExist:s,isGroup:o,isExpanded:a,hasIndeterminateExpandState:d},p=this.createBean(new rA(c));return p.addEventListener("selectionChanged",h),u&&p.addEventListener("expandedChanged",u),p}newSetTreeItemAttributes(e){let t=this.displayValueModel.hasGroups();return e.key===ry?{value:()=>this.getSelectAllLabel(),isGroup:t,depth:e.depth,hasIndeterminateExpandState:!0,selectedListener:e=>this.onSelectAll(e.isSelected),expandedListener:e=>this.onExpandAll(e.item,e.isExpanded)}:e.key===rw?{value:()=>this.getAddSelectionToFilterLabel(),depth:e.depth,isGroup:!1,hasIndeterminateExpandState:!1,selectedListener:e=>{this.addCurrentSelectionToFilter=e.isSelected,this.refreshAfterSelection()}}:e.children?{value:this.params.treeListFormatter?.(e.treeKey,e.depth,e.parentTreeKeys)??e.treeKey,depth:e.depth,isGroup:!0,selectedListener:e=>this.onGroupItemSelected(e.item,e.isSelected),expandedListener:e=>this.onExpandedChanged(e.item,e.isExpanded)}:{value:this.params.treeListFormatter?.(e.treeKey,e.depth,e.parentTreeKeys)??e.treeKey,depth:e.depth,selectedListener:e=>this.onItemSelected(e.item.key,e.isSelected)}}newSetListItemAttributes(e){return this.isSetFilterModelTreeItem(e)?this.newSetTreeItemAttributes(e):e===ry?{value:()=>this.getSelectAllLabel(),selectedListener:e=>this.onSelectAll(e.isSelected)}:e===rw?{value:()=>this.getAddSelectionToFilterLabel(),selectedListener:e=>{this.addCurrentSelectionToFilter=e.isSelected,this.refreshAfterSelection()}}:{value:this.handler.valueModel.allValues.get(e)??null,selectedListener:e=>this.onItemSelected(e.item,e.isSelected)}}updateSetListItem(e,t){let{isSelected:i,isExpanded:s}=this.isSelectedExpanded(e);t.refresh(e,i,s)}isSelectedExpanded(e){let t,i;return this.isSetFilterModelTreeItem(e)?(i=e.expanded,t=e.key===ry?this.isSelectAllSelected():e.key===rw?this.isAddCurrentSelectionToFilterChecked():e.children?this.areAllChildrenSelected(e):this.selectedKeys.has(e.key)):t=e===ry?this.isSelectAllSelected():e===rw?this.isAddCurrentSelectionToFilterChecked():this.selectedKeys.has(e),{isSelected:t,isExpanded:i}}isSetFilterModelTreeItem(e){return e?.treeKey!==void 0}initMiniFilter(){let{eMiniFilter:e}=this;this.updateMiniFilter(),e.onValueChange(()=>this.onMiniFilterInput()),e.setInputAriaLabel(rT(this,"ariaSearchFilterValues")),this.addManagedElementListeners(e.getInputElement(),{keydown:e=>this.onMiniFilterKeyDown(e)})}updateMiniFilter(){let{eMiniFilter:e,miniFilterText:t,params:i}=this;e.setDisplayed(!i.suppressMiniFilter),e.setValue(t)}afterGuiAttached(e){super.afterGuiAttached(e),this.resetExpansion(),this.refreshVirtualList();let{eMiniFilter:t}=this;t.setInputPlaceholder(rT(this,"searchOoo")),e?.suppressFocus||(t.isDisplayed()?t.getFocusableElement().focus():this.virtualList.awaitStable(()=>this.virtualList.focusRow(0)))}afterGuiDetached(){super.afterGuiDetached();let{column:e,excelMode:t,model:i,onStateChange:s}=this.params;!this.beans.colFilter?.shouldKeepStateOnDetach(e)&&(t&&this.resetMiniFilter(),(t||i!==this.state.model)&&(s({model:i,state:this.getState()}),this.showOrHideResults()))}canApply(e){return!this.params.excelMode||null==e||e.values.length>0}onNewRowsLoaded(){}setFilterValues(e){(0,m._warn)(283),this.handler.setFilterValues(e)}resetFilterValues(){(0,m._warn)(283),this.handler.resetFilterValues()}refreshFilterValues(){(0,m._warn)(283),this.doRefreshFilterValues()}doRefreshFilterValues(){this.handler.refreshFilterValues()}onAnyFilterChanged(){}onMiniFilterInput(e){if(!this.doSetMiniFilter(this.eMiniFilter.getValue()))return;if(e)return void this.showOrHideResults();let{applyMiniFilterWhileTyping:t,readOnly:i,excelMode:s}=this.params,r=!i&&(t||!!s),a=t&&!i?"debounce":void 0;this.updateUiAfterMiniFilterChange(r,a)}updateUiAfterMiniFilterChange(e,t){if(e){let{excelMode:e,readOnly:t,model:i}=this.params;e&&!t&&null==this.miniFilterText?this.setModelAndRefresh(i?.values??null):this.selectAllMatchingMiniFilter(!0)}this.checkAndRefreshVirtualList(),this.onUiChanged(e?t:"prevent"),this.showOrHideResults()}showOrHideResults(){let e=null!=this.miniFilterText&&1>this.displayValueModel.getDisplayedValueCount();(0,m._setDisplayed)(this.eFilterNoMatches,e),(0,m._setDisplayed)(this.eSetFilterList,!e)}resetMiniFilter(){this.eMiniFilter.setValue(null,!0),this.doSetMiniFilter(null)}onMiniFilterKeyDown(e){let{excelMode:t,readOnly:i}=this.params;e.key!==m.KeyCode.ENTER||t||i||this.updateUiAfterMiniFilterChange(!0,"immediately")}focusRowIfAlive(e){return null==e?Promise.resolve():new Promise(t=>{window.setTimeout(()=>{this.isAlive()&&this.virtualList.focusRow(e),t()},0)})}onSelectAll(e){e?this.selectAllMatchingMiniFilter():this.deselectAllMatchingMiniFilter(),this.refreshAfterSelection()}onGroupItemSelected(e,t){let i=e=>{if(!e.filterPasses)return;let s=e.children;if(s)for(let e of s.values())i(e);else this.setKeySelected(e.key,t)};i(e),this.refreshAfterSelection()}onItemSelected(e,t){this.setKeySelected(e,t),this.refreshAfterSelection()}onExpandAll(e,t){let i=e=>{if(e.filterPasses&&e.available&&e.children){for(let t of e.children.values())i(t);e.expanded=t}};i(e),this.refreshAfterExpansion()}onExpandedChanged(e,t){e.expanded=t,this.refreshAfterExpansion()}refreshAfterExpansion(){let e=this.virtualList.getLastFocusedRow();this.updateDisplayedValues("expansion"),this.checkAndRefreshVirtualList(),this.focusRowIfAlive(e)}refreshAfterSelection(){let e=this.virtualList.getLastFocusedRow();this.checkAndRefreshVirtualList(),this.onUiChanged(),this.focusRowIfAlive(e)}setMiniFilter(e,t){this.eMiniFilter.setValue(e,t),this.onMiniFilterInput(t)}doSetMiniFilter(e){return e=(0,m._makeNull)(e),this.miniFilterText!==e&&(null===e&&(this.addCurrentSelectionToFilter=!1),this.miniFilterText=e,this.updateDisplayedValues("miniFilter"),!0)}getMiniFilter(){return this.miniFilterText}getUiChangeEventParams(){return{miniFilterValue:this.miniFilterText}}getState(){let e=this.miniFilterText;return e?{miniFilterValue:e}:void 0}checkAndRefreshVirtualList(){this.virtualList.refresh(!this.hardRefreshVirtualList),this.hardRefreshVirtualList&&(this.hardRefreshVirtualList=!1)}getFilterKeys(){return(0,m._warn)(283),this.handler.getFilterKeys()}getFilterValues(){return(0,m._warn)(283),this.handler.getFilterValues()}refreshVirtualList(){this.params.refreshValuesOnOpen?this.doRefreshFilterValues():this.checkAndRefreshVirtualList()}isSelectAllSelected(){if(this.params.defaultToNothingSelected){if(this.hasSelections()&&this.isEverythingVisibleSelected())return!0;if(this.isNothingVisibleSelected())return!1}else{if(this.hasSelections()&&this.isNothingVisibleSelected())return!1;if(this.isEverythingVisibleSelected())return!0}}areAllChildrenSelected(e){let t=e=>{if(!e.children)return this.selectedKeys.has(e.key);{let i=!1,s=!1;for(let r of e.children.values()){if(!r.filterPasses||!r.available)continue;let e=t(r);if(void 0===e||(e?i=!0:s=!0,i&&s))return}return i}};return this.params.defaultToNothingSelected?this.hasSelections()&&t(e):t(e)}resetExpansion(){if(!this.params.treeList)return;let e=this.displayValueModel.getSelectAllItem();if(this.isSetFilterModelTreeItem(e)){let t=e=>{let i=e.children;if(i){for(let e of i.values())t(e);e.expanded=!1}};t(e),this.updateDisplayedValues("expansion")}}getModelAsString(e){return this.handler.getModelAsString(e)}getPositionableElement(){return this.eSetFilterList}updateDisplayedValues(e,t){if("expansion"===e)return void this.displayValueModel.refresh();let i=this.handler,s=i.valueModel;if(null==this.miniFilterText)return void this.displayValueModel.updateDisplayedValuesToAllAvailable(e=>s.allValues.get(e)??null,t,s.availableKeys,e);let r=i.caseFormat(this.formatter(this.miniFilterText)||""),a=e=>null!=e&&i.caseFormat(e).includes(r),l=!!this.params.excelMode&&a(rT(this,"blanks"));this.displayValueModel.updateDisplayedValuesToMatchMiniFilter(e=>s.allValues.get(e)??null,t,s.availableKeys,a,l,e)}hasSelections(){return this.params.defaultToNothingSelected?this.selectedKeys.size>0:this.handler.valueModel.allValues.size!==this.selectedKeys.size}isInWindowsExcelMode(){return"windows"===this.params.excelMode}isAddCurrentSelectionToFilterChecked(){return this.isInWindowsExcelMode()&&this.addCurrentSelectionToFilter}showAddCurrentSelectionToFilter(){return this.isInWindowsExcelMode()&&(0,m._exists)(this.miniFilterText)&&this.miniFilterText.length>0}selectAllMatchingMiniFilter(e=!1){null==this.miniFilterText?this.selectedKeys=new Set(this.handler.valueModel.allValues.keys()):(e&&this.selectedKeys.clear(),this.displayValueModel.forEachDisplayedKey(e=>this.selectedKeys.add(e)))}deselectAllMatchingMiniFilter(){null==this.miniFilterText?this.selectedKeys.clear():this.displayValueModel.forEachDisplayedKey(e=>this.selectedKeys.delete(e))}setKeySelected(e,t){t?this.selectedKeys.add(e):(this.params.excelMode&&this.isEverythingVisibleSelected()&&this.resetSelectionState(this.displayValueModel.getDisplayedKeys()),this.selectedKeys.delete(e))}isEverythingVisibleSelected(){return!this.displayValueModel.someDisplayedKey(e=>!this.selectedKeys.has(e))}isNothingVisibleSelected(){return!this.displayValueModel.someDisplayedKey(e=>this.selectedKeys.has(e))}getSelectedModel(){if(!this.hasSelections())return null;let e=this.isAddCurrentSelectionToFilterChecked()?this.params.model?.values:void 0;return e?.length?this.selectedKeys?Array.from(new Set([...e,...this.selectedKeys])):Array.from(e):Array.from(this.selectedKeys)}setSelectedModel(e){let t=this.handler,i=t.valueModel;return i.allKeys.then(s=>{if(null==e)this.resetSelectionState(s??[]);else{this.selectedKeys.clear();let s=new Map;i.allValues.forEach((e,i)=>{s.set(t.caseFormat(i),i)}),e.forEach(e=>{let i=t.caseFormat((0,m._makeNull)(e)),r=s.get(i);void 0!==r&&this.selectedKeys.add(r)})}})}resetSelectionState(e){this.params.defaultToNothingSelected?this.selectedKeys.clear():this.selectedKeys=new Set(e)}getFilterHandler(){return this.handler}destroy(){for(let e of(this.virtualList=this.destroyBean(this.virtualList),this.handlerDestroyFuncs??[]))e();this.handler=void 0,this.displayValueModel=void 0,this.selectedKeys.clear(),super.destroy()}},rE=class{constructor(e){this.model=e}getRowCount(){return this.model.getDisplayedValueCount()}getRow(e){return this.model.getDisplayedItem(e)}areRowsEqual(e,t){return e===t}},rD=class{constructor(e,t){this.model=e,this.showAddCurrentSelectionToFilter=t}getRowCount(){let e=this.showAddCurrentSelectionToFilter();return this.model.getDisplayedValueCount()+(e?2:1)}getRow(e){if(0===e)return this.model.getSelectAllItem();let t=this.showAddCurrentSelectionToFilter();return 1===e&&t?this.model.getAddSelectionToFilterItem():this.model.getDisplayedItem(e-(t?2:1))}areRowsEqual(e,t){return e===t}},rk=class{constructor(e){this.model=e}getRowCount(){return this.model.getRowCount()}getRow(e){return this.model.getRow(e)}areRowsEqual(e,t){return null==e&&null==t||null!=e&&null!=t&&e.treeKey===t.treeKey&&e.depth===t.depth}},rL=class extends m.BeanStub{constructor(e,t,i,s,r){super(),this.createKey=e,this.caseFormat=t,this.getValue=i,this.isTreeDataOrGrouping=s,this.isTreeData=r}extractUniqueValuesAsync(e,t){return new m.AgPromise(i=>{if(this.beans.rowModel.rowCountReady)i(this.extractUniqueValues(e,t));else{let[s]=this.addManagedEventListeners({rowCountReady:()=>{s?.(),i(this.extractUniqueValues(e,t))}})}})}extractUniqueValues(e,t){let i=new Map,s=this.extractExistingFormattedKeys(t),r=new Set,a=this.isTreeData(),l=this.isTreeDataOrGrouping(),n=this.beans.rowGroupColsSvc?.columns,o=this.gos.get("groupAllowUnbalanced"),d=(e,a)=>{let l=this.caseFormat(e);if(!r.has(l)){r.add(l);let n=e,o=(0,m._makeNull)(a),d=s?.get(l);null!=d&&(n=d,o=t.get(d)),i.set(n,o)}};return this.beans.rowModel.forEachLeafNode(t=>{if(!t.data||!e(t))return;if(l)return void this.addValueForTreeDataOrGrouping(t,a,n,d,o);let i=this.getValue(t);if(null!=i&&Array.isArray(i)){for(let e of i)d(this.createKey(e,t),e);0===i.length&&d(null,null)}else d(this.createKey(i,t),i)}),i}addValueForTreeDataOrGrouping(e,t,i=[],s,r){let a;if(t){if(e.childrenAfterGroup?.length)return;a=e.getRoute()??[e.key??e.id]}else(a=i.map(t=>this.beans.valueSvc.getKeyForNode(t,e))).push(this.getValue(e));let l=rR(a,t,r);s(this.createKey(l),l)}extractExistingFormattedKeys(e){if(!e)return null;let t=new Map;return e.forEach((e,i)=>{t.set(this.caseFormat(i),i)}),t}},rN=class{constructor(e){this.caseFormat=e,this.keys=null}isNull(){return null==this.keys}isEmpty(){return!this.keys?.size}update(e){let t=new Set;this.keys=t;let i=e?.values;if(i){let e=this.caseFormat;for(let s=0,r=i.length;s<r;s++)t.add(e(i[s]))}}has(e){return!!this.keys?.has(this.caseFormat(e))}destroy(){this.keys=null}},rG=((t=rG||{})[t.PROVIDED_LIST=0]="PROVIDED_LIST",t[t.PROVIDED_CALLBACK=1]="PROVIDED_CALLBACK",t[t.TAKEN_FROM_GRID_VALUES=2]="TAKEN_FROM_GRID_VALUES",t),rO=class extends m.BeanStub{constructor(e,t,i,s,r){super(),this.clientSideValuesExtractor=e,this.caseFormat=t,this.createKey=i,this.isTreeDataOrGrouping=s,this.params=r,this.allValues=new Map,this.availableKeys=new Set,this.providedValues=null,this.initialised=!1}postConstruct(){let e=this.params,t=e.handlerParams.filterParams.values;this.updateParams(e),null==t?this.valuesType=2:(this.valuesType=+!Array.isArray(t),this.providedValues=t),this.updateAllValues()}refresh(e){let t=e.handlerParams;if("colDef"!==t.source)return;let{values:i,suppressSorting:s}=t.filterParams,r=this.providedValues,a=this.params.handlerParams.filterParams.suppressSorting;this.params=e,this.updateParams(e),this.providedValues=i??null,(this.providedValues!==r||s!==a)&&(i&&0!==i.length?this.valuesType=+!Array.isArray(i):(this.valuesType=2,this.providedValues=null),this.updateAllValues())}updateParams(e){let t,{handlerParams:{colDef:i,filterParams:{comparator:s,treeList:r,treeListPathGetter:a}},usingComplexObjects:l}=e,n=s??i.comparator,o=this.isTreeDataOrGrouping();t=o&&!n?([e,t],[i,s])=>{if(null==t)return null==s?0:-1;if(null==s)return 1;for(let e=0;e<t.length;e++){if(e>=s.length)return 1;let i=(0,m._defaultComparator)(t[e],s[e]);if(0!==i)return i}return 0}:!r||a||n?([e,t],[i,s])=>n(t,s):([e,t],[i,s])=>(0,m._defaultComparator)(t,s),this.entryComparator=t,this.keyComparator=n??m._defaultComparator,this.compareByValue=!!(l&&n||o||r&&!a)}updateAllValues(){return this.allKeys=new m.AgPromise(e=>{switch(this.valuesType){case 2:this.getValuesFromRowsAsync().then(t=>e(this.processAllValues(t)));break;case 0:e(this.processAllValues(this.uniqueValues(this.validateProvidedValues(this.providedValues))));break;case 1:{this.dispatchLocalEvent({type:"loadingStart"});let t=this.providedValues,{column:i,colDef:s}=this.params.handlerParams,r=(0,m._addGridCommonParams)(this.gos,{success:t=>{this.dispatchLocalEvent({type:"loadingEnd"}),e(this.processAllValues(this.uniqueValues(this.validateProvidedValues(t))))},colDef:s,column:i});window.setTimeout(()=>t(r),0)}}}),this.allKeys.then(e=>{this.updateAvailableKeys(e??[]),this.initialised=!0}),this.allKeys}getAvailableValues(e){return this.sortKeys(this.getValuesFromRows(e))}overrideValues(e){return this.allKeys.then(()=>{this.valuesType=0,this.providedValues=e})}refreshAvailable(){return new m.AgPromise(e=>{this.showAvailableOnly()?this.allKeys.then(t=>{this.updateAvailableKeys(t??[]),e(!0)}):e(!1)})}refreshAll(){return new m.AgPromise(e=>{this.allKeys.then(()=>{this.updateAllValues().then(()=>{e()})})})}isLoading(){return!this.initialised&&1===this.valuesType}isInitialised(){return this.initialised}getValueForFormatter(e){return this.initialised?this.allValues.get(e):e}getAvailableKeys(e){return this.initialised?e.filter(e=>this.availableKeys.has(e)):e}getParamsForValuesFromRows(e){return this.clientSideValuesExtractor?e&&!this.params.handlerParams.filterParams.caseSensitive?this.allValues:void 0:void(0,m._error)(113)}getValuesFromRows(e){let t=this.getParamsForValuesFromRows(!0);return this.clientSideValuesExtractor?.extractUniqueValues(e,t)??null}getValuesFromRowsAsync(){let e=this.getParamsForValuesFromRows(!1);return this.clientSideValuesExtractor?.extractUniqueValuesAsync(()=>!0,e)??m.AgPromise.resolve(null)}processAllValues(e){let t=this.sortKeys(e);return this.allValues=e??new Map,t}uniqueValues(e){let t=new Map,i=new Set,{caseFormat:s,createKey:r}=this;for(let a of e??[]){let e=(0,m._makeNull)(a),l=r(e),n=s(l);i.has(n)||(i.add(n),t.set(l,e))}return t}validateProvidedValues(e){if(this.params.usingComplexObjects&&e?.length){let t=e[0];t&&"object"!=typeof t&&"function"!=typeof t&&(null==this.createKey(t)?(0,m._warn)(209):(0,m._warn)(210))}return e}sortKeys(e){let t,i=e??new Map,s=this.params.handlerParams.filterParams;return s.suppressSorting?Array.from(i.keys()):(t=this.compareByValue?Array.from(i.entries()).sort(this.entryComparator).map(([e])=>e):Array.from(i.keys()).sort(this.keyComparator),s.excelMode&&i.has(null)&&(t=t.filter(e=>null!=e)).push(null),t)}showAvailableOnly(){return 2===this.valuesType}updateAvailableKeys(e){let t=this.showAvailableOnly()?this.getAvailableValues(e=>this.params.handlerParams.doesRowPassOtherFilter(e)):e;this.availableKeys=new Set(t),window.setTimeout(()=>{this.isAlive()&&this.dispatchLocalEvent({type:"availableValuesChanged"})})}},rB={tag:"div",cls:"ag-floating-filter-input ag-set-floating-filter-input",role:"presentation",children:[{tag:"ag-input-text-field",ref:"eFloatingFilterText"}]},rV=class extends m.Component{constructor(){super(rB,[m.AgInputTextFieldSelector]),this.eFloatingFilterText=m.RefPlaceholder}init(e){this.params=e,this.eFloatingFilterText.setDisabled(!0).addGuiEventListener("click",()=>this.params.showParentFilter()),this.setParams(e)}setParams(e){let t=this.beans.colNames.getDisplayNameForColumn(e.column,"header",!0),i=this.getLocaleTextFunc();this.eFloatingFilterText.setInputAriaLabel(`${t} ${i("ariaFilterInput","Filter Input")}`),this.gos.get("enableFilterHandlers")&&this.updateFloatingFilterText(e.model)}refresh(e){this.params=e,this.setParams(e)}onParentModelChanged(e){this.updateFloatingFilterText(e)}parentSetFilterInstance(e){this.params.parentFilterInstance(t=>{t instanceof rI?e(t):(0,m._error)(248)})}updateFloatingFilterText(e){null==e?this.eFloatingFilterText.setValue(""):this.gos.get("enableFilterHandlers")?this.eFloatingFilterText.setValue(this.params.getHandler().getModelAsString?.(e)??""):this.parentSetFilterInstance(t=>{this.eFloatingFilterText.setValue(t.getModelAsString(e))})}},r_={moduleName:"SetFilter",version:tv,userComponents:{agSetColumnFilter:{classImp:rI,params:{useForm:!0},processParams:e=>("windows"===e.excelMode?(e.buttons||(e.buttons=["apply","cancel"]),null==e.closeOnApply&&(e.closeOnApply=!0)):"mac"===e.excelMode&&(e.buttons||(e.buttons=["reset"]),null==e.applyMiniFilterWhileTyping&&(e.applyMiniFilterWhileTyping=!0),null==e.debounceMs&&(e.debounceMs=500)),e.excelMode&&e.defaultToNothingSelected&&(e.defaultToNothingSelected=!1,(0,m._warn)(207)),e)},agSetColumnFloatingFilter:rV},dynamicBeans:{agSetColumnFilterHandler:class extends m.BeanStub{constructor(){super(...arguments),this.filterType="set",this.treeDataTreeList=!1,this.groupingTreeList=!1,this.caseSensitive=!1,this.noValueFormatterSupplied=!1,this.useValueFormatterFromColumn=!1}init(e){this.updateParams(e);let t=this.isTreeDataOrGrouping.bind(this),i=()=>this.treeDataTreeList,s=this.createKey,r=this.caseFormat.bind(this),{gos:a,beans:l}=this,n=(0,m._isClientSideRowModel)(a,l.rowModel)?this.createManagedBean(new rL(s,r,e.getValue,t,i)):void 0,o=this.createManagedBean(new rO(n,r,s,t,{handlerParams:e,usingComplexObjects:!!(e.filterParams.keyCreator??e.colDef.keyCreator)}));this.addManagedListeners(o,{availableValuesChanged:e.onModelAsStringChange}),this.valueModel=o,this.appliedModel=new rN(this.caseFormat.bind(this)),this.appliedModel.update(e.model),this.validateModel(e),this.addEventListenersForDataChanges()}refresh(e){this.updateParams(e),this.valueModel.refresh({handlerParams:e,usingComplexObjects:!!(e.filterParams.keyCreator??e.colDef.keyCreator)}),this.appliedModel.update(e.model),this.validateModel(e)}updateParams(e){this.params=e;let{colDef:t,filterParams:{caseSensitive:i,treeList:s,keyCreator:r}}=e;this.caseSensitive=!!i;let a=!!t.showRowGroup;this.treeDataTreeList=this.gos.get("treeData")&&!!s&&a,this.groupingTreeList=!!this.beans.rowGroupColsSvc?.columns.length&&!!s&&a;let l=r??t.keyCreator;this.createKey=this.generateCreateKey(l,this.isTreeDataOrGrouping()),this.setValueFormatter(l,e)}doesFilterPass(e){let{appliedModel:t,treeDataTreeList:i,groupingTreeList:s}=this;if(t.isNull())return!0;if(t.isEmpty())return!1;let{node:r}=e;if(i)return this.doesFilterPassForTreeData(r);if(s)return this.doesFilterPassForGrouping(r);let a=this.params.getValue(r);return null!=a&&Array.isArray(a)?0===a.length?t.has(null):a.some(e=>t.has(this.createKey(e,r))):t.has(this.createKey(a,r))}getFormattedValue(e){let t=this.valueModel.getValueForFormatter(e);this.isTreeDataOrGrouping()&&Array.isArray(t)&&(this.noValueFormatterSupplied||this.useValueFormatterFromColumn)&&(t=(0,m._last)(t));let i=this.beans.valueSvc.formatValue(this.params.column,null,t,this.valueFormatter,this.useValueFormatterFromColumn);return(null==i?(0,m._toStringOrNull)(t):i)??rT(this,"blanks")}getModelAsString(e,t){let{values:i}=e??{},s="filterToolPanel"===t;if(null==i)return s?rT(this,"filterSummaryListInactive"):"";let r=this.valueModel.getAvailableKeys(i),a=r.length,l=r.slice(0,s?3:10).map(e=>this.getFormattedValue(e));if(s){let e=l.join(rT(this,"filterSummaryListSeparator"));return a>3?rT(this,"filterSummaryListLong",[e,String(a-3)]):rT(this,"filterSummaryListShort",[e])}return`(${a}) ${l.join(",")}${a>10?",...":""}`}onAnyFilterChanged(){window.setTimeout(()=>{this.isAlive()&&this.valueModel.refreshAvailable().then(e=>{this.dispatchLocalEvent({type:"anyFilterChanged",updated:!!e})})})}onNewRowsLoaded(){this.syncAfterDataChange()}setFilterValues(e){this.valueModel.overrideValues(e).then(()=>{this.refreshFilterValues()})}resetFilterValues(){this.valueModel.valuesType=rG.TAKEN_FROM_GRID_VALUES,this.syncAfterDataChange()}refreshFilterValues(e){this.valueModel.isInitialised()&&this.valueModel.refreshAll().then(()=>{this.dispatchLocalEvent({type:"dataChanged",hardRefresh:!0}),this.validateModel(this.params,void 0,!e)})}getFilterKeys(){return Array.from(this.valueModel.allValues.keys())}getFilterValues(){return Array.from(this.valueModel.allValues.values())}isTreeDataOrGrouping(){return this.treeDataTreeList||this.groupingTreeList}caseFormat(e){return null==e||"string"!=typeof e||this.caseSensitive?e:e.toUpperCase()}addEventListenersForDataChanges(){this.addManagedPropertyListeners(["groupAllowUnbalanced"],()=>this.syncAfterDataChange());let e=(0,m._debounce)(this,this.syncAfterDataChange.bind(this),0);this.addManagedEventListeners({cellValueChanged:t=>{t.column===this.params.column&&e()}})}syncAfterDataChange(){this.isValuesTakenFromGrid()&&this.valueModel.refreshAll().then(()=>{this.dispatchLocalEvent({type:"dataChanged"}),this.validateModel(this.params,{afterDataChange:!0})})}validateModel(e,t,i){let s=this.valueModel;s.allKeys.then(()=>{let r=e.model;if(null==r)return;let a=new Map,l=e=>a.set(this.caseFormat(e),e);if(i)for(let e of s.availableKeys)l(e);else s.allValues.forEach((e,t)=>l(t));let n=[],o=!1;for(let e of r.values){let t=this.caseFormat((0,m._makeNull)(e)),i=a.get(t);void 0!==i?(n.push(i),i!==e&&(o=!0)):o=!0}let d=n.length,h=e.filterParams;if(0===d&&h.excelMode)return void e.onModelChange(null,t);let u=!h.defaultToNothingSelected&&(this.valueModel.valuesType===rG.TAKEN_FROM_GRID_VALUES||!h.suppressClearModelOnRefreshValues)&&d===a.size;if(o||!r.filterType||u){let i=u?null:{filterType:this.filterType,values:n};e.onModelChange(i,t)}})}isValuesTakenFromGrid(){return this.valueModel.valuesType===rG.TAKEN_FROM_GRID_VALUES}doesFilterPassForTreeData(e){if(e.childrenAfterGroup?.length)return!1;let{gos:t,appliedModel:i}=this;return i.has(this.createKey(rR(e.getRoute()??[e.key??e.id],!0,t.get("groupAllowUnbalanced"))))}doesFilterPassForGrouping(e){let{appliedModel:t,params:i,gos:s,beans:{rowGroupColsSvc:r,valueSvc:a}}=this,l=(r?.columns??[]).map(t=>a.getKeyForNode(t,e));return l.push(i.getValue(e)),t.has(this.createKey(rR(l,!1,s.get("groupAllowUnbalanced"))))}generateCreateKey(e,t){return t&&!e?((0,m._error)(250),()=>null):e?(t,i=null)=>{let s=this.getKeyCreatorParams(t,i);return(0,m._makeNull)(e(s))}:e=>(0,m._makeNull)((0,m._toStringOrNull)(e))}getKeyCreatorParams(e,t=null){let{colDef:i,column:s}=this.params;return(0,m._addGridCommonParams)(this.gos,{value:e,colDef:i,column:s,node:t,data:t?.data})}setValueFormatter(e,t){let{colDef:{refData:i,valueFormatter:s},filterParams:{treeList:r,valueFormatter:a}}=t;if(e&&!(a||r||s)){(0,m._error)(249),this.valueFormatter=void 0,this.noValueFormatterSupplied=!0,this.useValueFormatterFromColumn=!1;return}let l=a;l||s||i||(l=e=>(0,m._toStringOrNull)(e.value)),this.valueFormatter=l,this.noValueFormatterSupplied=!a&&!s,this.useValueFormatterFromColumn=!a&&!!s}shouldUseValueFormatterFromColumn(){return this.useValueFormatterFromColumn&&!this.valueFormatter}getCrossFilterModel(e){let{createKey:t,valueModel:i,params:s}=this;return e(t,i.availableKeys,s.model?.values)}destroy(){this.appliedModel.destroy(),super.destroy(),this.valueModel=void 0}}},icons:{setFilterGroupClosed:"tree-closed",setFilterGroupOpen:"tree-open",setFilterGroupIndeterminate:"tree-indeterminate",setFilterLoading:"loading"},dependsOn:[tb,m._ColumnFilterModule]},rz={name:"statusPanel",optionalMethods:["refresh"]},rH={agAggregationComponent:{rowModels:["clientSide","serverSide"],warnArgs:[221]},agFilteredRowCountComponent:{rowModels:["clientSide"],warnArgs:[222]},agSelectedRowCountComponent:{rowModels:["clientSide","serverSide"],warnArgs:[223]},agTotalAndFilteredRowCountComponent:{rowModels:["clientSide"],warnArgs:[224]},agTotalRowCountComponent:{rowModels:["clientSide"],warnArgs:[225]}},rU={tag:"div",cls:"ag-status-bar",children:[{tag:"div",ref:"eStatusBarLeft",cls:"ag-status-bar-left",role:"status"},{tag:"div",ref:"eStatusBarCenter",cls:"ag-status-bar-center",role:"status"},{tag:"div",ref:"eStatusBarRight",cls:"ag-status-bar-right",role:"status"}]},rW=class extends m.Component{constructor(){super(rU),this.updateQueued=!1,this.panelsPromise=m.AgPromise.resolve(),this.eStatusBarLeft=m.RefPlaceholder,this.eStatusBarCenter=m.RefPlaceholder,this.eStatusBarRight=m.RefPlaceholder,this.compDestroyFunctions={},this.registerCSS(".ag-status-bar{border-top:var(--ag-footer-row-border);display:flex;justify-content:space-between;line-height:1.5;overflow:hidden;padding-left:calc(var(--ag-spacing)*4);padding-right:calc(var(--ag-spacing)*4)}.ag-status-panel,:where(.ag-status-panel.ag-status-panel-aggregations .ag-status-name-value){display:inline-flex}.ag-status-name-value{color:var(--ag-status-bar-label-color);font-weight:var(--ag-status-bar-label-font-weight);margin-left:var(--ag-spacing);margin-right:var(--ag-spacing);padding-bottom:var(--ag-widget-container-vertical-padding);padding-top:var(--ag-widget-container-vertical-padding);white-space:nowrap}.ag-status-name-value-value{color:var(--ag-status-bar-value-color);font-weight:var(--ag-status-bar-value-font-weight)}.ag-status-bar-left{display:inline-flex}.ag-status-bar-center{display:inline-flex;text-align:center}.ag-status-bar-right{display:inline-flex}")}wireBeans(e){this.userCompFactory=e.userCompFactory,this.statusBarSvc=e.statusBarSvc}postConstruct(){this.processStatusPanels(new Map),this.addManagedPropertyListeners(["statusBar"],this.handleStatusBarChanged.bind(this))}getValidPanels(){let e=this.gos,t=e.get("statusBar")?.statusPanels;return t?t.filter(t=>{let{rowModels:i,warnArgs:s}=rH[t.statusPanel]??{};return!!(!i||i.includes(e.get("rowModelType")))||((0,m._warn)(...s),!1)}):t}processStatusPanels(e){let t=this.getValidPanels();if(t){let i=t.filter(e=>"left"===e.align),s=t.filter(e=>"center"===e.align),r=t.filter(e=>!e.align||"right"===e.align);this.panelsPromise=m.AgPromise.all([this.createAndRenderComponents(i,this.eStatusBarLeft,e),this.createAndRenderComponents(s,this.eStatusBarCenter,e),this.createAndRenderComponents(r,this.eStatusBarRight,e)])}else this.setDisplayed(!1)}handleStatusBarChanged(){this.updateQueued||(this.updateQueued=!0,this.panelsPromise.then(()=>{this.updateStatusBar(),this.updateQueued=!1}))}updateStatusBar(){let e=this.getValidPanels(),t=Array.isArray(e)&&e.length>0;this.setDisplayed(t);let i=new Map;if(t)for(let t of e){let e=t.key??t.statusPanel,s=this.statusBarSvc.getStatusPanel(e);if(s?.refresh){let r=(0,m._addGridCommonParams)(this.gos,{...t.statusPanelParams??{},key:e});s.refresh(r)&&(i.set(e,s),delete this.compDestroyFunctions[e],(0,m._removeFromParent)(s.getGui()))}}this.resetStatusBar(),t&&this.processStatusPanels(i)}resetStatusBar(){(0,m._clearElement)(this.eStatusBarLeft),(0,m._clearElement)(this.eStatusBarCenter),(0,m._clearElement)(this.eStatusBarRight),this.destroyComponents(),this.statusBarSvc.unregisterAllComponents()}destroy(){this.destroyComponents(),super.destroy()}destroyComponents(){for(let e of Object.values(this.compDestroyFunctions))e();this.compDestroyFunctions={}}createAndRenderComponents(e,t,i){let s=[];for(let t of e){let e,l=t.key||t.statusPanel,n=i.get(l);if(n)e=m.AgPromise.resolve(n);else{var r,a;let i=(r=this.userCompFactory,a=(0,m._addGridCommonParams)(this.gos,{key:l}),r.getCompDetails(t,rz,void 0,a,!0));if(null==i)continue;e=i.newAgStackInstance()}s.push({key:l,promise:e})}return m.AgPromise.all(s.map(e=>e.promise)).then(()=>{for(let e of s)e.promise.then(i=>{let s=()=>{this.destroyBean(i)};this.isAlive()?(this.statusBarSvc.registerStatusPanel(e.key,i),t.appendChild(i.getGui()),this.compDestroyFunctions[e.key]=s):s()})})}},rK={tag:"div",cls:"ag-status-name-value",children:[{tag:"span",ref:"eLabel"},":",{tag:"span",ref:"eValue",cls:"ag-status-name-value-value"}]},r$=BigInt(Number.MIN_SAFE_INTEGER),rj=BigInt(Number.MAX_SAFE_INTEGER),rY=class extends m.Component{constructor(){super(rK),this.eLabel=m.RefPlaceholder,this.eValue=m.RefPlaceholder}setLabel(e,t){this.setDisplayed(!1),this.eLabel.textContent=this.getLocaleTextFunc()(e,t)}setValue(e,t){let i,s=null;"bigint"==typeof e?(i=e,e>=r$&&e<=rj&&(s=Number(e))):s=e,this.eValue.textContent=this.valueFormatter((0,m._addGridCommonParams)(this.gos,{value:s,bigintValue:i,totalRows:t,key:this.key}))}},rq={selector:"AG-NAME-VALUE",component:rY},rZ=e=>{let t=0;return e.forEachNodeAfterFilter(e=>{e.data&&t++}),t},rX=e=>{let t=0;return e.forEachNode(e=>{e.data&&t++}),t},rJ={tag:"div",cls:"ag-status-panel ag-status-panel-aggregations",children:[{tag:"ag-name-value",ref:"avgAggregationComp"},{tag:"ag-name-value",ref:"countAggregationComp"},{tag:"ag-name-value",ref:"minAggregationComp"},{tag:"ag-name-value",ref:"maxAggregationComp"},{tag:"ag-name-value",ref:"sumAggregationComp"}]},rQ=class extends m.Component{constructor(){super(rJ,[rq]),this.sumAggregationComp=m.RefPlaceholder,this.countAggregationComp=m.RefPlaceholder,this.minAggregationComp=m.RefPlaceholder,this.maxAggregationComp=m.RefPlaceholder,this.avgAggregationComp=m.RefPlaceholder}postConstruct(){this.avgAggregationComp.setLabel("avg","Average"),this.countAggregationComp.setLabel("count","Count"),this.minAggregationComp.setLabel("min","Min"),this.maxAggregationComp.setLabel("max","Max"),this.sumAggregationComp.setLabel("sum","Sum"),this.addManagedEventListeners({cellSelectionChanged:this.onCellSelectionChanged.bind(this),modelUpdated:this.onCellSelectionChanged.bind(this)})}init(e){this.refresh(e)}refresh(e){this.params=e;let t=e.valueFormatter??(e=>{var t;let{value:i,bigintValue:s}=e;return null!=s?s.toString():(t=this.getLocaleTextFunc.bind(this),"number"!=typeof i?"":(0,m._formatNumberCommas)(Math.round(100*i)/100,t))});for(let e of["avg","count","min","max","sum"]){let i=this.getAllowedAggregationValueComponent(e);i&&(i.key=e,i.valueFormatter=t.bind(this))}return this.onCellSelectionChanged(),!0}setAggregationComponentValue(e,t,i){let s=this.getAllowedAggregationValueComponent(e),r=rX(this.beans.rowModel);(0,m._exists)(s)&&s?(s.setValue(t,r),s.setDisplayed(i)):this.getAggregationValueComponent(e)?.setDisplayed(!1)}getAllowedAggregationValueComponent(e){let{aggFuncs:t}=this.params;return!t||t.includes(e)?this.getAggregationValueComponent(e):null}getAggregationValueComponent(e){return this[`${e}AggregationComp`]}onCellSelectionChanged(){let e,t=this.beans,{rangeSvc:i,valueSvc:s}=t,r=i?.getCellRanges(),a=0,l=0n,n=!1,o=!1,d=0,h=0,u=null,c=null,p=null,g=null,f=e=>{if("number"==typeof e)if(a+=e,(null===u||e<u)&&(u=e),(null===c||e>c)&&(c=e),Number.isInteger(e)&&Number.isSafeInteger(e)){let t=BigInt(e);l+=t,(null===p||t<p)&&(p=t),(null===g||t>g)&&(g=t)}else o=!0;else{n=!0,l+=e,(null===p||e<p)&&(p=e),(null===g||e>g)&&(g=e);let t=Number(e);a+=t,(null===u||t<u)&&(u=t),(null===c||t>c)&&(c=t)}h++},C={};if(r?.length&&i)for(let e=0;e<r.length;e++){let l=r[e],n=i.getRangeStartRow(l),o=i.getRangeEndRow(l);for(;!((0,m._missing)(n)||!n||(0,m._isRowBefore)(o,n))&&n&&l.columns;)l.columns.forEach(e=>{if(null===n)return;let i=(0,m._createCellId)({rowPinned:n.rowPinned,column:e,rowIndex:n.rowIndex});if(C[i])return;C[i]=!0;let r=(0,m._getRowNode)(t,n);if((0,m._missing)(r))return;let l=s.getValue(e,r,"data");if(!(0,m._missing)(l)&&""!==l){if(d++,"object"==typeof l&&"value"in l&&""===(l=l.value))return;if("string"==typeof l){let e=l.trim();if(""===e)return;let t=Number(e);if(!Number.isFinite(t))return;a+t>=Number.MAX_SAFE_INTEGER||a+t<=Number.MIN_SAFE_INTEGER||t>=Number.MAX_SAFE_INTEGER||t<=Number.MIN_SAFE_INTEGER?null===(l=(0,m._parseBigIntOrNull)(e))&&(l=t):l=t}("number"!=typeof l||isNaN(l))&&"bigint"!=typeof l||f(l)}}),n=(0,m._getRowBelow)(t,n)}let v=d>1,b=h>1,y=n&&!o;e=y?l/BigInt(h):a/h;let w=b?y?l:a:null,S=b?y?p:u:null,x=b?y?g:c:null,F=b?e:null;this.setAggregationComponentValue("count",d,v),this.setAggregationComponentValue("sum",w,b),this.setAggregationComponentValue("min",S,b),this.setAggregationComponentValue("max",x,b),this.setAggregationComponentValue("avg",F,b)}},r0=class extends rY{postConstruct(){this.setLabel("filteredRows","Filtered"),this.addCss("ag-status-panel"),this.addCss("ag-status-panel-filtered-row-count"),this.setDisplayed(!0);let e=this.onDataChanged.bind(this);this.addManagedEventListeners({modelUpdated:e})}onDataChanged(){let{rowModel:e}=this.beans,t=rX(e),i=rZ(e);this.setValue(i,t),this.setDisplayed(t!==i)}init(e){this.refresh(e),this.onDataChanged()}updateValueFormatter(e){this.valueFormatter=e??(({value:e})=>(0,m._formatNumberCommas)(e,this.getLocaleTextFunc.bind(this)))}refresh(e){let{key:t,valueFormatter:i}=e;return this.key=t,this.updateValueFormatter(i),!0}},r1=class extends rY{postConstruct(){this.setLabel("selectedRows","Selected"),this.addCss("ag-status-panel"),this.addCss("ag-status-panel-selected-row-count");let e=this.onRowSelectionChanged.bind(this);this.addManagedEventListeners({modelUpdated:e,selectionChanged:e})}onRowSelectionChanged(){let{selectionSvc:e,rowModel:t}=this.beans,i=e?.getSelectionCount()??0,s=rX(t);(this.setValue(i,s),i<0)?this.setDisplayed(!0):this.setDisplayed(i>0)}init(e){this.refresh(e),this.onRowSelectionChanged()}updateValueFormatter(e){this.valueFormatter=e??(({value:e})=>null==e||e>=0?(0,m._formatNumberCommas)(e,this.getLocaleTextFunc.bind(this)):this.getLocaleTextFunc()("statusBarLastRowUnknown","?"))}refresh(e){let{key:t,valueFormatter:i}=e;return this.key=t,this.updateValueFormatter(i),!0}},r2=class extends rY{postConstruct(){this.setLabel("totalAndFilteredRows","Rows"),this.addCss("ag-status-panel"),this.addCss("ag-status-panel-total-and-filtered-row-count"),this.setDisplayed(!0),this.addManagedEventListeners({modelUpdated:this.onDataChanged.bind(this)})}onDataChanged(){let{rowModel:e}=this.beans,t=rZ(e),i=rX(e);this.setValue(t,i)}init(e){this.refresh(e),this.onDataChanged()}updateValueFormatter(e){this.valueFormatter=e??(({value:e,totalRows:t})=>{let i=this.getLocaleTextFunc.bind(this),s=(0,m._formatNumberCommas)(e,i),r=(0,m._formatNumberCommas)(t??e,i);if(e===t)return s;let a=i();return`${s} ${a("of","of")} ${r}`})}refresh(e){let{key:t,valueFormatter:i}=e;return this.key=t,this.updateValueFormatter(i),!0}},r5={moduleName:"StatusBar",version:tv,beans:[class extends m.BeanStub{constructor(){super(),this.beanName="statusBarSvc",this.comps=new Map}registerStatusPanel(e,t){this.comps.set(e,t)}unregisterStatusPanel(e){this.comps.delete(e)}unregisterAllComponents(){this.comps.clear()}getStatusPanel(e){return this.comps.get(e)}destroy(){this.unregisterAllComponents(),super.destroy()}}],userComponents:{agAggregationComponent:rQ,agTotalRowCountComponent:class extends rY{postConstruct(){this.setLabel("totalRows","Total Rows"),this.addCss("ag-status-panel"),this.addCss("ag-status-panel-total-row-count"),this.setDisplayed(!0),this.addManagedEventListeners({modelUpdated:this.onDataChanged.bind(this)})}onDataChanged(){let e=rX(this.beans.rowModel);this.setValue(e,e)}init(e){this.refresh(e),this.onDataChanged()}updateValueFormatter(e){this.valueFormatter=e??(({value:e})=>(0,m._formatNumberCommas)(e,this.getLocaleTextFunc.bind(this)))}refresh(e){let{key:t,valueFormatter:i}=e;return this.key=t,this.updateValueFormatter(i),!0}},agFilteredRowCountComponent:r0,agTotalAndFilteredRowCountComponent:r2,agSelectedRowCountComponent:r1},selectors:[{selector:"AG-STATUS-BAR",component:rW}],apiFunctions:{getStatusPanel:function(e,t){let i=e.statusBarSvc?.getStatusPanel(t);return(0,m._unwrapUserComp)(i)}},dependsOn:[tb,m._KeyboardNavigationModule]};function r4(e){return e.excelCreator?.getFactoryMode()!=="MULTI_SHEET"||((0,m._warn)(161),!1)}var r3={moduleName:"ExcelExport",version:tv,beans:[e2],apiFunctions:{getDataAsExcel:function(e,t){if(r4(e))return e.excelCreator?.getDataAsExcel(t)},exportDataAsExcel:function(e,t){r4(e)&&e.excelCreator?.exportDataAsExcel(t)},getSheetDataForExcel:function(e,t){return e.excelCreator?.setFactoryMode("MULTI_SHEET"),e.excelCreator?.getSheetDataForExcel(t)},getMultipleSheetsAsExcel:function(e,t){return e.excelCreator?.getMultipleSheetsAsExcel(t)},exportMultipleSheetsAsExcel:function(e,t){e.excelCreator?.exportMultipleSheetsAsExcel(t)}},dependsOn:[m._SharedExportModule,tb]};function r6(e){let{filters:t}=e;return t&&t.length>0?t:[{filter:"agTextColumnFilter"},{filter:"agSetColumnFilter"}]}function r8(e,t){if(null!=e)for(let i=e.length-1;i>=0;i--)t(e[i],i)}function r7(e,t,i,s){let r=[],a=e?.filterModels;for(let e=0;e<t;e++)r[e]=(e===s?i:a?.[e])??null;return r.every(e=>null==e)?null:{filterType:"multi",filterModels:r}}function r9(e,t){return e?.filterModels?.[t]??null}function ae(e,t,i,s){let r=i.filterValueGetter;return r?e.colFilter.createGetValue(t,r):s}var at=class extends m.TabGuardComp{constructor(){super({tag:"div",cls:"ag-multi-filter ag-menu-list-compact"}),this.filterDefs=[],this.guiDestroyFuncs=[],this.filterGuis=[],this.lastActivatedMenuItem=null}postConstruct(){this.initialiseTabGuard({onFocusIn:e=>this.onFocusIn(e)})}refreshGui(e){return e===this.lastOpenedInContainer?m.AgPromise.resolve():(this.tabGuardFeature.removeAllChildrenExceptTabGuards(),this.destroyChildren(),m.AgPromise.all(this.getFilterWrappers().map((t,i)=>{let s;if(!t)return m.AgPromise.resolve(null);let r=this.getFilterFromWrapper(t),a=this.getCompFromWrapper(t),l=this.filterDefs[i],n=null!=l.title?l.title:r instanceof m.ProvidedFilter?r.getFilterTitle():"Filter";if("subMenu"===l.display&&"toolPanel"!==e)s=this.insertFilterMenu(a,r,n).then(e=>e.getGui());else if("subMenu"===l.display||"accordion"===l.display){let e=this.insertFilterGroup(r,a,n);s=m.AgPromise.resolve(e.getGui())}else s=m.AgPromise.resolve(a.getGui());return s})).then(t=>{t.forEach((e,t)=>{e&&(t>0&&this.appendChild((0,m._createElement)({tag:"div",cls:"ag-filter-separator"})),this.appendChild(e))}),this.filterGuis=t,this.lastOpenedInContainer=e}))}destroyChildren(){for(let e of this.guiDestroyFuncs)e();this.guiDestroyFuncs.length=0,this.filterGuis.length=0}insertFilterMenu(e,t,i){let s=e.getGui();(0,m._setAriaRole)(s,"dialog");let r=this.createBean(new sk);return r.init({menuItemDef:{name:i,subMenu:[],subMenuRole:"dialog",cssClasses:["ag-multi-filter-menu-item"],menuItem:sg,menuItemParams:{cssClassPrefix:"ag-compact-menu-option",isCompact:!0}},level:0,isAnotherSubMenuOpen:()=>!1,childComponent:{getGui:()=>e.getGui(),afterGuiAttached:i=>{e.afterGuiAttached?.(i),e!==t&&t.afterGuiAttached?.(i)}},contextParams:{column:null,node:null,value:null}}).then(()=>{r.setParentComponent(this),this.guiDestroyFuncs.push(()=>this.destroyBean(r)),this.addManagedListeners(r,{menuItemActivated:e=>{this.lastActivatedMenuItem&&this.lastActivatedMenuItem!==e.menuItem&&this.lastActivatedMenuItem.deactivate(),this.lastActivatedMenuItem=e.menuItem}});let e=r.getGui();return r.addManagedElementListeners(e,{keydown:e=>{let{key:t}=e;switch(t){case m.KeyCode.UP:case m.KeyCode.RIGHT:case m.KeyCode.DOWN:case m.KeyCode.LEFT:e.preventDefault(),t===m.KeyCode.RIGHT&&r.openSubMenu(!0)}},focusin:()=>r.activate(),focusout:()=>{r.isSubMenuOpen()||r.isSubMenuOpening()||r.deactivate()}}),r})}insertFilterGroup(e,t,i){let s=this.createBean(new tg({title:i,cssIdentifier:"multi-filter"}));return this.guiDestroyFuncs.push(()=>this.destroyBean(s)),s.addItem(t.getGui()),s.toggleGroupExpand(!1),e.afterGuiAttached&&s.addManagedListeners(s,{expanded:()=>e.afterGuiAttached({container:this.lastOpenedInContainer,suppressFocus:!0,hidePopup:this.hidePopup})}),s}afterGuiAttached(e){let t;e?(this.hidePopup=e.hidePopup,t=this.refreshGui(e.container)):(this.hidePopup=void 0,t=m.AgPromise.resolve());let i=e?.suppressFocus;t.then(()=>{let{filterDefs:t,filterGuis:s,beans:r}=this,a=this.getFilterWrappers(),l=!!i;t&&r8(t,(t,r)=>{let n=0===r,o=t.display&&"inline"!==t.display,d=i||!n||o,h={...e??{},suppressFocus:d},u=a[r],c=u?this.getFilterFromWrapper(u):void 0;if(u){let e=this.getCompFromWrapper(u);e!==c&&e.afterGuiAttached(h)}if(c&&(this.executeFunctionIfExistsOnFilter(c,"afterGuiAttached",h),n&&!d&&(l=!0)),!i&&n&&o){let e=s[r];e&&((0,m._focusInto)(e)||e.focus({preventScroll:!0}),l=!0)}});let n=(0,m._getActiveDomElement)(r);!l&&((0,m._isNothingFocused)(r)||this.getGui().contains(n))&&this.forceFocusOutOfContainer(!0)})}afterGuiDetached(){this.executeFunctionIfExists("afterGuiDetached")}onAnyFilterChanged(){this.executeFunctionIfExists("onAnyFilterChanged",e=>this.executeOnWrapper(e,"onAnyFilterChanged"))}onNewRowsLoaded(){this.executeFunctionIfExists("onNewRowsLoaded",e=>this.executeOnWrapper(e,"onNewRowsLoaded"))}destroy(){this.destroyChildren(),this.hidePopup=void 0,super.destroy()}executeOnWrapper(e,t){}executeFunctionIfExists(e,t){r8(this.getFilterWrappers(),i=>{i&&(t?.(i),this.executeFunctionIfExistsOnFilter(this.getFilterFromWrapper(i),e))})}executeFunctionIfExistsOnFilter(e,t,...i){let s=e[t];"function"==typeof s&&s.apply(e,i)}onFocusIn(e){let t=this.lastActivatedMenuItem;null==t||t.getGui().contains(e.target)||(t.deactivate(),this.lastActivatedMenuItem=null)}},ai=class extends at{constructor(){super(...arguments),this.filterType="multi",this.wrappers=[],this.activeFilterIndices=[],this.afterFiltersReadyFuncs=[]}init(e){this.params=e,this.filterDefs=r6(e);let t=(0,m._getFilterModel)(this.beans.colFilter.model,e.column.getColId()),{filterChangedCallback:i}=e;this.filterChangedCallback=i;let s=this.filterDefs.map((e,i)=>this.createFilter(e,i,t));return new m.AgPromise(e=>{m.AgPromise.all(s).then(t=>{this.wrappers=t,this.refreshGui("columnMenu").then(()=>{e()})})}).then(()=>{for(let e of this.afterFiltersReadyFuncs)e();this.afterFiltersReadyFuncs.length=0})}refresh(e){return this.params=e,!0}isFilterActive(){return this.wrappers.some(e=>{if(!e)return!1;let{filter:t,handler:i,model:s}=e;return i?null!=s:t.isFilterActive()})}getLastActiveFilterIndex(){let e=this.activeFilterIndices;return e.length>0?e[e.length-1]:null}doesFilterPass(e,t){return this.wrappers.every((i,s)=>{if(!i||null!=t&&s===t)return!0;let{handler:r,filter:a,model:l}=i;return r?null==l||r.doesFilterPass({...e,model:l,handlerParams:i.handlerParams}):!a.isFilterActive()||a.doesFilterPass(e)})}getModelFromUi(){return{filterType:this.filterType,filterModels:this.wrappers.map(e=>{if(!e)return null;let t=e.filter;return"function"==typeof t.getModelFromUi?t.getModelFromUi():null})}}getModel(){return this.isFilterActive()?{filterType:this.filterType,filterModels:this.wrappers.map(e=>{if(!e)return null;let{filter:t,handler:i,model:s}=e;return i?s:t.isFilterActive()?t.getModel():null})}:null}setModel(e){let t=[];return this.wrappers.forEach((i,s)=>{if(!i)return;let r=r9(e,s),{filter:a,filterParams:l,handler:n,handlerParams:o,state:d}=i;if(n){let e={model:r,state:d?.state};i.state=e,i.model=r,t.push((0,m._refreshHandlerAndUi)(()=>m.AgPromise.resolve({filter:a,filterParams:l}),n,o,r,e,"api").then(()=>{this.updateActiveListForHandler(s,i.model)}))}else t.push(new m.AgPromise(e=>{let t=a.setModel(r);t?t.then(e):e()}).then(()=>{this.updateActiveListForFilter(s,a)}))}),m.AgPromise.all(t).then(()=>{})}applyModel(e="api"){let t=!1;for(let i of this.wrappers)if(i){let s=i.filter;s instanceof m.ProvidedFilter&&(t=s.applyModel(e)||t)}return t}getChildFilterInstance(e){return this.wrappers[e]?.filter}getNumChildFilters(){return this.wrappers.length}destroy(){for(let e of this.wrappers)this.destroyBean(e?.filter),this.destroyBean(e?.handler);this.wrappers.length=0,super.destroy()}getFilterWrappers(){return this.wrappers}getFilterFromWrapper(e){return e.filter}getCompFromWrapper(e){return e.comp}executeOnWrapper(e,t){e.handler?.[t]?.()}createFilter(e,t,i){let s,r,a=this.params.column,l=null,n=this.beans,o=(e,i)=>{let s=this.wrappers[t];if(!s)return;let r={model:e,state:s.state?.state};s.state=r,s.model=e,(0,m._refreshHandlerAndUi)(()=>m.AgPromise.resolve({filter:s.filter,filterParams:s.filterParams}),s.handler,s.handlerParams,e,r,"ui").then(()=>{this.onHandlerModelChanged(t,s.model,i)})},{compDetails:d,handler:h,handlerParams:u,createFilterUi:c}=n.colFilter.createFilterInstance(a,e,"agTextColumnFilter",(r,u)=>{let c={...r,filterChangedCallback:u?()=>{}:e=>{this.executeWhenAllFiltersReady(()=>this.onFilterModelChanged(t,e))},doesRowPassOtherFilter:e=>r.doesRowPassOtherFilter(e)&&this.doesFilterPass({node:e,data:e.data},t),getValue:ae(n,a,e,r.getValue)};return u&&(l=r9(i,t),s=this.updateDisplayParams(c,t,l,()=>d,()=>h,o)),c});if(!c)return m.AgPromise.resolve(null);if(h){let{doesRowPassOtherFilter:i,getValue:s}=u;r={...u,onModelChange:o,doesRowPassOtherFilter:e=>i(e)&&this.doesFilterPass({node:e,data:e.data},t),getValue:ae(n,a,e,s)},h.init?.({...r,model:l,source:"init"})}return c().then(e=>{if(!h)return{filter:e,comp:e};let t=d?.params,i=s(e);return{filter:e,comp:i,filterParams:t,handler:h,handlerParams:r,model:l}})}updateDisplayParams(e,t,i,s,r,a){let l=this.params.column,n=new m.LocalEventService;e.model=i,e.state={model:i},e.onModelChange=a,e.getHandler=r;let o=(e,t)=>{e.state=t,n.dispatchEvent({type:"filterStateChanged",column:l,state:t})};e.onStateChange=e=>{let i=this.wrappers[t];i&&(o(i,e),(0,m._refreshFilterUi)(i.filter,i.filterParams,i.model??null,e,"ui"))};let d=(e,i,r)=>{let a=this.wrappers[t];if(!a)return;let l=()=>a?.model??null;(0,m._updateFilterModel)({action:i,filterParams:a.filterParams,getFilterUi:()=>{let e=m.AgPromise.resolve(a.filter);return{created:!0,filterParams:a.filterParams,compDetails:s(),create:()=>e,promise:e}},getModel:l,getState:()=>a?.state??{model:l()},updateState:e=>o(a,e),updateModel:e=>a.filterParams?.onModelChange(e,r),processModelToApply:a.handler?.processModelToApply?.bind(a.handler)})};return e.onAction=(e,t,i)=>{d(l,e,t),n.dispatchEvent({type:"filterAction",column:l,action:e,event:i})},e=>{let t=s()?.params;return this.createManagedBean(new m.FilterWrapperComp(l,{comp:e,params:t,isHandler:!0},n,d,!1))}}executeWhenAllFiltersReady(e){(this.wrappers?.length??0)>0?e():this.afterFiltersReadyFuncs.push(e)}updateActiveListForFilter(e,t){this.updateActiveList(e,()=>t?.isFilterActive())}updateActiveListForHandler(e,t){this.updateActiveList(e,()=>null!=t)}updateActiveList(e,t){let i=this.activeFilterIndices;(0,m._removeFromArray)(this.activeFilterIndices,e),t()&&i.push(e)}onFilterModelChanged(e,t){this.updateActiveListForFilter(e,this.wrappers[e]?.filter),this.filterChanged(e,t)}onHandlerModelChanged(e,t,i){this.updateActiveListForHandler(e,t),this.filterChanged(e,i)}filterChanged(e,t){this.filterChangedCallback(t),this.wrappers.forEach((t,i)=>{if(e===i||!t)return;let{filter:s,handler:r}=t;r?.onAnyFilterChanged?.(),"function"==typeof s.onAnyFilterChanged&&s.onAnyFilterChanged()})}getModelAsString(e){if(!e?.filterModels?.length)return"";let t=this.getLastActiveFilterIndex()??0,i=this.wrappers[t]?.filter;return i?.getModelAsString?.(e.filterModels[t])??""}},as=class extends m.BeanStub{constructor(){super(...arguments),this.filterType="multi",this.handlerWrappers=[],this.activeFilterIndices=[],this.filterDefs=[]}init(e){this.params=e;let t=r6(e.filterParams);this.filterDefs=t,t.forEach((t,i)=>{let s=this.beans.colFilter.createHandler(e.column,t,"agTextColumnFilter");if(this.handlerWrappers.push(s),!s)return void(0,m._warn)(278,{colId:e.column.getColId()});let{handler:r,handlerParams:a}=s;r.init?.({...this.updateHandlerParams(a,i,!0),model:r9(e.model,i),source:"init"})}),this.resetActiveList(e.model)}refresh(e){this.params=e;let{model:t,source:i,filterParams:s}=e,r=s?.filters;this.handlerWrappers.forEach((s,a)=>{if(s){let l=this.updateHandlerParams(e,a,!1,r?.[a].filterParams);s.handlerParams=l,s.handler.refresh?.({...l,model:r9(t,a),source:i})}}),"floating"!==e.source&&"ui"!==e.source&&this.resetActiveList(e.model),e.additionalEventAttributes?.fromButtons&&this.onAnyFilterChanged()}updateHandlerParams(e,t,i,s){let{onModelChange:r,doesRowPassOtherFilter:a,getValue:l}=e,n={...e,onModelChange:(e,i)=>r(r7(this.params.model,this.handlerWrappers.length,e,t),i),doesRowPassOtherFilter:e=>a(e)&&this.doesFilterPass({node:e,data:e.data,model:this.params.model,handlerParams:n},t),getValue:ae(this.beans,e.column,this.filterDefs[t],l),filterParams:this.updateFilterParams(e,i,s)};return n}updateFilterParams(e,t,i){let s=e.filterParams;i?.buttons&&t&&(0,m._warn)(292,{colId:e.column.getColId()});let r=i?{...s,...i}:s;if(!r.buttons)return r;if(i)return delete r.buttons,r;let{buttons:a,...l}=r;return l}doesFilterPass(e,t){let i=e.model?.filterModels;return null==i||this.handlerWrappers.every((s,r)=>{let a=i[r];if(null==a||null!=t&&r===t)return!0;let l=s?.handler;return!l||l.doesFilterPass({...e,model:a,handlerParams:s.handlerParams})})}resetActiveList(e){this.activeFilterIndices=[];let t=e?.filterModels;if(null!=t)for(let e=0;e<this.handlerWrappers.length;e++)null!=t[e]&&this.activeFilterIndices.push(e)}updateActiveList(e,t){let i=this.activeFilterIndices;(0,m._removeFromArray)(i,e),null!=t&&i.push(e)}getLastActiveFilterIndex(){let e=this.activeFilterIndices;return e.length>0?e[e.length-1]:null}getModelAsString(e,t){let i="filterToolPanel"===t,s=()=>i?this.getLocaleTextFunc()("filterSummaryInactive","is (All)"):"";if(!e?.filterModels?.length)return s();let r=this.getLastActiveFilterIndex()??0,a=this.handlerWrappers[r];return a?.handler.getModelAsString?.(e.filterModels[r],t)??s()}getHandler(e){return this.handlerWrappers[e]?.handler}onAnyFilterChanged(){r8(this.handlerWrappers,e=>e?.handler?.onAnyFilterChanged?.())}onNewRowsLoaded(){r8(this.handlerWrappers,e=>e?.handler?.onNewRowsLoaded?.())}destroy(){for(let e of this.handlerWrappers)this.destroyBean(e?.handler);this.handlerWrappers.length=0,super.destroy()}},ar=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="multiFilter"}getParamsForDataType(e,t,i,s){let r=e?.filters,a=this.beans;r||(r=[{filter:(0,m._getDefaultSimpleFilter)(i.baseDataType)},{filter:"agSetColumnFilter"}]);let l=this.getLocaleTextFunc();return r=r.map(e=>{let{filter:r,filterParams:n,filterValueGetter:o}=e;if("string"!=typeof r)return e;let{filterParams:d,filterValueGetter:h}=(0,m._getFilterParamsForDataType)(r,n,o??t,i,s,a,l);return{...e,filterParams:d,filterValueGetter:h}}),{filterParams:{...e,filters:r}}}},aa=class extends at{constructor(){super(...arguments),this.filterType="multi",this.filters=[],this.filterParams=[],this.validity=[]}init(e){this.params=e;let t=r6(e).map(t=>{if(t.filterParams?.buttons){(0,m._warn)(292,{colId:e.column.getColId()});let i={...t.filterParams};return delete i.buttons,{...t,filterParams:i}}return t});this.filterDefs=t,this.allState=e.state;let i=this.filterDefs.map((e,t)=>this.createFilter(e,t));return new m.AgPromise(e=>{m.AgPromise.all(i).then(t=>{this.filters=t,this.refreshGui("columnMenu").then(()=>{e()})})})}refresh(e){let{model:t,state:i,source:s}=e;if("colDef"===s)return!1;this.params=e;let r=this.filterParams;if(i===this.allState)return!0;this.allState=i;let a=i.state;return this.filters.forEach((e,l)=>{let n=r9(t,l),o={state:a?.[l],model:r9(i.model,l)};(0,m._refreshFilterUi)(e,r[l],n,o,s)}),!0}getLastActiveFilterIndex(){return this.getHandler().getLastActiveFilterIndex?.()??null}getChildFilterInstance(e){return this.filters[e]??void 0}getNumChildFilters(){return this.filters.length}destroy(){for(let e of this.filters)this.destroyBean(e);this.filters.length=0,super.destroy()}getFilterWrappers(){return this.filters}getFilterFromWrapper(e){return e}getCompFromWrapper(e){return e}createFilter(e,t){let i=this.beans.userCompFactory,s=this.updateParams(e,this.params,t),r=(0,m._getFilterDetails)(i,e,s,"agTextColumnFilter");return r?(this.filterParams[t]=r.params,r.newAgStackInstance()):m.AgPromise.resolve(null)}updateParams(e,t,i){let{doesRowPassOtherFilter:s,model:r,onModelChange:a,state:l,onStateChange:n,column:o,source:d,onAction:h,onUiChange:u,getValue:c}=t,p=r9(r,i),g=l?{model:r9(l.model,i),state:l.state?.[i]}:{model:p},f=()=>{let e=this.getHandler();this.filters.forEach((t,s)=>{i!==s&&(e.getHandler(s)?.onAnyFilterChanged?.(),t?.onAnyFilterChanged?.())})},C=this.beans.colFilter;return{...C.createBaseFilterParams(o),...e,doesRowPassOtherFilter:e=>s(e)&&this.getHandler().doesFilterPass({node:e,data:e.data,model:this.params.model,handlerParams:C.getHandlerParams(o)},i),model:p,state:g,onModelChange:(e,t)=>{let{filters:s,params:r}=this,l=r7(r.model,s.length,e,i);this.updateActiveList(i,e),a(l,t),f()},onStateChange:e=>this.onStateChange(n,i,e),getHandler:()=>this.getHandler().getHandler(i),onAction:(e,s,r)=>{if((0,m._isUseApplyButton)(t))return;let a="apply"===e||"reset"===e;a&&this.updateActiveList(i,r9(this.params.state.model,i)),h(e,s,r),a&&f()},onUiChange:u,source:d,getValue:ae(this.beans,o,e,c)}}updateActiveList(e,t){this.getHandler().updateActiveList?.(e,t)}getHandler(){return this.params.getHandler()}onStateChange(e,t,i){let{model:s,state:r,valid:a}=i,l=this.validity;l[t]=a;let n=this.allState,o=r7(n.model,this.filters.length,s,t),d=l.every(e=>!1!==e),h=[...n.state??[]];h[t]=r;let u={state:h,model:o,valid:d};this.allState=u,e(u)}getModelAsString(e){return this.getHandler().getModelAsString?.(e)??""}},al={tag:"div",cls:"ag-multi-floating-filter ag-floating-filter-input"},an={moduleName:"MultiFilter",version:tv,userComponents:{agMultiColumnFilter:{getComp:e=>e.gos.get("enableFilterHandlers")?{classImp:aa,params:{useForm:!0}}:ai},agMultiColumnFloatingFilter:class extends m.Component{constructor(){super(al),this.floatingFilters=[],this.compDetailsList=[]}init(e){this.params=e;let{compDetailsList:t}=this.getCompDetailsList(e);return this.setParams(t)}setParams(e){let t=[];return e.forEach(e=>{let i=e?.newAgStackInstance();null!=i&&(this.compDetailsList.push(e),t.push(i))}),m.AgPromise.all(t).then(e=>{e.forEach((e,t)=>{this.floatingFilters.push(e);let i=e.getGui();this.appendChild(i),t>0&&(0,m._setDisplayed)(i,!1)})})}refresh(e){this.params=e;let{compDetailsList:t,floatingFilterParamsList:i}=this.getCompDetailsList(e);if(t.length===this.compDetailsList.length&&t.every((e,t)=>!this.beans.colFilter?.areFilterCompsDifferent(this.compDetailsList[t],e))){if(i.forEach((e,t)=>{let i=this.floatingFilters[t];i.refresh?.(e)}),this.gos.get("enableFilterHandlers"))if(null==e.model)this.floatingFilters.forEach((e,t)=>{(0,m._setDisplayed)(e.getGui(),0===t)});else{let t=e.getHandler()?.getLastActiveFilterIndex?.();this.floatingFilters.forEach((e,i)=>{(0,m._setDisplayed)(e.getGui(),null==t?0===i:i===t)})}}else(0,m._clearElement)(this.getGui()),this.destroyBeans(this.floatingFilters),this.floatingFilters=[],this.compDetailsList=[],this.setParams(t)}getCompDetailsList(e){let t=[],i=[],s=e.filterParams,r=e.currentParentModel,a=r6(s);return a.forEach((s,l)=>{let n={...e,parentFilterInstance:e=>{this.parentMultiFilterInstance(t=>{let i=t.getChildFilterInstance(l);null!=i&&e(i)})},currentParentModel:()=>r()?.filterModels?.[l]??null};if(this.gos.get("enableFilterHandlers")){n.model=n.model?.filterModels?.[l]??null;let{onModelChange:e,getHandler:t}=n;n.onModelChange=(t,i)=>e(r7(this.params.model,a.length,t,l),i),n.getHandler=()=>t().getHandler(l)}(0,m._mergeDeep)(n.filterParams,s.filterParams);let o=this.getCompDetails(s,n);o&&(t.push(o),i.push(n))}),{compDetailsList:t,floatingFilterParamsList:i}}onParentModelChanged(e,t){t?.afterFloatingFilter||this.parentMultiFilterInstance(i=>{if(null==e)this.floatingFilters.forEach((e,i)=>{e.onParentModelChanged(null,t),(0,m._setDisplayed)(e.getGui(),0===i)});else{let s=i.getLastActiveFilterIndex();this.floatingFilters.forEach((i,r)=>{let a=e.filterModels.length>r?e.filterModels[r]:null;i.onParentModelChanged(a,t),(0,m._setDisplayed)(i.getGui(),null==s?0===r:r===s)})}})}destroy(){this.destroyBeans(this.floatingFilters),this.floatingFilters.length=0,super.destroy()}getCompDetails(e,t){let{colFilter:i,frameworkOverrides:s,userCompFactory:r}=this.beans,a=(0,m._getDefaultFloatingFilterType)(s,e,()=>i.getDefaultFloatingFilter(this.params.column))??"agReadOnlyFloatingFilter";return(0,m._getFloatingFilterCompDetails)(r,e,t,a)}parentMultiFilterInstance(e){this.params.parentFilterInstance(t=>{t instanceof ai||t instanceof aa||(0,m._error)(120),e(t)})}}},beans:[ar],dynamicBeans:{agMultiColumnFilterHandler:as},dependsOn:[tb,m._ColumnFilterModule,sm]},ao=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="aggColNameSvc"}getHeaderName(e,t){let i;if(this.gos.get("suppressAggFuncInHeader"))return t;let{valueColsSvc:s,colModel:r,rowGroupColsSvc:a}=this.beans,l=e.getColDef().pivotValueColumn,n=(0,m._exists)(l),o=null;if(n){let r=s?.columns??[],a=this.gos.get("removePivotHeaderRowWhenSingleValueColumn")&&1===r.length,n=void 0!==e.getColDef().pivotTotalColumnIds;if(a&&!n)return t;o=l?l.getAggFunc():null,i=!0}else{let t=e.isValueActive(),s=a?.columns.length!==0,l=r.isPivotMode()||s||this.gos.get("treeData");t&&l?(o=e.getAggFunc(),i=!0):i=!1}if(i){let e="string"==typeof o?o:"func",i=this.getLocaleTextFunc()(e,e);return`${i}(${t})`}return t}},ad={sum:"Sum",first:"First",last:"Last",min:"Min",max:"Max",count:"Count",avg:"Average"},ah=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="aggFuncSvc",this.aggFuncsMap={},this.initialised=!1}postConstruct(){this.init()}init(){this.initialised||(this.initialiseWithDefaultAggregations(),this.addAggFuncs(this.gos.get("aggFuncs")))}initialiseWithDefaultAggregations(){let e=this.aggFuncsMap;e.sum=au,e.first=ac,e.last=ap,e.min=ag,e.max=am,e.count=aC,e.avg=ab,this.initialised=!0}isAggFuncPossible(e,t){let i=this.getFuncNames(e).includes(t),s=(0,m._exists)(this.aggFuncsMap[t]);return i&&s}getDefaultFuncLabel(e){return ad[e]??e}getDefaultAggFunc(e){let t=e.getColDef().defaultAggFunc;if((0,m._exists)(t)&&this.isAggFuncPossible(e,t))return t;if(this.isAggFuncPossible(e,"sum"))return"sum";let i=this.getFuncNames(e);return i?.length?i[0]:null}addAggFuncs(e){if(this.init(),e)for(let t of Object.keys(e))e[t]&&(this.aggFuncsMap[t]=e[t])}getAggFunc(e){return this.init(),this.aggFuncsMap[e]}getFuncNames(e){let t=e.getColDef().allowedAggFuncs;return null==t?Object.keys(this.aggFuncsMap).sort():t}clear(){this.aggFuncsMap={}}};function au(e){let{values:t}=e,i=null;for(let e=0;e<t.length;e++){let s=t[e];"number"==typeof s?null===i?i=s:i+="number"==typeof i?s:BigInt(s):"bigint"==typeof s&&(i=null===i?s:("bigint"==typeof i?i:BigInt(i))+s)}return i}function ac(e){return e.values.length>0?e.values[0]:null}function ap(e){return e.values.length>0?(0,m._last)(e.values):null}function ag(e){let{values:t}=e,i=null;for(let e=0;e<t.length;e++){let s=t[e];("number"==typeof s||"bigint"==typeof s)&&(null===i||i>s)&&(i=s)}return i}function am(e){let{values:t}=e,i=null;for(let e=0;e<t.length;e++){let s=t[e];("number"==typeof s||"bigint"==typeof s)&&(null===i||i<s)&&(i=s)}return i}var af=Object.freeze({toString:function(){return this.value.toString()},toNumber:function(){return this.value}});function aC(e){let{values:t}=e,i=0;for(let e=0;e<t.length;e++){let s=t[e];i+=null!=s&&"number"==typeof s.value?s.value:1}let s=e.rowNode?.aggData?.[e.column.getColId()];if(s&&s.value===i)return s;let r=Object.create(af);return r.value=i,r}var av=Object.freeze({toString:function(){return"number"==typeof this.value||"bigint"==typeof this.value?this.value.toString():""},toNumber:function(){return this.value}});function ab(e){let{values:t}=e,i=0,s=0;for(let e=0;e<t.length;e++){let r=t[e],a=null;"number"==typeof r||"bigint"==typeof r?(a=r,s++):null!=r&&("number"==typeof r.value||"bigint"==typeof r.value)&&"number"==typeof r.count&&(a=r.value*("number"==typeof r.value?r.count:BigInt(r.count)),s+=r.count),"number"==typeof a?i+="number"==typeof i?a:BigInt(a):"bigint"==typeof a&&(i=("bigint"==typeof i?i:BigInt(i))+a)}let r=null;s>0&&(r=i/("number"==typeof i?s:BigInt(s)));let a=e.rowNode?.aggData?.[e.column?.getColId()];if(a&&a.count===s&&a.value===r)return a;let l=Object.create(av);return l.count=s,l.value=r,l}function ay({beans:e,values:t,aggFuncOrString:i,column:s,rowNode:r,pivotResultColumn:a,aggregatedChildren:l}){let n="string"==typeof i?e.aggFuncSvc.getAggFunc(i):i;return"function"!=typeof n?((0,m._warn)(109,{inputValue:i.toString(),allSuggestions:e.aggFuncSvc.getFuncNames(s)}),null):n((0,m._addGridCommonParams)(e.gos,{values:t,column:s,colDef:s.colDef,pivotResultColumn:a,rowNode:r,data:r?.data,aggregatedChildren:l}))}var aw=(e,t,i)=>{if(!t)return[];let s=t.length,r=Array(s);for(let a=0;a<s;++a)r[a]=e.getValue(i,t[a],"data");return r},aS=(e,t,i)=>{let s=i.length,r=Array(s);for(let e=0;e<s;e++)r[e]=[];let a=t.length;for(let l=0;l<a;l++){let a=t[l];for(let t=0;t<s;t++)r[t].push(e.getValue(i[t],a,"data"))}return r},ax=(e,t)=>{if(!e)return[];let i=e.length,s=Array(i);for(let r=0;r<i;r++)s[r]=e[r].aggData?.[t];return s},aF=(e,t)=>{if(!t)return;let i=e;for(let e=0;e<t.length&&i;e++)i=i[t[e]];if(Array.isArray(i))return i};function aA(e,t){if(e.sibling)return;let i=(0,m._createRowNodeSibling)(e,t);i.footer=!0,i.setRowTop(null),i.setRowIndex(null),i.oldRowTop=null,i.id="rowGroupFooter_"+e.id,i.sibling=e,e.sibling=i}function aM(e){let t=e.sibling;t&&(t._destroy(!1),e.sibling=void 0,t.sibling=void 0)}var aR=class extends m.BaseColsService{constructor(){super(...arguments),this.beanName="valueColsSvc",this.eventName="columnValueChanged",this.columnProcessors={set:(e,t,i)=>this.setValueActive(t,e,i),add:(e,t,i)=>this.setValueActive(!0,e,i),remove:(e,t,i)=>this.setValueActive(!1,e,i)},this.columnExtractors={setFlagFunc:(e,t,i)=>this.setColValueActive(e,t,i),getIndexFunc:()=>void 0,getInitialIndexFunc:()=>void 0,getValueFunc:e=>{let t=e.aggFunc;return null===t||""===t?null:void 0!==t?!!t:void 0},getInitialValueFunc:e=>null!=e.initialAggFunc&&""!=e.initialAggFunc},this.modifyColumnsNoEventsCallbacks={addCol:e=>this.columns.push(e),removeCol:e=>(0,m._removeFromArray)(this.columns,e)}}extractCols(e,t){for(let i of(this.columns=super.extractCols(e,t),this.columns)){let e=i.getColDef();null!=e.aggFunc&&""!=e.aggFunc?this.setColAggFunc(i,e.aggFunc):i.getAggFunc()||this.setColAggFunc(i,e.initialAggFunc)}return this.columns}setColumnAggFunc(e,t,i){if(!e)return;let s=this.colModel.getColDefCol(e);s&&(this.setColAggFunc(s,t),this.dispatchColumnChangedEvent(this.eventSvc,this.eventName,[s],i))}syncColumnWithState(e,t,i){let s=i("aggFunc").value1;void 0!==s&&("string"==typeof s?(this.setColAggFunc(e,s),e.isValueActive()||(this.setColValueActive(e,!0,t),this.modifyColumnsNoEventsCallbacks.addCol(e))):((0,m._exists)(s)&&(0,m._warn)(33),e.isValueActive()&&(this.setColValueActive(e,!1,t),this.modifyColumnsNoEventsCallbacks.removeCol(e))))}setValueActive(e,t,i){if(e!==t.isValueActive()&&(this.setColValueActive(t,e,i),e&&!t.getAggFunc()&&this.aggFuncSvc)){let e=this.aggFuncSvc.getDefaultAggFunc(t);this.setColAggFunc(t,e)}}setColAggFunc(e,t){e.aggFunc=t,e.dispatchStateUpdatedEvent("aggFunc")}setColValueActive(e,t,i){e.aggregationActive!==t&&(e.aggregationActive=t,e.dispatchColEvent("columnValueChanged",i))}},aT={moduleName:"SharedAggregation",version:tv,beans:[ah,ao,class extends m.BeanStub{constructor(){super(...arguments),this.beanName="footerSvc"}addTotalRows(e,t,i,s,r,a){let l=e;if(r)return function(e,t){switch(t){case"top":case"pinnedTop":return"top"===e;case"bottom":case"pinnedBottom":return"bottom"===e;default:return!1}}(a,s&&(0,m._getGrandTotalRow)(this.gos))&&(aA(t,this.beans),i(t.sibling,l++)),l;let n=(0,m._getGroupTotalRowCallback)(this.gos);return(s&&n({node:t}))===a&&(aA(t,this.beans),i(t.sibling,l++)),l}getTopDisplayIndex(e,t,i,s){let r=t;if(e[0].footer){if(0===t)return 0;r-=1}let a=e[e.length-1],l=r>=i.length;return a.footer&&l?a.rowIndex:s(r)}doesCellShowTotalPrefix(e,t){return!!e.footer&&!!t?.getColDef().showRowGroup&&(!!this.gos.get("treeData")||(-1===e.level?this.beans.showRowGroupCols?.columns[0]===t:!!e.rowGroupColumn&&t?.isRowGroupDisplayed(e.rowGroupColumn.getId())))}applyTotalPrefix(e,t,i,s){let r=s.getColDef().cellRendererParams?.totalValueGetter;if(r){let a=(0,m._addGridCommonParams)(this.gos,{column:s,node:i,value:e,formattedValue:t});if("function"==typeof r)return r(a);if("string"==typeof r)return this.beans.expressionSvc?.evaluate(r,a);(0,m._warn)(179)}return -1===i.level?this.getLocaleTextFunc()("footerTotal","Total")+" ":this.getTotalValue(t??e)??""}getTotalValue(e){return this.getLocaleTextFunc()("footerTotal","Total")+" "+(e??"")}},aR],apiFunctions:{addAggFuncs:function(e,t){e.aggFuncSvc&&e.aggFuncSvc.addAggFuncs(t)},clearAggFuncs:function(e){e.aggFuncSvc&&e.aggFuncSvc.clear()},setColumnAggFunc:function(e,t,i){e.valueColsSvc?.setColumnAggFunc?.(t,i,"api")}},dependsOn:[tb]},aP={moduleName:"Aggregation",version:tv,beans:[class extends m.BeanStub{constructor(){super(...arguments),this.beanName="aggStage",this.step="aggregate",this.refreshProps=["getGroupRowAgg","alwaysAggregateAtRootLevel","suppressAggFilteredOnly","grandTotalRow"],this.clientSide=!1}wireBeans(e){this.colModel=e.colModel,this.pivotColsSvc=e.pivotColsSvc,this.valueColsSvc=e.valueColsSvc,this.pivotResultCols=e.pivotResultCols,this.valueSvc=e.valueSvc,this.clientSide=(0,m._isClientSideRowModel)(e.gos)}execute(e){let t=!this.valueColsSvc?.columns?.length,i=!this.gos.getCallback("getGroupRowAgg");if(t&&i&&e?.active)return;let s=this.createAggDetails(e);this.recursivelyCreateAggData(s)}createAggDetails(e){let t=this.colModel.isPivotActive(),i=this.valueColsSvc?.columns,s=t&&this.pivotColsSvc?this.pivotColsSvc.columns:[];return{alwaysAggregateAtRootLevel:this.gos.get("alwaysAggregateAtRootLevel"),groupIncludeTotalFooter:!!(0,m._getGrandTotalRow)(this.gos),changedPath:e,valueColumns:i??[],pivotColumns:s,filteredOnly:!this.isSuppressAggFilteredOnly(),userAggFunc:this.gos.getCallback("getGroupRowAgg")}}isSuppressAggFilteredOnly(){return void 0!==(0,m._getGroupAggFiltering)(this.gos)||this.gos.get("suppressAggFilteredOnly")}recursivelyCreateAggData(e){let t=t=>{if(!t.hasChildren()){t.aggData&&this.setAggDataWithSiblings(t,null);return}if(-1===t.level&&!e.groupIncludeTotalFooter){let i=!this.colModel.isPivotMode();if(!e.alwaysAggregateAtRootLevel&&i)return void this.setAggData(t,null)}this.aggregateRowNode(t,e)};e.changedPath.forEachChangedNodeDepthFirst(t,!0)}aggregateRowNode(e,t){let i,s=0===t.valueColumns.length,r=0===t.pivotColumns.length;i=t.userAggFunc?t.userAggFunc({nodes:e.childrenAfterFilter}):s?null:r?this.aggregateRowNodeUsingValuesOnly(e,t):this.aggregateRowNodeUsingValuesAndPivot(e),this.setAggDataWithSiblings(e,i)}aggregateRowNodeUsingValuesAndPivot(e){let t={},i=this.pivotResultCols?.getPivotResultCols()?.list??[],s=!0,r=this.beans,a=this.valueSvc;for(let l=0;l<i.length;l++){let n,o,d=i[l],h=d.getColDef();if(null!=h.pivotTotalColumnIds){s=!1;continue}let u=h.pivotValueColumn;n=e.leafGroup?aw(a,o=aF(e.childrenMapped,h.pivotKeys),u):ax(o=e.childrenAfterFilter,d.getId()),t[h.colId]=ay({beans:r,values:n,aggFuncOrString:u.getAggFunc(),column:u,rowNode:e,pivotResultColumn:d,aggregatedChildren:o??[]})}if(!s)for(let s=0;s<i.length;s++){let a=i[s],l=a.getColDef();if(!l.pivotTotalColumnIds?.length)continue;let n=l.pivotTotalColumnIds.map(e=>t[e]);t[l.colId]=ay({beans:r,values:n,aggFuncOrString:l.pivotValueColumn.getAggFunc(),column:l.pivotValueColumn,rowNode:e,pivotResultColumn:a,aggregatedChildren:e.childrenAfterFilter??[]})}return t}aggregateRowNodeUsingValuesOnly(e,t){let i={},{changedPath:s,valueColumns:r,filteredOnly:a}=t,l=s.active?s.getValueColumnsForNode(e,r):r,n=s.active?s.getNotValueColumnsForNode(e,r):null,o=(a?e.childrenAfterFilter:e.childrenAfterGroup)??[],d=aS(this.valueSvc,o,l),h=e.aggData,u=this.beans;if(l.forEach((t,s)=>{i[t.getId()]=ay({beans:u,values:d[s],aggFuncOrString:t.getAggFunc(),column:t,rowNode:e,pivotResultColumn:void 0,aggregatedChildren:o})}),n&&h)for(let e of n)i[e.getId()]=h[e.getId()];return i}getAggregatedChildren(e,t){if(!e?.group||!this.clientSide)return[];if(e.rowPinned){let t=e.pinnedSibling;if(!t)return[];e=t}let i=t?.getColDef(),s=i?.pivotKeys;return s?e.leafGroup&&s.length&&!i.pivotTotalColumnIds?aF(e.childrenMapped,s)??[]:e.childrenAfterFilter??e.childrenAfterGroup??[]:this.isSuppressAggFilteredOnly()?e.childrenAfterGroup??[]:e.childrenAfterFilter??e.childrenAfterGroup??[]}setAggDataWithSiblings(e,t){this.setAggData(e,t);let i=e.pinnedSibling;i&&this.setAggData(i,t);let s=e.sibling;if(s){this.setAggData(s,t);let e=s.pinnedSibling;e&&this.setAggData(e,t)}}setAggData(e,t){let i=e.aggData;if(e.aggData=t,e.__localEventService){let s=t=>{let s=e.aggData?e.aggData[t]:void 0,r=i?i[t]:void 0;if(s===r)return;let a=this.colModel.getColById(t);a&&e.dispatchCellChangedEvent(a,s,r)};if(i)for(let e of Object.keys(i))s(e);if(t)for(let e of Object.keys(t))i&&e in i||s(e)}}},class extends m.BeanStub{constructor(){super(...arguments),this.beanName="filterAggStage",this.step="filter_aggregates",this.refreshProps=[]}wireBeans(e){this.filterManager=e.filterManager}execute(e){let t=this.beans.colModel.isPivotMode(),i=this.filterManager?.isAggregateFilterPresent()||this.filterManager?.isAggregateQuickFilterPresent(),s=(0,m._getGroupAggFiltering)(this.gos)||(t?e=>e.node.leafGroup:e=>!e.node.group),r=(e,t=!1)=>{if(e.childrenAfterFilter){if(e.childrenAfterAggFilter=e.childrenAfterFilter,t)for(let i of e.childrenAfterAggFilter)r(i,t);this.setAllChildrenCount(e)}e.sibling&&(e.sibling.childrenAfterAggFilter=e.childrenAfterAggFilter)},a=e=>{e.childrenAfterAggFilter=e.childrenAfterFilter?.filter(e=>s({node:e})&&this.filterManager.doesRowPassAggregateFilters({rowNode:e})?(r(e,!0),!0):e.childrenAfterAggFilter?.length)||null,this.setAllChildrenCount(e),e.sibling&&(e.sibling.childrenAfterAggFilter=e.childrenAfterAggFilter)};e.forEachChangedNodeDepthFirst(i?a:r,!0)}setAllChildrenCountTreeData(e){let t=e.childrenAfterAggFilter,i=0;if(t){let e=t.length;i=e;for(let s=0;s<e;++s)i+=t[s].allChildrenCount??0}e.setAllChildrenCount(0===i&&e.level>=0?null:i)}setAllChildrenCountGridGrouping(e){let t=0;e.childrenAfterAggFilter.forEach(e=>{e.group?t+=e.allChildrenCount:t++}),e.setAllChildrenCount(t)}setAllChildrenCount(e){e.hasChildren()?this.gos.get("treeData")?this.setAllChildrenCountTreeData(e):this.setAllChildrenCountGridGrouping(e):e.setAllChildrenCount(null)}}],rowModels:["clientSide"],dependsOn:[aT]},aI=(e,t,i,s)=>r=>{let a=(({valueSvc:e,dataTypeSvc:t},i,s)=>{let r=e.getValue(i,s,"data"),a=null;return r instanceof Date?a=r:"string"==typeof r&&(a=(t?.getDateParserFunction(i)??m._parseDateTimeFromString)(r)??null),a})(e,t,r.node),l=(0,m._getDateParts)(a);return l?s?.(l[i])??l[i]:null},aE=({colNames:e},t,i)=>s=>{let r=e.getDisplayNameForColumn(t,s.location);return r?`${r} (${i})`:""},aD=Object.fromEntries(m._MONTHS.map(e=>[e,e.toLowerCase()]));function ak(e){return e.groupHierarchy??e.rowGroupingHierarchy}var aL=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="groupHierarchyColSvc",this.columns=null,this.sourceColumnMap=new WeakMap,this.inverseColumnMap=new WeakMap}addColumns(e){let t=this.columns;null!=t&&(e.list=t.list.filter(t=>!e.list.some(e=>e.getColId()===t.getColId())).concat(e.list),e.tree=t.tree.filter(t=>!e.tree.some(e=>e.getId()===t.getId())).concat(e.tree),(0,m._updateColsMap)(e))}createColumns(e){let t=new WeakMap,i=new WeakMap,s=this.createGroupHierarchyColumns(e,t,i);if((0,m._areColIdsEqual)(s,this.columns?.list??[]))return;(0,m._destroyColumnTree)(this.beans,this.columns?.tree),this.columns=null;let{colGroupSvc:r}=this.beans,a=r?.findDepth(e.tree)??0,l=r?.balanceTreeForAutoCols(s,a)??[];this.columns={list:s,tree:l,treeDepth:a,map:{}},this.sourceColumnMap=t,this.inverseColumnMap=i}updateColumns(e){}getColumn(e){return this.columns?.list.find(t=>(0,m._columnsMatch)(t,e))??null}getColumns(){return this.columns?.list??null}expandColumnInto(e,t){for(let i of this.getVirtualColumnsForColumn(t).concat(t))e.some(e=>(0,m._columnsMatch)(e,i)||e.getColId()===i.getColId())||e.push(i)}compareVirtualColumns(e,t){let i=this.inverseColumnMap.get(e),s=this.inverseColumnMap.get(t);if(i&&i===s){let s=this.sourceColumnMap.get(i)??[];return s?.indexOf(e)-s?.indexOf(t)}return this.sourceColumnMap.get(e)?.includes(t)?1:this.sourceColumnMap.get(t)?.includes(e)?-1:null}insertVirtualColumnsForCol(e,t){let i=this.getVirtualColumnsForColumn(t);if(!i)return[];let s=e.indexOf(t);return s<0&&(s=e.length-1),(0,m._removeAllFromArray)(e,i),e.splice(s,0,...i),i}getVirtualColumnsForColumn(e){return this.isGroupHierarchyColsEnabledForCol(e)?this.sourceColumnMap.get(e)??[]:[]}isGroupHierarchyColsEnabled(e){return e.list.some(e=>this.isGroupHierarchyColsEnabledForCol(e))}isGroupHierarchyColsEnabledForCol(e){let t=e.getColDef();return!!(ak(t)&&(t.rowGroup||t.enableRowGroup||null!=t.rowGroupIndex||t.pivot||t.enablePivot||null!=t.pivotIndex))}createGroupHierarchyColDefs(e){let t=[],i=e.getColDef(),s=ak(i);if(!s||!this.isGroupHierarchyColsEnabledForCol(e))return t;for(let r of s){let s=null;(s="string"==typeof r?this.createColDefForPart(r,e,i):r)&&t.push(s)}return t}createGroupHierarchyColumns(e,t,i){if(!this.isGroupHierarchyColsEnabled(e))return[];let s=[];for(let r of e.list)for(let e of this.createGroupHierarchyColDefs(r)){let a=e.colId;this.gos.validateColDef(e,a,!0);let l=new m.AgColumn(e,null,a,!0);this.createBean(l),s.push(l),function(e,t,i){let s=e.get(t);e.set(t,(s??[]).concat(i))}(t,r,l),i.set(l,r)}return s}createColDefForPart(e,t,i){let{beans:s,gos:r}=this,a=`${m.GROUP_HIERARCHY_COLUMN_ID_PREFIX}-${t.getColId()}-${e}`,l={enableRowGroup:i.enableRowGroup,rowGroup:i.rowGroup,enablePivot:i.enablePivot,hide:!0,editable:!1},n=r.get("groupHierarchyConfig")??{};if(e in n){let t={...l,...n[e]};return t.colId??(t.colId=a),(0,m._addColumnDefaultAndTypes)(s,t,t.colId,!0)}let o=(0,m._addColumnDefaultAndTypes)(s,{colId:a,...l},a,!0),d=this.getLocaleTextFunc(),h=(e,t)=>d?.(e,t)??t;switch(e){case"year":return{...o,headerValueGetter:aE(s,t,h(e,"Year")),valueGetter:aI(s,t,0)};case"quarter":return{...o,headerValueGetter:aE(s,t,h(e,"Quarter")),valueGetter:aI(s,t,1,e=>(Math.floor(Number(e)/4)+1).toString())};case"month":return{...o,headerValueGetter:aE(s,t,h(e,"Month")),valueGetter:aI(s,t,1)};case"formattedMonth":return{...o,headerValueGetter:aE(s,t,h("month","Month")),valueGetter:aI(s,t,1,e=>{let t,i,s=(i=aD[t=m._MONTHS[Number.parseInt(e,10)-1]??e]??e,{month:t,localeKey:i});return h(s.localeKey,s.month)})};case"day":return{...o,headerValueGetter:aE(s,t,h(e,"Day")),valueGetter:aI(s,t,2)};case"hour":return{...o,headerValueGetter:aE(s,t,h(e,"Hour")),valueGetter:aI(s,t,3)};case"minute":return{...o,headerValueGetter:aE(s,t,h(e,"Minute")),valueGetter:aI(s,t,4)};case"second":return{...o,headerValueGetter:aE(s,t,h(e,"Second")),valueGetter:aI(s,t,5)};default:return null}}},aN=class extends m.BaseColsService{constructor(){super(...arguments),this.beanName="pivotColsSvc",this.eventName="columnPivotChanged",this.columnProcessors={set:(e,t,i)=>this.setColPivotActive(e,t,i),add:(e,t,i)=>this.setColPivotActive(e,!0,i),remove:(e,t,i)=>this.setColPivotActive(e,!1,i)},this.columnOrdering={enableProp:"pivot",initialEnableProp:"initialPivot",indexProp:"pivotIndex",initialIndexProp:"initialPivotIndex"},this.columnExtractors={setFlagFunc:(e,t,i)=>this.setColPivotActive(e,t,i),getIndexFunc:e=>e.pivotIndex,getInitialIndexFunc:e=>e.initialPivotIndex,getValueFunc:e=>e.pivot,getInitialValueFunc:e=>e.initialPivot},this.modifyColumnsNoEventsCallbacks={addCol:e=>{this.columns.includes(e)||this.columns.push(e)},removeCol:e=>(0,m._removeFromArray)(this.columns,e)}}syncColumnWithState(e,t,i,s){let{value1:r,value2:a}=i("pivot","pivotIndex");(void 0!==r||void 0!==a)&&("number"==typeof a||r?(e.isPivotActive()||(this.setColPivotActive(e,!0,t),this.modifyColumnsNoEventsCallbacks.addCol(e)),s&&"number"==typeof a&&(s[e.getId()]=a)):e.isPivotActive()&&(this.setColPivotActive(e,!1,t),this.modifyColumnsNoEventsCallbacks.removeCol(e)))}setColPivotActive(e,t,i){if(e.pivotActive!==t){if(e.pivotActive=t,t){let s=this.beans.groupHierarchyColSvc?.insertVirtualColumnsForCol(this.columns,e);s?.forEach(e=>this.setColPivotActive(e,t,i))}e.dispatchColEvent("columnPivotChanged",i)}e.dispatchStateUpdatedEvent("pivot")}},aG=class extends m.BaseColsService{constructor(){super(...arguments),this.beanName="rowGroupColsSvc",this.eventName="columnRowGroupChanged",this.columnProcessors={set:(e,t,i)=>this.setActive(t,e,i),add:(e,t,i)=>this.setActive(!0,e,i),remove:(e,t,i)=>this.setActive(!1,e,i)},this.columnOrdering={enableProp:"rowGroup",initialEnableProp:"initialRowGroup",indexProp:"rowGroupIndex",initialIndexProp:"initialRowGroupIndex"},this.columnExtractors={setFlagFunc:(e,t,i)=>this.setColRowGroupActive(e,t,i),getIndexFunc:e=>e.rowGroupIndex,getInitialIndexFunc:e=>e.initialRowGroupIndex,getValueFunc:e=>e.rowGroup,getInitialValueFunc:e=>e.initialRowGroup},this.modifyColumnsNoEventsCallbacks={addCol:e=>{this.columns.includes(e)||this.columns.push(e)},removeCol:e=>(0,m._removeFromArray)(this.columns,e)}}moveColumn(e,t,i){if(0===this.columns.length)return;let s=this.columns[e],r=this.columns.slice(e,t);this.columns.splice(e,1),this.columns.splice(t,0,s),this.updateIndexMap(),this.eventSvc.dispatchEvent({type:this.eventName,columns:r,column:1===r.length?r[0]:null,source:i})}syncColumnWithState(e,t,i,s){let{value1:r,value2:a}=i("rowGroup","rowGroupIndex");(void 0!==r||void 0!==a)&&("number"==typeof a||r?(e.isRowGroupActive()||(this.setColRowGroupActive(e,!0,t),this.modifyColumnsNoEventsCallbacks.addCol(e)),s&&"number"==typeof a&&(s[e.getId()]=a)):e.isRowGroupActive()&&(this.setColRowGroupActive(e,!1,t),this.modifyColumnsNoEventsCallbacks.removeCol(e)))}setActive(e,t,i){if(e===t.isRowGroupActive())return;this.setColRowGroupActive(t,e,i);let s=this.beans.groupHierarchyColSvc?.getColumn(t);(0,m._shouldUpdateColVisibilityAfterGroup)(this.gos,e)&&!s&&this.colModel.setColsVisible([t],!e,i)}setColRowGroupActive(e,t,i){if(e.rowGroupActive!==t){if(e.rowGroupActive=t,t){let s=this.beans.groupHierarchyColSvc?.insertVirtualColumnsForCol(this.columns,e);s?.forEach(e=>this.setColRowGroupActive(e,t,i))}e.dispatchColEvent("columnRowGroupChanged",i)}e.dispatchStateUpdatedEvent("rowGroup")}},aO=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="autoColSvc"}postConstruct(){this.addManagedPropertyListener("autoGroupColumnDef",this.updateColumns.bind(this))}addColumns(e){null!=this.columns&&(e.list=this.columns.list.concat(e.list),e.tree=this.columns.tree.concat(e.tree),(0,m._updateColsMap)(e))}createColumns(e,t,i){let s=this.beans,{colModel:r,gos:a,rowGroupColsSvc:l,colGroupSvc:n}=s,o=r.isPivotMode(),d=(0,m._isGroupUseEntireRow)(a,o),h=o?a.get("pivotSuppressAutoColumn"):this.isSuppressAutoCol(),u=l?.columns,c=u&&u.length>0||a.get("treeData"),p=()=>{this.columns&&((0,m._destroyColumnTree)(s,this.columns.tree),this.columns=null)};if(!c||h||d)return void p();let g=this.generateAutoCols(u),f=(0,m._areColIdsEqual)(g,this.columns?.list||null),C=e.treeDepth,v=this.columns?this.columns.treeDepth:-1;if(f&&v==C){let e=new Map(g.map(e=>[e.getId(),e]));for(let t of this.columns?.list??[]){let s=e.get(t.getId());s&&t.setColDef(s.getColDef(),null,i)}return}p();let b=n?.findDepth(e.tree)??0,y=n?.balanceTreeForAutoCols(g,b)??[];this.columns={list:g,tree:y,treeDepth:b,map:{}},t(e=>e?[...g,...e.filter(e=>!(0,m.isColumnGroupAutoCol)(e))]:null)}updateColumns(e){let t=(0,m._convertColumnEventSourceType)(e.source);this.columns?.list.forEach((e,i)=>this.updateOneAutoCol(e,i,t))}getColumn(e){return this.columns?.list.find(t=>(0,m._columnsMatch)(t,e))??null}getColumns(){return this.columns?.list??null}generateAutoCols(e=[]){let t=[],{gos:i}=this,s=i.get("treeData"),r=(0,m._isGroupMultiAutoColumn)(i);return s&&r&&((0,m._warn)(182),r=!1),r?e.forEach((e,i)=>{t.push(this.createOneAutoCol(e,i))}):t.push(this.createOneAutoCol()),t}isSuppressAutoCol(){let e=this.gos;return"custom"===e.get("groupDisplayType")||"custom"===e.get("treeDataDisplayType")}createOneAutoCol(e,t){let i;i=e?`${m.GROUP_AUTO_COLUMN_ID}-${e.getId()}`:m.GROUP_AUTO_COLUMN_ID;let s=this.createAutoColDef(i,e,t);s.colId=i;let r=new m.AgColumn(s,null,i,!0);return this.createBean(r),r}updateOneAutoCol(e,t,i){let s=e.getColDef(),r="string"==typeof s.showRowGroup?s.showRowGroup:void 0,a=this.beans,l=null!=r?a.colModel.getColDefCol(r):void 0,n=e.getId(),o=this.createAutoColDef(n,l??void 0,t);e.setColDef(o,null,i),(0,m._applyColumnState)(a,{state:[(0,m._getColumnStateFromColDef)(o,n)]},i)}createAutoColDef(e,t,i){let s=this.createBaseColDef(t),r=this.gos.get("autoGroupColumnDef");(0,m._mergeDeep)(s,r),s=(0,m._addColumnDefaultAndTypes)(this.beans,s,e,!0),!this.gos.get("treeData")&&(0,m._missing)(s.field)&&(0,m._missing)(s.valueGetter)&&(0,m._missing)(s.filterValueGetter)&&"agGroupColumnFilter"!==s.filter&&(s.filter=!1),i&&i>0&&(s.headerCheckboxSelection=!1);let a=(0,m._isColumnsSortingCoupledToGroup)(this.gos),l=s.valueGetter||null!=s.field;return a&&!l&&(s.sortIndex=void 0,s.initialSort=void 0),s}createBaseColDef(e){let t=this.gos.get("autoGroupColumnDef"),i={headerName:this.getLocaleTextFunc()("group","Group"),showRowGroup:e?.getColId()??!0};return t&&(t.cellRenderer||t.cellRendererSelector)||(i.cellRenderer="agGroupCellRenderer"),e&&(i.headerName=this.beans.colNames.getDisplayNameForColumn(e,"header")??void 0,i.headerValueGetter=e.colDef.headerValueGetter),i}destroy(){(0,m._destroyColumnTree)(this.beans,this.columns?.tree),super.destroy()}},aB=class extends m.BeanStub{addExpandedCss(e,t){t.isExpandable()&&(e.push("ag-row-group"),e.push(t.expanded?"ag-row-group-expanded":"ag-row-group-contracted"))}getRowExpandedListeners(e){let{rowNode:t}=e,i=this.updateExpandedCss.bind(this,e,t);return{expandedChanged:i,hasChildrenChanged:i}}setExpanded(e,t,i,s){if(e.expanded===t)return;e.expanded=t,e.dispatchRowEvent("expandedChanged");let r={...(0,m._createGlobalRowEvent)(e,this.gos,"rowGroupOpened"),expanded:t,event:i||null};this.dispatchExpandedEvent(r,s)}isExpandable(e){return!e.footer&&(this.beans.colModel.isPivotMode()?e.hasChildren()&&!e.leafGroup:e.hasChildren()||e.master)}updateExpandedCss(e,t){let i=t.isExpandable(),s=!0==t.expanded;e.forEachGui(void 0,e=>{let t=e.rowComp;t.toggleCss("ag-row-group",i),t.toggleCss("ag-row-group-expanded",i&&s),t.toggleCss("ag-row-group-contracted",i&&!s),(0,m._setAriaExpanded)(e.element,i&&s)})}dispatchStateUpdatedEvent(){this.eventSvc.dispatchEvent({type:"rowExpansionStateChanged"})}},aV=class extends aB{constructor(){super(...arguments),this.beanName="expansionSvc",this.events=null,this.dispatchExpandedDebounced=null}destroy(){super.destroy(),this.events=null,this.dispatchExpandedDebounced=null}setExpansionState(e){let t=new Set(e.expandedRowGroupIds);this.beans.rowModel.forEachNode(e=>{let i=e.id;i&&(e.expanded=t.has(i))}),this.onGroupExpandedOrCollapsed()}getInternalExpansionState(e=!1){let t=[],i=[];return this.beans.rowModel.forEachNode(s=>{let r=s.id;r&&(s.expanded?t.push(r):e&&s.isExpandable()&&i.push(r))}),{expandedRowGroupIds:t,collapsedRowGroupIds:i}}getExpansionState(){return this.getInternalExpansionState()}expandAll(e){let{gos:t,rowModel:i,colModel:s,eventSvc:r}=this.beans,a=t.get("treeData"),l=s.isPivotActive(),n=t=>{if(t)for(let i of t){let t=()=>{i.expanded=e,n(i.childrenAfterGroup)};if(i.master){t();continue}if(a){(0,m._exists)(i.childrenAfterGroup)&&t();continue}if(l){i.leafGroup||t();continue}i.group&&t()}},o=i.rootNode;o&&n(o.childrenAfterGroup),this.onGroupExpandedOrCollapsed(),r.dispatchEvent({type:"expandOrCollapseAll",source:e?"expandAll":"collapseAll"})}onGroupExpandedOrCollapsed(){this.dispatchStateUpdatedEvent(),this.beans.rowModel.reMapRows()}setDetailsExpansionState(e){let t=this.getInternalExpansionState(!0),i=0===t.collapsedRowGroupIds.length;if(0===t.expandedRowGroupIds.length!==i)return i?e.expandAll():e.collapseAll()}dispatchExpandedEvent(e,t){if((this.events??(this.events=[])).push(e),t)return void this.dispatchExpandedEvents();let i=this.dispatchExpandedDebounced;if(!i){if(!this.isAlive())return;i=this.debounce(()=>this.dispatchExpandedEvents()),this.dispatchExpandedDebounced=i}i()}dispatchExpandedEvents(){let{eventSvc:e,rowRenderer:t}=this.beans,i=this.events,s=i?.length;if(!s)return;this.events=null;let r=Array(s);for(let t=0;t<s;++t)r[t]=i[t].node,e.dispatchEvent(i[t]);this.dispatchStateUpdatedEvent(),t.refreshCells({rowNodes:r})}debounce(e){let t=this.beans.animationFrameSvc;if(!t)return()=>window.setTimeout(e,0);let i=!1;return()=>{t.active?i||(i=!0,t.addDestroyTask(()=>{i=!1,e()})):window.setTimeout(e,0)}}};function a_(e){let t=e.get("groupHideParentOfSingleChild");return t||!(t=e.get("groupRemoveSingleChildren"))&&e.get("groupRemoveLowestSingleChildren")&&(t="leafGroupsOnly"),{groupHideParentOfSingleChild:t,isGroupMultiAutoColumn:(0,m._isGroupMultiAutoColumn)(e),hideOpenParents:e.get("groupHideOpenParents"),grandTotalRow:(0,m._getGrandTotalRow)(e),groupTotalRow:(0,m._getGroupTotalRowCallback)(e)}}function az(e,t,i){return!0===e.groupHideParentOfSingleChild&&i&&1===t.childrenAfterGroup.length}function aH(e,t,i){return"leafGroupsOnly"===e.groupHideParentOfSingleChild&&i&&t.leafGroup&&1===t.childrenAfterGroup.length}function aU(e,t,i,s,r,a){let l=s&&t.leafGroup,n=e.hideOpenParents&&t.expanded&&!t.master&&!l;return!(s&&!i)&&!n&&!r&&!a}var aW=()=>{let e=new m._ChangedRowNodes;return e.reordered=!0,e},aK=(e,t)=>{if(!e||!t)return!1;let i=t;for(;i;){if(i===e)return!0;i=i.parent}return!1},a$=(e,t)=>{if(!t||e.parent===t)return!1;let i=t,s=e.id;for(;i;){if(i===e||null!=s&&i.id===s)return!0;i=i.parent}return!1},aj=(e,t)=>{for(let i=0,s=e.length;i<s;++i)if(e[i].parent!==t)return!1;return!0},aY=e=>{let t=e.sibling;if(!t)return null;let i=t._leafs;return void 0!==i?i:aq(t)},aq=e=>{let t,i=e.childrenAfterGroup,s=i?.length;if(e._leafs=null,!s)return null;let r=1===s?i[0]:null;if(r?.group&&r.sourceRowIndex<0)void 0===(t=r._leafs)&&(t=aq(r));else if(e.leafGroup)t=i;else{t=[];for(let e=0;e<s;++e){let s=i[e];if(s.sourceRowIndex>=0&&t.push(s),!s.group)continue;let r=s._leafs;if(void 0===r&&(r=aq(s)),r)for(let e=0,i=r.length;e<i;++e)t.push(r[e])}}return e._leafs=t,t},aZ=(e,t)=>{let i=e._leafs,s=e.sibling;e.treeNodeFlags=0,e.childrenAfterGroup=i,e.childrenMapped=null,e._groupData=void 0,s&&(s.childrenAfterGroup=e.childrenAfterGroup,s.childrenAfterAggFilter=e.childrenAfterAggFilter,s.childrenAfterFilter=e.childrenAfterFilter,s.childrenAfterSort=e.childrenAfterSort,s.childrenMapped=null,s._groupData=void 0);for(let s=0,r=i.length??0;s<r;++s){let r=i[s],a=r.sibling;r._leafs=void 0,aX(r),a&&aX(a),r.parent=e,t&&(r.treeParent=null),r.group=!1,r.updateHasChildren()}e.updateHasChildren()},aX=e=>{e.key=null,e.treeNodeFlags=0,e.allChildrenCount=null,e.childrenAfterGroup=null,e.childrenAfterAggFilter=null,e.childrenAfterFilter=null,e.childrenAfterSort=null,e.childrenMapped=null,e.level=0,e._groupData=void 0};function aJ(e,t,i){let s=e,r=s.level-t.level;if(r<=0||!i.get("groupHideOpenParents"))return!1;for(let e=0;e<r;e++){if(s.parent?.getFirstChild()!==s)return!1;s=s.parent}return s===t}var aQ=(e,t,i,s=t.group)=>{let r=e.gos,a=s&&r.get("isGroupOpenByDefault");if(!a){let e=r.get("groupDefaultExpanded");return -1===e||i<e}return!0==a({api:e.gridApi,context:e.gridOptions.context,rowNode:t,field:t.field,key:t.key,level:i,rowGroupColumn:t.rowGroupColumn})},a0=class extends m.BeanStub{constructor(){super(...arguments),this.indentClass=null}init(e,t,i,s,r,a,l){this.params=l,this.eGui=t,this.eCheckbox=i,this.eExpanded=s,this.eContracted=r,this.comp=e,this.compClass=a;let{node:n,column:o}=l;if(this.node=n,this.displayedNode=n,!this.isEmbeddedRowMismatch()){if(n.footer)return void this.initFooterCell();if(!o)return void this.initFullWidthCell();this.displayedNode=this.beans.showRowGroupColValueSvc?.getDisplayedNode(n,o)??this.node,this.setupExpand(),this.setupCheckbox(),this.addGroupValue(),this.setupIndent()}}initFooterCell(){let{node:e}=this.params;this.addGroupValue(),this.setupIndent(),-1!==e.level&&this.comp.toggleCss("ag-row-group-leaf-indent",!0)}initFullWidthCell(){let e=()=>{let{rowDragSvc:e}=this.beans;if(!this.params.rowDrag||!e)return;let t=e.createRowDragComp(()=>this.params.value,this.params.node);this.createManagedBean(t),this.eGui.insertAdjacentElement("afterbegin",t.getGui())};this.setupExpand(),e(),this.setupCheckbox(),this.addGroupValue(),this.setupIndent()}getCellAriaRole(){let e=this.params.colDef?.cellAriaRole,t=this.params.column?.getColDef().cellAriaRole;return e||t||"gridcell"}isEmbeddedRowMismatch(){if(!this.params.fullWidth||!this.gos.get("embedFullWidthRows"))return!1;let{visibleCols:e}=this.beans,t="left"===this.params.pinned,i="right"===this.params.pinned,s=!t&&!i;return this.gos.get("enableRtl")?e.isPinningLeft()?!i:!s:e.isPinningLeft()?!t:!s}addGroupValue(){let{params:{value:e,valueFormatted:t}}=this,i=this.getInnerCompDetails();this.comp.setInnerRenderer(i,t??e??null)}setupExpand(){let{colModel:e}=this.beans,{eGridCell:t,column:i,suppressDoubleClickExpand:s}=this.params,r=(e,t)=>{let i=(0,m._createIconNoSpan)(e,this.beans,null);i&&(t.appendChild(i),this.addDestroyFunc(()=>i.remove()))};r("groupExpanded",this.eExpanded),r("groupContracted",this.eContracted);let a=this.comp,l=()=>{if(!this.isExpandable())return;let e=this.displayedNode.expanded;a.setExpandedDisplayed(e),a.setContractedDisplayed(!e),(0,m._setAriaExpanded)(t,!!this.displayedNode.expanded)},n=()=>{let i=this.isExpandable();a.toggleCss("ag-cell-expandable",i),a.toggleCss("ag-row-group",i);let s=!i&&e.isPivotMode();a.toggleCss("ag-pivot-leaf-group",s);let r=!e.isPivotMode()&&(!this.displayedNode.footer||-1!==this.displayedNode.level);a.toggleCss("ag-row-group-leaf-indent",!i&&r);let n=this.getChildCount(),o=n>0?`(${n})`:"";a.setChildCount(o),i?l():(a.setExpandedDisplayed(!1),a.setContractedDisplayed(!1),(0,m._removeAriaExpanded)(t))};i?.isCellEditable(this.displayedNode)&&this.gos.get("enableGroupEdit")||s||this.addManagedListeners(t,{dblclick:this.onCellDblClicked.bind(this)}),this.addManagedListeners(this.eExpanded,{click:this.onExpandClicked.bind(this)}),this.addManagedListeners(this.eContracted,{click:this.onExpandClicked.bind(this)}),this.addManagedListeners(t,{keydown:this.onKeyDown.bind(this)}),this.addManagedListeners(this.displayedNode,{allChildrenCountChanged:n,masterChanged:n,groupChanged:n,hasChildrenChanged:n,expandedChanged:l}),n()}getInnerCompDetails(){let{userCompFactory:e,findSvc:t}=this.beans,i=this.params;if(i.fullWidth){let s=this.gos.get("groupRowRendererParams"),r=(0,m._getInnerCellRendererDetails)(e,s,i);return r||(t?.isMatch(i.node,null)?(0,m._getInnerCellRendererDetails)(e,{...s,innerRenderer:"agFindCellRenderer"},i):void 0)}let s=e=>e&&e.componentClass==this.compClass,r=(0,m._getInnerCellRendererDetails)(e,i,i);if(r&&!s(r))return r;let{displayedNode:{rowGroupColumn:a}}=this,l=a?.colDef,n=a&&i.column?.isRowGroupDisplayed(a.getId());if(l&&n){let t=(0,m._getCellRendererDetails)(e,l,i);if(t){if(!s(t))return t;else if(l?.cellRendererParams?.innerRenderer)return(0,m._getInnerCellRendererDetails)(e,l.cellRendererParams,i)}}if(t?.isMatch(i.node,i.column))return(0,m._getCellRendererDetails)(e,{...l??i.colDef,cellRenderer:"agFindCellRenderer"},i)}getChildCount(){let{column:e,suppressCount:t}=this.params;if(t)return 0;let{allChildrenCount:i,rowGroupColumn:s}=this.displayedNode;return!((i??0)>0&&(!s||!e||e?.isRowGroupDisplayed(s.getId())))||this.gos.get("showOpenedGroup")&&this.displayedNode!==this.node&&!aJ(this.node,this.displayedNode,this.gos)?0:i??0}isExpandable(){let{node:e,column:t,colDef:i}=this.params;if(!this.displayedNode.isExpandable()||e.rowPinned)return!1;if(!t)return!0;if(e.hasChildren()&&i){let{showRowGroup:e}=i;if(!e)return!1;if(!0===e)return!0}if(e===this.displayedNode)return!!(e.rowGroupColumn&&t?.isRowGroupDisplayed(e.rowGroupColumn.getId()))||!!e.master&&(i?.showRowGroup===!0||i?.showRowGroup==null);return aJ(this.node,this.displayedNode,this.gos)}setupIndent(){let{suppressPadding:e,node:t,colDef:i}=this.params;if(e)return;let s=()=>{let e=t.uiLevel;i&&!0!==i.showRowGroup&&(e=0);let s="ag-row-group-indent-"+e;s!==this.indentClass&&(this.indentClass&&this.comp.toggleCss(this.indentClass,!1),this.indentClass=s,this.comp.toggleCss(s,!0),this.eGui.style.setProperty("--ag-indentation-level",String(e)))};this.addManagedListeners(t,{uiLevelChanged:s.bind(this)}),s()}setupCheckbox(){let{node:e}=this.params;e.footer||e.rowPinned||e.detail||(this.addManagedPropertyListener("rowSelection",({currentValue:e,previousValue:t})=>{("object"==typeof e?e:void 0)?.checkboxLocation!==("object"==typeof t?t:void 0)?.checkboxLocation&&(this.destroyCheckbox(),this.addCheckbox())}),this.addCheckbox())}addCheckbox(){let{selectionSvc:e}=this.beans;if(!e||!(0,m._isRowSelection)(this.gos))return;let{node:t,column:i}=this.params,s=this.gos.get("rowSelection"),r=(0,m._getCheckboxLocation)(s);if("selectionColumn"===r)return;if("autoGroupColumn"===r){let e=i?.getColDef().showRowGroup!=null,s=!i&&t.group;if(!(e||s))return}let a="object"==typeof s?(0,m._getCheckboxes)(s):this.params.checkbox;if("function"!=typeof a&&!0!==a)return;if("string"==typeof i?.getColDef().showRowGroup&&!this.isExpandable())return void this.comp.setCheckboxSpacing(!0);let l=e.createCheckboxSelectionComponent();this.cbComp=l,this.createBean(l),l.init({rowNode:t,column:i,overrides:{isVisible:a,callbackParams:this.params,removeHidden:!0}}),this.eCheckbox.appendChild(l.getGui()),this.comp.setCheckboxVisible(!0)}destroyCheckbox(){this.comp.setCheckboxSpacing(!1),this.comp.setCheckboxVisible(!1),this.cbComp?.getGui().remove(),this.cbComp=this.destroyBean(this.cbComp)}onExpandClicked(e){(0,m._isStopPropagationForAgGrid)(e)||((0,m._stopPropagationForAgGrid)(e),this.onExpandOrContract(e))}onKeyDown(e){e.key!==m.KeyCode.ENTER||this.params.suppressEnterExpand||this.params.column?.isCellEditable(this.params.node)||this.onExpandOrContract(e)}onCellDblClicked(e){(0,m._isStopPropagationForAgGrid)(e)||(0,m._isElementInEventPath)(this.eExpanded,e)||(0,m._isElementInEventPath)(this.eContracted,e)||this.onExpandOrContract(e)}onExpandOrContract(e){if(!this.isExpandable())return;let t=this.displayedNode,i=!t.expanded;!i&&t.sticky&&this.beans.ctrlsSvc.getScrollFeature().setVerticalScrollPosition(t.rowTop-t.stickyRowTop),t.setExpanded(i,e)}destroy(){super.destroy(),this.destroyCheckbox()}},a1={tag:"span",cls:"ag-cell-wrapper",children:[{tag:"span",ref:"eExpanded",cls:"ag-group-expanded ag-hidden"},{tag:"span",ref:"eContracted",cls:"ag-group-contracted ag-hidden"},{tag:"span",ref:"eCheckbox",cls:"ag-group-checkbox ag-invisible"},{tag:"span",ref:"eValue",cls:"ag-group-value"},{tag:"span",ref:"eChildCount",cls:"ag-group-child-count"}]},a2=class extends m.Component{constructor(){super(a1),this.eExpanded=m.RefPlaceholder,this.eContracted=m.RefPlaceholder,this.eCheckbox=m.RefPlaceholder,this.eValue=m.RefPlaceholder,this.eChildCount=m.RefPlaceholder}init(e){let t=this.createManagedBean(new a0),i=!e.colDef,s=this.getGui();t.init({setInnerRenderer:(e,t)=>this.setRenderDetails(e,t),setChildCount:e=>this.eChildCount.textContent=e,toggleCss:(e,t)=>this.toggleCss(e,t),setContractedDisplayed:e=>(0,m._setDisplayed)(this.eContracted,e),setExpandedDisplayed:e=>(0,m._setDisplayed)(this.eExpanded,e),setCheckboxVisible:e=>this.eCheckbox.classList.toggle("ag-invisible",!e),setCheckboxSpacing:e=>this.eCheckbox.classList.toggle("ag-group-checkbox-spacing",e)},s,this.eCheckbox,this.eExpanded,this.eContracted,this.constructor,e),i&&(0,m._setAriaRole)(s,t.getCellAriaRole())}setRenderDetails(e,t){e?e.newAgStackInstance().then(e=>{if(!e)return;let t=()=>this.destroyBean(e);this.isAlive()?(this.eValue.appendChild(e.getGui()),this.addDestroyFunc(t)):t()}):this.eValue.innerText=t}destroy(){this.destroyBean(this.innerCellRenderer),super.destroy()}refresh(){return!1}},a5=class extends m.BeanStub{constructor(e,t){super(),this.createRowCon=e,this.destroyRowCtrls=t,this.stickyTopRowCtrls=[],this.stickyBottomRowCtrls=[],this.extraTopHeight=0,this.extraBottomHeight=0}postConstruct(){this.isClientSide=(0,m._isClientSideRowModel)(this.gos),this.beans.ctrlsSvc.whenReady(this,e=>{this.gridBodyCtrl=e.gridBodyCtrl}),this.resetStickyContainers()}setOffsetTop(e){this.extraTopHeight!==e&&(this.extraTopHeight=e,this.eventSvc.dispatchEvent({type:"stickyTopOffsetChanged",offset:e}))}setOffsetBottom(e){this.extraBottomHeight!==e&&(this.extraBottomHeight=e)}resetOffsets(){this.setOffsetBottom(0),this.setOffsetTop(0)}getLastPixelOfGroup(e){return this.isClientSide?function(e){if(e.isExpandable()||e.footer){if(e.footer&&0===e.rowIndex)return Number.MAX_SAFE_INTEGER;if(!e.sibling||1===Math.abs(e.sibling.rowIndex-e.rowIndex)){let t=e.footer?e.sibling:e;for(;t.isExpandable()&&t.expanded;)if(t.master&&t.detailNode)t=t.detailNode;else if(t.childrenAfterSort){if(0===t.childrenAfterSort.length)break;t=(0,m._last)(t.childrenAfterSort)}return t.rowTop+t.rowHeight}return e.footer?e.rowTop+e.rowHeight:e.sibling.rowTop+e.sibling.rowHeight}return Number.MAX_SAFE_INTEGER}(e):function(e){if(e.isExpandable()||e.footer){if(e.master&&e.detailNode)return e.detailNode.rowTop+e.detailNode.rowHeight;if(!e.sibling||1===Math.abs(e.sibling.rowIndex-e.rowIndex)){let t=e.childStore?.getStoreBounds();return e.footer&&(t=e.sibling.childStore?.getStoreBounds()),(t?.heightPx??0)+(t?.topPx??0)}return e.footer?e.rowTop+e.rowHeight:e.sibling.rowTop+e.sibling.rowHeight}return Number.MAX_SAFE_INTEGER}(e)}getFirstPixelOfGroup(e){return e.footer?e.sibling.rowTop+e.sibling.rowHeight-1:e.hasChildren()?e.rowTop-1:0}updateStickyRows(e){let t="top"===e,i=0;if(!this.canRowsBeSticky())return this.refreshNodesAndContainerHeight(e,new Set,i);let s=new Set,{rowModel:r,rowRenderer:a,pinnedRowModel:l,pageBounds:n,rowContainerHeight:o}=this.beans,{pageFirstPixel:d,pageLastPixel:h}=n.getCurrentPagePixelRange(),u=t?a.firstVisibleVPixel-this.extraTopHeight:a.lastVisibleVPixel-this.extraTopHeight,c=o.divStretchOffset??0,p=d+c,g=h+c,m=e=>{if(s.add(e),t){let t=this.getLastPixelOfGroup(e),s=u+i+e.rowHeight;t<s?e.stickyRowTop=i+(t-s):e.stickyRowTop=i}else{let t=this.getFirstPixelOfGroup(e),s=u-(i+e.rowHeight);t>s?e.stickyRowTop=i-(t-s):e.stickyRowTop=i}i=0,s.forEach(e=>{let t=e.stickyRowTop+e.rowHeight;i<t&&(i=t)})},f=this.areFooterRowsStickySuppressed(),C=this.gos.get("suppressGroupRowsSticky"),v=t=>{if(!t.displayed)return!1;if(t.footer){if(!0===f||"grand"===f&&-1===t.level||"group"===f&&t.level>-1)return!1;let i=!!t.sibling.rowIndex&&t.sibling.rowIndex+1===t.rowIndex;return!("bottom"===e&&i||-1===t.level&&l?.getGrandTotalPinned())&&!s.has(t)}return!!t.isExpandable()&&!0!==C&&"bottom"!==e&&!s.has(t)&&t.expanded};for(let e=0;e<100;e++){let e=u+i;t||(e=u-i),t&&e<p?e=p:!t&&e>g&&(e=g);let s=r.getRowIndexAtPixel(e),a=r.getRow(s);if(null==a)break;let l=this.getStickyAncestors(a).find(e=>(t?e.rowIndex<s:e.rowIndex>s)&&v(e));if(l){m(l);continue}if((t?a.rowTop<e:a.rowTop+a.rowHeight>e)&&v(a)){m(a);continue}break}return t||s.forEach(e=>{e.stickyRowTop=i-(e.stickyRowTop+e.rowHeight)}),this.refreshNodesAndContainerHeight(e,s,i)}areFooterRowsStickySuppressed(){let e=this.gos.get("suppressStickyTotalRow");if(!0===e)return!0;let t="group"===e,i="grand"===e;return!!t&&!!i||(i?"grand":!!t&&"group")}canRowsBeSticky(){let e=(0,m._isGroupRowsSticky)(this.gos),t=this.areFooterRowsStickySuppressed(),i=this.gos.get("suppressGroupRowsSticky");return e&&(!t||!i)}getStickyAncestors(e){let t=[],i=e.footer?e.sibling:e.parent;for(;i;)i.sibling&&t.push(i.sibling),t.push(i),i=i.parent;return t.reverse()}checkStickyRows(){let e=this.updateStickyRows("top"),t=this.updateStickyRows("bottom");return e||t}destroyStickyCtrls(){this.resetStickyContainers()}resetStickyContainers(){this.refreshNodesAndContainerHeight("top",new Set,0),this.refreshNodesAndContainerHeight("bottom",new Set,0)}refreshStickyNode(e){let t=new Set;if(this.stickyTopRowCtrls.some(t=>t.rowNode===e)){for(let i=0;i<this.stickyTopRowCtrls.length;i++){let s=this.stickyTopRowCtrls[i].rowNode;s!==e&&t.add(s)}this.refreshNodesAndContainerHeight("top",t,this.topContainerHeight)&&this.checkStickyRows();return}for(let i=0;i<this.stickyBottomRowCtrls.length;i++){let s=this.stickyBottomRowCtrls[i].rowNode;s!==e&&t.add(s)}this.refreshNodesAndContainerHeight("bottom",t,this.bottomContainerHeight)&&this.checkStickyRows()}refreshNodesAndContainerHeight(e,t,i){let s="top"===e,r=s?this.stickyTopRowCtrls:this.stickyBottomRowCtrls,a={},l=[];for(let e=0;e<r.length;e++){let i=r[e].rowNode;if(!t.has(i)){a[i.id]=r[e],i.sticky=!1;continue}l.push(r[e])}let n=new Set;for(let e=0;e<l.length;e++)n.add(l[e].rowNode);let o=[];t.forEach(e=>{n.has(e)||(e.sticky=!0,o.push(this.createRowCon(e,!1,!1)))});let d=!!o.length||l.length!==r.length;s?this.topContainerHeight!==i&&(this.topContainerHeight=i,this.gridBodyCtrl.setStickyTopHeight(i),d=!0):this.bottomContainerHeight!==i&&(this.bottomContainerHeight=i,this.gridBodyCtrl.setStickyBottomHeight(i),d=!0),this.destroyRowCtrls(a,!1);let h=[...l,...o];for(let e of(h.sort((e,t)=>t.rowNode.rowIndex-e.rowNode.rowIndex),s||h.reverse(),h))e.setRowTop(e.rowNode.stickyRowTop);let u=this.beans.pageBounds,c=0;if(s){for(let e of t)e.rowIndex<u.getFirstRow()&&(c+=e.rowHeight);c>this.topContainerHeight&&(c=this.topContainerHeight),this.setOffsetTop(c)}else{for(let e of t)e.rowIndex>u.getLastRow()&&(c+=e.rowHeight);c>this.bottomContainerHeight&&(c=this.bottomContainerHeight),this.setOffsetBottom(c)}return!!d&&(s?this.stickyTopRowCtrls=h:this.stickyBottomRowCtrls=h,!0)}ensureRowHeightsValid(){let e=!1,t=t=>{let i=t.rowNode;if(i.rowHeightEstimated){let t=(0,m._getRowHeightForNode)(this.beans,i);i.setRowHeight(t.height),e=!0}};return this.stickyTopRowCtrls.forEach(t),this.stickyBottomRowCtrls.forEach(t),e}},a4={moduleName:"GroupCellRenderer",version:tv,userComponents:{agGroupRowRenderer:a2,agGroupCellRenderer:a2},dynamicBeans:{groupCellRendererCtrl:a0},icons:{groupContracted:"tree-closed",groupExpanded:"tree-open"},css:[".ag-group-checkbox-spacing{width:var(--ag-icon-size)}:where(.ag-ltr) .ag-group-checkbox-spacing{margin-right:var(--ag-cell-widget-spacing)}:where(.ag-rtl) .ag-group-checkbox-spacing{margin-left:var(--ag-cell-widget-spacing)}"],dependsOn:[tb]},a3={moduleName:"GroupColumn",version:tv,beans:[aO,class extends m.BeanStub{constructor(){super(...arguments),this.beanName="showRowGroupCols",this.columns=[],this.colsSet=new Set,this.colsMap=new Map}destroy(){super.destroy(),this.columns.length=0,this.colsSet.clear(),this.colsMap.clear()}refresh(){let{colModel:e,rowGroupColsSvc:t}=this.beans,i=this.columns,s=this.colsSet,r=this.colsMap;r.clear();let a=i.length,l=0,n=!1,o=e.getCols();for(let e=0,d=o.length;e<d;++e){let d=o[e],h=d.getColDef().showRowGroup;if("string"==typeof h)r.set(h,d);else{if(!0!==h)continue;let e=t?.columns;if(e)for(let t=0,i=e.length;t<i;++t)r.set(e[t].getId(),d)}n||(n=l>=a||!s.has(d)),i[l++]=d}if(n||(n=l!==a),n){i.length=l,s.clear();for(let e=0;e<l;++e)s.add(i[e]);this.eventSvc.dispatchEvent({type:"showRowGroupColsSetChanged"})}}getShowRowGroupCol(e){return this.colsMap.get(e)}getSourceColumnsForGroupColumn(e){let t=e.getColDef().showRowGroup;if(!t)return null;let{rowGroupColsSvc:i,colModel:s}=this.beans;if(!0===t&&i)return i.columns;let r=s.getColDefCol(t);return r?[r]:null}isRowGroupDisplayed(e,t){let i=e.getColDef()?.showRowGroup;return!0===i||null!=i&&i===t}},class extends m.BeanStub{constructor(){super(...arguments),this.beanName="showRowGroupColValueSvc"}getGroupValue(e,t,i){if(!t)return e.group?{displayedNode:e,value:e.groupValue}:null;let s=this.beans.valueSvc,r=t.colDef.showRowGroup;if(!r)return null;if(-1===e.level&&e.footer)return{displayedNode:e,value:null};if("string"==typeof r){if((this.beans.rowGroupColsSvc?.getColumnIndex(r)??-1)>e.level)return null;let a=this.getDisplayedNode(e,t,!0);if(a)return{displayedNode:a,value:s.getValue(t,a,"data",i)}}let a=s.getValue(t,e,"data",i);if(null==a){let r=this.getDisplayedNode(e,t);if(r)return{displayedNode:r,value:s.getValue(t,r,"data",i)}}return{displayedNode:e,value:a}}formatAndPrefixGroupColValue(e,t,i=!1){let s=this.formatGroupColValue(e,t,i),{value:r,displayedNode:a}=e,l=this.beans.footerSvc;return l?.doesCellShowTotalPrefix(a,t)?l.applyTotalPrefix(r,s,a,t):a.footer&&-1===a.level?null:s}formatGroupColValue(e,t,i=!1){let s=this.beans.valueSvc,{displayedNode:r,value:a}=e,l=r.rowGroupColumn,n=r.group&&!t;if(l&&(n||t?.isRowGroupDisplayed(l.colId))){if(i&&!1===l.colDef.useValueFormatterForExport)return null;let e=s.formatValue(l,r,a);return null==e&&""===r.key?this.getLocaleTextFunc()("blanks","(Blanks)"):e}return!t||r.group||i&&!1===t.colDef.useValueFormatterForExport?null:s.formatValue(t,r,a)}getDisplayedNode(e,t,i=!1){let s=this.gos,r=s.get("groupHideOpenParents"),a=s.get("showOpenedGroup")&&!i;if(!r&&!a)return;let l=t.colDef.showRowGroup;if(!0===l){if(e.group)return;return e.parent??void 0}let n=e;for(;n&&n.rowGroupColumn?.getId()!=l;){let e=n===n.parent?.getFirstChild();if(!a&&!e)return;n=n.parent}if(n!==e)return n??void 0}},aG,aN,aR],dependsOn:[tb,a4]},a6={moduleName:"ClientSideRowModelHierarchy",version:tv,rowModels:["clientSide"],beans:[class extends m.BeanStub{constructor(){super(...arguments),this.beanName="groupStage",this.step="group",this.refreshProps=["groupAllowUnbalanced","groupDefaultExpanded","groupDisplayType","groupHideOpenParents","initialGroupOrderComparator","treeData","treeDataChildrenField","treeDataParentIdField"],this.treeData=!1,this.hasTreeData=!1,this.needReset=!1,this.nested=!1,this.strategy=void 0}postConstruct(){let e=this.gos;e.isModuleRegistered("TreeData")&&(this.hasTreeData=!0,this.treeData=e.get("treeData")),this.addManagedEventListeners({showRowGroupColsSetChanged:()=>this.strategy?.onShowRowGroupColsSetChanged()})}invalidateGroupCols(){this.strategy?.invalidateGroupCols?.()}destroy(){this.strategy=this.destroyBean(this.strategy),super.destroy()}getNonLeaf(e){return this.strategy?.nonLeafsById?.get(e)}getNestedDataGetter(){return this.getStrategy()?.nestedDataGetter}onPropChange(e){let t=this.gos,i=this.strategy?.nestedDataGetter;if(e.has("treeData")){let e=t.get("treeData")&&this.hasTreeData;this.treeData!==e&&(this.beans.rowDragSvc?.cancelRowDrag(),this.treeData=e,this.needReset=!0,this.strategy=this.destroyBean(this.strategy))}return this.strategy?.onPropChange?.(e),this.getNestedDataGetter()!==i}extractData(){let e=this.beans.rowModel.rootNode,t=this.nested?e?.childrenAfterGroup:e?._leafs;if(!t)return this.gos.get("rowData")??[];let i=t.length,s=Array(i),r=0;for(let e=0;e<i;++e){let i=t[e].data;null!=i&&(s[r++]=i)}return s.length=r,s}execute(e){let t=this.beans,i=t.rowModel.rootNode;if(!i)return!1;let s=this.getStrategy(),r=!!s?.nestedDataGetter,a=this.needReset;return this.nested=r,a&&(this.needReset=!1,t.rowDragSvc?.cancelRowDrag(),e.animate=!1,aZ(i,!r)),s?s.execute(i,e)||a:void 0}loadLeafs(e){return e.footer?aY(e):aq(e)}loadGroupData(e){let t=this.getStrategy();return t?t.loadGroupData(e):(e._groupData=null,null)}clearNonLeafs(){this.strategy?.clearNonLeafs()}getStrategy(){let e=this.strategy;return void 0!==e&&this.isAlive()||(e=this.beans.registry.createDynamicBean(this.treeData?"treeGroupStrategy":"groupStrategy",!1)??null,this.strategy=e&&this.createBean(e)),e}},class extends m.BeanStub{constructor(){super(...arguments),this.beanName="flattenStage",this.step="map",this.refreshProps=["groupHideParentOfSingleChild","groupRemoveSingleChildren","groupRemoveLowestSingleChildren","groupTotalRow","masterDetail"]}execute(){let{beans:e,gos:t}=this,i=[],s=e.rowModel.rootNode;if(!s)return i;let r=e.colModel.isPivotMode(),a=r&&s.leafGroup&&s.aggData,l=a?[s]:s.childrenAfterSort,n=a_(t);this.recursivelyAddToRowsToDisplay(n,l,i,r,0);let o=i.length>0,d=n.grandTotalRow;return!a&&o&&d&&(aA(s,e),"pinnedBottom"===d||"pinnedTop"===d?this.beans.pinnedRowModel?.setGrandTotalPinned("pinnedBottom"===d?"bottom":"top"):this.addRowNodeToRowsToDisplay(n,s.sibling,i,0,"top"===d)),i}recursivelyAddToRowsToDisplay(e,t,i,s,r){if(!t?.length)return;let a=this.beans.masterDetailSvc;for(let l=0;l<t.length;l++){let n=t[l],o=n.hasChildren(),d=az(e,n,o),h=aH(e,n,o);if(aU(e,n,o,s,d,h)&&this.addRowNodeToRowsToDisplay(e,n,i,r),!s||!n.leafGroup)if(o){let t=d||h;if(n.expanded||t){let l=e.groupTotalRow({node:n});l||aM(n);let o=t?r:r+1;"top"===l&&(aA(n,this.beans),this.addRowNodeToRowsToDisplay(e,n.sibling,i,o));let d=a?.getDetail(n);d&&this.addRowNodeToRowsToDisplay(e,d,i,r),this.recursivelyAddToRowsToDisplay(e,n.childrenAfterSort,i,s,o),"bottom"===l&&(aA(n,this.beans),this.addRowNodeToRowsToDisplay(e,n.sibling,i,o))}}else{let t=a?.getDetail(n);t&&this.addRowNodeToRowsToDisplay(e,t,i,r)}}}addRowNodeToRowsToDisplay(e,t,i,s,r){r?i.unshift(t):i.push(t),t.setUiLevel(e.isGroupMultiAutoColumn?0:s)}},aV],dependsOn:[tb]},a8={moduleName:"StickyRow",version:tv,beans:[class extends m.BeanStub{constructor(){super(...arguments),this.beanName="stickyRowSvc"}createStickyRowFeature(e,t,i){let s=this.gos;if((0,m._isGroupRowsSticky)(s)&&(0,m._isClientSideRowModel)(s)||(0,m._isServerSideRowModel)(s))return e.createManagedBean(new a5(t,i))}}]},a7={moduleName:"GroupEdit",version:tv,beans:[class extends m.BeanStub{constructor(){super(...arguments),this.beanName="groupEditSvc",this.pendingEditRefresh=null,this.dropGroupTarget=null,this.dropGroupTimer=null,this.dropGroupThrottled=!1,this.draggingGroups=null}postConstruct(){(0,m._isClientSideRowModel)(this.gos)&&this.addManagedListeners(this.eventSvc,{cellValueChanged:e=>this.onCsrmCellChange(e),batchEditingStopped:()=>this.flushGroupEdits()})}destroy(){this.stopDragging(!0),super.destroy()}isGroupingDrop(e){return!!e.rowDragManaged&&!!e.sameGrid&&!!this.gos.get("refreshAfterGroupEdit")&&!!this.beans.rowGroupColsSvc?.columns?.length&&!this.beans.colModel.isPivotMode()}initDraggingGroups(e){let t=new Map,i=e=>{let s=e.childrenAfterGroup;if(s){if(t.has(e))return;let r=s.slice();for(let s of(t.set(e,r),r))i(s)}};for(let t of e.rows)t.group&&i(t);this.draggingGroups=t}canSetParent(e){return!!e.sameGrid&&(!!this.beans.groupStage?.treeData||(!e.rowDragManaged||!!this.gos.get("refreshAfterGroupEdit"))&&!!this.beans.rowGroupColsSvc?.columns?.length)}canDropRow(e,t){if(this.beans.groupStage?.treeData)return!a$(e,t.newParent);let{position:i,target:s,newParent:r,rootNode:a}=t,l=e.parent;if(e.group&&(aK(e,s)||aK(e,r)))return!1;if("inside"===i)return!0;if(r&&r!==l)return r!==a||l===a;let n=r??s?.parent??a;if(n!==l)return!1;let o=e.group?e.level:l.level??-1,d=-1;return s?d=s.group?s.level:s.parent?.level??-1:n&&(d=n.level),!(o>=0)||!(d>=0)||d===o}fixRowsDrop(e,t,i,s){let r=!!this.beans.groupStage?.treeData;if(e.treeData=r,!(this.beans.rowGroupColsSvc?.columns?.length||this.gos.get("pivotMode"))&&!r)return;!this.draggingGroups&&this.isGroupingDrop(e)&&!e.suppressMoveWhenRowDragging&&this.initDraggingGroups(e);let a=e.target,l=null,n=!1,o=e.rootNode,d=this.beans.rowModel,h=this.canStartGroup(a,r);this.updateDropTarget(e,i,h);let u=this.beans.pageBounds?.getLastRow?.()??d.getRowCount()-1;if(t&&(!a||s>=.5&&a.rowIndex===u?l=o:e.moved&&a&&this.dropGroupThrottled&&this.shouldDropTargetBeParent(e)&&(l=a),l||(l=a?.parent??o)),!i&&a&&h&&!(a.group&&a.expanded)&&this.startDropGroupDelay(a),l){if(a&&l===a&&l!==o){let e=l.expanded?(0,m._prevOrNextDisplayedRow)(d,1,a):null;e?.parent===l?(a=e,s=-.5):n=!0}if(a&&!n){let e=a;for(;e&&e!==o&&e!==l;)a=e,e=e.parent}}e.target=a,e.newParent=l,e.yDelta=s,e.inside=n}clearNewSameParent(e,t){let i=e.newParent;i&&(!t||aj(e.rows,i))&&(e.newParent=null)}updateDropTarget(e,t,i){let s=i?e.target:null;this.dropGroupTarget&&this.dropGroupTarget!==s&&this.resetDragGroup(),s?.childrenAfterSort?.length&&(t&&this.dropGroupThrottled&&!s.expanded&&s.isExpandable?.()&&s.setExpanded(!0,void 0,!0),this.canDropInTarget(s,e)&&(this.dropGroupThrottled=!0,this.dropGroupTarget=s))}canDropInTarget(e,t){if(e.expanded)return!0;if(!e.group)return!1;if("inside"===t.pointerPos)return!0;if(t.treeData)return!1;let i=t.rows,s=e.level;for(let t=0,r=i.length;t<r;++t){let r=i[t];if(r!==e&&r.group&&r.level!==s)return!1}return!0}startDropGroupDelay(e){if(this.dropGroupTarget&&this.dropGroupTarget!==e&&this.resetDragGroup(),this.dropGroupTarget=e,null!==this.dropGroupTimer)return;let t=this.gos.get("rowDragInsertDelay");this.dropGroupTimer=window.setTimeout(()=>{this.dropGroupTimer=null,this.dropGroupThrottled=!0,this.beans.dragAndDrop?.nudge()},t)}resetDragGroup(){null!==this.dropGroupTimer&&(window.clearTimeout(this.dropGroupTimer),this.dropGroupTimer=null),this.dropGroupTarget=null,this.dropGroupThrottled=!1}stopDragging(e){e&&(this.draggingGroups=null),this.resetDragGroup()}shouldDropTargetBeParent({target:e,rows:t,pointerPos:i,treeData:s}){let r;if(!e||"none"===i)return!1;if("inside"===i||!s&&e.group&&!e.expanded)return!0;if("above"===i)return!1;let a=this.beans.rowModel,l=e.rowIndex+1;do r=a.getRow(l++);while(r?.footer)let n=this.draggingGroups?.get(e)??e.childrenAfterGroup;if(r&&r.parent===e&&n?.length){let e=new Set(t);for(let t=0,i=n.length;t<i;++t){let i=n[t];if(null!==i.rowIndex&&!e.has(i))return!0}}return!1}dropGroupEdit(e){let t,{beans:i}=this,s=e.position,r=e.target??null,a=e.rootNode,l=e.newParent??r?.parent??a,n=i.focusSvc,o=n.getFocusedCell(),d=o&&(0,m._getCellByPosition)(i,o),h=new Set,u=new m._ChangedRowNodes,c=u.updates,p=e=>{!h.has(e)&&(h.add(e),t??(t=this.newGroupValues(l)),this.setRowGroup(e,t)&&c.add(e))},g=e=>{let t=this.draggingGroups?.get(e)??e.childrenAfterGroup,i=t?.length;if(i)for(let e=0;e<i;++e){let i=t[e];i.sourceRowIndex>=0?p(i):g(i)}};for(let t of e.rows)if(t.group)g(t);else{let e=t.sourceRowIndex>=0&&!t.destroyed?t:this.csrmFirstLeaf(t);e&&p(e)}let f="inside"===s?"above":s,C="inside"===s?this.findFirstLeafForParent(l,h)??r:r,v=!1;if(h.size&&"none"!==f&&(v=(0,m._csrmReorderAllLeafs)(a._leafs,h,C,"above"===f)),!c.size&&!v)return!1;for(let e of(u.reordered=v,h))u.updates.add(e);return this.csrmRefresh(u),d?d.focusCell():n.clearFocusedCell(),!0}canStartGroup(e,t){return!!e&&!(e.level<0)&&!e.footer&&!e.detail&&(!!e.group||t)}flushGroupEdits(){let e=this.pendingEditRefresh;e&&(this.pendingEditRefresh=null,this.csrmRefresh(e))}csrmRefresh(e){let t=this.beans.rowModel,i=t.rootNode;i&&t.refreshModel({step:"group",keepRenderedRows:!0,animate:!this.gos.get("suppressAnimationFrame"),changedPath:new m.ChangedPath(!1,i),changedRowNodes:e})}newGroupValues(e){let t=this.beans.rowGroupColsSvc?.columns??[],i=Array(t.length),s=-1,r=e;for(;r&&r.level>=0;){let e=t[r.level];if(e){let t=e.getColId(),a=r.level;i[a]=r.groupData?.[t]??r.key??void 0,a>s&&(s=a)}r=r.parent}return{values:i,columns:t,maxLevel:s}}setRowGroup(e,{values:t,columns:i,maxLevel:s}){if(s<0)return!1;let{valueSvc:r}=this.beans,a=!1;for(let l=0;l<i.length;++l){let n=i[l];if(!n||l>s)continue;let o=t[l],d=r.getValue(n,e,"data");if(d===o||null==d&&null==o)continue;let h=o,u=r.parseValue(n,e,o,d);void 0!==u&&(h=u),e.setDataValue(n,h,"rowDrag")&&(a=!0)}return a}onCsrmCellChange(e){let{column:t,node:i,source:s}=e;if(!this.gos.get("refreshAfterGroupEdit")||"rowDrag"===s||!t?.isRowGroupActive()||i.group||!i.data)return;let r=this.beans.editSvc;if(r?.isBatchEditing()){let e=this.pendingEditRefresh;e||(e=aW(),this.pendingEditRefresh=e),e.updates.add(i)}else{let e=aW();e.updates.add(i),this.csrmRefresh(e)}}csrmFirstLeaf(e){if(!e)return null;let t=this.draggingGroups,i=t?.get(e)??e.childrenAfterGroup;for(;i?.length;){let e=i[0];if(e.sourceRowIndex>=0){if(!e.destroyed)return e;return this.firstAliveChildLeaf(e)}i=t?.get(e)??e.childrenAfterGroup}return(0,m._csrmFirstLeaf)(e)}firstAliveChildLeaf(e){let t=this.draggingGroups?.get(e)??e.childrenAfterGroup;if(t){for(let e of t)if(e.sourceRowIndex>=0&&!e.destroyed)return e}return null}findFirstLeafForParent(e,t){if(!e)return null;let i=this.draggingGroups?.get(e)??e?.childrenAfterGroup;if(!i)return null;for(let e=0,s=i.length;e<s;++e){let s=i[e];if(s.sourceRowIndex>=0&&!t.has(s))return s;let r=this.findFirstLeafForParent(s,t);if(null!==r)return r}return null}}],dependsOn:[tb,a6]},a9={tag:"div",cls:"ag-group-filter",children:[{tag:"div",ref:"eGroupField"},{tag:"div",ref:"eUnderlyingFilter"}]},le=class extends m.TabGuardComp{constructor(){super(a9),this.filterType="group",this.eGroupField=m.RefPlaceholder,this.eUnderlyingFilter=m.RefPlaceholder}wireBeans(e){this.groupFilterSvc=e.groupFilter}postConstruct(){this.initialiseTabGuard({})}init(e){return this.params=e,this.updateParams().then(()=>{this.addHandlerListeners(this.updateGroups.bind(this))})}refresh(e){return this.params=e,"colDef"===e.source&&this.updateParams(),!0}updateParams(){return this.validateParams(),this.updateGroups()}validateParams(){let{colDef:e}=this.params;e.field&&(0,m._warn)(234),e.filterValueGetter&&(0,m._warn)(235),e.filterParams&&(0,m._warn)(236)}addHandlerListeners(e){let t=this.addManagedListeners(this.getHandler(),{sourceColumnsChanged:()=>{this.updateGroups()},destroyed:()=>{for(let e of t)e();this.addHandlerListeners(e)}})}updateGroups(){let{sourceColumns:e,selectedColumn:t}=this.updateGroupField();return this.dispatchLocalEvent({type:"columnsChanged"}),this.getUnderlyingFilters(e,t)}updateGroupField(){this.groupColumn=this.params.column;let e=this.getHandler();if(!e)return{sourceColumns:null};let{sourceColumns:t,hasMultipleColumns:i,selectedColumn:s}=e,r=this.eGroupField;return(0,m._clearElement)(r),this.eGroupFieldSelect&&this.destroyBean(this.eGroupFieldSelect),i&&t&&(this.createGroupFieldSelectElement(t,s),r.appendChild(this.eGroupFieldSelect.getGui()),r.appendChild((0,m._createElement)({tag:"div",cls:"ag-filter-separator"}))),(0,m._setDisplayed)(r,i),{sourceColumns:t,selectedColumn:s}}createGroupFieldSelectElement(e,t){let i=this.createManagedBean(new m.AgSelect);this.eGroupFieldSelect=i;let s=this.getLocaleTextFunc();i.setLabel(s("groupFilterSelect","Select field:")),i.setLabelAlignment("top"),i.addOptions(e.map(e=>({value:e.getColId(),text:this.beans.colNames.getDisplayNameForColumn(e,"groupFilter",!1)??void 0}))),i.setValue(t.getColId()),i.onValueChange(e=>this.updateSelectedColumn(e)),i.addCss("ag-group-filter-field-select-wrapper"),1===e.length&&i.setDisabled(!0)}getUnderlyingFilters(e,t){if(!e)return this.filterColumnPairs=void 0,this.selectedFilter=void 0,m.AgPromise.resolve();let i=[],s=[],r=this.beans.colFilter;for(let a of e){let e=r.getOrCreateFilterUi(a);e&&i.push(e.then(e=>{e&&s.push({filter:e,column:a}),a.getColId()===t.getColId()&&(this.selectedFilter=e??void 0)}))}return m.AgPromise.all(i).then(()=>{this.filterColumnPairs=s})}addUnderlyingFilterElement(e){if((0,m._clearElement)(this.eUnderlyingFilter),!e)return m.AgPromise.resolve();let t=this.createManagedBean(new m.FilterComp(e,"COLUMN_MENU"));return(this.filterComp=t,t.hasFilter())?(this.eUnderlyingFilter.appendChild(t.getGui()),t.getFilter()?.then(()=>{t.afterGuiAttached?.(this.afterGuiAttachedParams),this.afterGuiAttachedParams?.suppressFocus||!this.eGroupFieldSelect||this.eGroupFieldSelect.isDisabled()||this.eGroupFieldSelect.getFocusableElement().focus()})??m.AgPromise.resolve()):m.AgPromise.resolve()}updateSelectedColumn(e){if(!e)return;this.filterComp?.afterGuiDetached(),this.destroyBean(this.filterComp);let t=this.getFilterColumnPair(e),i=t?.column;this.selectedFilter=t?.filter,this.getHandler().setSelectedColumn(i),this.dispatchLocalEvent({type:"columnsChanged"}),this.addUnderlyingFilterElement(i)}isFilterActive(){return this.groupFilterSvc.isFilterActive(this.groupColumn)}doesFilterPass(){return!0}getModel(){return null}setModel(){}afterGuiAttached(e){this.afterGuiAttachedParams=e,this.addUnderlyingFilterElement(this.getHandler().selectedColumn)}afterGuiDetached(){(0,m._clearElement)(this.eUnderlyingFilter),this.selectedFilter?.afterGuiDetached?.()}getSelectedColumn(){return this.getHandler().selectedColumn}getHandler(){return this.params.getHandler()}getFilterColumnPair(e){if(e)return this.filterColumnPairs?.find(({column:t})=>t.getColId()===e)}},lt=class extends m.BeanStub{init(e){this.params=e,this.validateModel(e),this.updateColumns(),this.addManagedEventListeners({columnRowGroupChanged:this.updateColumns.bind(this),filterDestroyed:e=>this.onFilterDestroyed(e)})}refresh(e){this.params=e,this.validateModel(e),"colDef"===e.source&&this.updateColumns()}doesFilterPass(){return!0}setSelectedColumn(e){this.selectedColumn=e,this.dispatchLocalEvent({type:"selectedColumnChanged"})}validateModel(e){null!=e.model&&e.onModelChange(null)}getSourceColumns(){let e=this.params.column;if(this.gos.get("treeData"))return(0,m._warn)(237),[];let t=this.beans.groupFilter.getSourceColumns(e);return t||((0,m._warn)(183),[])}updateColumns(){let e,t,i=this.getSourceColumns(),s=i.filter(e=>e.isFilterAllowed());this.sourceColumns=s,s.length?1===i.length?(e=s[0],t=!1):((e=this.selectedColumn)&&s.some(t=>t.getId()===e.getId())||(e=s[0]),t=!0):(e=void 0,t=!1),this.selectedColumn=e,this.hasMultipleColumns=t,this.dispatchLocalEvent({type:"sourceColumnsChanged"})}onFilterDestroyed({column:e,source:t}){if("gridDestroyed"===t)return;let i=e.getColId();this.sourceColumns?.some(e=>e.getColId()===i)&&setTimeout(()=>{this.isAlive()&&this.updateColumns()})}},li=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="groupFilter"}postConstruct(){this.addManagedEventListeners({columnRowGroupChanged:()=>this.updateFilterFlags("columnRowGroupChanged")})}isGroupFilter(e){return"agGroupColumnFilter"===e.getColDef().filter}isFilterAllowed(e){let t=this.beans.colFilter;return!!this.getSourceColumns(e)?.some(e=>t?.isFilterAllowed(e))}isFilterActive(e){let t=this.beans.colFilter;return!!this.getSourceColumns(e)?.some(e=>t?.isFilterActive(e))}getSourceColumns(e){return this.beans.showRowGroupCols?.getSourceColumnsForGroupColumn(e)}updateFilterFlags(e,t){let{autoColSvc:i,colFilter:s}=this.beans;i?.getColumns()?.forEach(i=>{this.isGroupFilter(i)&&s?.setColFilterActive(i,this.isFilterActive(i),e,t)})}},ls={tag:"div",ref:"eFloatingFilter",cls:"ag-group-floating-filter ag-floating-filter-input",role:"presentation"},lr=class extends m.Component{constructor(){super(ls),this.eFloatingFilter=m.RefPlaceholder,this.haveAddedColumnListeners=!1}init(e){this.params=e;let t=(0,m._isGroupMultiAutoColumn)(this.gos),i=this.onColChange.bind(this),s=e=>{t?this.setupUnderlyingFloatingFilterElement().then(()=>e()):(this.setupReadOnlyFloatingFilterElement(),e())};return this.gos.get("enableFilterHandlers")?new m.AgPromise(e=>s(e)).then(()=>{this.addHandlerListeners(e,i)}):new m.AgPromise(e=>{this.params.parentFilterInstance(t=>{this.parentFilterInstance=t,s(e)})}).then(()=>{this.addManagedListeners(this.parentFilterInstance,{columnsChanged:i})})}refresh(e){if(this.params=e,this.setParams(),this.gos.get("enableFilterHandlers"))if(this.showingUnderlyingFloatingFilter){let e=this.getSelectedColumn(),t=this.beans.colFilter.getFloatingFilterCompDetails(e,this.params.showParentFilter);this.underlyingFloatingFilter?.refresh?.(t?.params)}else this.updateDisplayedValue()}setParams(){let e=this.beans.colNames.getDisplayNameForColumn(this.params.column,"header",!0),t=this.getLocaleTextFunc();this.eFloatingFilterText?.setInputAriaLabel(`${e} ${t("ariaFilterInput","Filter Input")}`)}addHandlerListeners(e,t){let i=this.addManagedListeners(e.getHandler(),{selectedColumnChanged:t,sourceColumnsChanged:t,destroyed:()=>{for(let e of i)e();this.addHandlerListeners(this.params,t)}})}setupReadOnlyFloatingFilterElement(){this.eFloatingFilterText||(this.eFloatingFilterText=this.createManagedBean(new m.AgInputTextField),this.eFloatingFilterText.setDisabled(!0).addGuiEventListener("click",()=>this.params.showParentFilter()),this.setParams()),this.updateDisplayedValue(),this.eFloatingFilter.appendChild(this.eFloatingFilterText.getGui())}setupUnderlyingFloatingFilterElement(){this.showingUnderlyingFloatingFilter=!1,this.underlyingFloatingFilter=void 0,(0,m._clearElement)(this.eFloatingFilter);let e=this.getSelectedColumn();if(e&&!e.isVisible()){let t=this.beans.colFilter,i=t.getFloatingFilterCompDetails(e,this.params.showParentFilter);if(i)return this.haveAddedColumnListeners||(this.haveAddedColumnListeners=!0,this.addManagedListeners(e,{visibleChanged:this.onColumnVisibleChanged.bind(this),colDefChanged:this.onColDefChanged.bind(this)})),i.newAgStackInstance().then(i=>{this.underlyingFloatingFilter=i,this.underlyingFloatingFilter?.onParentModelChanged(t.getModelForColumn(e)),this.appendChild(i.getGui()),this.showingUnderlyingFloatingFilter=!0})}return this.setupReadOnlyFloatingFilterElement(),m.AgPromise.resolve()}getSelectedColumn(){return this.gos.get("enableFilterHandlers")?this.params.getHandler().selectedColumn:this.parentFilterInstance.getSelectedColumn()}onColumnVisibleChanged(){this.setupUnderlyingFloatingFilterElement()}onColDefChanged(e){if(!e.column)return;let t=this.beans.colFilter.getFloatingFilterCompDetails(e.column,this.params.showParentFilter);t&&this.underlyingFloatingFilter?.refresh?.(t.params)}onParentModelChanged(e,t){this.showingUnderlyingFloatingFilter?this.underlyingFloatingFilter?.onParentModelChanged(this.beans.colFilter.getModelForColumn(this.getSelectedColumn()),t):this.updateDisplayedValue()}updateDisplayedValue(){let e=this.eFloatingFilterText;if(!e)return;let t=this.beans.colFilter,i=this.getSelectedColumn(),s=s=>{if(s){let r=i?t.getModelForColumn(i):null;e.setValue(null==r?"":s.getModelAsString?.(r)??""),e.setDisplayed(!0)}else e.setValue(""),e.setDisplayed(!1)};this.gos.get("enableFilterHandlers")?s(t.getHandler(i)):t.getOrCreateFilterUi(i)?.then(e=>{s(e)})}onColChange(){this.showingUnderlyingFloatingFilter||this.updateDisplayedValue()}};function la(e,t){let i=e.sourceRowIndex,s=t.sourceRowIndex,r=i>=0,a=s>=0;return r&&a?i-s:r||a?r?1:-1:e.__objectId-t.__objectId}var ll=e=>{for(let t of e){let e=t?.childrenAfterGroup;if(!e)continue;let i=e.length,s=0;for(let r=0;r<i;++r){let i=e[r];i.parent===t&&!i.destroyed&&(s!==r&&(e[s]=i),++s)}i!==s&&(e.length=s,t.updateHasChildren(),ln(t))}},ln=e=>{for(;void 0!==e._leafs;){let t=e.parent;if(!t)break;e._leafs=void 0,e=t}},lo={moduleName:"SharedRowGrouping",version:tv,apiFunctions:{setRowGroupColumns:function(e,t){e.rowGroupColsSvc?.setColumns(t,"api")},removeRowGroupColumns:function(e,t){e.rowGroupColsSvc?.removeColumns(t,"api")},addRowGroupColumns:function(e,t){e.rowGroupColsSvc?.addColumns(t,"api")},getRowGroupColumns:function(e){return e.rowGroupColsSvc?.columns??[]},moveRowGroupColumn:function(e,t,i){e.rowGroupColsSvc?.moveColumn?.(t,i,"api")}},dependsOn:[tb,aT,a3,a8,{moduleName:"GroupHierarchy",version:tv,beans:[aL]}]},ld={moduleName:"RowGrouping",version:tv,dynamicBeans:{groupStrategy:class extends m.BeanStub{constructor(){super(...arguments),this.groupCols=[],this.nonLeafsById=new Map,this.checkGroupCols=!0,this.pivotMode=!1,this.groupEmpty=!1}invalidateGroupCols(){this.checkGroupCols=!0}destroy(){super.destroy(),this.groupCols.length=0,this.nonLeafsById.clear()}clearNonLeafs(){let e=this.nonLeafsById;for(let t of e.values())t._destroy(!1);e.clear()}loadGroupData(e){if(!e.group)return e._groupData=null,null;let t=e.rowGroupColumn,{valueSvc:i,showRowGroupCols:s}=this.beans,r={};if(e._groupData=r,!t)return r;let a=(0,m._csrmFirstLeaf)(e),l=t.getId();if(!s)return r;let n=s.columns;for(let e=0,s=n.length;e<s;++e){let s=n[e];s.isRowGroupDisplayed(l)&&(r[s.getColId()]=i.getValue(t,a,"data"))}return r}execute(e,t){let i=t.changedPath;if(this.initRefresh(t)){let s=t.changedRowNodes;s?this.handleDeltaUpdate(e,i,s,!!t.animate):this.shotgunResetEverything(e)}this.positionLeafsAndGroups(i),this.orderGroups(e),this.beans.selectionSvc?.updateSelectableAfterGrouping(i)}positionLeafsAndGroups(e){e.forEachChangedNodeDepthFirst(e=>{let t,i=e.childrenAfterGroup,s=i?.length;if(!s)return;let r=Array(s),a=0,l=!1;for(let e=0;e<s;++e){let n=i[e];if(n.childrenAfterGroup?.length){if(!t&&""===n.key){t=n;let i=s-1;l||(l=e!==i),r[i]=n}}else l||(l=a!==e),r[a++]=n}if(l){for(let e=0;e<s;++e){let s=i[e];s.childrenAfterGroup?.length&&s!==t&&(r[a++]=s)}e.childrenAfterGroup=r;let l=e.sibling;l&&(l.childrenAfterGroup=r)}},!1)}initRefresh(e){let{rowGroupColsSvc:t,colModel:i,gos:s}=this.beans,r=i.isPivotMode();this.pivotMode=r,this.groupEmpty=r||!s.get("groupAllowUnbalanced");let a=t?.columns,l=this.groupCols,n=e.afterColumnsChanged;if(n||!l||this.checkGroupCols)if(this.checkGroupCols=!1,l&&!((e,t)=>{let i=e.length;if(i!==t?.length)return!0;for(let s=0;s<i;s++){let i=e[s],r=t[s];if(i.col!==r)return!0;let a=r.getColDef();if(i.field!==a.field||i.type!==a.type||i.valueGetter!==a.valueGetter||i.keyCreator!==a.keyCreator)return!0}return!1})(l,a)){if(n)return!1}else e.animate=!1,((e,t)=>{if(!e){t.length=0;return}let i=e.length;t.length=i;for(let s=0;s<i;s++){let i=e[s],r=i.getColDef();t[s]={col:i,field:r.field,type:r.type,keyCreator:r.keyCreator,valueGetter:r.valueGetter}}})(a,this.groupCols);return!0}handleDeltaUpdate(e,t,{removals:i,updates:s,adds:r,reordered:a},l){let n=new Set,o=t;o.active||(o=null);for(let e=0,t=i.length;e<t;++e){let t=i[e],s=this.removeFromParent(t);n.has(s)||(n.add(s),o?.addParentNode(s))}for(let t of s){let i=t.parent;if(o?.addParentNode(i),this.moveNodeInWrongPath(e,t)){n.add(i);let e=t.parent;o?.addParentNode(e),a||(a=(e?.childrenAfterGroup?.length??0)>1)}}if(r.size)for(let t of r){this.insertOneNode(e,t);let i=t.parent;o?.addParentNode(i),a||(a=(i?.childrenAfterGroup?.length??0)>1)}n.size&&(ll(n),this.removeEmptyGroups(n,l)),a&&this.sortChildren(t)}sortChildren(e){e.forEachChangedNodeDepthFirst(t=>{(function(e){if(!e)return!1;let t=e.length;if(t<2)return!1;let i=!1;for(let s=1;s<t;s++)if(la(e[s-1],e[s])>0){i=!0;break}return!!i&&(e.sort(la),!0)})(t.childrenAfterGroup)&&e.active&&e.addParentNode(t)},!1,!0)}orderGroups(e){let t=this.gos.getCallback("initialGroupOrderComparator");if(!t)return;let i=this.beans,s=i.gridApi,r=i.gridOptions.context,a=(e,i)=>t({api:s,context:r,nodeA:e,nodeB:i}),l=e=>{let t=e.childrenAfterGroup,i=t?.length;if(i&&!e.leafGroup){i>1&&t.sort(a);for(let e=0;e<i;++e)l(t[e])}};l(e)}moveNodeInWrongPath(e,t){let{valueSvc:i}=this.beans,s=this.groupEmpty,r=t.parent,a=!1,l=this.groupCols;if(!l)return!1;for(let e=l.length-1;e>=0;--e){let{col:n}=l[e],o=i.getKeyForNode(n,t);if(null==o||""===o){if(!s)continue;o=""}if(!r?.parent||r.key!==o){a=!0;break}r=r.parent}return a||(a=!!r?.parent),!!a&&(this.removeFromParent(t),this.insertOneNode(e,t),t.setData(t.data),!0)}groupShouldBeRemoved(e){let t=this.getChildrenMappedKey(e.key,e.rowGroupColumn),i=e.parent?.childrenMapped;return!!i&&!!i[t]&&!!e.group&&(e.childrenAfterGroup?.length??0)===0}removeEmptyGroups(e,t){let i,s=this.beans.selectionSvc,r=Array.from(e),a=this.nonLeafsById;do{e.clear();for(let l=0;l<r.length;++l){let n=r[l];for(;n;){let o=n.parent;if(n.destroyed){r[l]=o,n=o;continue}if(!o)break;if(!this.groupShouldBeRemoved(n)){n=o;continue}e.add(o),this.removeFromParent(n),s&&n.isSelected()&&(i??(i=[]),i.push(n)),r[l]=o,a.delete(n.id),n._destroy(t),n=o}}ll(e)}while(e.size)i&&s.setNodesSelected({nodes:i,newValue:!1,source:"rowGroupChanged"})}removeFromParent(e){let t=e.parent;if(t){let i=this.getChildrenMappedKey(e.key,e.rowGroupColumn),s=t.childrenMapped;s&&delete s[i]}return e.setRowTop(null),e.setRowIndex(null),t}addToParent(e,t){let i=t.childrenMapped??(t.childrenMapped={}),s=this.getChildrenMappedKey(e.key,e.rowGroupColumn);if(i[s]!==e){i[s]=e;let r=t.childrenAfterGroup;if(!r){t.childrenAfterGroup=r=[];let e=t.sibling;e&&(e.childrenAfterGroup=t.childrenAfterGroup)}r.push(e),sT(t,this.beans,!0),ln(t)}}shotgunResetEverything(e){this.beans.selectionSvc?.filterFromSelection?.(e=>!e.group),this.nonLeafsById.clear(),e.leafGroup=!this.groupCols?.length,e.childrenAfterGroup=[],e.childrenMapped={},e.updateHasChildren();let t=e.sibling;t&&(t.childrenAfterGroup=e.childrenAfterGroup,t.childrenMapped=e.childrenMapped);let i=e._leafs;for(let t=0,s=i.length;t<s;++t)this.insertOneNode(e,i[t])}insertOneNode(e,t){let i=e,{beans:s,pivotMode:r,groupCols:a,groupEmpty:l}=this,n=s.valueSvc;if(!a)return;let o=a.length;for(let e=0;e<o;++e){let s=a[e],d=s.col,h=n.getKeyForNode(d,t);if(null==h||""===h){if(!l)continue;h=""}let u=i.childrenMapped?.[this.getChildrenMappedKey(h,d)];if(u){i=u;continue}let c=i.level+1,p=c>=o-1,g=this.createGroup(i,s,h,c,p,t);this.addToParent(g,i),this.setExpandedInitialValue(r,g),i=g}i.group||(0,m._warn)(184,{parentGroupData:i.data,childNodeData:t.data}),t.parent=i,t.level=i.level+1,i.childrenAfterGroup.push(t),i.updateHasChildren(),ln(i)}createGroup(e,t,i,s,r,a){let l=t.col,n=(e.level>=0?e.id+"-":"row-group-")+l.getColId()+"-"+i,o=this.nonLeafsById,d=o.get(n);return void 0!==d||((d=new m.RowNode(this.beans)).group=!0,d.parent=e,d.field=t.field??null,d.rowGroupColumn=l,d.key=i,d.id=n,d.level=s,d.leafGroup=r,d.rowGroupIndex=s,d.childrenAfterGroup=[],d.childrenMapped={},o.set(n,d),d.groupValue=a&&this.beans.valueSvc.getValue(l,a,"data"),d.setAllChildrenCount(0),d.updateHasChildren()),d}getChildrenMappedKey(e,t){return t?t.getId()+"-"+e:e}setExpandedInitialValue(e,t){if(e&&t.leafGroup){t.expanded=!1;return}t.expanded=aQ(this.beans,t,t.level)}onShowRowGroupColsSetChanged(){let{rowModel:e,valueSvc:t}=this.beans;for(let e of this.nonLeafsById.values()){e._groupData=void 0;let i=e.rowGroupColumn,s=i&&(0,m._csrmFirstLeaf)(e);e.groupValue=s&&t.getValue(i,s,"data")}let i=e.rootNode?._leafs;if(i)for(let e=0,t=i.length;e<t;++e)i[e].parent._groupData=void 0}}},rowModels:["clientSide"],dependsOn:[lo,aP,a6,a7]},lh={moduleName:"RowGroupingPanel",version:tv,selectors:[{selector:"AG-GRID-HEADER-DROP-ZONES",component:class extends m.Component{constructor(){super()}postConstruct(){this.setGui(this.createNorthPanel());let e=this.onRowGroupChanged.bind(this);this.addManagedEventListeners({columnRowGroupChanged:e,newColumnsLoaded:e}),this.addManagedPropertyListener("rowGroupPanelShow",e),this.addManagedPropertyListener("pivotPanelShow",()=>this.onPivotPanelShow()),this.onRowGroupChanged()}createNorthPanel(){let e=(0,m._createElement)({tag:"div",cls:"ag-column-drop-wrapper",role:"presentation"}),t=new s5(!0);this.rowGroupComp=this.createManagedBean(t);let i=new s2(!0);this.pivotComp=this.createManagedBean(i),e.appendChild(t.getGui()),e.appendChild(i.getGui());let s=this.onDropPanelVisible.bind(this);return this.addManagedListeners(t,{displayChanged:s}),this.addManagedListeners(i,{displayChanged:s}),this.onDropPanelVisible(),e}onDropPanelVisible(){let{rowGroupComp:e,pivotComp:t}=this,i=e.isDisplayed()&&t.isDisplayed(),s="ag-column-drop-horizontal-half-width";e.toggleCss(s,i),t.toggleCss(s,i)}onRowGroupChanged(){let e=this.rowGroupComp;if(!e)return;let t=this.gos.get("rowGroupPanelShow");if("always"===t)e.setDisplayed(!0);else if("onlyWhenGrouping"===t){let t=this.beans.rowGroupColsSvc?.columns?.length!==0;e.setDisplayed(t)}else e.setDisplayed(!1)}onPivotPanelShow(){let e=this.pivotComp;if(!e)return;let t=this.gos.get("pivotPanelShow");if("always"===t)e.setDisplayed(!0);else if("onlyWhenPivoting"===t){let t=this.beans.colModel.isPivotActive();e.setDisplayed(t)}else e.setDisplayed(!1)}}}],icons:{pivotPanel:"pivot",rowGroupPanel:"group",panelDelimiter:"small-right",panelDelimiterRtl:"small-left"},dependsOn:[tb,m._PopupModule]},lu={moduleName:"GroupFilter",version:tv,userComponents:{agGroupColumnFilter:{classImp:le,processParams:function(e){return e.buttons&&(e.buttons=[]),e}},agGroupColumnFloatingFilter:lr},beans:[li],dynamicBeans:{agGroupColumnFilterHandler:lt},dependsOn:[tb,m._ColumnFilterModule]},lc=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="rowModel",this.firstRow=-1,this.lastRow=-1,this.rowCount=-1,this.rowNodesByIndex={},this.rootNode=null,this.viewportChangedContext=!1}ensureRowHeightsValid(e,t,i,s){return!1}postConstruct(){let e=this.beans,t=new m.RowNode(e);this.rootNode=t,t.level=-1,this.rowHeight=(0,m._getRowHeightAsNumber)(e),this.addManagedEventListeners({viewportChanged:this.onViewportChanged.bind(this)}),this.addManagedPropertyListener("viewportDatasource",()=>this.updateDatasource()),this.addManagedPropertyListener("rowHeight",()=>{this.rowHeight=(0,m._getRowHeightAsNumber)(e),this.updateRowHeights()})}start(){this.updateDatasource()}isLastRowIndexKnown(){return!0}destroy(){this.destroyDatasource(),super.destroy(),this.rootNode=null}destroyDatasource(){let e=this.datasource;e&&(e.destroy?.(),this.beans.rowRenderer.datasourceChanged(),this.firstRow=-1,this.lastRow=-1)}updateDatasource(){let e=this.gos.get("viewportDatasource");e&&this.setViewportDatasource(e)}getPageSize(){return this.gos.get("viewportRowModelPageSize")}getBufferSize(){return this.gos.get("viewportRowModelBufferSize")}calculateFirstRow(e){let t=this.getBufferSize(),i=this.getPageSize(),s=e-t;return s<0?0:Math.floor(s/i)*i}calculateLastRow(e){if(-1===e)return e;let t=this.getBufferSize(),i=this.getPageSize();return Math.min(Math.ceil((e+t)/i)*i,this.rowCount-1)}onViewportChanged(e){let t=this.calculateFirstRow(e.firstRow),i=this.calculateLastRow(e.lastRow);(this.firstRow!==t||this.lastRow!==i)&&(this.firstRow=t,this.lastRow=i,this.purgeRowsNotInViewport(),this.viewportChangedContext=!0,this.datasource?.setViewportRange(this.firstRow,this.lastRow),this.viewportChangedContext=!1)}purgeRowsNotInViewport(){let e=this.rowNodesByIndex;for(let t of Object.keys(e)){let i=parseInt(t,10);if(i<this.firstRow||i>this.lastRow){if(this.isRowFocused(i)||this.beans.editSvc?.isRowEditing(e[i]))continue;delete e[i]}}}isRowFocused(e){let t=this.beans.focusSvc.getFocusCellToUseAfterRefresh();return!!t&&null==t.rowPinned&&t.rowIndex===e}setViewportDatasource(e){this.destroyDatasource(),this.datasource=e,this.rowCount=-1,e.init?e.init((0,m._addGridCommonParams)(this.gos,{setRowCount:this.setRowCount.bind(this),setRowData:this.setRowData.bind(this),getRow:this.getRow.bind(this)})):(0,m._warn)(226)}getType(){return"viewport"}getRow(e){return this.rowNodesByIndex[e]||(this.rowNodesByIndex[e]=this.createBlankRowNode(e)),this.rowNodesByIndex[e]}getRowNode(e){let t;return this.forEachNode(i=>{i.id===e&&(t=i)}),t}getRowCount(){return -1===this.rowCount?0:this.rowCount}getRowIndexAtPixel(e){return 0!==this.rowHeight?Math.floor(e/this.rowHeight):0}resetRowHeights(){}onRowHeightChanged(){}getRowBounds(e){let t=this.rowHeight;return{rowHeight:t,rowTop:t*e}}updateRowHeights(){let e=this.rowHeight;this.forEachNode(t=>{t.setRowHeight(e),t.setRowTop(e*t.rowIndex)}),this.eventSvc.dispatchEvent({type:"modelUpdated",newData:!1,newPage:!1,keepRenderedRows:!0,animate:!1})}getTopLevelRowCount(){return this.getRowCount()}getTopLevelRowDisplayedIndex(e){return e}isEmpty(){return this.rowCount>0}getOverlayType(){return null}isRowsToRender(){return this.rowCount>0}getNodesInRangeForSelection(e,t){let i=e.rowIndex,s=t.rowIndex,r=i<this.firstRow||i>this.lastRow,a=s<this.firstRow||s>this.lastRow;if(r||a)return[];let l=[],n=i<=s?i:s,o=i<=s?s:i;for(let e=n;e<=o;e++)l.push(this.rowNodesByIndex[e]);return l}forEachNode(e){let t=0;for(let i of Object.keys(this.rowNodesByIndex)){let s=parseInt(i,10);e(this.rowNodesByIndex[s],t),t++}}setRowData(e){let t=(0,m._getRowIdCallback)(this.beans.gos),i=new Map;if(t)for(let e of Object.values(this.rowNodesByIndex))i.set(e.id,e);for(let s=this.firstRow;s<=this.lastRow;s++){let r,a,l=e[s];l&&(t?(r=t({data:l,rowPinned:void 0,level:0,parentKeys:void 0}),a=i.get(r)):a=this.rowNodesByIndex[s],a?(a.updateData(l),a.setRowIndex(s),a.setRowTop(this.rowHeight*s)):(a=this.createBlankRowNode(s)).setDataAndId(l,r??s.toString()),this.rowNodesByIndex[s]=a)}this.viewportChangedContext||this.eventSvc.dispatchEvent({type:"modelUpdated",newData:!1,newPage:!1,keepRenderedRows:!0,animate:!1})}createBlankRowNode(e){let t=new m.RowNode(this.beans),i=this.rowHeight;return t.setRowHeight(i),t.setRowTop(i*e),t.setRowIndex(e),t}setRowCount(e,t=!1){if(e===this.rowCount)return;this.rowCount=e;let i=this.eventSvc;i.dispatchEventOnce({type:"rowCountReady"}),i.dispatchEvent({type:"modelUpdated",newData:!1,newPage:!1,keepRenderedRows:t,animate:!1})}isRowPresent(e){return!!this.getRowNode(e.id)}},lp="paste",lg="dragCopy",lm="clipboard",lf={moduleName:"Clipboard",version:tv,beans:[class extends m.BeanStub{constructor(){super(...arguments),this.beanName="clipboardSvc",this.clientSideRowModel=null,this.gridCtrl=null,this.lastPasteOperationTime=0,this.navigatorApiFailed=!1}postConstruct(){let{gos:e,rowModel:t,ctrlsSvc:i}=this.beans;(0,m._isClientSideRowModel)(e,t)&&(this.clientSideRowModel=t),i.whenReady(this,e=>{this.gridCtrl=e.gridCtrl})}destroy(){super.destroy(),this.clientSideRowModel=null,this.gridCtrl=null}pasteFromClipboard(){!this.gos.get("suppressClipboardApi")&&!this.navigatorApiFailed&&navigator.clipboard?.readText?navigator.clipboard.readText().then(this.processClipboardData.bind(this)).catch(e=>{(0,m._warn)(40,{e,method:"readText"}),this.navigatorApiFailed=!0,this.pasteFromClipboardLegacy()}):this.pasteFromClipboardLegacy()}pasteFromClipboardLegacy(){let e=!1,t=t=>{let i=Date.now();i-this.lastPasteOperationTime<50&&(e=!0,t.preventDefault()),this.lastPasteOperationTime=i};this.executeOnTempElement(e=>{e.addEventListener("paste",t),e.focus({preventScroll:!0})},i=>{let s=i.value;e?this.refocusLastFocusedCell():this.processClipboardData(s),i.removeEventListener("paste",t)})}refocusLastFocusedCell(){let{focusSvc:e}=this.beans,t=e.getFocusedCell();t&&e.setFocusedCell({rowIndex:t.rowIndex,column:t.column,rowPinned:t.rowPinned,forceBrowserFocus:!0})}getClipboardDelimiter(){let e=this.gos.get("clipboardDelimiter");return(0,m._exists)(e)?e:"	"}processClipboardData(e){if(null==e)return;let t=function(e,t=","){let i=[],s=e=>"\r"===e||"\n"===e,r=!1;if(""===e)return[[""]];for(let a=0,l=0,n=0;n<e.length;n++){let o=e[n-1],d=e[n],h=e[n+1],u=()=>{i[a]||(i[a]=[]),i[a][l]||(i[a][l]="")};if(u(),'"'===d&&(r?'"'===h?(i[a][l]+='"',n++):r=!1:(void 0===o||o===t||s(o))&&(r=!0)),!r&&'"'!==d){if(d===t){l++,u();continue}else if(s(d)){l=0,a++,u(),"\r"===d&&"\n"===h&&n++;continue}}i[a][l]+=d}return i}(e,this.getClipboardDelimiter()),i=this.gos.getCallback("processDataFromClipboard");if(i&&(t=i({data:t})),null==t)return;this.gos.get("suppressLastEmptyLineOnPaste")&&this.removeLastLineIfBlank(t);let{rangeSvc:s,editSvc:r}=this.beans,a=(e,i,a,l)=>{s?.isMoreThanOneCell()&&!this.hasOnlyOneValueToPaste(t)?this.pasteIntoActiveRange(t,e,i,l):this.pasteStartingFromFocusedCell(t,e,i,a,l),r?.stopEditing(void 0,{source:lp})};this.doPasteOperation(a)}doPasteOperation(e){let t="clipboard",{eventSvc:i,focusSvc:s,rowRenderer:r,gos:a}=this.beans;i.dispatchEvent({type:"pasteStart",source:t});let{clientSideRowModel:l}=this,n=l?.rootNode,o=n&&new m.ChangedPath(a.get("aggregateOnlyChangedColumns"),n),d={},h=[];e(d,h,s.getFocusedCell(),o);let u=[...h];o&&(l.doAggregate(o),o.forEachChangedNodeDepthFirst(e=>{u.push(e)})),r.refreshCells({rowNodes:u}),this.dispatchFlashCells(d),this.fireRowChanged(h),this.refocusLastFocusedCell(),i.dispatchEvent({type:"pasteEnd",source:t})}getPreProcessRangeCallback(e){return t=>{let{rangeSvc:i}=this.beans;if(!i)return;let{rowDiff:s,colDiff:r}=this.getAdjustedRangeDimensionForPaste(t,e);0!==s&&i.extendRangeRowCountBy(t,s),0!==r&&i.extendRangeColumnCountBy(t,r)}}getAdjustedRangeDimensionForPaste(e,t){let i=this.beans.rangeSvc,s=t.length,r=i.getRangeRowCount(e),a=t[0].length,l=e.columns.length;return{rowDiff:r>=s&&r%s==0?0:s-r,colDiff:l>=a&&l%a==0?0:a-l}}pasteIntoActiveRange(e,t,i,s){let r=0,a=0,l=(l,n,o,d)=>{if(d-r>=e.length){if(d%e.length!=0)return;r+=a,a=0}let h=e[d-r];i.push(n);let u=this.gos.getCallback("processCellFromClipboard"),c=o.columns,p=c.findIndex(m.isColumnSelectionCol);-1!==p&&c.splice(p,1);for(let e=0;e<c.length;e++){let i=c[e];if(!i.isCellEditable(n)||i.isSuppressPaste(n))continue;let r=e;e>=h.length&&(r=e%h.length);let a=this.processCell(n,i,h[r],lg,u,!0);n.setDataValue(i,a,lp),s?.addParentNode(n.parent,[i]);let{rowIndex:o,rowPinned:d}=l;t[(0,m._createCellId)({rowIndex:o,column:i,rowPinned:d})]=!0}a++};this.iterateActiveRanges(l,!1,this.getPreProcessRangeCallback(e))}getDisplayedColumnsStartingAt(e){let t=e,i=[],{visibleCols:s}=this.beans;for(;t&&(0,m.isSpecialCol)(t);)t=s.getColAfter(t);for(;null!=t;)i.push(t),t=s.getColAfter(t);return i}pasteStartingFromFocusedCell(e,t,i,s,r){if(!s)return;let a={rowIndex:s.rowIndex,rowPinned:s.rowPinned},l=this.getDisplayedColumnsStartingAt(s.column);this.isPasteSingleValueIntoRange(e)?this.pasteSingleValueIntoRange(e,i,t,r):this.pasteMultipleValues(e,a,i,l,t,lm,r)}isPasteSingleValueIntoRange(e){let t=this.beans.rangeSvc;return this.hasOnlyOneValueToPaste(e)&&!!t&&!t.isEmpty()}pasteSingleValueIntoRange(e,t,i,s){let r=e[0][0],a=(e,a,l)=>{t.push(a),l.columns.forEach(e=>this.updateCellValue(a,e,r,i,lm,s))};this.iterateActiveRanges(a)}hasOnlyOneValueToPaste(e){return 1===e.length&&1===e[0].length}copyRangeDown(){let{rangeSvc:e,gos:t,formula:i,valueSvc:s}=this.beans;if(!e||e.isEmpty())return;let r=[],a=(e,a,l,n)=>{let o=t.getCallback("processCellForClipboard"),d=t.getCallback("processCellFromClipboard"),h=(t,l,h)=>{let{columns:u}=h;r.length?(a.push(l),u.forEach((s,a)=>{if(!s.isCellEditable(l)||s.isSuppressPaste(l))return;s.isAllowFormula()&&i?.isFormula(r[a])&&(r[a]=i?.updateFormulaByOffset({value:r[a],rowDelta:1}));let o=this.processCell(l,s,r[a],lg,d,!0);l.setDataValue(s,o,lp),n&&n.addParentNode(l.parent,[s]);let{rowIndex:h,rowPinned:u}=t;e[(0,m._createCellId)({rowIndex:h,column:s,rowPinned:u})]=!0})):u.forEach(e=>{let t=this.processCell(l,e,s.getValue(e,l,"batch"),lg,o,!1,!0);r.push(t)})};this.iterateActiveRanges(h,!0)};this.doPasteOperation(a)}removeLastLineIfBlank(e){let t=(0,m._last)(e);if(t&&1===t.length&&""===t[0]){if(1===e.length)return;(0,m._removeFromArray)(e,t)}}fireRowChanged(e){if("fullRow"===this.gos.get("editType"))for(let t of e)this.eventSvc.dispatchEvent({type:"rowValueChanged",node:t,data:t.data,rowIndex:t.rowIndex,rowPinned:t.rowPinned})}pasteMultipleValues(e,t,i,s,r,a,l){let n=t,o=this.beans,{gos:d}=o,h=null!=this.clientSideRowModel&&!d.get("enableGroupEdit")&&!d.get("treeData"),u=()=>{for(;;){if(!n)return null;let e=(0,m._getRowNode)(o,n);if(n=(0,m._getRowBelow)(o,{rowPinned:n.rowPinned,rowIndex:n.rowIndex}),null==e)return null;if(!(e.detail||e.footer||h&&e.group))return e}};for(let t of e){let e=u();e&&(t.forEach((t,i)=>this.updateCellValue(e,s[i],t,r,a,l)),i.push(e))}}updateCellValue(e,t,i,s,r,a){if(!e||!t?.isCellEditable(e)||t?.isSuppressPaste(e))return;let l=this.processCell(e,t,i,r,this.gos.getCallback("processCellFromClipboard"),!0);e.setDataValue(t,l,lp);let{rowIndex:n,rowPinned:o}=e;s[(0,m._createCellId)({rowIndex:n,column:t,rowPinned:o})]=!0,a&&a.addParentNode(e.parent,[t])}copyToClipboard(e={}){this.copyOrCutToClipboard(e)}cutToClipboard(e={},t="api"){this.gos.get("suppressCutToClipboard")||(this.eventSvc.dispatchEvent({type:"cutStart",source:t}),this.copyOrCutToClipboard(e,!0),this.eventSvc.dispatchEvent({type:"cutEnd",source:t}))}copyOrCutToClipboard(e,t){let{includeHeaders:i,includeGroupHeaders:s}=e,{gos:r,focusSvc:a}=this.beans;null==i&&(i=r.get("copyHeadersToClipboard")),null==s&&(s=r.get("copyGroupHeadersToClipboard"));let l={includeHeaders:i,includeGroupHeaders:s},n=r.get("rowSelection"),o=r.get("cellSelection"),d=null;this.shouldCopyCells(o,n)?(this.copySelectedRangeToClipboard(l),d=0):this.shouldCopyRows(n)?(this.copySelectedRowsToClipboard(l),d=1):a.isAnyCellFocused()&&(this.copyFocusedCellToClipboard(l),d=2),t&&null!==d&&this.clearCellsAfterCopy(d)}shouldCopyCells(e,t){let{rangeSvc:i,selectionSvc:s,gos:r}=this.beans;if(!i||i.isEmpty())return!1;if(e)return!("object"==typeof t&&t.copySelectedRows&&!s?.isEmpty());{let e=r.get("suppressCopySingleCellRanges");return!(!i.isMoreThanOneCell()&&e)}}shouldCopyRows(e){let{selectionSvc:t,gos:i}=this.beans;return!(t?.isEmpty()??!0)&&(e&&"string"!=typeof e?e.copySelectedRows??!1:!i.get("suppressCopyRowsToClipboard"))}clearCellsAfterCopy(e){let t=this.beans,{rangeSvc:i,focusSvc:s,eventSvc:r}=t;if(r.dispatchEvent({type:"keyShortcutChangedCellStart"}),0===e)i.clearCellRangeCellValues({cellEventSource:"clipboardSvc"});else if(1===e)this.clearSelectedRows();else{let e=s.getFocusedCell();if(null==e)return;let i=(0,m._getRowNode)(t,e);i&&this.clearCellValue(i,e.column)}r.dispatchEvent({type:"keyShortcutChangedCellEnd"})}clearSelectedRows(){let{selectionSvc:e,visibleCols:t}=this.beans,i=e?.getSelectedNodes()??[],s=t.allCols;for(let e of i)for(let t of s)this.clearCellValue(e,t)}clearCellValue(e,t){if(!t.isCellEditable(e))return;let i=this.beans.valueSvc.getDeleteValue(t,e);e.setDataValue(t,i,"clipboardSvc")}iterateActiveRanges(e,t,i){let s=this.beans.rangeSvc;if(!s||s.isEmpty())return;let r=s.getCellRanges();for(let s of t?[r[0]]:r)this.iterateActiveRange({cellRange:s,rowCallback:e,preProcessRange:i})}iterateActiveRange(e){let{cellRange:t,preProcessRange:i,rowCallback:s}=e,{beans:r}=this,{rangeSvc:a}=r;if(!a)return;i&&i(t);let l=a.getRangeStartRow(t),n=a.getRangeEndRow(t),o=0,d=!1;for(;!d&&null!=l;){let e=(0,m._getRowNode)(r,l);d=(0,m._isSameRow)(l,n),s(l,e,t,o++),l=(0,m._getRowBelow)(r,l)}}copySelectedRangeToClipboard(e={}){let t=this.beans.rangeSvc;if(!t||t.isEmpty())return;let{data:i,cellsToFlash:s}=t.areAllRangesAbleToMerge()?this.buildDataFromMergedRanges(t,e):this.buildDataFromRanges(t,e);this.copyDataToClipboard(i),this.dispatchFlashCells(s)}buildDataFromMergedRanges(e,t){let i=new Set,s=e.getCellRanges(),r=new Map,a=[],l={},n=(0,m._isClientSideRowModel)(this.gos,this.beans.rowModel),o=new Set;for(let t of(n||this.beans.rowModel.forEachNode(e=>{o.add(e.rowIndex)}),s)){t.columns.forEach(e=>i.add(e));let{rowPositions:s,cellsToFlash:d}=this.getRangeRowPositionsAndCellsToFlash(e,t);for(let e of s){let t=o.has(e.rowIndex);if(!n&&!t)continue;let i=`${e.rowIndex}-${e.rowPinned||"null"}`;r.get(i)||(r.set(i,!0),a.push(e))}Object.assign(l,d)}let d=this.beans.visibleCols.allCols,h=Array.from(i);return h.sort((e,t)=>d.indexOf(e)-d.indexOf(t)),{data:this.buildExportParams({columns:h,rowPositions:a,includeHeaders:t.includeHeaders,includeGroupHeaders:t.includeGroupHeaders}),cellsToFlash:l}}buildDataFromRanges(e,t){let i=e.getCellRanges(),s=[],r={};for(let a of i){let{rowPositions:i,cellsToFlash:l}=this.getRangeRowPositionsAndCellsToFlash(e,a);Object.assign(r,l),s.push(this.buildExportParams({columns:a.columns,rowPositions:i,includeHeaders:t.includeHeaders,includeGroupHeaders:t.includeGroupHeaders}))}return{data:s.join("\n"),cellsToFlash:r}}getRangeRowPositionsAndCellsToFlash(e,t){let i=[],s={},r=e.getRangeStartRow(t),a=e.getRangeEndRow(t),l=r;for(;l;){for(let e of(i.push(l),t.columns)){let{rowIndex:t,rowPinned:i}=l;s[(0,m._createCellId)({rowIndex:t,column:e,rowPinned:i})]=!0}if((0,m._isSameRow)(l,a))break;l=(0,m._getRowBelow)(this.beans,l)}return{rowPositions:i,cellsToFlash:s}}getCellsToFlashFromRowNodes(e){let t=this.beans.visibleCols.allCols,i={};for(let s=0;s<e.length;s++){let{level:r,rowIndex:a,rowPinned:l,sibling:n}=e[s],o=-1===r?n.rowIndex:a;if(null!=o)for(let e=0;e<t.length;e++){let s=t[e];i[(0,m._createCellId)({rowIndex:o,column:s,rowPinned:l})]=!0}}return i}copyFocusedCellToClipboard(e={}){let t=this.beans.focusSvc.getFocusedCell();if(null==t)return;t=this.beans.rowSpanSvc?.getCellStart(t)??t;let i=(0,m._createCellId)(t),s={rowPinned:t.rowPinned,rowIndex:t.rowIndex},r=t.column,a=this.buildExportParams({columns:[r],rowPositions:[s],includeHeaders:e.includeHeaders,includeGroupHeaders:e.includeGroupHeaders});this.copyDataToClipboard(a),this.dispatchFlashCells({[i]:!0})}copySelectedRowsToClipboard(e={}){let{columnKeys:t,includeHeaders:i,includeGroupHeaders:s}=e,r=this.buildExportParams({columns:t,includeHeaders:i,includeGroupHeaders:s});this.copyDataToClipboard(r);let a=this.beans.selectionSvc?.getSelectedNodes()||[];this.dispatchFlashCells(this.getCellsToFlashFromRowNodes(a))}buildExportParams(e){let{columns:t,rowPositions:i,includeHeaders:s=!1,includeGroupHeaders:r=!1}=e,{gos:a,csvCreator:l}=this.beans,n=({node:e,column:t})=>{let{value:i,valueFormatted:s}=this.beans.valueSvc.getValueForDisplay({column:t,node:e,includeValueFormatted:!0,from:"batch"}),r=s??i??"",l=a.getCallback("processCellForClipboard");return l?l({column:t,node:e,value:r,type:lm,formatValue:i=>this.beans.valueSvc.formatValue(t,e,i)??i,parseValue:s=>this.beans.valueSvc.parseValue(t,e,s,i)??s}):r},o={columnKeys:t,rowPositions:i,skipColumnHeaders:!s,skipColumnGroupHeaders:!r,suppressQuotes:!0,columnSeparator:this.getClipboardDelimiter(),onlySelected:!i,valueFrom:"batch",processCellCallback:a.getCallback("processCellForClipboard"),processRowGroupCallback:n,processHeaderCallback:a.getCallback("processHeaderForClipboard"),processGroupHeaderCallback:a.getCallback("processGroupHeaderForClipboard")};return l.getDataAsCsv(o,!0)}dispatchFlashCells(e){window.setTimeout(()=>{this.eventSvc.dispatchEvent({type:"flashCells",cells:e})},0)}processCell(e,t,i,s,r,a,l){let{valueSvc:n,formula:o}=this.beans;return r?r({column:t,node:e,value:i,type:s,formatValue:i=>n.formatValue(t,e??null,i)??i,parseValue:i=>n.parseValue(t,e??null,i,n.getValue(t,e,"edit"))}):a&&!1!==t.getColDef().useValueParserForImport?n.parseValue(t,e??null,i,n.getValue(t,e,"edit")):l&&!1!==t.getColDef().useValueFormatterForExport?o?.isFormula(i)?i:n.formatValue(t,e??null,i)??i:i}copyDataToClipboard(e){let t=this.gos.getCallback("sendToClipboard");t?t({data:e}):!this.gos.get("suppressClipboardApi")&&navigator.clipboard?navigator.clipboard.writeText(e).catch(t=>{(0,m._warn)(40,{e:t,method:"writeText"}),this.copyDataToClipboardLegacy(e)}):this.copyDataToClipboardLegacy(e)}copyDataToClipboardLegacy(e){this.executeOnTempElement(t=>{let i=(0,m._getDocument)(this.beans),s=(0,m._getActiveDomElement)(this.beans);t.value=e||" ",t.select(),t.focus({preventScroll:!0}),i.execCommand("copy")||(0,m._warn)(41),s?.focus!=null&&s.focus({preventScroll:!0})})}executeOnTempElement(e,t){if(!this.gridCtrl)return;let i=(0,m._getDocument)(this.beans),s=i.createElement("textarea"),r=s.style;r.width="1px",r.height="1px";let a=i.documentElement;r.top=a.scrollTop+"px",r.left=a.scrollLeft+"px",r.position="absolute",r.opacity="0",this.gridCtrl.getGui().appendChild(s);try{e(s)}catch(e){(0,m._warn)(42)}t?window.setTimeout(()=>{t(s),s.remove()},100):s.remove()}}],apiFunctions:{copyToClipboard:function(e,t){e.clipboardSvc?.copyToClipboard(t)},cutToClipboard:function(e,t){e.clipboardSvc?.cutToClipboard(t)},copySelectedRowsToClipboard:function(e,t){e.clipboardSvc?.copySelectedRowsToClipboard(t)},copySelectedRangeToClipboard:function(e,t){e.clipboardSvc?.copySelectedRangeToClipboard(t)},copySelectedRangeDown:function(e){e.clipboardSvc?.copyRangeDown()},pasteFromClipboard:function(e){e.clipboardSvc?.pasteFromClipboard()}},dependsOn:[tb,m.CsvExportModule,m._KeyboardNavigationModule,m.HighlightChangesModule]},lC={tag:"div",cls:"ag-row-numbers-resizer"},lv=class extends m.Component{constructor(e){super(lC),this.cellCtrl=e,this.initialYPosition=-1,this.dragging=!1}postConstruct(){let{beans:e,cellCtrl:t}=this,{dragSvc:i,environment:s}=e;this.defaultRowHeight=s.getDefaultRowHeight(),i.addDragSource({dragStartPixels:0,eElement:this.getGui(),onDragStart:this.onDragStart.bind(this),onDragging:this.onDragging.bind(this),onDragStop:this.onDragStop.bind(this),onDragCancel:this.onDragCancel.bind(this),includeTouch:!0,stopPropagationForTouch:!0});let r=t.getRowPosition();this.node=(0,m._getRowNode)(this.beans,r)}onDragStart(e){if(!this.node)return;let{beans:{ctrlsSvc:t,eventSvc:i}}=this;t.get("gridCtrl").setResizeCursor(m.Direction.Vertical),this.dragging=!0,this.initialHeight=this.node.rowHeight,i.dispatchEvent({type:"rowResizeStarted",node:this.node,event:e,rowHeight:this.initialHeight})}onDragging(e){let{clientY:t}=e;if("bottom"===this.cellCtrl.rowNode.rowPinned&&(t*=-1),-1===this.initialYPosition||!this.dragging){this.initialYPosition=t;return}let{beans:i,initialHeight:s,initialYPosition:r,defaultRowHeight:a,node:l}=this;if(null==s)return;let n=l?.rowHeight,o=Math.max(s-(r-t),a);if(n===o)return;l?.setRowHeight(o);let{rowRenderer:d,rowModel:h,pinnedRowModel:u}=i,c=!!l?.rowPinned;c&&d.redraw({afterScroll:!0}),(!c||u?.isManual())&&h.onRowHeightChanged({animate:!1})}onDragStop(e){this.beans.eventSvc.dispatchEvent({type:"rowResizeEnded",node:this.node,event:e,rowHeight:this.node?.rowHeight}),this.clearDragDetails(!0)}onDragCancel(){this.clearDragDetails(!0)}clearDragDetails(e){this.initialYPosition=-1,this.initialHeight=null,this.dragging=!1,e&&this.beans.ctrlsSvc.get("gridCtrl").setResizeCursor(!1)}destroy(){this.clearDragDetails(!1),this.node=void 0,super.destroy()}};function lb(e){let t=(0,m._isRowNumbers)(e);return!(!t||"object"!=typeof t||!t.enableRowResizer)}var ly=class{constructor(e,t){this.beans=e,this.cellCtrl=t}refreshRowResizer(){lb(this.beans)&&this.isRowResizeSupported(this.cellCtrl.rowNode)?this.addResizerToCellComp():this.removeRowResizerFromCellComp()}isRowResizeSupported(e){let{pinnedRowModel:t,rowModel:i,visibleCols:s}=this.beans,r=!!i.onRowHeightChanged;return s.autoHeightCols.length?((0,m._warn)(276),!1):null!=e.rowPinned&&!t?.isManual()||r}addResizerToCellComp(){let{beans:e,cellCtrl:t}=this,{eGui:i}=t,{rowResizer:s}=this;s?i.appendChild(s.getGui()):(s=e.registry.createDynamicBean("rowNumberRowResizer",!1,t))&&(this.rowResizer=e.context.createBean(s),i.appendChild(s.getGui()))}removeRowResizerFromCellComp(){let{rowResizer:e,beans:{context:t}}=this;e&&((0,m._removeFromParent)(e.getGui()),this.rowResizer=t.destroyBean(e))}destroy(){this.removeRowResizerFromCellComp()}},lw={moduleName:"RowNumbers",version:tv,beans:[class extends m.BeanStub{constructor(){super(...arguments),this.beanName="rowNumbersSvc",this.isIntegratedWithSelection=!1,this.lastColumnResized=0}postConstruct(){let e=(0,m._debounce)(this,this.refreshCells.bind(this),10);this.addManagedEventListeners({columnResized:()=>{this.lastColumnResized=Date.now()},modelUpdated:t=>{e(!1,!t.keepRenderedRows)},rangeSelectionChanged:()=>this.refreshCells(!0),pinnedRowsChanged:()=>e(!1,!0)}),this.addManagedPropertyListeners(["rowNumbers","cellSelection"],e=>{this.updateColumns(e)}),this.refreshSelectionIntegration(),this.registerRangeSelectionExtension()}shouldSkipColumn(e){return(0,m._isRowNumbers)(this.beans)&&(0,m.isRowNumberCol)(e)}isAllColumnsSelectionCell(e){return(0,m._isRowNumbers)(this.beans)&&(0,m.isRowNumberCol)(e.column)}isAllColumnsRange(e,t){return!!(0,m._isRowNumbers)(this.beans)&&0!==t.length&&e.columns.length===t.length&&t.every(t=>e.columns.includes(t))}registerRangeSelectionExtension(){let e=this.beans.rangeSvc;e&&(e.registerRangeSelectionExtension(this),this.addDestroyFunc(()=>e.unregisterRangeSelectionExtension?.(this)))}addColumns(e){null!=this.columns&&(e.list=this.columns.list.concat(e.list),e.tree=this.columns.tree.concat(e.tree),(0,m._updateColsMap)(e))}createColumns(e,t){let i=()=>{(0,m._destroyColumnTree)(this.beans,this.columns?.tree),this.columns=null},{beans:s}=this;if(!(0,m._isRowNumbers)(s))return void i();let r=e.treeDepth,a=this.columns?.treeDepth??-1,l=this.generateRowNumberCols();if((0,m._areColIdsEqual)(l,this.columns?.list??[])&&a==r)return;i();let{colGroupSvc:n}=this.beans,o=n?.findDepth(e.tree)??0,d=n?.balanceTreeForAutoCols(l,o)??[];this.columns={list:l,tree:d,treeDepth:o,map:{}},t(e=>e?[...l,...e.filter(e=>!(0,m.isRowNumberCol)(e))]:null)}handleMouseDownOnCell(e,t){return!this.isIntegratedWithSelection||t.target.classList.contains("ag-row-numbers-resizer")?(this.beans.rangeSvc&&t.preventDefault(),t.stopImmediatePropagation(),!1):(t.shiftKey||(0,m._interpretAsRightClick)(this.beans,t)||this.focusFirstRenderedCellAtRowPosition(e),!0)}updateColumns(e){let t=(0,m._convertColumnEventSourceType)(e.source);for(let e of(this.refreshSelectionIntegration(),this.columns?.list??[])){let i=this.createRowNumbersColDef();e.setColDef(i,null,t),(0,m._applyColumnState)(this.beans,{state:[(0,m._getColumnStateFromColDef)(i,e.getColId())]},t)}}getColumn(){return this.columns?.list.find(m.isRowNumberCol)??null}getColumns(){return this.columns?.list??null}setupForHeader(e){let{column:t,eGridHeader:i}=e.params;(0,m.isRowNumberCol)(t)&&((0,m._setAriaLabel)(i,"Row Number"),this.addManagedElementListeners(i,{click:this.onHeaderClick.bind(this),keydown:this.onHeaderKeyDown.bind(this),focus:this.onHeaderFocus.bind(this)}))}createRowNumbersRowResizerFeature(e){if(lb(this.beans))return new ly(this.beans,e)}refreshSelectionIntegration(){let{beans:e}=this,{gos:t,rangeSvc:i}=e,s=t.get("cellSelection");this.refreshRowNumberOverrides(),this.isIntegratedWithSelection=!!i&&!!s&&!this.isSuppressCellSelectionIntegration}refreshRowNumberOverrides(){let e=(0,m._isRowNumbers)(this.beans);if(this.rowNumberOverrides={},e&&"object"==typeof e)for(let t of(e.suppressCellSelectionIntegration&&(this.isSuppressCellSelectionIntegration=!0),["contextMenuItems","context","onCellClicked","onCellContextMenu","onCellDoubleClicked","headerTooltip","headerStyle","headerComponent","headerComponentParams","suppressHeaderKeyboardEvent","tooltipField","tooltipValueGetter","tooltipComponent","tooltipComponentParams","tooltipComponentSelector","valueGetter","valueFormatter","width","maxWidth","minWidth","resizable"]))null!=e[t]&&(this.rowNumberOverrides[t]=e[t])}onHeaderFocus(){this.beans.ariaAnnounce?.announceValue("Press Space to select all cells","ariaSelectAllCells")}onHeaderKeyDown(e){this.isIntegratedWithSelection&&e.key===m.KeyCode.SPACE&&this.handleFocusAllCellsFromHeader()}onHeaderClick(e){Date.now()-this.lastColumnResized<100||!this.isIntegratedWithSelection||this.getColumn()?.resizing||this.handleFocusAllCellsFromHeader()}handleFocusAllCellsFromHeader(){(0,m._selectAllCells)(this.beans),this.focusFirstRenderedCellAtRowPosition()}refreshCells(e,t){let i=this.getColumn();if(i){if(t){let e=this.beans.autoWidthCalc?.getPreferredWidthForElements([this.createDummyElement(i)],2);null!=e&&this.beans.colResize?.setColumnWidths([{key:i,newWidth:e}],!1,!0,"rowNumbersService")}this.beans.rowRenderer.refreshCells({columns:[i],force:e})}}createDummyElement(e){let t=(0,m._createElement)({tag:"div",cls:"ag-cell-value ag-cell"}),i=String(this.beans.rowModel.getRowCount()+1);if("function"==typeof this.rowNumberOverrides.valueFormatter){let t=(0,m._addGridCommonParams)(this.beans.gos,{data:void 0,value:i,node:null,column:e,colDef:e.colDef});i=this.rowNumberOverrides.valueFormatter(t)}return t.textContent=i,t}createRowNumbersColDef(){let{gos:e,contextMenuSvc:t}=this.beans,i=e.get("enableRtl");return{minWidth:60,width:60,resizable:!1,valueGetter:this.valueGetter.bind(this),contextMenuItems:this.isIntegratedWithSelection||!t?void 0:()=>[],...this.rowNumberOverrides,colId:m.ROW_NUMBERS_COLUMN_ID,chartDataType:"excluded",suppressHeaderMenuButton:!0,sortable:!1,suppressMovable:!0,lockPinned:!0,pinned:i?"right":"left",lockPosition:i?"right":"left",editable:!1,suppressFillHandle:!0,suppressAutoSize:!0,suppressSizeToFit:!0,suppressHeaderContextMenu:!0,suppressNavigable:!0,headerClass:this.getHeaderClass(),cellClass:this.getCellClass.bind(this),cellAriaRole:"rowheader"}}valueGetter(e){let t=e.node,i=this.beans.formula?.active,s=t?.pinnedSibling;if(t?.rowPinned&&s){let e=i?s.formulaRowIndex:s.rowIndex;return`${null==e?"-":e+1}`}return String(((i?t?.formulaRowIndex:t?.rowIndex)||0)+1)}getHeaderClass(){let e=["ag-row-number-header"];return this.isIntegratedWithSelection&&e.push("ag-row-number-selection-enabled"),e}getCellClass(e){let{beans:t}=this,{rangeSvc:i,gos:s}=t,{node:r}=e,a=["ag-row-number-cell"],l=s.get("cellSelection");if(!i||!l)return a;this.isIntegratedWithSelection&&a.push("ag-row-number-selection-enabled");let n=i.getCellRanges();if(!n.length)return a;let o=this.beans.visibleCols.allCols.length-1,d="object"==typeof l&&l.enableHeaderHighlight;for(let e of n)i.isRowInRange({rowIndex:r.rowIndex,rowPinned:r.rowPinned},e)&&(d&&a.push("ag-row-number-range-highlight"),e.columns.length===o&&a.push("ag-row-number-range-selected"));return a}generateRowNumberCols(){let{gos:e,beans:t}=this;if(!(0,m._isRowNumbers)(t))return[];let i=this.createRowNumbersColDef(),s=i.colId;e.validateColDef(i,s,!0);let r=new m.AgColumn(i,null,s,!1);return this.createBean(r),[r]}focusFirstRenderedCellAtRowPosition(e){let t,i=this.beans.editSvc;if(i?.isEditing()&&i.isRangeSelectionEnabledWhileEditing?.()||!e&&!(e=(0,m._getFirstRow)(this.beans)))return;let{beans:s,gos:r}=this,{visibleCols:a,colViewport:l}=s,n=r.get("enableRtl")?a.rightCols:a.leftCols;if(1==n.length){let i=(0,m._getRowNode)(s,e);if(!i)return;t=l.getColsWithinViewport(i)}else t=n;let o=t.find(e=>!(0,m.isRowNumberCol)(e));if(!o)return;let{rowPinned:d,rowIndex:h}=e;setTimeout(()=>{s.focusSvc.setFocusedCell({rowIndex:h,rowPinned:d,column:o,forceBrowserFocus:!0,preventScrollOnBrowserFocus:!0})})}destroy(){(0,m._destroyColumnTree)(this.beans,this.columns?.tree),this.rowNumberOverrides=null,super.destroy()}}],dynamicBeans:{rowNumberRowResizer:lv},dependsOn:[tb,m.CellStyleModule,m._SharedDragAndDropModule],css:['.ag-row-number-cell{background-color:var(--ag-header-background-color);border:none;color:var(--ag-header-text-color);font-family:var(--ag-header-font-family);font-size:var(--ag-header-font-size);font-weight:var(--ag-header-font-weight);overflow:hidden;-webkit-user-select:none;-moz-user-select:none;user-select:none;white-space:nowrap;width:100%}:where(.ag-ltr) .ag-row-number-cell{text-align:right}:where(.ag-rtl) .ag-row-number-cell{text-align:left}.ag-row-numbers-resizer{bottom:-2px;cursor:ns-resize;height:4px;position:absolute;width:100%}:where(.ag-ltr) .ag-row-numbers-resizer{left:0}:where(.ag-rtl) .ag-row-numbers-resizer{right:0}.ag-floating-bottom .ag-row-numbers-resizer{bottom:unset;top:-2px}:where(.ag-row-number-header.ag-row-number-selection-enabled){cursor:cell}.ag-row-number-range-highlight{background-color:var(--ag-range-header-highlight-color)}.ag-row-number-range-selected{background-color:var(--ag-row-numbers-selected-color)}:where(.ag-ltr){.ag-row-number-header,:where(.ag-cell.ag-row-number-cell):not(.ag-cell-last-left-pinned){border-right:var(--ag-pinned-column-border)}:where(.ag-cell.ag-row-number-cell.ag-row-number-selection-enabled){cursor:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbDpzcGFjZT0icHJlc2VydmUiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgc3R5bGU9ImZpbGwtcnVsZTpldmVub2RkO2NsaXAtcnVsZTpldmVub2RkO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoxLjUiPjxwYXRoIGQ9Ik0zLjQ0NSA4LjkxMVY3LjQwOUg5Ljc1VjYuMDE0bDIuNTM1IDIuMTQ2LTIuNTM1IDIuMTQ2VjguOTExeiIgc3R5bGU9InN0cm9rZTojZmZmO3N0cm9rZS13aWR0aDouNDFweCIgdHJhbnNmb3JtPSJtYXRyaXgoMS41Nzg0IDAgMCAxLjg2NDI5IC00LjQxMyAtNy4yMTIpIi8+PC9zdmc+"),auto}}:where(.ag-rtl){.ag-row-number-header,:where(.ag-cell.ag-row-number-cell):not(.ag-cell-first-right-pinned){border-left:var(--ag-pinned-column-border)}:where(.ag-cell.ag-row-number-cell.ag-row-number-selection-enabled){cursor:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbDpzcGFjZT0icHJlc2VydmUiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgc3R5bGU9ImZpbGwtcnVsZTpldmVub2RkO2NsaXAtcnVsZTpldmVub2RkO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoxLjUiPjxwYXRoIGQ9Ik01Ljk3OSA4LjkxMXYxLjM5NUwzLjQ0NSA4LjE2bDIuNTM0LTIuMTQ2djEuMzk1aDYuMzA2djEuNTAyeiIgc3R5bGU9InN0cm9rZTojZmZmO3N0cm9rZS13aWR0aDouNDFweCIgdHJhbnNmb3JtPSJtYXRyaXgoMS41Nzg0IDAgMCAxLjg2NDI5IC00LjQxMyAtNy4yMTIpIi8+PC9zdmc+"),auto}}']},lS={tag:"div",cls:"ag-filter-toolpanel-search",role:"presentation",children:[{tag:"div",ref:"eExpand",cls:"ag-filter-toolpanel-expand"},{tag:"ag-input-text-field",ref:"eFilterTextField",cls:"ag-filter-toolpanel-search-input"}]},lx={selector:"AG-FILTERS-TOOL-PANEL-HEADER",component:class extends m.Component{constructor(){super(...arguments),this.eExpand=m.RefPlaceholder,this.eFilterTextField=m.RefPlaceholder}postConstruct(){this.setTemplate(lS,[m.AgInputTextFieldSelector]);let e=this.getLocaleTextFunc();this.eFilterTextField.setAutoComplete(!1).setInputAriaLabel(e("ariaFilterColumnsInput","Filter Columns Input")).onValueChange(this.onSearchTextChanged.bind(this)),this.createExpandIcons(),this.setExpandState(0),this.addManagedElementListeners(this.eExpand,{click:this.onExpandClicked.bind(this)}),this.addManagedEventListeners({newColumnsLoaded:this.showOrHideOptions.bind(this)})}init(e){this.params=e,this.beans.colModel.ready&&this.showOrHideOptions()}createExpandIcons(){let{eExpand:e,beans:t}=this;e.appendChild(this.eExpandChecked=(0,m._createIconNoSpan)("accordionOpen",t)),e.appendChild(this.eExpandUnchecked=(0,m._createIconNoSpan)("accordionClosed",t)),e.appendChild(this.eExpandIndeterminate=(0,m._createIconNoSpan)("accordionIndeterminate",t))}showOrHideOptions(){let{params:e,eFilterTextField:t}=this,i=!e.suppressFilterSearch,s=!e.suppressExpandAll,r=this.getLocaleTextFunc();t.setInputPlaceholder(r("searchOoo","Search..."));let a=this.beans.colModel.getCols().some(e=>e.getOriginalParent()&&e.isFilterAllowed());(0,m._setDisplayed)(t.getGui(),i),(0,m._setDisplayed)(this.eExpand,s&&a)}onSearchTextChanged(){this.onSearchTextChangedDebounced||(this.onSearchTextChangedDebounced=(0,m._debounce)(this,()=>this.dispatchLocalEvent({type:"searchChanged",searchText:this.eFilterTextField.getValue()}),300)),this.onSearchTextChangedDebounced()}onExpandClicked(){let e=0===this.currentExpandState?{type:"collapseAll"}:{type:"expandAll"};this.dispatchLocalEvent(e)}setExpandState(e){this.currentExpandState=e,(0,m._setDisplayed)(this.eExpandChecked,0===e),(0,m._setDisplayed)(this.eExpandUnchecked,1===e),(0,m._setDisplayed)(this.eExpandIndeterminate,2===e)}}},lF={tag:"div",cls:"ag-filter-toolpanel-instance",children:[{tag:"div",ref:"eFilterToolPanelHeader",cls:"ag-filter-toolpanel-header ag-filter-toolpanel-instance-header",role:"button",attrs:{"aria-expanded":"false"},children:[{tag:"div",ref:"eExpand",cls:"ag-filter-toolpanel-expand"},{tag:"span",ref:"eFilterName",cls:"ag-header-cell-text"},{tag:"span",ref:"eFilterIcon",cls:"ag-header-icon ag-filter-icon ag-filter-toolpanel-instance-header-icon"}]},{tag:"div",ref:"agFilterToolPanelBody",cls:"ag-filter-toolpanel-instance-body ag-filter"}]},lA=class extends m.Component{constructor(e,t){super(lF),this.hideHeader=e,this.expandedCallback=t,this.eFilterToolPanelHeader=m.RefPlaceholder,this.eFilterName=m.RefPlaceholder,this.agFilterToolPanelBody=m.RefPlaceholder,this.eFilterIcon=m.RefPlaceholder,this.eExpand=m.RefPlaceholder,this.expanded=!1}postConstruct(){let{beans:e,eExpand:t,eFilterIcon:i}=this,s=(0,m._createIconNoSpan)("accordionOpen",e);this.eExpandChecked=s;let r=(0,m._createIconNoSpan)("accordionClosed",e);this.eExpandUnchecked=r,t.appendChild(s),t.appendChild(r);let a=this.getLocaleTextFunc();(0,m._setAriaLabel)(i,a("ariaFilterActive","Filter Active")),(0,m._setAriaRole)(i,"img")}setColumn(e){this.column=e;let{beans:t,eFilterToolPanelHeader:i,eFilterIcon:s,eExpandChecked:r,hideHeader:a}=this;this.eFilterName.innerText=t.colNames.getDisplayNameForColumn(e,"filterToolPanel",!1)||"",this.addManagedListeners(i,{click:this.toggleExpanded.bind(this),keydown:this.onKeyDown.bind(this)}),this.addManagedEventListeners({filterOpened:this.onFilterOpened.bind(this)}),this.addInIcon("filterActive",s,e),(0,m._setDisplayed)(s,this.isFilterActive()),(0,m._setDisplayed)(r,!1),a?((0,m._setDisplayed)(i,!1),i.removeAttribute("tabindex")):i.setAttribute("tabindex","0"),this.addManagedListeners(e,{filterChanged:this.onFilterChanged.bind(this)})}onKeyDown(e){let{key:t}=e,{ENTER:i,SPACE:s,LEFT:r,RIGHT:a}=m.KeyCode;(t===i||t===s||t===r||t===a)&&(e.preventDefault(),t===i||t===s?this.toggleExpanded():t===m.KeyCode.LEFT?this.collapse():this.expand())}getColumn(){return this.column}getColumnFilterName(){return this.beans.colNames.getDisplayNameForColumn(this.column,"filterToolPanel",!1)}addCssClassToTitleBar(e){this.eFilterToolPanelHeader.classList.add(e)}addInIcon(e,t,i){if(null==t)return;let s=(0,m._createIconNoSpan)(e,this.beans,i);t.appendChild(s)}isFilterActive(){return!!this.beans.colFilter?.isFilterActive(this.column)}onFilterChanged(){(0,m._setDisplayed)(this.eFilterIcon,this.isFilterActive()),this.dispatchLocalEvent({type:"filterChanged"})}toggleExpanded(){this.expanded?this.collapse():this.expand()}expand(){this.expanded||(this.expanded=!0,(0,m._setAriaExpanded)(this.eFilterToolPanelHeader,!0),(0,m._setDisplayed)(this.eExpandChecked,!0),(0,m._setDisplayed)(this.eExpandUnchecked,!1),this.addFilterElement(),this.expandedCallback())}addFilterElement(e){let t=(0,m._createElement)({tag:"div",cls:"ag-filter-toolpanel-instance-filter"}),i=this.createManagedBean(new m.FilterComp(this.column,"TOOLBAR"));this.filterComp=i,i.hasFilter()&&i.getFilter()?.then(s=>{this.underlyingFilter=s,s&&(t.appendChild(i.getGui()),this.agFilterToolPanelBody.appendChild(t),i.afterGuiAttached({container:"toolPanel",suppressFocus:e}))})}collapse(){if(!this.expanded)return;this.expanded=!1,(0,m._setAriaExpanded)(this.eFilterToolPanelHeader,!1),this.removeFilterElement(),(0,m._setDisplayed)(this.eExpandChecked,!1),(0,m._setDisplayed)(this.eExpandUnchecked,!0);let e=this.filterComp;e?.afterGuiDetached(),this.destroyBean(e),this.expandedCallback()}removeFilterElement(){(0,m._clearElement)(this.agFilterToolPanelBody)}isExpanded(){return this.expanded}onPanelHidden(){if(!this.expanded)return;let e=this.underlyingFilter;e&&e.afterGuiDetached?.()}onFilterOpened(e){"COLUMN_MENU"!==e.source||e.column!==this.column||this.expanded&&this.collapse()}},lM=class extends m.Component{constructor(e,t,i,s,r){super(),this.columnGroup=e,this.childFilterComps=t,this.expandedCallback=i,this.depth=s,this.showingColumn=r,this.filterGroupComp=m.RefPlaceholder}postConstruct(){this.setTemplate({tag:"div",cls:"ag-filter-toolpanel-group-wrapper",children:[{tag:"ag-group-component",ref:"filterGroupComp"}]},[tC],{filterGroupComp:{cssIdentifier:"filter-toolpanel",direction:"vertical"}}),this.setGroupTitle();let{filterGroupComp:e,depth:t,childFilterComps:i,gos:s}=this;for(let s of(e.setAlignItems("stretch"),e.addCss(`ag-filter-toolpanel-group-level-${t}`),e.getGui().style.setProperty("--ag-indentation-level",String(t)),e.addCssClassToTitleBar(`ag-filter-toolpanel-group-level-${t}-header`),i))e.addItem(s),s.addCssClassToTitleBar(`ag-filter-toolpanel-group-level-${t+1}-header`),s.getGui().style.setProperty("--ag-indentation-level",String(t+1));let r=this.showingColumn?this.columnGroup:void 0;this.tooltipFeature=this.createOptionalManagedBean(this.beans.registry.createDynamicBean("tooltipFeature",!1,{getGui:()=>this.getGui(),getLocation:()=>"filterToolPanelColumnGroup",shouldDisplayTooltip:(0,m._getShouldDisplayTooltip)(s,()=>e.getGui().querySelector(".ag-group-title")),getAdditionalParams:()=>({colDef:r?.getColDef(),column:r})})),this.refreshFilterClass(),this.addExpandCollapseListeners(),this.addFilterChangedListeners(),this.setupTooltip(),this.addInIcon("filterActive")}setupTooltip(){if(!this.showingColumn)return;let e=()=>{this.tooltipFeature?.setTooltipAndRefresh(this.columnGroup.getColDef().headerTooltip)};e(),this.addManagedEventListeners({newColumnsLoaded:e})}addCssClassToTitleBar(e){this.filterGroupComp.addCssClassToTitleBar(e)}onPanelHidden(){for(let e of this.childFilterComps)e.onPanelHidden()}isColumnGroup(){return(0,m.isProvidedColumnGroup)(this.columnGroup)}isExpanded(){return this.filterGroupComp.isExpanded()}getChildren(){return this.childFilterComps}getFilterGroupName(){return this.filterGroupName??""}getFilterGroupId(){return this.columnGroup.getId()}hideGroupItem(e,t){this.filterGroupComp.hideItem(e,t)}hideGroup(e){this.setDisplayed(!e)}addInIcon(e){let t=(0,m._createIconNoSpan)(e,this.beans);if(t){t.classList.add("ag-filter-toolpanel-group-instance-header-icon");let e=this.getLocaleTextFunc();(0,m._setAriaLabel)(t,e("ariaFilterActive","Filter Active")),(0,m._setAriaRole)(t,"img")}this.filterGroupComp.addTitleBarWidget(t)}forEachToolPanelFilterChild(e){for(let t of this.childFilterComps)t instanceof lA&&e(t)}addExpandCollapseListeners(){let e=this.isColumnGroup()?()=>this.expandedCallback():()=>this.forEachToolPanelFilterChild(e=>e.expand()),t=this.isColumnGroup()?()=>this.expandedCallback():()=>this.forEachToolPanelFilterChild(e=>e.collapse());this.addManagedListeners(this.filterGroupComp,{expanded:e,collapsed:t})}getColumns(){return(0,m.isProvidedColumnGroup)(this.columnGroup)?this.columnGroup.getLeafColumns():[this.columnGroup]}addFilterChangedListeners(){for(let e of this.getColumns())this.addManagedListeners(e,{filterChanged:()=>this.refreshFilterClass()});(0,m.isProvidedColumnGroup)(this.columnGroup)||this.addManagedEventListeners({filterOpened:this.onFilterOpened.bind(this)})}refreshFilterClass(){let e=this.getColumns();this.filterGroupComp.toggleCss("ag-has-filter",e.some(e=>e.isFilterActive()))}onFilterOpened(e){"COLUMN_MENU"!==e.source||e.column!==this.columnGroup||this.isExpanded()&&this.collapse()}expand(){this.filterGroupComp.toggleGroupExpand(!0)}collapse(){this.filterGroupComp.toggleGroupExpand(!1)}setGroupTitle(){let e=this.columnGroup,t=(0,m.isProvidedColumnGroup)(e)?this.getColumnGroupName(e):this.getColumnName(e);this.filterGroupName=t,this.filterGroupComp.setTitle(t||"")}getColumnGroupName(e){return this.beans.colNames.getDisplayNameForProvidedColumnGroup(null,e,"filterToolPanel")}getColumnName(e){return this.beans.colNames.getDisplayNameForColumn(e,"filterToolPanel",!1)}destroyFilters(){this.childFilterComps=this.destroyBeans(this.childFilterComps),(0,m._clearElement)(this.getGui())}destroy(){this.destroyFilters(),super.destroy()}},lR={selector:"AG-FILTERS-TOOL-PANEL-LIST",component:class extends m.Component{constructor(){super({tag:"div",cls:"ag-filter-list-panel"}),this.initialised=!1,this.hasLoadedInitialState=!1,this.isInitialState=!1,this.filterGroupComps=[],this.suppressOnColumnsChanged=!1,this.onColumnsChangedPending=!1}wireBeans(e){this.colModel=e.colModel}init(e){this.initialised=!0;let t=(0,m._addGridCommonParams)(this.gos,{suppressExpandAll:!1,suppressFilterSearch:!1,suppressSyncLayoutWithGrid:!1});(0,m._mergeDeep)(t,e),this.params=t,t.suppressSyncLayoutWithGrid||this.addManagedEventListeners({columnMoved:()=>this.onColumnsChanged()}),this.addManagedEventListeners({newColumnsLoaded:()=>this.onColumnsChanged(),toolPanelVisibleChanged:e=>{"filters"!==e.key||e.visible||this.onPanelHidden()},dragStarted:()=>{this.suppressOnColumnsChanged=!0},dragStopped:()=>{this.suppressOnColumnsChanged=!1,this.onColumnsChangedPending&&(this.onColumnsChangedPending=!1,this.onColumnsChanged())}}),this.colModel.ready&&this.onColumnsChanged()}onColumnsChanged(){if(this.suppressOnColumnsChanged){this.onColumnsChangedPending=!0;return}let e=this.colModel.isPivotMode();this.params.suppressSyncLayoutWithGrid||e?this.buildTreeFromProvidedColumnDefs():this.syncFilterLayout(),this.refreshAriaLabel()}syncFilterLayout(){sw(this.colModel,this.setFiltersLayout.bind(this)),this.refreshAriaLabel()}buildTreeFromProvidedColumnDefs(){let e=this.colModel.getColDefColTree();this.recreateFilters(e)}setFiltersLayout(e){let t=sy(this.colModel,e);this.recreateFilters(t)}recreateFilters(e){let t=(0,m._getActiveDomElement)(this.beans);this.hasLoadedInitialState||(this.hasLoadedInitialState=!0,this.isInitialState=!!this.params.initialState);let i=this.getExpansionState();this.destroyFilters();let s=this.recursivelyAddComps(e,0,i);this.filterGroupComps=s;let r=s.length;if(r){for(let e of s)this.appendChild(e);this.setFirstAndLastVisible(0,r-1)}let a=this.searchFilterText;(0,m._exists)(a)&&this.searchFilters(a),this.fireExpandedEvent(),this.getGui().contains(t)&&t.focus(),this.isInitialState=!1,this.refreshAriaLabel()}recursivelyAddComps(e,t,i){return e.map(e=>{if((0,m.isProvidedColumnGroup)(e))return this.recursivelyAddFilterGroupComps(e,t,i)?.flatMap(e=>e)??[];if(!this.shouldDisplayFilter(e))return[];let s=new lA(0===t,()=>this.onFilterExpanded());if(this.createBean(s),s.setColumn(e),i.get(e.getId())&&s.expand(),t>0)return s;let r=this.createBean(new lM(e,[s],this.onGroupExpanded.bind(this),t,!0));return r.addCssClassToTitleBar("ag-filter-toolpanel-header"),i.get(r.getFilterGroupId())||r.collapse(),r}).flatMap(e=>e)}refreshAriaLabel(){let e=this.getLocaleTextFunc(),t=e("ariaFilterPanelList","Filter List"),i=e("filters","Filters"),s=this.getGui().querySelectorAll(".ag-filter-toolpanel-group-item:not(.ag-filter-toolpanel-group-wrapper, .ag-hidden)").length;(0,m._setAriaLabel)(this.getAriaElement(),`${t} ${s} ${i}`)}recursivelyAddFilterGroupComps(e,t,i){if(!this.filtersExistInChildren(e.getChildren()))return;let s=e.getColGroupDef();if(s?.suppressFiltersToolPanel)return[];let r=e.isPadding()?t:t+1,a=this.recursivelyAddComps(e.getChildren(),r,i).flatMap(e=>e);if(e.isPadding())return a;let l=new lM(e,a,this.onGroupExpanded.bind(this),t,!1);this.createBean(l),l.addCssClassToTitleBar("ag-filter-toolpanel-header");let n=i.get(l.getFilterGroupId());return(this.isInitialState&&!n||!1===n)&&l.collapse(),[l]}filtersExistInChildren(e){return e.some(e=>(0,m.isProvidedColumnGroup)(e)?this.filtersExistInChildren(e.getChildren()):this.shouldDisplayFilter(e))}shouldDisplayFilter(e){let t=e.getColDef()?.suppressFiltersToolPanel;return e.isFilterAllowed()&&!t}getExpansionState(){let e=new Map;if(this.isInitialState){let{expandedColIds:t,expandedGroupIds:i}=this.params.initialState;for(let i of t)e.set(i,!0);for(let t of i)e.set(t,!0);return e}let t=i=>{for(let s of(e.set(i.getFilterGroupId(),i.isExpanded()),i.getChildren()))s instanceof lM?t(s):e.set(s.getColumn().getId(),s.isExpanded())};return this.filterGroupComps.forEach(t),e}refresh(){}setVisible(e){super.setDisplayed(e),e&&!this.initialised&&this.init(this.params)}expandFilterGroups(e,t){let i=[],s=r=>{let a=r.getFilterGroupId();for(let l of((!t||t.includes(a))&&(e&&r.isColumnGroup()?r.expand():r.collapse(),i.push(a)),r.getChildren()))l instanceof lM&&s(l)};if(this.filterGroupComps.forEach(s),this.onGroupExpanded(),t){let e=t.filter(e=>0>i.indexOf(e));e.length>0&&(0,m._warn)(166,{unrecognisedGroupIds:e})}}expandFilters(e,t){let i=[],s=r=>{if(r instanceof lM){let t=!1;for(let i of r.getChildren())s(i)&&(e?(r.expand(),t=!0):r.isColumnGroup()||r.collapse());return t}let a=r.getColumn().getColId(),l=!t||t.includes(a);return l&&(e?r.expand():r.collapse(),i.push(a)),l};if(this.filterGroupComps.forEach(s),this.onGroupExpanded(),t){let e=t.filter(e=>0>i.indexOf(e));e.length>0&&(0,m._warn)(167,{unrecognisedColIds:e})}}onGroupExpanded(){this.fireExpandedEvent()}onFilterExpanded(){this.dispatchLocalEvent({type:"filterExpanded"})}fireExpandedEvent(){let e,t=0,i=0,s=e=>{if(e.isColumnGroup())for(let r of(e.isExpanded()?t++:i++,e.getChildren()))r instanceof lM&&s(r)};this.filterGroupComps.forEach(s),e=t>0&&i>0?2:+(i>0),this.dispatchLocalEvent({type:"groupExpanded",state:e})}performFilterSearch(e){this.searchFilterText=(0,m._exists)(e)?e.toLowerCase():null,this.searchFilters(this.searchFilterText)}searchFilters(e){let t,i,s=t=>!(0,m._exists)(e)||-1!==t.toLowerCase().indexOf(e),r=(e,t)=>{if(!(e instanceof lM))return s(e.getColumnFilterName()||"");let i=e.getChildren(),a=s(e.getFilterGroupName()),l=t||a;if(l){e.hideGroup(!1);for(let t=0;t<i.length;t++)r(i[t],l),e.hideGroupItem(!1,t);return!0}let n=!1;return i.forEach((i,s)=>{let a=r(i,t);e.hideGroupItem(!a,s),a&&(n=!0)}),e.hideGroup(!n),n};this.filterGroupComps.forEach((e,s)=>{r(e,!1);let a=e.getGui()?.classList.contains("ag-hidden");void 0===t?a||(t=s,i=s):a||i===s||(i=s)}),this.setFirstAndLastVisible(t,i),this.refreshAriaLabel()}setFirstAndLastVisible(e,t){this.filterGroupComps.forEach((i,s)=>{i.removeCss("ag-first-group-visible"),i.removeCss("ag-last-group-visible"),s===e&&i.addCss("ag-first-group-visible"),s===t&&i.addCss("ag-last-group-visible")})}onPanelHidden(){for(let e of this.filterGroupComps)e.onPanelHidden()}getExpandedFiltersAndGroups(){let e=[],t=new Set,i=s=>{if(s instanceof lM){for(let e of s.getChildren())i(e);let r=s.getFilterGroupId();s.isExpanded()&&!t.has(r)&&e.push(r)}else s.isExpanded()&&t.add(s.getColumn().getColId())};return this.filterGroupComps.forEach(i),{expandedGroupIds:e,expandedColIds:Array.from(t)}}destroyFilters(){this.filterGroupComps=this.destroyBeans(this.filterGroupComps),(0,m._clearElement)(this.getGui())}destroy(){this.destroyFilters(),super.destroy()}}},lT={tag:"div",cls:"ag-filter-toolpanel",children:[{tag:"ag-filters-tool-panel-header",ref:"filtersToolPanelHeaderPanel"},{tag:"ag-filters-tool-panel-list",ref:"filtersToolPanelListPanel"}]},lP=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="filterPanelSvc",this.states=new Map,this.orderedStates=[],this.initialStateApplied=!1,this.columnsLoaded=!1,this.isActive=!1}postConstruct(){if(!this.gos.get("enableFilterHandlers"))return;let e=this.updateFilterStates.bind(this),t=()=>this.dispatchStatesUpdates(void 0,!0),i=this.onFilterDestroyed.bind(this);this.addManagedEventListeners({newColumnsLoaded:()=>{this.columnsLoaded=!0,this.initialStateApplied||this.applyState(),e()},dataTypesInferred:e,filterChanged:e,filterDestroyed:i,filterHandlerDestroyed:i,filterOpened:t,filterClosed:t});let s=({column:e})=>{this.states.get(e.getColId())?.refresh?.(),t()};this.addManagedListeners(this.beans.colFilter,{filterStateChanged:s,filterModelAsStringChanged:s})}updateParams(e,t){this.params=e;let i=!1;if(t&&(this.currState=t,this.columnsLoaded)){let e=new Set(t.filters?.map(e=>e.colId));for(let t of this.getIds())e.has(t)||this.remove(t);this.clear(),this.applyState(),this.updateFilterStates(),i=!0}i||this.dispatchStatesUpdates(),this.beans.colFilter?.setGlobalButtons(!!e.buttons?.length)}getIds(){return Array.from(this.states.keys())}getAvailable(){let e=this.beans,t=[];for(let i of e.colModel.getColDefCols()??[]){let s=i.getColId();!i.isFilterAllowed()||i.colDef.suppressFiltersToolPanel||this.states.get(s)||t.push({id:s,name:lI(e,i)})}return t}add(e){this.createFilter(e,!0),this.dispatchStatesUpdates(e)}remove(e){let{states:t,orderedStates:i,beans:{colFilter:s,selectableFilter:r}}=this,a=t.get(e);if(!a)return;a.destroy?.();let l=a.state.column;t.delete(e),r?.clearActive(e),s?.destroyFilter(l),this.eventSvc.dispatchEvent({type:"filterSwitched",column:l});let n=i.indexOf(e);i.splice(n,1);let o=i[n];this.dispatchStatesUpdates(o)}getState(e){return this.states.get(e)?.state}updateFilterState(e,t,i,s){let r=this.getState(e);r&&(r[t]=i,s||this.dispatchLocalEvent({type:"filterPanelStateChanged",id:e,state:r}))}expand(e,t){let i=this.states.get(e);if(!i)return;i.destroy?.();let{handler:s,state:{column:r}}=i,a=this.createFilterState(r,s,t);this.states.set(e,a),this.dispatchLocalEvent({type:"filterPanelStateChanged",id:e,state:a.state})}updateType(e,t){let i=this.states.get(e);if(!i)return;let s=i.state;if(!1===s.expanded)return;let r=s.filterDefs;if(!r)return;let{colFilter:a,selectableFilter:l}=this.beans;l?.setActive(e,r,t),a.filterParamsChanged(e,"columnFilter");let n=s.column;this.eventSvc.dispatchEvent({type:"filterSwitched",column:n});let o=this.states.get(e);if(!o)return;let d=o.state;this.dispatchLocalEvent({type:"filterPanelStateChanged",id:e,state:d})}getActions(){let e=this.params?.buttons;if(e?.length)return{actions:e,canApply:!!this.beans.colFilter?.canApplyAll()}}doAction(e){this.beans.colFilter?.updateAllModels(e)}getGridState(){let e=[];return this.states.forEach((t,i)=>{e.push({colId:i,expanded:t.state.expanded})}),{filters:e}}createFilter(e,t){let i=this.createFilterStateWrapper(e,t);i&&(this.states.set(e,i),this.orderedStates.push(e))}createFilterStateWrapper(e,t){let{colModel:i,colFilter:s}=this.beans,r=i.getColDefCol(e);if(r&&!r.colDef.suppressFiltersToolPanel){let e=s.getHandler(r,!0);if(e)return this.createFilterState(r,e,t)}}updateFilterStates(){if(!this.params)return;let e=this.beans.colFilter.getModel(),t=new Set;for(let i of Object.keys(e)){let e=this.states.get(i);e?e.refresh?.():this.createFilter(i),t.add(i)}this.states.forEach((e,i)=>{t.has(i)||e.refresh?.()}),this.dispatchStatesUpdates()}createFilterState(e,t,i){let s=this.beans,{colFilter:r,selectableFilter:a}=s,l=lI(s,e),n=e.getColId(),o=()=>!!this.params?.buttons&&r.hasUnappliedModel(n),d=o();if(i){let s=e.colDef,{filterDefs:r,activeFilterDef:h}=a?.getDefs(e,s)??{},u=this.createBean(new m.FilterComp(e,"TOOLBAR",!0));return{state:{column:e,name:l,isEditing:d,expanded:i,detail:u.getGui(),activeFilterDef:h,filterDefs:r,afterGuiAttached:u.afterGuiAttached.bind(u),afterGuiDetached:u.afterGuiDetached.bind(u)},handler:t,refresh:()=>{this.updateFilterState(n,"isEditing",o())},destroy:()=>this.destroyBean(u)}}{let i=e.getColId(),s=()=>t.getModelAsString?.(r.getStateForColumn(i).model,"filterToolPanel")??"";return{state:{column:e,name:l,isEditing:d,expanded:!1,summary:s()},handler:t,refresh:()=>{this.updateFilterState(i,"isEditing",o(),!0),this.updateFilterState(i,"summary",s())}}}}onFilterDestroyed({column:e,source:t}){let{colFilter:i,filterManager:s}=this.beans;if(!i?.isAlive()||!s?.isFilterAllowed(e))return;let r=this.states,a=e.getColId(),l=r.get(a);if(l){let e=this.createFilterStateWrapper(a,l.state.expanded);e?(l.destroy?.(),r.set(a,e)):this.remove(a),"api"===t&&this.dispatchStatesUpdates()}}dispatchStatesUpdates(e,t){this.dispatchLocalEvent({type:"filterPanelStatesChanged",activeId:e,action:t})}applyState(){if(this.params&&this.columnsLoaded)for(let{colId:e,expanded:t}of(this.initialStateApplied=!0,this.currState?.filters??[]))this.createFilter(e,t)}destroy(){this.clear(),this.params=void 0,this.currState=void 0,super.destroy()}clear(){let{states:e,orderedStates:t}=this;e.forEach(e=>e.destroy?.()),e.clear(),t.length=0}};function lI(e,t){return e.colNames.getDisplayNameForColumn(t,"filterToolPanel")??t.getColId()}var lE={addFilterCard:"Add Filter",ariaLabelAddFilterField:"Add Filter Field",ariaLabelFilterCardDelete:"Delete Filter",ariaLabelFilterCardHasEdits:"Has Edits",agTextColumnFilterDisplayName:"Simple Filter",agNumberColumnFilterDisplayName:"Simple Filter",agDateColumnFilterDisplayName:"Simple Filter",agSetColumnFilterDisplayName:"Selection Filter",agMultiColumnFilterDisplayName:"Combo Filter",addFilterPlaceholder:"Search columns..."};function lD(e,t){return(0,m._translate)(e,lE,t)}var lk=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="selectableFilter",this.selectedFilters=new Map,this.valueGetters=new Map}postConstruct(){let{gos:e,selectedFilters:t}=this,i=e.get("initialState")?.filter?.selectableFilters??{};for(let e of Object.keys(i))t.set(e,i[e])}getFilterValueGetter(e){return this.valueGetters.get(e)}isSelectable(e){return"agSelectableColumnFilter"===e.filter}getFilterDef(e,t){return this.getDefs(e,t).activeFilterDef}getDefs(e,t,i){if(!this.isSelectable(t))return;let s=this.beans,{gos:r,dataTypeSvc:a,colFilter:l}=s,n=t.filterParams,o=e.colDef;"function"==typeof n&&(n=n((0,m._addGridCommonParams)(r,{column:e,colDef:o})));let d=a?.getBaseDataType(e),h=a?.getDataTypeDefinition(e),u=a?.getFormatValue(d),{filters:c,defaultFilterParams:p,defaultFilterIndex:g}=n??{},f=t=>{let i,r,{filter:a,filterParams:n,name:c,filterValueGetter:g=o.filterValueGetter}=t,f=p?{...p,...n}:n;if(h&&u&&(i="agMultiColumnFilter"===a?s.multiFilter?.getParamsForDataType(f,g,h,u):(0,m._getFilterParamsForDataType)(a,f,g,h,u,s,this.getLocaleTextFunc())),!c){let t=a;"boolean"==typeof a&&(t=l?.getDefaultFilterFromDataType(()=>d)),"string"==typeof t?r=lD(this,`${t}DisplayName`):((0,m._warn)(280,{colId:e.getColId()}),r="")}return p||i||r?{...t,filterParams:f,name:r??c,...i}:t},C=(c??this.getDefaultFilters(e)).map(f),v=i??this.selectedFilters.get(e.getColId())??g??(!c&&(0,m._isSetFilterByDefault)(r)?1:0);v>=C.length&&(v=0);let b=C[v];return{filterDefs:C,activeFilterDef:b}}setActive(e,t,i,s){let r=t.indexOf(i);if(r<0)return;let{selectedFilters:a,valueGetters:l}=this;a.set(e,r);let n=i.filterValueGetter;n?l.set(e,n):l.delete(e),s||this.onChange()}clearActive(e){let{selectedFilters:t,valueGetters:i}=this;t.delete(e),i.delete(e),this.onChange()}getState(){return Object.fromEntries(this.selectedFilters)}setState(e){this.clearAll();let t=this.beans.colModel;for(let i of Object.keys(e)){let s=t.getColDefCol(i);if(s){let t=this.getDefs(s,s.colDef,e[i]);t&&this.setActive(i,t.filterDefs,t.activeFilterDef,!0)}}}destroy(){this.clearAll(),super.destroy()}clearAll(){let{selectedFilters:e,valueGetters:t}=this;e.clear(),t.clear()}onChange(){this.dispatchLocalEvent({type:"selectedFilterChanged"})}getDefaultFilters(e){let{gos:t,dataTypeSvc:i}=this.beans,s=t.isModuleRegistered("MultiFilter"),r=i?.getBaseDataType(e);return[{filter:(0,m._getDefaultSimpleFilter)(r,!1)},{filter:"agSetColumnFilter"},...s?[{filter:"agMultiColumnFilter"}]:[]]}},lL={tag:"div",cls:"ag-filter-card ag-filter-card-add"},lN=class extends m.Component{constructor(e){super(lL),this.options=new Map,this.setOptions(e)}postConstruct(){this.showButton()}refresh(e){this.setOptions(e);let{eSelect:t,options:i}=this;t&&t.setValueList({valueList:Array.from(i.keys()),refresh:!0})}showButton(){(0,m._clearElement)(this.getGui()),this.destroySelect();let e=(0,m._createElement)({tag:"button",cls:"ag-button ag-standard-button ag-filter-add-button",children:[{tag:"span",children:[()=>(0,m._createIconNoSpan)("filterAdd",this.beans)]},{tag:"span",cls:"ag-filter-add-button-label",children:lD(this,"addFilterCard")}]});this.activateTabIndex([e]);let t=this.showSelect.bind(this);e.addEventListener("click",t),this.removeButton=()=>{e.removeEventListener("click",t)},this.appendChild(e),e.focus()}showSelect(){(0,m._clearElement)(this.getGui()),this.destroyButton();let e="ariaLabelAddFilterField",t={className:"ag-filter-add-select",pickerType:"virtual-list",pickerAriaLabelKey:e,pickerAriaLabelValue:lD(this,e),placeholder:lD(this,"addFilterPlaceholder"),value:"",valueList:Array.from(this.options.keys()),searchType:"matchAny",allowTyping:!0,filterList:!0,highlightMatch:!0,valueFormatter:e=>this.options.get(e)},i=this.createManagedBean(new it(t));this.eSelect=i,this.appendChild(i.getGui()),i.showPicker(),i.getFocusableElement().focus(),i.addManagedListeners(i,{fieldPickerValueSelected:({value:e})=>this.dispatchLocalEvent({type:"filterSelected",id:e}),pickerHidden:()=>{this.showButton()}})}setOptions(e){let t=this.options;for(let{id:i,name:s}of(t.clear(),e))t.set(i,s)}destroySelect(){this.eSelect=this.destroyBean(this.eSelect)}destroyButton(){this.removeButton=this.removeButton?.()}destroy(){this.destroySelect(),this.destroyButton(),super.destroy()}},lG={tag:"div",cls:"ag-filter-card-body",children:[{tag:"ag-select",cls:"ag-filter-type-select",ref:"eFilterType"}]},lO=class extends m.Component{constructor(){super(...arguments),this.eFilterType=m.RefPlaceholder}postConstruct(){this.setTemplate(lG,[m.AgSelectSelector],{eFilterType:{onValueChange:e=>this.dispatchLocalEvent({type:"filterTypeChanged",filterDef:e})}}),this.eFilterType.setDisplayed(!1)}refresh(e){let t=this.state;this.state=e;let{activeFilterDef:i,filterDefs:s,detail:r,afterGuiAttached:a,afterGuiDetached:l}=e,{activeFilterDef:n,filterDefs:o,detail:d}=t??{},h=this.eFilterType;if(s!==o){h.clearOptions();let e=s?.map(e=>({value:e,text:e.name}));e&&h.clearOptions().addOptions(e).setValue(i,!0),h.setDisplayed(!!e)}else i!==n&&h.setValue(i,!0);r!==d&&(d&&((0,m._removeFromParent)(d),l()),this.appendChild(r),a({container:"newFiltersToolPanel",suppressFocus:!0}))}},lB={tag:"div",cls:"ag-filter-card-summary",attrs:{"aria-hidden":"true"}},lV=class extends m.Component{constructor(){super(lB)}refresh(e){this.getGui().textContent=e.summary}},l_={tag:"div",cls:"ag-filter-card",children:[{tag:"div",cls:"ag-filter-card-header",role:"presentation",children:[{tag:"div",cls:"ag-filter-card-heading",role:"heading",attrs:{"aria-level":"2"},children:[{tag:"button",ref:"eExpand",cls:"ag-button ag-filter-card-expand",children:[{tag:"span",ref:"eTitle",cls:"ag-filter-card-title"},{tag:"span",ref:"eEditing",cls:"ag-filter-card-editing-icon"},{tag:"span",ref:"eExpandIcon",cls:"ag-filter-card-expand-icon"}]}]},{tag:"button",ref:"eDelete",cls:"ag-button ag-filter-card-delete",children:[{tag:"span",ref:"eDeleteIcon",cls:"ag-filter-card-delete-icon"}]}]}]},lz=class extends m.Component{constructor(e){super(l_),this.id=e,this.eTitle=m.RefPlaceholder,this.eExpand=m.RefPlaceholder,this.eDelete=m.RefPlaceholder,this.eExpandIcon=m.RefPlaceholder,this.eDeleteIcon=m.RefPlaceholder,this.eEditing=m.RefPlaceholder}postConstruct(){let{beans:e,eDelete:t,eExpand:i,eDeleteIcon:s,eEditing:r,id:a}=this,l=e.filterPanelSvc;(0,m._setAriaLabel)(t,lD(this,"ariaLabelFilterCardDelete")),s.appendChild((0,m._createIcon)("close",e,null)),this.activateTabIndex([i,t]),this.addManagedElementListeners(i,{click:()=>l.expand(a,!this.state?.expanded)}),this.addManagedElementListeners(t,{click:()=>l.remove(a)}),this.addManagedEventListeners({filterOpened:this.onFilterOpened.bind(this)}),r.appendChild((0,m._createIcon)("filterCardEditing",e,null))}refresh(e){let{eExpand:t,eEditing:i,state:s,beans:r}=this;this.state=e;let{name:a,expanded:l,isEditing:n}=e;this.eTitle.textContent=a,(0,m._setDisplayed)(i,n),s&&l===s.expanded||this.toggleExpand(e);let o=l?null:`${a} ${e.summary}`;n&&(o=`${o??a}. ${lD(this,"ariaLabelFilterCardHasEdits")}`),(0,m._setAriaLabel)(t,o);let d=e=>{if(e)return(0,m._removeFromParent)(e.getGui()),this.destroyBean(e)},h=(t,i,s)=>(t||(t=this.createBean(new i),s?.(t),this.appendChild(t.getGui())),t.refresh(e),t);if(e.expanded){this.summaryComp=d(this.summaryComp);let e=h(this.detailComp,lO,e=>e.addManagedListeners(e,{filterTypeChanged:({filterDef:e})=>r.filterPanelSvc.updateType(this.id,e)}));this.detailComp=e;let i=`ag-${this.getCompId()}-filter`;e.getGui().id=i,(0,m._setAriaControls)(t,i)}else this.detailComp=d(this.detailComp),this.summaryComp=h(this.summaryComp,lV),(0,m._setAriaControls)(t,null)}toggleExpand(e){let t=!!e.expanded,{eExpandIcon:i,eExpand:s,beans:r}=this;(0,m._clearElement)(i),i.appendChild((0,m._createIcon)(t?"filterCardCollapse":"filterCardExpand",r,null)),(0,m._setAriaExpanded)(s,t)}onFilterOpened(e){let{state:t,beans:i,id:s}=this;"COLUMN_MENU"===e.source&&e.column===t?.column&&t?.expanded&&i.filterPanelSvc.expand(s,!1)}destroy(){this.detailComp=this.destroyBean(this.detailComp),this.summaryComp=this.destroyBean(this.summaryComp),this.state=void 0,super.destroy()}},lH={tag:"div",cls:"ag-filter-panel",children:[{tag:"div",cls:"ag-filter-panel-container",ref:"eContainer"}]},lU=class extends m.Component{constructor(){super(lH),this.eContainer=m.RefPlaceholder,this.filters=new Map}refresh(e){if(e?.action)return void this.refreshActions();if(e?.id)return void this.filters.get(e.id)?.refresh(e.state);let{eContainer:t,filters:i,beans:s}=this,r=s.filterPanelSvc,a=r.getIds(),l=new Map,n=!(0,m._isNothingFocused)(s),o=n?(0,m._getActiveDomElement)(s):void 0,d=n&&t.contains(o),h=[],u=[];for(let e of a){let t=i.get(e)??this.createBean(new lz(e));t.refresh(r.getState(e)),l.set(e,t),u.push(t.getGui())}this.filters=l;let c=[];i.forEach((e,t)=>{h.push(e.getGui()),l.has(t)||c.push(e)});let p=this.addFilterComp;p&&h.push(p.getGui());let g=r.getAvailable();g.length?(p||(p=this.createBean(new lN(g))).addManagedListeners(p,{filterSelected:({id:e})=>r.add(e)}),p.refresh(g),u.push(p.getGui())):p=this.destroyBean(p),this.addFilterComp=p;let f=0;for(let e=0;e<h.length;e++){let t=h[e];t===u[f]?f++:(0,m._removeFromParent)(t)}for(;f<u.length;)t.appendChild(u[f++]);for(let e of c)this.destroyBean(e);let C=e?.activeId,v=C&&l.get(C)?.getGui();v?(0,m._focusInto)(v):d&&(0,m._isNothingFocused)(s)&&(0,m._focusInto)(u[u.length-1]??t),this.refreshActions()}refreshActions(){let e=this.beans.filterPanelSvc,{actions:t,canApply:i}=e.getActions()??{},s=this.buttonComp;if(t?.length){let r=t.map(e=>({type:e,label:(0,m._translateForFilter)(this,`${e}Filter`)}));if(!s){s=this.createBean(new m.FilterButtonComp({className:"ag-filter-panel-buttons"})),this.getGui().appendChild(s.getGui());let t={};for(let i of["apply","clear","reset","cancel"])t[i]=()=>e.doAction(i);s.addManagedListeners(s,t)}s.updateButtons(r),s.updateValidity(!1!==i)}else s&&((0,m._removeFromParent)(s.getGui()),s=this.destroyBean(s));this.buttonComp=s}destroy(){this.beans.filterPanelSvc?.clear?.(),this.addFilterComp=this.destroyBean(this.addFilterComp),this.buttonComp=this.destroyBean(this.buttonComp);let e=this.filters;e.forEach(e=>this.destroyBean(e)),e.clear(),super.destroy()}},lW=class extends m.Component{constructor(){super(),this.registerCSS(".ag-filter-panel{display:flex;flex-direction:column;width:100%;:where(.ag-standard-button){transition:background-color .25s ease-in-out,color .25s ease-in-out}}.ag-filter-panel .ag-simple-filter-body-wrapper{padding:var(--ag-widget-vertical-spacing) var(--ag-widget-container-horizontal-padding) 0}.ag-filter-panel .ag-mini-filter{margin-left:var(--ag-widget-container-horizontal-padding);margin-right:var(--ag-widget-container-horizontal-padding);margin-top:var(--ag-widget-vertical-spacing)}.ag-filter-panel-container{display:flex;flex:1;flex-direction:column;gap:var(--ag-widget-container-vertical-padding);overflow:auto;padding:var(--ag-widget-container-vertical-padding) var(--ag-widget-container-horizontal-padding) 0}.ag-filter-card{background-color:var(--ag-background-color);border:solid var(--ag-border-width) var(--ag-border-color);border-radius:var(--ag-border-radius)}.ag-filter-card-header{align-items:center;display:flex;flex-direction:row;gap:var(--ag-spacing);padding-top:var(--ag-widget-vertical-spacing)}.ag-filter-card-heading{flex:1;overflow:hidden;padding-bottom:calc(var(--ag-widget-container-vertical-padding) - var(--ag-widget-vertical-spacing));padding-top:calc(var(--ag-widget-container-vertical-padding) - var(--ag-widget-vertical-spacing))}:where(.ag-ltr) .ag-filter-card-heading{padding-left:var(--ag-widget-horizontal-spacing)}:where(.ag-rtl) .ag-filter-card-heading{padding-right:var(--ag-widget-horizontal-spacing)}.ag-filter-card-expand{align-items:center;display:flex;flex-direction:row;width:100%}.ag-filter-card-title{font-weight:var(--ag-header-font-weight);overflow:hidden;text-overflow:ellipsis}.ag-filter-card-expand-icon{display:flex;flex:1;justify-content:end}.ag-filter-card-editing-icon{margin:0 var(--ag-spacing)}.ag-filter-card-delete-icon,.ag-filter-card-editing-icon,.ag-filter-card-expand-icon,.ag-filter-card-summary{color:var(--ag-filter-panel-card-subtle-color)}.ag-filter-card-delete-icon,.ag-filter-card-expand-icon{transition:color .25s ease-in-out}.ag-filter-card-delete-icon:hover,.ag-filter-card-expand-icon:hover,.ag-filter-card-heading:hover .ag-filter-card-expand-icon{color:var(--ag-filter-panel-card-subtle-hover-color)}.ag-filter-add-button,.ag-filter-card-delete,.ag-filter-card-expand{border-radius:var(--ag-button-border-radius)}.ag-filter-card-summary,.ag-filter-type-select{margin-left:var(--ag-widget-container-horizontal-padding);margin-right:var(--ag-widget-container-horizontal-padding)}:where(.ag-ltr) .ag-filter-card-delete{margin-right:var(--ag-widget-horizontal-spacing)}:where(.ag-rtl) .ag-filter-card-delete{margin-left:var(--ag-widget-horizontal-spacing)}.ag-filter-card-summary{margin-bottom:var(--ag-widget-container-vertical-padding)}.ag-filter-type-select{padding-top:var(--ag-widget-vertical-spacing)}.ag-filter-card-add{border:0;padding:0}.ag-filter-add-button{align-items:center;display:flex;flex-direction:row;line-height:1.5;width:100%}:where(.ag-ltr) .ag-filter-add-button-label{margin-left:var(--ag-spacing)}:where(.ag-rtl) .ag-filter-add-button-label{margin-right:var(--ag-spacing)}.ag-filter-add-select{border:0;.ag-rich-select-value{border:0;padding:calc(((1.5*var(--ag-font-size) + 2*var(--ag-button-vertical-padding)) - var(--ag-input-height))/2) var(--ag-spacing)}}:where(.ag-ltr) .ag-filter-add-select{.ag-text-field-input{padding-left:calc(var(--ag-spacing)*1.5 + 12px)!important}}:where(.ag-rtl) .ag-filter-add-select{.ag-text-field-input{padding-right:calc(var(--ag-spacing)*1.5 + 12px)!important}}.ag-filter-panel-buttons{display:flex;flex-wrap:wrap;gap:var(--ag-widget-vertical-spacing) var(--ag-widget-horizontal-spacing);justify-content:flex-end;overflow:hidden;padding:var(--ag-widget-container-vertical-padding) var(--ag-widget-container-horizontal-padding) 0}.ag-filter-panel-buttons-button{line-height:1.5}.ag-filter-panel .ag-filter-panel-buttons-apply-button{background-color:var(--ag-filter-panel-apply-button-background-color);color:var(--ag-filter-panel-apply-button-color)}.ag-filter-panel-buttons:where(:last-child),.ag-filter-panel-container:where(:last-child){padding-bottom:var(--ag-widget-container-vertical-padding)}.ag-filter-panel .ag-set-filter-body-wrapper,.ag-filter-panel .ag-simple-filter-body-wrapper{padding-bottom:var(--ag-widget-container-vertical-padding)}")}init(e){if(!this.gos.get("enableFilterHandlers"))return void(0,m._warn)(282);let t=this.beans.filterPanelSvc;t.isActive=!0,this.addDestroyFunc(()=>{t.isActive=!1}),this.updateParams(e,e.initialState);let i=this.createManagedBean(new lU);this.filterPanel=i;let s=t=>{i.refresh(t),e.onStateUpdated()};s(),this.addManagedListeners(t,{filterPanelStatesChanged:s,filterPanelStateChanged:s})}getGui(){return this.filterPanel?.getGui()}refresh(e){return this.updateParams(e,e.initialState),!0}updateParams(e,t){this.beans.filterPanelSvc?.updateParams(e,t)}getState(){return this.beans.filterPanelSvc?.getGridState()??{}}},lK={moduleName:"FiltersToolPanel",version:tv,userComponents:{agFiltersToolPanel:class extends m.Component{constructor(){super(lT,[lx,lR]),this.filtersToolPanelHeaderPanel=m.RefPlaceholder,this.filtersToolPanelListPanel=m.RefPlaceholder,this.initialised=!1,this.listenerDestroyFuncs=[],this.registerCSS(".ag-filter-toolpanel{flex:1 1 0px;min-width:0}.ag-filter-toolpanel-header,.ag-filter-toolpanel-search{align-items:center;color:var(--ag-header-text-color);display:flex;font-weight:var(--ag-header-font-weight);padding:0 var(--ag-spacing);>:where(.ag-filter-icon),>:where(.ag-filter-toolpanel-expand),>:where(.ag-filter-toolpanel-search-input),>:where(.ag-header-cell-text){align-items:center;display:flex}}.ag-filter-toolpanel-header{padding-bottom:var(--ag-spacing);padding-top:var(--ag-spacing);position:relative;&:focus-visible{border-radius:var(--ag-border-radius);box-shadow:inset var(--ag-focus-shadow)}}:where(.ag-ltr) .ag-filter-toolpanel-group-instance-header-icon,:where(.ag-ltr) .ag-filter-toolpanel-instance-header-icon{margin-left:var(--ag-spacing)}:where(.ag-rtl) .ag-filter-toolpanel-group-instance-header-icon,:where(.ag-rtl) .ag-filter-toolpanel-instance-header-icon{margin-right:var(--ag-spacing)}.ag-filter-toolpanel-search{min-height:var(--ag-header-height);padding-bottom:var(--ag-spacing);padding-top:var(--ag-widget-container-vertical-padding)}:where(.ag-filter-toolpanel-group:not(.ag-has-filter)>.ag-group-title-bar) .ag-filter-toolpanel-group-instance-header-icon{display:none}.ag-filter-toolpanel-search-input{flex-grow:1;height:calc(var(--ag-spacing)*4)}:where(.ag-ltr) .ag-filter-toolpanel-group-title-bar-icon{margin-right:var(--ag-spacing)}:where(.ag-rtl) .ag-filter-toolpanel-group-title-bar-icon{margin-left:var(--ag-spacing)}.ag-filter-toolpanel-expand{cursor:pointer}:where(.ag-ltr) .ag-filter-toolpanel-expand{margin-right:var(--ag-spacing)}:where(.ag-rtl) .ag-filter-toolpanel-expand{margin-left:var(--ag-spacing)}:where(.ag-ltr) .ag-filter-toolpanel-group-title-bar,:where(.ag-ltr) .ag-filter-toolpanel-instance-header{padding-left:calc(var(--ag-spacing) + var(--ag-filter-tool-panel-group-indent)*var(--ag-indentation-level))}:where(.ag-rtl) .ag-filter-toolpanel-group-title-bar,:where(.ag-rtl) .ag-filter-toolpanel-instance-header{padding-right:calc(var(--ag-spacing) + var(--ag-filter-tool-panel-group-indent)*var(--ag-indentation-level))}:where(.ag-ltr) .ag-filter-toolpanel-instance-body{margin-left:var(--ag-filter-tool-panel-group-indent)}:where(.ag-rtl) .ag-filter-toolpanel-instance-body{margin-right:var(--ag-filter-tool-panel-group-indent)}.ag-filter-toolpanel-instance-filter{background-color:var(--ag-chrome-background-color)}.ag-filter-toolpanel-group-level-0{border-top:none}")}init(e){if(this.initialised){for(let e of this.listenerDestroyFuncs)e();this.listenerDestroyFuncs=[]}this.initialised=!0;let t={suppressExpandAll:!1,suppressFilterSearch:!1,suppressSyncLayoutWithGrid:!1,...e};this.params=t;let{filtersToolPanelHeaderPanel:i,filtersToolPanelListPanel:s}=this;i.init(t),s.init(t);let{suppressExpandAll:r,suppressFilterSearch:a}=t;r&&a&&i.setDisplayed(!1),this.listenerDestroyFuncs.push(...this.addManagedListeners(i,{expandAll:()=>s.expandFilterGroups(!0),collapseAll:()=>s.expandFilterGroups(!1),searchChanged:e=>s.performFilterSearch(e.searchText)}),...this.addManagedListeners(s,{filterExpanded:t.onStateUpdated,groupExpanded:e=>{i.setExpandState(e.state),t.onStateUpdated()}}))}setVisible(e){super.setDisplayed(e),e&&!this.initialised&&this.init(this.params)}setFilterLayout(e){this.filtersToolPanelListPanel.setFiltersLayout(e)}expandFilterGroups(e){this.filtersToolPanelListPanel.expandFilterGroups(!0,e)}collapseFilterGroups(e){this.filtersToolPanelListPanel.expandFilterGroups(!1,e)}expandFilters(e){this.filtersToolPanelListPanel.expandFilters(!0,e)}collapseFilters(e){this.filtersToolPanelListPanel.expandFilters(!1,e)}syncLayoutWithGrid(){this.filtersToolPanelListPanel.syncFilterLayout()}refresh(e){return this.init(e),!0}getState(){return this.filtersToolPanelListPanel.getExpandedFiltersAndGroups()}}},icons:{filtersToolPanel:"filter"},dependsOn:[sp,tb,m._ColumnFilterModule]},l$={moduleName:"NewFiltersToolPanel",version:tv,userComponents:{agNewFiltersToolPanel:lW},beans:[lP,lk],icons:{filterAdd:"filter-add",filtersToolPanel:"filter",richSelectOpen:"small-down",richSelectRemove:"cancel",richSelectLoading:"loading",filterCardExpand:"chevron-down",filterCardCollapse:"chevron-up",filterCardEditing:"edit"},dependsOn:[sp,tb,m._ColumnFilterModule]},lj=class extends m.BeanStub{constructor(){super(...arguments),this.loadRowDataVersion=0}wireBeans(e){this.environment=e.environment}init(e,t){this.params=t,this.comp=e,null==t.pinned&&(this.setAutoHeightClasses(),this.setupRefreshStrategy(),this.createDetailGrid(),this.loadRowData(),this.addManagedEventListeners({fullWidthRowFocused:this.onFullWidthRowFocused.bind(this)}))}onFullWidthRowFocused(e){let t=this.params,i={rowIndex:t.node.rowIndex,rowPinned:t.node.rowPinned},s={rowIndex:e.rowIndex,rowPinned:e.rowPinned};(0,m._isSameRow)(i,s)&&(0,m._focusInto)(this.comp.getGui(),e.fromBelow)}setAutoHeightClasses(){let e=this.gos.get("detailRowAutoHeight"),t=this.comp;t.toggleCss(e?"ag-details-row-auto-height":"ag-details-row-fixed-height",!0),t.toggleDetailGridCss(e?"ag-details-grid-auto-height":"ag-details-grid-fixed-height",!0)}setupRefreshStrategy(){let e=this.params.refreshStrategy;if("everything"==e||"nothing"==e||"rows"==e){this.refreshStrategy=e;return}null!=e&&(0,m._warn)(170,{providedStrategy:e}),this.refreshStrategy="rows"}createDetailGrid(){let{params:e,gos:t}=this;if((0,m._missing)(e.detailGridOptions))return void(0,m._warn)(171);let i=t.get("theme"),s=e.detailGridOptions.theme;s&&s!==i&&(0,m._warn)(267);let r={themeStyleContainer:this.environment.eStyleContainer,...e.detailGridOptions,theme:i};t.get("detailRowAutoHeight")&&(r.domLayout="autoHeight"),this.comp.setDetailGrid(r)}registerDetailWithMaster(e){let{params:t,beans:{selectionSvc:i,findSvc:s,expansionSvc:r}}=this,a=t.node.id,l=t.api,n={id:a,api:e},o=t.node;if(l.isDestroyed())return;l.addDetailGridInfo(a,n),o.detailGridInfo=n;let d=o.parent;function h(){d&&i?.refreshMasterNodeState(d)}function u({source:t}){return"expandAll"===t?e.expandAll():"collapseAll"===t?e.collapseAll():void 0}function c({node:s,source:r}){s!==d||"masterDetail"===r||e.isDestroyed()||i?.setDetailSelectionState(d,t.detailGridOptions,e)}s?.registerDetailGrid(o,e),e.addEventListener("firstDataRendered",()=>{if(!(e.isDestroyed()||l.isDestroyed())){i?.setDetailSelectionState(d,t.detailGridOptions,e),e.addEventListener("selectionChanged",h),l.addEventListener("rowSelected",c);e.isModuleRegistered("CsrmSsrmSharedApiModule")&&(l.addEventListener("expandOrCollapseAll",u),r?.setDetailsExpansionState(e))}}),this.addManagedListeners(d,{masterChanged:e=>{e.node.master||this.onDestroy(n)}}),this.addDestroyFunc(()=>this.onDestroy(n))}onDestroy(e){let{params:t}=this,i=t.node,s=t.api;i.detailGridInfo===e&&(s.isDestroyed()||s.removeDetailGridInfo(i.id),i.detailGridInfo=null)}loadRowData(){this.loadRowDataVersion++;let e=this.loadRowDataVersion,t=this.params;if(t.detailGridOptions?.rowModelType==="serverSide"){let e=t.node;e.detailGridInfo?.api?.refreshServerSide({purge:!0});return}let i=t.getDetailRowData;if(!i)return void(0,m._warn)(172);let s=t=>{this.loadRowDataVersion===e&&this.comp.setRowData(t)};i({node:t.node,data:t.node.data,successCallback:s,context:(0,m._addGridCommonParams)(this.gos,{}).context})}refresh(){switch(this.refreshStrategy){case"nothing":return!0;case"everything":return!1}return this.loadRowData(),!0}},lY=class{constructor(e){this.parentWrapper=e}wrap(e,t,i,s){return this.parentWrapper.wrap(e,t,i,s)}},lq={tag:"div",cls:"ag-details-row"},lZ={tag:"div",cls:"ag-details-row",role:"gridcell",children:[{tag:"div",ref:"eDetailGrid",cls:"ag-details-grid",role:"presentation"}]};function lX(e,t){let i=e.masterDetailSvc?.store;return i?t(i):void 0}var lJ={moduleName:"MasterDetail",version:tv,dependsOn:[{moduleName:"SharedMasterDetail",version:tv,beans:[class extends m.BeanStub{constructor(){super(...arguments),this.beanName="masterDetailSvc",this.store={}}isEnabled(){return this.gos.get("masterDetail")}postConstruct(){let e=this.gos;(0,m._isClientSideRowModel)(e)&&(this.enabled=this.isEnabled()),(0,m._isServerSideRowModel)(e)&&this.addEventListeners()}addEventListeners(){let e,t=e=>{this.setMaster(e.node,!1,!0)},i=()=>{if(e){for(let t of e)t();e=void 0}this.isEnabled()&&(e=this.addManagedListeners(this.beans.eventSvc,{rowNodeDataChanged:t}))};i(),this.gos.addPropertyEventListener("masterDetail",i)}refreshModel(e){if(e.changedProps){let e=this.isEnabled();if(this.enabled!==e)return void this.setMasters(null)}e.rowDataUpdated&&this.setMasters(e.changedRowNodes)}setMaster(e,t,i){let s=e.master,r=this.isEnabled(),a=r,l=this.gos,n=l.get("isRowMaster"),o=l.get("treeData");if(r)if(t||i){if(n){let t=e.data;a=!!t&&!!n(t)}}else a=s;let d=this.beans;if(!o)if(a&&t){let t=d.rowGroupColsSvc?.columns.length??0;e.expanded=aQ(d,e,t,!1)}else!a&&s&&(e.expanded=!1);a!==s&&(e.master=a,e.dispatchRowEvent("masterChanged"))}setMasters(e){if(this.enabled=this.isEnabled(),e){for(let t of e.updates)this.setMaster(t,!1,!0);for(let t of e.adds)this.setMaster(t,!0,!1)}else{let e=(0,m._getClientSideRowModel)(this.beans)?.rootNode?._leafs;if(e)for(let t=0,i=e.length;t<i;++t)this.setMaster(e[t],!0,!1)}}getDetail(e){if(!e.master||!e.expanded)return null;let t=e.detailNode;return t||((t=new m.RowNode(this.beans)).detail=!0,t.selectable=!1,t.parent=e,(0,m._exists)(e.id)&&(t.id="detail_"+e.id),t.data=e.data,t.level=e.level+1,e.detailNode=t),t}setupDetailRowAutoHeight(e,t){let{gos:i,beans:s}=this;if(!i.get("detailRowAutoHeight"))return;let r=()=>{let s=t.clientHeight;if(null!=s&&s>0){let t=()=>{let{rowModel:t}=this.beans,{rowNode:r}=e;r.setRowHeight(s),((0,m._isClientSideRowModel)(i,t)||(0,m._isServerSideRowModel)(i,t))&&t.onRowHeightChanged()};window.setTimeout(t,0)}},a=(0,m._observeResize)(s,t,r);e.addDestroyFunc(a),r()}destroy(){this.store={},super.destroy()}}],userComponents:{agDetailCellRenderer:class extends m.Component{constructor(){super(...arguments),this.eDetailGrid=m.RefPlaceholder}wireBeans(e){this.context=e.context}init(e){this.params=e,this.selectAndSetTemplate(),this.ctrl=this.createManagedBean(new lj),this.ctrl.init({toggleCss:(e,t)=>this.toggleCss(e,t),toggleDetailGridCss:(e,t)=>this.eDetailGrid.classList.toggle(e,t),setDetailGrid:e=>this.setDetailGrid(e),setRowData:e=>this.setRowData(e),getGui:()=>this.eDetailGrid},e)}refresh(){return this.ctrl?.refresh()??!1}selectAndSetTemplate(){let e=this.params;if(e.pinned)return void this.setTemplate(lq);let t=()=>{this.setTemplate(lZ)};if((0,m._missing)(e.template))t();else if("string"==typeof e.template)this.setTemplate(e.template,[]);else if("function"==typeof e.template){let t=(0,e.template)(e);this.setTemplate(t,[])}else(0,m._warn)(168),t();null==this.eDetailGrid&&(0,m._warn)(169)}setDetailGrid(e){if(!this.eDetailGrid)return;let t=new lY(this.context.getBean("frameworkCompWrapper")),{frameworkOverrides:i}=this.beans,s=(0,m.createGrid)(this.eDetailGrid,e,{frameworkOverrides:i,providedBeanInstances:{frameworkCompWrapper:t},modules:(0,m._getGridRegisteredModules)(this.params.api.getGridId(),e.rowModelType??"clientSide")});this.detailApi=s,this.ctrl?.registerDetailWithMaster(s),this.addDestroyFunc(()=>{s.destroy()})}setRowData(e){this.detailApi?.setGridOption("rowData",e)}}},dynamicBeans:{detailCellRendererCtrl:lj},apiFunctions:{addDetailGridInfo:function(e,t,i){lX(e,e=>{e[t]=i})},removeDetailGridInfo:function(e,t){lX(e,e=>{delete e[t]})},getDetailGridInfo:function(e,t){return lX(e,e=>e[t])},forEachDetailGridInfo:function(e,t){lX(e,e=>{let i=0;Object.values(e).forEach(e=>{e&&t(e,i++)})})}},dependsOn:[tb,a4,a8],css:[".ag-details-row{width:100%}.ag-details-row-fixed-height{height:100%}.ag-details-grid{width:100%}.ag-details-grid-fixed-height{height:100%}"]},a6,m.EventApiModule]},lQ=class extends m.Component{constructor(){super(...arguments),this.changedCalculatedValues=!1,this.dragging=!1,this.shouldDestroyOnEndDragging=!1}postConstruct(){this.beans.dragSvc.addDragSource({dragStartPixels:0,eElement:this.getGui(),onDragging:e=>{let t=!1;if(!this.dragging){t=!0,this.dragging=!0;let e=(0,m._getPageBody)(this.beans);e.classList?.add(this.getDraggingCssClass())}if(this.updateValuesOnMove(e),t){this.changedCalculatedValues=!1;return}this.beans.rangeSvc.autoScrollService.check(e),this.changedCalculatedValues&&(this.onDrag(e),this.changedCalculatedValues=!1)},onDragStop:e=>{this.dragging=!1,this.onDragEnd(e),this.clearDragProperties()},onDragCancel:()=>{this.dragging=!1,this.onDragCancel(),this.clearDragProperties()}}),this.addManagedEventListeners({cellSelectionChanged:this.updateLocalRangeIfNeeded.bind(this)}),this.addManagedElementListeners(this.getGui(),{pointerdown:l0,mousedown:l0})}getLastCellHovered(){return this.lastCellHovered}getDraggingCssClass(){return`ag-dragging-${0===this.type?"fill":"range"}-handle`}updateValuesOnMove(e){let t=(0,m._getCellPositionForEvent)(this.gos,e);!t||this.shouldSkipCell(t)||this.lastCellHovered&&(0,m._areCellsEqual)(t,this.lastCellHovered)||(this.lastCellHovered=t,this.changedCalculatedValues=!0)}clearDragProperties(){this.clearValues(),this.beans.rangeSvc.autoScrollService.ensureCleared();let e=(0,m._getPageBody)(this.beans);e.classList?.remove(this.getDraggingCssClass()),this.shouldDestroyOnEndDragging&&this.destroy()}getType(){return this.type}refresh(e,t){let i=this.cellCtrl,s=this.getGui(),r=t??(0,m._last)(this.beans.rangeSvc.getCellRanges()),a=r.startRow,l=r.endRow;if(a&&l&&((0,m._isRowBefore)(l,a)?(this.rangeStartRow=l,this.rangeEndRow=a):(this.rangeStartRow=a,this.rangeEndRow=l)),i!==e||!(0,m._isVisible)(s)){this.cellCtrl=e;let t=e.comp.getParentOfValue();t&&t.appendChild(s)}this.cellRange=r}clearValues(){this.lastCellHovered=void 0}destroy(){if(!this.shouldDestroyOnEndDragging&&this.dragging){(0,m._setDisplayed)(this.getGui(),!1),this.shouldDestroyOnEndDragging=!0;return}this.shouldDestroyOnEndDragging=!1,super.destroy(),this.getGui()?.remove()}updateLocalRangeIfNeeded(e){if(!this.cellRange)return;let{id:t,type:i}=this.cellRange;if(!t||t!==e.id)return;let s=this.beans.rangeSvc?.getCellRanges().find(e=>e.id===t&&e.type===i);s&&s!==this.cellRange&&(this.cellRange=s)}},l0=e=>{e.stopPropagation()},l1={tag:"div",cls:"ag-fill-handle"},l2=class extends lQ{constructor(){super(l1),this.markedCells=[],this.cellValues=[],this.isUp=!1,this.isLeft=!1,this.isReduce=!1,this.type=0}postConstruct(){super.postConstruct(),this.addManagedElementListeners(this.getGui(),{dblclick:this.onDblClick.bind(this)})}onDblClick(e){(0,m._stopPropagationForAgGrid)(e);let{cellRange:t,rangeStartRow:i,beans:s}=this,{rangeSvc:r,visibleCols:a}=s,l=(0,m._getLastRow)(s);if(!l)return;let n=this.getFillHandleDirection();this.dragAxis="xy"===n?"y":n;let o=r?.createCellRangeFromCellRangeParams({rowStartIndex:i.rowIndex,rowStartPinned:i.rowPinned,columnStart:t.columns[0],rowEndIndex:"x"===this.dragAxis?t.endRow?.rowIndex??null:l.rowIndex,rowEndPinned:"x"===this.dragAxis?t.endRow?.rowPinned:l.rowPinned,columnEnd:"x"===this.dragAxis?(0,m._last)(a.allCols):(0,m._last)(t.columns)});this.isUp=!1,this.isLeft=!1,o&&this.performFill({event:e,initialRange:t,finalRange:o}),this.dragAxis=void 0}updateValuesOnMove(e){let t;super.updateValuesOnMove(e),this.initialXY||(this.initialXY=(0,m._getNormalisedMousePosition)(this.beans,e));let{x:i,y:s}=this.initialXY,{x:r,y:a}=(0,m._getNormalisedMousePosition)(this.beans,e),l=Math.abs(i-r),n=Math.abs(s-a),o=this.getFillHandleDirection();(t="xy"===o?l>n?"x":"y":o)!==this.dragAxis&&(this.dragAxis=t,this.changedCalculatedValues=!0)}shouldSkipCell(e){return(0,m.isRowNumberCol)(e.column)}onDrag(e){if(!this.initialPosition){let e=this.cellCtrl;if(!e)return;this.initialPosition=e.cellPosition}let t=this.getLastCellHovered();t&&this.markPathFrom(this.initialPosition,t)}onDragEnd(e){let t;if(this.initialXY=null,!this.markedCells.length)return;let i="x"===this.dragAxis,{cellRange:s,rangeStartRow:r,rangeEndRow:a,beans:{rangeSvc:l}}=this,n=s.columns.length;if(this.isUp||this.isLeft){let e=i?r:this.lastCellMarked;t=l.createCellRangeFromCellRangeParams({rowStartIndex:e.rowIndex,rowStartPinned:e.rowPinned,columnStart:i?this.lastCellMarked.column:s.columns[0],rowEndIndex:a.rowIndex,rowEndPinned:a.rowPinned,columnEnd:s.columns[n-1]})}else t=l.createCellRangeFromCellRangeParams({rowStartIndex:r.rowIndex,rowStartPinned:r.rowPinned,columnStart:s.columns[0],rowEndIndex:i?a.rowIndex:this.lastCellMarked.rowIndex,rowEndPinned:i?a.rowPinned:this.lastCellMarked.rowPinned,columnEnd:i?this.lastCellMarked.column:s.columns[n-1]});t&&this.performFill({event:e,initialRange:s,finalRange:t,shouldUpdateRange:!0})}onDragCancel(){this.initialXY=null,this.markedCells.length&&this.clearMarkedPath()}performFill({event:e,initialRange:t,finalRange:i,shouldUpdateRange:s}){let{eventSvc:r,rangeSvc:a}=this.beans;r.dispatchEvent({type:"fillStart"}),this.handleValueChanged(t,i,e),s&&a.setCellRanges([i]),r.dispatchEvent({type:"fillEnd",initialRange:t,finalRange:i})}getFillHandleDirection(){let e=(0,m._getFillHandle)(this.gos)?.direction;return e?"x"!==e&&"y"!==e&&"xy"!==e?((0,m._warn)(177),"xy"):e:"xy"}handleValueChanged(e,t,i){let{beans:s}=this,{rangeSvc:r,gos:a,valueSvc:l}=s,n=r.getRangeEndRow(e),o=r.getRangeStartRow(e),d=r.getRangeEndRow(t),h=r.getRangeStartRow(t),u="y"===this.dragAxis;if(this.isReduce&&!(0,m._getFillHandle)(a)?.suppressClearOnFillReduction){let i=u?e.columns:e.columns.filter(e=>0>t.columns.indexOf(e)),r=u?(0,m._getRowBelow)(s,d):h;r&&this.clearCellsInRange(r,n,i);return}let c=[],p=[],g=[],f=[],C=!0,v=0,b=()=>{c.length=0,p.length=0,g.length=0,f.length=0,v=0},y=(t,i)=>{let r=this.isUp?n:o,a=!1;for(u&&(C=!0,b());!a&&r;){let l=(0,m._getRowNode)(s,r);if(!l)break;if(u&&t)w(c,t,l,()=>!(0,m._isSameRow)(r,this.isUp?o:n));else if(i)for(let t of(C=!0,b(),i))w(c,t,l,()=>t!==(this.isLeft?e.columns[0]:(0,m._last)(e.columns)));a=(0,m._isSameRow)(r,this.isUp?h:d),r=this.isUp?(0,m._getRowAbove)(this.beans,r):(0,m._getRowBelow)(s,r)}},w=(e,t,s,r)=>{let a,n=!1;if(C)a=l.getValue(t,s,"edit"),p.push(a),g.push(l.getValue(t,s,"edit",!0)),f.push(l.getValueForDisplay({column:t,node:s,from:"edit"}).valueFormatted),C=r();else{let{value:r,fromUserFunction:o,sourceCol:d,sourceRowNode:h}=this.processValues({event:i,values:e,initialValues:p,initialNonAggregatedValues:g,initialFormattedValues:f,col:t,rowNode:s,idx:v++});if(a=r,t.isCellEditable(s)){let e=l.getValue(t,s,"edit");if(!o){if(d){let e=d.getColDef();if(!1!==e.useValueFormatterForExport&&e.valueFormatter){let e=l.getValueForDisplay({column:d,node:h,includeValueFormatted:!0,from:"edit"}).valueFormatted;null!=e&&(a=e)}}!1!==t.getColDef().useValueParserForImport&&(a=l.parseValue(t,s,d?a:(0,m._toStringOrNull)(a),e))}o&&e===a?n=!0:s.setDataValue(t,a,"rangeSvc")}}n||e.push({value:a,column:t,rowNode:s})};u?e.columns.forEach(e=>{y(e)}):y(void 0,this.isLeft?[...t.columns].reverse():t.columns),this.beans.editSvc?.stopEditing(void 0,{source:"fillHandle"})}clearCellsInRange(e,t,i){let s={startRow:e,endRow:t,columns:i,startColumn:i[0]};this.beans.rangeSvc.clearCellRangeCellValues({cellRanges:[s],restoreSourceInBatch:!0})}processValues(e){let t,{formula:i,valueSvc:s}=this.beans,{event:r,values:a,initialValues:l,initialNonAggregatedValues:n,initialFormattedValues:o,col:d,rowNode:h,idx:u}=e,c=(0,m._getFillHandle)(this.gos)?.setFillValue;if(t="y"===this.dragAxis?this.isUp?"up":"down":this.isLeft?"left":"right",c){let e=(0,m._addGridCommonParams)(this.gos,{event:r,values:a.map(({value:e})=>e),initialValues:l,initialNonAggregatedValues:n,initialFormattedValues:o,currentIndex:u,currentCellValue:s.getValue(d,h,"edit"),direction:t,column:d,rowNode:h}),i=c(e);if(!1!==i)return{value:i,fromUserFunction:!0}}let p=a.every(({value:e})=>"number"==typeof e&&Number.isFinite(e)||"string"==typeof e&&/^[+-]?\d+(?:\.\d+)?$/.test(e.trim()));if(r.altKey||!p){let e,s=String((0,m._last)(a)?.value??"");if(p&&1===l.length){let e=this.isUp||this.isLeft?-1:1;return{value:parseFloat(s)+ +e,fromUserFunction:!1}}let{value:r,column:n,rowNode:o}=a[u%a.length],d=n.isAllowFormula()&&i?.isFormula(s);return{value:e=d?i.updateFormulaByOffset({value:s,rowDelta:"up"===t?-1:+("down"===t),columnDelta:"left"===t?-1:+("right"===t)}):r,fromUserFunction:!1,sourceCol:d?void 0:n,sourceRowNode:o}}return{value:(0,m._last)(function(e){let t=e.length,i=0;if(t<=1)return e;for(let t=0;t<e.length;t++){let s=e[t],r=s.toString().split("e-");if(r.length>1){i=Math.max(i,parseInt(r[1],10));continue}Math.floor(s)!==s&&(i=Math.max(i,s.toString().split(".")[1].length))}let s=0,r=0,a=0,l=0,n=0;for(let i=0;i<t;i++)n=e[i],s+=i,r+=n,l+=i*i,a+=i*n;let o=(t*a-s*r)/(t*l-s*s),d=r/t-o*s/t,h=[];for(let e=0;e<=t;e++)h.push(parseFloat((e*o+d).toFixed(i)));return h}(a.map(({value:e})=>Number(e)))),fromUserFunction:!1}}clearValues(){this.clearMarkedPath(),this.clearCellValues(),this.lastCellMarked=void 0,super.clearValues()}clearMarkedPath(){for(let e of this.markedCells){if(!e.isAlive())continue;let{comp:t}=e;t.toggleCss("ag-selection-fill-top",!1),t.toggleCss("ag-selection-fill-right",!1),t.toggleCss("ag-selection-fill-bottom",!1),t.toggleCss("ag-selection-fill-left",!1)}this.markedCells.length=0,this.isUp=!1,this.isLeft=!1,this.isReduce=!1}clearCellValues(){this.cellValues.length=0}markPathFrom(e,t){if(this.clearMarkedPath(),this.clearCellValues(),"y"===this.dragAxis){if((0,m._isSameRow)(t,e))return;let i=(0,m._isRowBefore)(t,e),{rangeStartRow:s,rangeEndRow:r}=this;i&&(t.rowPinned==s.rowPinned&&t.rowIndex>=s.rowIndex||s.rowPinned!=r.rowPinned&&t.rowPinned==r.rowPinned&&t.rowIndex<=r.rowIndex)?(this.reduceVertical(e,t),this.isReduce=!0):(this.extendVertical(e,t,i),this.isReduce=!1)}else{let i=e.column,s=t.column;if(i===s)return;let r=this.beans.visibleCols.allCols,a=r.indexOf(i),l=r.indexOf(s);l<=a&&l>=r.indexOf(this.cellRange.columns[0])?(this.reduceHorizontal(e,t),this.isReduce=!0):(this.extendHorizontal(e,t,l<a),this.isReduce=!1)}this.lastCellMarked=t}extendVertical(e,t,i){let s=this.beans,{rangeSvc:r}=s,a=e;do{let l=this.cellRange,n=l.columns.length;for(let o=0;o<n;o++){let d=l.columns[o],h={...{rowIndex:a.rowIndex,rowPinned:a.rowPinned},column:d},u=r.isCellInSpecificRange(h,l),c=(0,m._isSameRow)(a,e);if(i&&(this.isUp=!0),!c){let e=(0,m._getCellByPosition)(s,h);if(e){this.markedCells.push(e);let s=e.comp;u||(s.toggleCss("ag-selection-fill-left",0===o),s.toggleCss("ag-selection-fill-right",o===n-1)),s.toggleCss(i?"ag-selection-fill-top":"ag-selection-fill-bottom",(0,m._isSameRow)(a,t))}}}if((0,m._isSameRow)(a,t))break}while(a=i?(0,m._getRowAbove)(this.beans,a):(0,m._getRowBelow)(s,a))}reduceVertical(e,t){let i=e,s=this.beans;do{let e=this.cellRange,r=e.columns.length,a=(0,m._isSameRow)(i,t);for(let a=0;a<r;a++){let r={...{rowIndex:i.rowIndex,rowPinned:i.rowPinned},column:e.columns[a]},l=(0,m._getCellByPosition)(s,r);l&&(this.markedCells.push(l),l.comp.toggleCss("ag-selection-fill-bottom",(0,m._isSameRow)(i,t)))}if(a)break}while(i=(0,m._getRowAbove)(s,i))}extendHorizontal(e,t,i){let s=this.beans,{visibleCols:r}=s,a=r.allCols,l=a.indexOf(i?t.column:e.column),n=a.indexOf(i?this.cellRange.columns[0]:t.column),o=+!i,d=a.slice(l+o,n+o),{rangeStartRow:h,rangeEndRow:u}=this;for(let e of d){let t=h,r=!1;do{r=(0,m._isSameRow)(t,u);let a=(0,m._getCellByPosition)(s,{rowIndex:t.rowIndex,rowPinned:t.rowPinned,column:e});if(a){this.markedCells.push(a);let s=a.comp;s.toggleCss("ag-selection-fill-top",(0,m._isSameRow)(t,h)),s.toggleCss("ag-selection-fill-bottom",(0,m._isSameRow)(t,u)),i?(this.isLeft=!0,s.toggleCss("ag-selection-fill-left",e===d[0])):s.toggleCss("ag-selection-fill-right",e===(0,m._last)(d))}t=(0,m._getRowBelow)(s,t)}while(!r)}}reduceHorizontal(e,t){let i=this.beans,{visibleCols:s}=i,r=s.allCols,a=r.indexOf(t.column),l=r.indexOf(e.column),n=r.slice(a,l),{rangeStartRow:o,rangeEndRow:d}=this;for(let e of n){let t=o,s=!1;do{s=(0,m._isSameRow)(t,d);let r=(0,m._getCellByPosition)(this.beans,{rowIndex:t.rowIndex,rowPinned:t.rowPinned,column:e});r&&(this.markedCells.push(r),r.comp.toggleCss("ag-selection-fill-right",e===n[0])),t=(0,m._getRowBelow)(i,t)}while(!s)}}refresh(e,t){let i=t??this.beans.rangeSvc.getCellRanges()[0];i.startRow&&i.endRow?super.refresh(e,i):this.destroy()}},l5=class extends lQ{constructor(){super({tag:"div",cls:"ag-range-handle"}),this.type=1,this.rangeFixed=!1}onDrag(e){let t=this.getLastCellHovered();if(!t)return;let i=this.beans.rangeSvc,s=this.cellRange??(0,m._last)(i.getCellRanges());s&&(this.rangeFixed||(this.fixRangeStartEnd(s),this.rangeFixed=!0),this.endPosition={rowIndex:t.rowIndex,rowPinned:t.rowPinned,column:t.column},2===i.getCellRanges().length&&i.getCellRanges()[0].type===m.CellRangeType.DIMENSION&&s.type===m.CellRangeType.VALUE&&((0,m._isSameRow)(this.endPosition,i.getRangeEndRow(s))||i.updateRangeRowBoundary({cellRange:i.getCellRanges()[0],boundary:"end",cellPosition:{...this.endPosition,column:i.getCellRanges()[0].columns[0]},silent:!0})),i.extendRangeToCell(s,this.endPosition))}shouldSkipCell(e){return!1}onDragEnd(e){let t=this.cellRange??(0,m._last)(this.beans.rangeSvc.getCellRanges());t&&(this.fixRangeStartEnd(t),this.rangeFixed=!1)}onDragCancel(){this.rangeFixed=!1}fixRangeStartEnd(e){let t=this.beans.rangeSvc,i=t.getRangeStartRow(e),s=t.getRangeEndRow(e),r=e.columns[0];e.startRow=i,e.endRow=s,e.startColumn=r}};function l4(e){e.rangeSvc?.removeAllCellRanges()}var l3="ag-cell-range-selected",l6="ag-cell-range-chart-category";function l8(e){let t=e.get("cellSelection");return void 0===t?e.get("enableFillHandle"):"boolean"!=typeof t&&t.handle?.mode==="fill"}var l7=class{constructor(e,t){this.beans=e,this.cellCtrl=t,this.rangeColorClass=null,this.handleColorClass=null,this.rangeSvc=e.rangeSvc}setComp(e){this.cellComp=e,this.eGui=this.cellCtrl.eGui,this.onCellSelectionChanged()}unsetComp(){this.beans.context.destroyBean(this.selectionHandle)}onCellSelectionChanged(){let e=this.cellComp;if(!e)return;let{rangeSvc:t,cellCtrl:i,eGui:s}=this,r=t.getCellRangeCount(i.cellPosition);this.rangeCount=r;let a=this.getHasChartRange();this.hasChartRange=a,e.toggleCss(l3,0!==r),e.toggleCss(`${l3}-1`,1===r),e.toggleCss(`${l3}-2`,2===r),e.toggleCss(`${l3}-3`,3===r),e.toggleCss(`${l3}-4`,r>=4),e.toggleCss("ag-cell-range-chart",a),(0,m._setAriaSelected)(s,r>0||void 0),e.toggleCss("ag-cell-range-single-cell",this.isSingleCell()),this.updateRangeBorders(),this.refreshRangeStyleAndHandle()}updateRangeBorders(){let e=this.getRangeBorders(),t=this.isSingleCell(),i=!t&&e.top,s=!t&&e.right,r=!t&&e.bottom,a=!t&&e.left,l=this.cellComp;l.toggleCss("ag-cell-range-top",i),l.toggleCss("ag-cell-range-right",s),l.toggleCss("ag-cell-range-bottom",r),l.toggleCss("ag-cell-range-left",a)}isSingleCell(){let{rangeSvc:e}=this;return 1===this.rangeCount&&!!e&&!e.isMoreThanOneCell()}getHasChartRange(){let{rangeSvc:e}=this;if(!this.rangeCount||!e)return!1;let t=e.getCellRanges();return t.length>0&&t.every(e=>[m.CellRangeType.DIMENSION,m.CellRangeType.VALUE].includes(e.type))}updateRangeBordersIfRangeCount(){this.rangeCount>0&&(this.updateRangeBorders(),this.refreshRangeStyleAndHandle())}getRangeBorders(){let e,t,i=this.beans.gos.get("enableRtl"),s=!1,r=!1,a=!1,l=!1,{rangeSvc:n,beans:{visibleCols:o},cellCtrl:{cellPosition:d}}=this,h=d.column,u=n.getCellRanges().filter(e=>n.isCellInSpecificRange(d,e));if(!u.length)return{top:s,right:r,bottom:a,left:l};i?(e=o.getColAfter(h),t=o.getColBefore(h)):(e=o.getColBefore(h),t=o.getColAfter(h)),e||(l=!0),t||(r=!0);for(let i=0;i<u.length&&(!s||!r||!a||!l);i++){let o=u[i],h=n.getRangeStartRow(o),c=n.getRangeEndRow(o);!s&&(0,m._isSameRow)(h,d)&&(s=!0),!a&&(0,m._isSameRow)(c,d)&&(a=!0),!l&&e&&0>o.columns.indexOf(e)&&(l=!0),!r&&t&&0>o.columns.indexOf(t)&&(r=!0)}return{top:s,right:r,bottom:a,left:l}}refreshRangeStyleAndHandle(){let{context:e}=this.beans;if(e.isDestroyed())return;this.styleCellForRangeType();let t=this.getRangeForHandle();this.selectionHandle&&!t&&(this.selectionHandle=e.destroyBean(this.selectionHandle)),t&&this.addSelectionHandle(t),this.refreshHandleColor(t),this.cellComp.toggleCss("ag-cell-range-handle",!!this.selectionHandle)}styleCellForRangeType(){if(this.hasChartRange){let{rangeSvc:e}=this,t=e.getCellRanges()[0],i=t.type===m.CellRangeType.DIMENSION&&e.isCellInSpecificRange(this.cellCtrl.cellPosition,t);this.cellComp.toggleCss(l6,i)}else this.cellComp.toggleCss(l6,!1),this.applyRangeColor(this.getRangeColorClass())}applyRangeColor(e){this.rangeColorClass&&this.rangeColorClass!==e&&(this.cellComp.toggleCss(this.rangeColorClass,!1),this.cellComp.toggleCss("ag-formula-range",!1)),e&&(this.cellComp.toggleCss(e,!0),this.cellComp.toggleCss("ag-formula-range",e.startsWith("ag-formula-range"))),this.rangeColorClass=e??null}getRangeColorClass(){let{rangeSvc:e,rangeCount:t}=this;if(!e||!t)return null;let i=e.getCellRanges();for(let t=i.length-1;t>=0;t--){let s=i[t],r=s.colorClass;if(r&&e.isCellInSpecificRange(this.cellCtrl.cellPosition,s))return r}return null}refreshHandleColor(e){let t=this.selectionHandle?.getGui?.(),i=e?.colorClass??null;if(!t){this.handleColorClass=null;return}this.handleColorClass&&this.handleColorClass!==i&&t.classList.remove(this.handleColorClass),i?t.classList.add(i):this.handleColorClass&&t.classList.remove(this.handleColorClass),this.handleColorClass=i??null}getRangeForHandle(){let{gos:e,editSvc:t}=this.beans,i=this.rangeSvc,s=i.getCellRanges(),r=s.length;if(this.rangeCount<1||r<1)return null;let a=t?.isRangeSelectionEnabledWhileEditing();for(let l of a?s:[(0,m._last)(s)]){let{cellPosition:s,column:n}=this.cellCtrl,o=l8(e)&&!n.isSuppressFillHandle(),d=function(e){let t=e.get("cellSelection");return void 0===t?e.get("enableRangeHandle"):"boolean"!=typeof t&&t.handle?.mode==="range"}(e),h=!t?.isEditing(this.cellCtrl,{withOpenEditor:!0})&&(a||1===r&&(o||d));if(this.hasChartRange&&(h=l.type===m.CellRangeType.VALUE),h&&null!=l.endRow&&i.isContiguousRange(l)&&i.isBottomRightCell(l,s))return l}return null}addSelectionHandle(e){let{beans:t}=this,i=t.editSvc?.isRangeSelectionEnabledWhileEditing(),s=e.type,r=+!(!i&&l8(t.gos)&&(0,m._missing)(s));if(this.selectionHandle&&this.selectionHandle.getType()!==r&&(this.selectionHandle=t.context.destroyBean(this.selectionHandle)),!this.selectionHandle){let e=t.registry.createDynamicBean(0===r?"fillHandle":"rangeHandle",!1);e&&(this.selectionHandle=t.context.createBean(e))}this.selectionHandle?.refresh(this.cellCtrl,e)}destroy(){this.unsetComp()}},l9=class extends m.BeanStub{constructor(e){super(),this.eContainer=e}postConstruct(){let{beans:e,gos:t,eContainer:i}=this,s=e.rangeSvc,r={eElement:i,onDragStart:s.onDragStart.bind(s),onDragStop:s.onDragStop.bind(s),onDragging:s.onDragging.bind(s)},a=e.dragSvc,l=a.addDragSource.bind(a,r),n=a.removeDragSource.bind(a,r);this.addManagedPropertyListeners(["enableRangeSelection","cellSelection"],()=>{(0,m._isCellSelectionEnabled)(t)?l():n()}),this.addDestroyFunc(n),(0,m._isCellSelectionEnabled)(t)&&l()}},ne=class extends m.BeanStub{constructor(e,t){super(),this.column=e,this.eGui=t}postConstruct(){this.addManagedElementListeners(this.eGui,{click:e=>e&&this.onClick(e)})}onClick(e){this.beans.rangeSvc?.handleColumnSelection(this.column,e)}},nt=class extends m.BeanStub{constructor(e,t){super(),this.column=e,this.comp=t,this.columnMap=new Map,this.isActive=!1,this.resetColumnMap()}postConstruct(){this.addManagedPropertyListener("cellSelection",()=>{this.refreshActive()}),this.refreshActive(),this.setupRangeHeaderHighlight()}resetColumnMap(){for(let e of(this.columnMap.clear(),this.column.isColumn?[this.column]:this.column.getDisplayedLeafColumns()))this.columnMap.set(e,!1)}refreshActive(){let{gos:e,rangeSvc:t}=this.beans,i=e.get("cellSelection");this.isActive=!!(i&&t&&"object"==typeof i&&i.enableHeaderHighlight)}setupRangeHeaderHighlight(){let e=this.onRangeSelectionChanged.bind(this);this.addManagedEventListeners({rangeSelectionChanged:e,columnPinned:e,columnMoved:e,columnGroupOpened:e}),e()}onRangeSelectionChanged(){if(!this.isActive)return;this.resetColumnMap();let e=this.beans.rangeSvc.getCellRanges(),t=!1,i=!0;for(let i of e){if(t)break;for(let e of i.columns)this.columnMap.has(e)&&(this.columnMap.set(e,!0),t||(t=!0))}for(let e of Array.from(this.columnMap.values()))if(!1===e){i=!1;break}this.comp.toggleCss("ag-header-range-highlight",t&&i)}destroy(){super.destroy(),this.comp=null,this.column=null}};function ni(e,t){return null!=e?{rowIndex:e,rowPinned:t}:void 0}function ns(e,t,i){let s;s="top"===i?!e.startRow||!e.endRow||(0,m._isRowBefore)(e.startRow,e.endRow)?"startRow":"endRow":!e.startRow||!e.endRow||(0,m._isRowBefore)(e.startRow,e.endRow)?"endRow":"startRow",e[s]=t??void 0}var nr={moduleName:"CellSelection",version:tv,beans:[class extends m.BeanStub{constructor(){super(...arguments),this.beanName="rangeSvc",this.rangeSelectionExtensions=[],this.cellRanges=[],this.bodyScrollListener=this.onBodyScroll.bind(this),this.dragging=!1,this.intersectionRange=!1,this.columnRangeSelectionCtx={}}wireBeans(e){this.rowModel=e.rowModel,this.dragSvc=e.dragSvc,this.colModel=e.colModel,this.visibleCols=e.visibleCols,this.cellNavigation=e.cellNavigation,this.ctrlsSvc=e.ctrlsSvc}postConstruct(){let e=this.onColumnsChanged.bind(this),t=()=>this.removeAllCellRanges(),i=this.refreshLastRangeStart.bind(this);this.addManagedEventListeners({newColumnsLoaded:e,columnVisible:e,columnValueChanged:e,columnPivotModeChanged:t,columnRowGroupChanged:t,columnPivotChanged:t,columnGroupOpened:i,columnMoved:i,columnPinned:i}),this.ctrlsSvc.whenReady(this,e=>{let t=e.gridBodyCtrl;this.autoScrollService=new m.AutoScrollService({scrollContainer:t.eBodyViewport,scrollAxis:"xy",getVerticalPosition:()=>t.scrollFeature.getVScrollPosition().top,setVerticalPosition:e=>t.scrollFeature.setVerticalScrollPosition(e),getHorizontalPosition:()=>t.scrollFeature.getHScrollPosition().left,setHorizontalPosition:e=>t.scrollFeature.setHorizontalScrollPosition(e),shouldSkipVerticalScroll:()=>!(0,m._isDomLayout)(this.gos,"normal"),shouldSkipHorizontalScroll:()=>!t.scrollFeature.isHorizontalScrollShowing()})})}registerRangeSelectionExtension(e){this.rangeSelectionExtensions.includes(e)||this.rangeSelectionExtensions.push(e)}unregisterRangeSelectionExtension(e){(0,m._removeFromArray)(this.rangeSelectionExtensions,e)}shouldSuppressRangeSelection(e){return this.rangeSelectionExtensions.some(t=>t.shouldSuppressRangeSelection?.(e))}shouldSkipColumn(e){return this.rangeSelectionExtensions.some(t=>t.shouldSkipColumn?.(e))}isAllColumnsSelectionCell(e){return this.rangeSelectionExtensions.some(t=>t.isAllColumnsSelectionCell?.(e))}isAllColumnsRange(e,t){return this.rangeSelectionExtensions.some(i=>i.isAllColumnsRange?.(e,t))}updateSelectionModeForCell(e){this.setSelectionMode(this.isAllColumnsSelectionCell(e))}onDragStart(e){let t=this.gos,i=e.target;if(!(0,m._isCellSelectionEnabled)(t)||(0,m._getRowCtrlForEventTarget)(t,i)?.isSuppressMouseEvent(e)||this.shouldSuppressRangeSelection(i))return;let{shiftKey:s}=e,r=this.isMultiRange(e),a=s&&!!this.cellRanges?.length;!r&&(!a||(0,m._exists)((0,m._last)(this.cellRanges).type))&&this.removeAllCellRanges(!0);let l=this.dragSvc.startTarget;if(l&&this.updateValuesOnMove(l),this.lastCellHovered){if(this.dragging=!0,this.lastMouseEvent=e,this.intersectionRange=r&&this.getCellRangeCount(this.lastCellHovered)>1,a||this.setNewestRangeStartCell(this.lastCellHovered),this.cellRanges.length>0)this.draggingRange=(0,m._last)(this.cellRanges);else{let e={rowIndex:this.lastCellHovered.rowIndex,rowPinned:this.lastCellHovered.rowPinned},t=this.getColumnsFromModel([this.lastCellHovered.column]);if(!t?.length)return;this.draggingRange={startRow:e,endRow:e,columns:t,startColumn:this.newestRangeStartCell.column},this.cellRanges.push(this.draggingRange)}this.ctrlsSvc.getGridBodyCtrl().eBodyViewport.addEventListener("scroll",this.bodyScrollListener,{passive:!0}),this.dispatchChangedEvent(!0,!1,this.draggingRange.id)}}onDragging(e){let{dragging:t,lastCellHovered:i,newestRangeStartCell:s,autoScrollService:r,cellHasChanged:a}=this;if(!t||!e)return;this.updateValuesOnMove(e.target),this.lastMouseEvent=e;let l=e=>i&&i.rowPinned===e&&s.rowPinned===e,n=l("top")||l("bottom");if(r.check(e,n),!a||!i)return;let o=s?.column,d=i?.column,h=this.calculateColumnsBetween(o,d);if(!h)return;let{rowIndex:u,rowPinned:c}=i;this.draggingRange.endRow={rowIndex:u,rowPinned:c},this.draggingRange.columns=h,this.dispatchChangedEvent(!1,!1,this.draggingRange.id)}onDragStop(){if(!this.dragging)return;let{id:e}=this.draggingRange;this.autoScrollService.ensureCleared(),this.ctrlsSvc.getGridBodyCtrl().eBodyViewport.removeEventListener("scroll",this.bodyScrollListener),this.lastMouseEvent=null,this.dragging=!1,this.draggingRange=void 0,this.lastCellHovered=void 0,this.intersectionRange&&(this.intersectionRange=!1,this.intersectLastRange()),this.dispatchChangedEvent(!1,!0,e)}onColumnsChanged(){this.refreshLastRangeStart();let e=this.visibleCols.allCols;for(let t of this.cellRanges){let i=t.columns;t.columns=t.columns.filter(t=>t.isVisible()&&-1!==e.indexOf(t)),(0,m._areEqual)(i,t.columns)||this.dispatchChangedEvent(!1,!0,t.id)}let t=this.cellRanges.length;this.cellRanges=this.cellRanges.filter(e=>e.columns.length>0),t>this.cellRanges.length&&this.dispatchChangedEvent(!1,!0)}refreshLastRangeStart(){let e=(0,m._last)(this.cellRanges);e&&this.refreshRangeStart(e)}isContiguousRange(e){let t=e.columns;if(!t.length)return!1;let i=this.visibleCols.allCols,s=t.map(e=>i.indexOf(e)).sort((e,t)=>e-t);return(0,m._last)(s)-s[0]+1===t.length}getRangeStartRow(e){return e.startRow&&e.endRow?(0,m._isRowBefore)(e.startRow,e.endRow)?e.startRow:e.endRow:{rowIndex:0,rowPinned:(this.beans.pinnedRowModel?.getPinnedTopRowCount()??0)>0?"top":null}}getRangeEndRow(e){if(e.startRow&&e.endRow)return(0,m._isRowBefore)(e.startRow,e.endRow)?e.endRow:e.startRow;let t=this.beans.pinnedRowModel?.getPinnedBottomRowCount()??0;return t>0?{rowIndex:t-1,rowPinned:"bottom"}:{rowIndex:this.rowModel.getRowCount()-1,rowPinned:null}}getRangeRowCount(e){let t=this.beans,i=this.getRangeStartRow(e),s=this.getRangeEndRow(e),r=(0,m._getAbsoluteRowIndex)(t,i);return(0,m._getAbsoluteRowIndex)(t,s)-r+1}handleCellMouseDown(e,t){let{beans:i}=this,s=e.target;if(this.shouldSuppressRangeSelection(s))return;let r=this.isAllColumnsSelectionCell(t);if(r&&e.preventDefault(),e.shiftKey)return this.extendLatestRangeToCell(t);if(r&&(0,m._interpretAsRightClick)(i,e))return;let a=this.isMultiRange(e);this.updateSelectionModeForCell(t);let l=this.calculateColumnsBetween(t.column,t.column);if(!l)return;let n=r?this.findContainingRange({columns:l,startRow:t,endRow:t}):void 0;r&&n&&a&&(e.ctrlKey||e.metaKey)&&n?this.removeRowFromAllColumnsRange(t,n):this.setRangeToCell(t,a)}isMultiRange(e){let{ctrlKey:t,metaKey:i}=e,{editingWithRanges:s,allowMulti:r}=this.getMultiRangeContext();return s||!!r&&(t||i)}getMultiRangeContext(){let{gos:e,editSvc:t}=this.beans,i=!!t?.isEditing()&&!!t?.isRangeSelectionEnabledWhileEditing(),s=(0,m._getSuppressMultiRanges)(e)&&!i;return{editingWithRanges:i,suppressMultiRanges:s,allowMulti:!s}}removeRowFromAllColumnsRange(e,t){let{beans:i,cellRanges:s}=this,r=(0,m._getFirstRow)(i),a=(0,m._getLastRow)(i),l=this.getRangeStartRow(t),n=this.getRangeEndRow(t);if(!l&&(0,m._isSameRow)(r,e))ns(t,(0,m._getRowBelow)(i,r),"top");else if(!n&&(0,m._isSameRow)(a,e))ns(t,(0,m._getRowAbove)(i,a),"bottom");else if((0,m._isSameRow)(l,n))(0,m._removeFromArray)(s,t);else if((0,m._isSameRow)(l,e))ns(t,(0,m._getRowBelow)(i,e),"top");else if((0,m._isSameRow)(n,e))ns(t,(0,m._getRowAbove)(i,e),"bottom");else{let r=(0,m._getRowAbove)(i,e),a=(0,m._getRowBelow)(i,e);t.startRow=l,t.endRow=r??void 0,s.push({...t,startRow:a??void 0,endRow:n})}this.dispatchChangedEvent(!0,!0)}setRangeToCell(e,t=!1){let{gos:i}=this;if(!(0,m._isCellSelectionEnabled)(i))return;this.updateSelectionModeForCell(e);let s=this.calculateColumnsBetween(e.column,e.column);if(!s)return;let{suppressMultiRanges:r}=this.getMultiRangeContext();(r||!t||(0,m._missing)(this.cellRanges))&&this.removeAllCellRanges(!0);let a={rowIndex:e.rowIndex,rowPinned:e.rowPinned},l={startRow:a,endRow:a,columns:s,startColumn:e.column};this.cellRanges.push(l),this.setNewestRangeStartCell(e),this.onDragStop(),this.dispatchChangedEvent(!0,!0)}getRangeLastColumn(e){let t=e.columns[0],i=(0,m._last)(e.columns);return this.newestRangeStartCell?.column===t?i:t}extendRangeRowCountBy(e,t){let i,{beans:s}=this,{startRow:r,endRow:a}=e;if(!r||!a)return;let l=0,n=(0,m._isRowBefore)(a,r);i=n?r:a;let o=t>0?m._getRowBelow:m._getRowAbove,d=Math.abs(t);for(;l<d;){let e=o(s,i);if(!e)break;i=e,l++}if(l!==d)return;let h={...i,column:this.getRangeLastColumn(e)};this.updateRangeRowBoundary({cellRange:e,boundary:n?"start":"end",cellPosition:h})}extendRangeColumnCountBy(e,t){let{columns:i,startColumn:s}=e;if(0===t)return;let r=this.getColumnsFromModel();if(!r)return;let a=(0,m._last)(i),l=s===i[0]?a:i[0];if(!a||!l)return;let n=r.indexOf(s),o=r.indexOf(l),d=o<n;d&&(n=o);let h=i.length+t;if(h<=0)return;let u=[];for(let e=n;e<n+h;e++){let t=r[e];if(!t)break;u.push(t)}if(u.length===h){if(d){let t=(0,m._last)(u);e.startColumn=t,this.focusCellOnNewColumn(e,t)}e.columns=u,this.dispatchChangedEvent(!0,!0,e.id)}}extendLatestRangeToCell(e){if(this.isEmpty()||!this.newestRangeStartCell)return;let t=(0,m._last)(this.cellRanges);this.updateSelectionModeForCell(e),this.updateRangeRowBoundary({cellRange:t,boundary:"end",cellPosition:e})}extendRangeToCell(e,t){e&&(this.updateSelectionModeForCell(t),this.updateRangeRowBoundary({cellRange:e,boundary:"end",cellPosition:t}))}updateRangeRowBoundary(e){let{cellRange:t,boundary:i,cellPosition:s,silent:r=!1}=e,a=s.column,l=this.calculateColumnsBetween(t.startColumn,a);!(!l||function(e,t){let{startRow:i,endRow:s}=e,r=(0,m._isRowBefore)(i,s)?s:i,a=t.rowIndex===r.rowIndex&&t.rowPinned===r.rowPinned,l=e.columns[0],n=(0,m._last)(e.columns),o=e.startColumn===l?n:l;return t.column===o&&a}(t,s))&&("start"===i&&this.focusCellOnNewRow(t,s),t.columns=l,t["start"===i?"startRow":"endRow"]={rowIndex:s.rowIndex,rowPinned:s.rowPinned},r||this.dispatchChangedEvent(!0,!0,t.id))}getRangeEdgeColumns(e){let t=this.visibleCols.allCols,i=e.columns.map(e=>t.indexOf(e)).filter(e=>e>-1).sort((e,t)=>e-t);return{left:t[i[0]],right:t[(0,m._last)(i)]}}extendLatestRangeInDirection(e){if(this.isEmpty()||!this.newestRangeStartCell)return;let t=e.key,i=e.ctrlKey||e.metaKey,s=(0,m._last)(this.cellRanges),r=this.newestRangeStartCell,a=s.endRow.rowIndex,l=s.endRow.rowPinned,n=this.getRangeLastColumn(s),o=this.cellNavigation.getNextCellToFocus(t,{column:n,rowIndex:a,rowPinned:l},i);if(o)return this.setCellRange({rowStartIndex:r.rowIndex,rowStartPinned:r.rowPinned,rowEndIndex:o.rowIndex,rowEndPinned:o.rowPinned,columnStart:r.column,columnEnd:o.column}),o}setCellRange(e){(0,m._isCellSelectionEnabled)(this.gos)&&(this.removeAllCellRanges(!0),this.addCellRange(e))}setCellRanges(e){if((0,m._areEqual)(this.cellRanges,e)||!this.verifyCellRanges(this.gos))return;this.setSelectionMode(!1),this.removeAllCellRanges(!0);let t=this.getColumnsFromModel(this.visibleCols.allCols)??[],i=!1;for(let s of e){if(s.columns&&s.startRow){let e=this.getColumnsFromModel(s.columns);if(!e||0===e.length)continue;s.columns=e;let{startRow:t}=s;this.setNewestRangeStartCell({rowIndex:t.rowIndex,rowPinned:t.rowPinned,column:s.columns[0]})}!i&&t.length>0&&this.isAllColumnsRange(s,t)&&(i=!0),this.cellRanges.push(s)}this.setSelectionMode(i),this.dispatchChangedEvent(!1,!0)}clearCellRangeCellValues(e){let{beans:t,eventSvc:i}=this,{cellEventSource:s="rangeSvc",dispatchWrapperEvents:r,wrapperEventSource:a="deleteKey",restoreSourceInBatch:l}=e,{cellRanges:n}=e;r&&(i.dispatchEvent({type:"cellSelectionDeleteStart",source:a}),i.dispatchEvent({type:"rangeDeleteStart",source:a})),n||(n=this.cellRanges);let{valueSvc:o,editSvc:d}=t,h=!!d?.isBatchEditing();this.forEachEditableCellInRanges(n,(e,t)=>{if(l&&h)return void d?.batchResetToSourceValue({rowNode:e,column:t});let i=o.getDeleteValue(t,e);e.setDataValue(t,i,s)}),r&&(i.dispatchEvent({type:"cellSelectionDeleteEnd",source:a}),i.dispatchEvent({type:"rangeDeleteEnd",source:a}))}createCellRangeFromCellRangeParams(e){return this.createPartialCellRangeFromRangeParams(e,!1)}createPartialCellRangeFromRangeParams(e,t){let{columns:i,columnStart:s,columnEnd:r,rowStartIndex:a,rowStartPinned:l,rowEndIndex:n,rowEndPinned:o}=e,d=this.getColumnsFromParams(i,s,r);if(!d||!t&&0===d.columns.length)return;let{columns:h,startsOnTheRight:u}=d;return{startRow:ni(a,l),endRow:ni(n,o),columns:h,startColumn:this.getColumnFromModel(s)??(u?(0,m._last)(h):h[0])}}addCellRange(e){let t=this.gos;if(!(0,m._isCellSelectionEnabled)(t)||!this.verifyCellRanges(t))return;this.setSelectionMode(!1);let i=this.createCellRangeFromCellRangeParams(e);if(i)return i.startRow&&this.setNewestRangeStartCell({rowIndex:i.startRow.rowIndex,rowPinned:i.startRow.rowPinned,column:i.startColumn}),this.cellRanges.push(i),this.dispatchChangedEvent(!1,!0,i.id),i}getCellRanges(){return this.cellRanges}isEmpty(){return 0===this.cellRanges.length}isMoreThanOneCell(){let e=this.cellRanges.length;if(0===e)return!1;if(e>1)return!0;let t=this.cellRanges[0],i=this.getRangeStartRow(t),s=this.getRangeEndRow(t);return i.rowPinned!==s.rowPinned||i.rowIndex!==s.rowIndex||1!==t.columns.length}areAllRangesAbleToMerge(){let e,t=new Map;if(this.cellRanges.length<=1)return!0;for(let e of this.cellRanges)this.forEachRowInRange(e,i=>{let s=`${i.rowPinned||"normal"}_${i.rowIndex}`,r=t.get(s),a=e.columns.map(e=>e.getId());if(r){let e=a.filter(e=>-1===r.indexOf(e));r.push(...e)}else t.set(s,a)});for(let i of t.values()){let t=i.sort().join();if(void 0===e){e=t;continue}if(e!==t)return!1}return!0}removeAllCellRanges(e){!this.isEmpty()&&(this.onDragStop(),this.cellRanges.length=0,e||this.dispatchChangedEvent(!1,!0))}isCellInAnyRange(e){return this.getCellRangeCount(e)>0}isCellInSpecificRange(e,t){let i=t.columns?.includes(e.column),s=this.isRowInRange(e,t);return i&&s}isColumnInAnyRange(e){let{beans:t}=this,i=(0,m._getFirstRow)(t),s=(0,m._getLastRow)(t);if(!i||!s)return!1;let r=e.isColumn?[e]:e.getDisplayedLeafColumns();return null!=this.findContainingRange({columns:r,startRow:i,endRow:s},!0)}findContainingRange({columns:e,startRow:t,endRow:i},s=!1){let r=this.cellRanges;for(let a=r.length-1;a>=0;a--){let l=r[a],n=e.every(e=>l.columns.includes(e)),o=!1;if(s)o=(0,m._isSameRow)(l.startRow,t)&&(0,m._isSameRow)(l.endRow,i);else{let e=t&&this.isRowInRange(t,l),s=i&&this.isRowInRange(i,l);o=!!e&&!!s}if(n&&o)return l}}isBottomRightCell(e,t){let i=this.visibleCols.allCols,s=e.columns.map(e=>i.indexOf(e)).sort((e,t)=>e-t),{startRow:r,endRow:a}=e,l=(0,m._isRowBefore)(r,a)?a:r,n=i.indexOf(t.column)===(0,m._last)(s),o=t.rowIndex===l.rowIndex&&(0,m._makeNull)(t.rowPinned)===(0,m._makeNull)(l.rowPinned);return n&&o}getCellRangeCount(e){return this.cellRanges.filter(t=>this.isCellInSpecificRange(e,t)).length}isRowInRange(e,t){let i=this.getRangeStartRow(t),s=this.getRangeEndRow(t),r=(0,m._isSameRow)(e,i),a=(0,m._isSameRow)(e,s);if(r||a)return!0;let l=!(0,m._isRowBefore)(e,i),n=(0,m._isRowBefore)(e,s);return l&&n}intersectLastRange(e){let{editingWithRanges:t,suppressMultiRanges:i}=this.getMultiRangeContext();if(t||i||e&&this.dragging||this.isEmpty())return;let s=(0,m._last)(this.cellRanges),r=this.getRangeStartRow(s),a=this.getRangeEndRow(s),l=[];for(let e of this.cellRanges.slice(0,-1)){let t=this.getRangeStartRow(e),i=this.getRangeEndRow(e),n=e.columns,o=n.filter(e=>-1===s.columns.indexOf(e));if(o.length===n.length||(0,m._isRowBefore)(a,t)||(0,m._isRowBefore)(i,r)){l.push(e);continue}let d=l.length;if((0,m._isRowBefore)(t,r)){let e={columns:[...n],startColumn:s.startColumn,startRow:{...t},endRow:(0,m._getRowAbove)(this.beans,r)};l.push(e)}if(o.length>0){let e={columns:o,startColumn:o.includes(s.startColumn)?s.startColumn:o[0],startRow:function(e){let t;for(let i of e)(void 0===t||(0,m._isRowBefore)(t,i))&&(t=i);return t}([{...r},{...t}]),endRow:function(e){let t;for(let i of e)(void 0===t||(0,m._isRowBefore)(i,t))&&(t=i);return t}([{...a},{...i}])};l.push(e)}(0,m._isRowBefore)(a,i)&&l.push({columns:[...n],startColumn:s.startColumn,startRow:(0,m._getRowBelow)(this.beans,a),endRow:{...i}}),l.length-d==1&&(l[l.length-1].id=e.id)}this.cellRanges=l,e&&this.dispatchChangedEvent(!1,!0)}createRangeHighlightFeature(e,t,i){e.createManagedBean(new nt(t,i))}setSelectionMode(e){this.selectionMode=+!!e}refreshRangeStart(e){let{startColumn:t,columns:i}=e,s=(t,i)=>{let s=e.columns.filter(e=>e!==t);t?(e.startColumn=t,e.columns=i?[t,...s]:[...s,t]):e.columns=s},{left:r,right:a}=this.getRangeEdgeColumns(e);t===i[0]&&t!==r?s(r,!0):t===(0,m._last)(i)&&t===a&&s(a,!1)}setNewestRangeStartCell(e){this.newestRangeStartCell=e}getColumnsFromParams(e,t,i){let s,r=!e&&!t&&!i,a=!1;return r||e?s=this.getColumnsFromModel(r?void 0:e):t&&i&&(s=this.calculateColumnsBetween(t,i),s?.length&&(a=s[0]!==this.getColumnFromModel(t))),s?{columns:s,startsOnTheRight:a}:void 0}verifyCellRanges(e){let{suppressMultiRanges:t}=this.getMultiRangeContext(),i=(0,m._isUsingNewCellSelectionAPI)(e)&&t&&this.cellRanges.length>1;return i&&(0,m._warn)(93),!i}forEachRowInRange(e,t){let i=this.getRangeStartRow(e),s=this.getRangeEndRow(e),r=i;for(;r&&(t(r),!(0,m._isSameRow)(r,s));)r=(0,m._getRowBelow)(this.beans,r)}forEachEditableCellInRanges(e,t){let{beans:i}=this;for(let s of e)this.forEachRowInRange(s,e=>{let r=(0,m._getRowNode)(i,e);if(r)for(let e=0;e<s.columns.length;e++){let i=this.getColumnFromModel(s.columns[e]);i?.isCellEditable(r)&&t(r,i)}})}onBodyScroll(){this.dragging&&this.lastMouseEvent&&this.onDragging(this.lastMouseEvent)}updateValuesOnMove(e){let t=(0,m._getCellCtrlForEventTarget)(this.gos,e),i=t?.cellPosition;if(this.cellHasChanged=!1,!i||this.lastCellHovered&&(0,m._areCellsEqual)(i,this.lastCellHovered))return;let s=this.beans.editSvc;s?.isEditing(t,{withOpenEditor:!0})&&!s?.isRangeSelectionEnabledWhileEditing()?this.dragSvc.cancelDrag(e):(this.lastCellHovered&&(this.cellHasChanged=!0),this.lastCellHovered=i)}dispatchChangedEvent(e,t,i){this.eventSvc.dispatchEvent({type:"cellSelectionChanged",started:e,finished:t,id:i}),this.eventSvc.dispatchEvent({type:"rangeSelectionChanged",started:e,finished:t,id:i})}getColumnFromModel(e){return"string"==typeof e?this.colModel.getCol(e):e}getColumnsFromModel(e){let{visibleCols:t,selectionMode:i}=this;e&&1!==i||(e=t.allCols);let s=[];for(let t of e){let e=this.getColumnFromModel(t);!e||this.shouldSkipColumn(e)||s.push(e)}return s.length?s:void 0}calculateColumnsBetween(e,t){let i=this.visibleCols.allCols,s=this.getColumnFromModel(e),r=this.getColumnFromModel(t),a=s===r,l=i.indexOf(s);if(l<0)return void(0,m._warn)(178,{colId:s.getId()});let n=a?l:i.indexOf(r);if(n<0)return void(0,m._warn)(178,{colId:r.getId()});if(a||1===this.selectionMode)return this.getColumnsFromModel([s]);let o=Math.min(l,n),d=o===l?n:l;return this.getColumnsFromModel(i.slice(o,d+1))}focusCellOnNewColumn(e,t){let{focusSvc:i}=this.beans,s=i.getFocusedCell();s&&this.isCellInSpecificRange(s,e)&&i.setFocusedCell({...s,column:t,forceBrowserFocus:!0,preventScrollOnBrowserFocus:!0})}focusCellOnNewRow(e,t){let{focusSvc:i}=this.beans,s=i.getFocusedCell();s&&this.isCellInSpecificRange(s,e)&&i.setFocusedCell({...t,column:s.column,forceBrowserFocus:!0,preventScrollOnBrowserFocus:!0})}createDragListenerFeature(e){return new l9(e)}createCellRangeFeature(e){return new l7(this.beans,e)}createHeaderGroupCellMouseListenerFeature(e,t){return new ne(e,t)}handleColumnSelection(e,t){let{gos:i,beans:s,columnRangeSelectionCtx:r,cellRanges:a}=this;if(!(0,m._getEnableColumnSelection)(i))return;let{suppressMultiRanges:l,editingWithRanges:n}=this.getMultiRangeContext(),o=a.length>0,d=t.ctrlKey||t.metaKey,h=!n||d,u=(0,m._getFirstRow)(s),c=(0,m._getLastRow)(s);if(!u||!c)return;if(t.key===m.KeyCode.ENTER&&t.preventDefault(),t.shiftKey){let t=r.root;if(!t)return;let i=e.isColumn?e:(0,m._last)(e.getLeafColumns()),s=this.findContainingRange({columns:[t],startRow:u,endRow:c},!0);if(!s){(0,m._removeFromArray)(a,r.lastCellRange),this.selectColumns(this.calculateColumnsBetween(t,i),u,c);return}this.updateRangeRowBoundary({cellRange:s,boundary:"end",cellPosition:{column:i,...c}});return}o&&(l||!d&&!n)&&this.removeAllCellRanges(!0);let p=(e,t)=>{let i=this.findContainingRange({columns:e,startRow:u,endRow:c},!0);if(i&&h)this.deselectColumnsFromRange(i,e);else{let t=this.selectColumns(e,u,c);t&&(r.lastCellRange=t)}r.root=t};if(e.isColumn)p([e],e);else{let t=e.getDisplayedLeafColumns();p(t,t[0])}}deselectColumnsFromRange(e,t){(0,m._removeAllFromArray)(e.columns,t),t.includes(e.startColumn)&&(e.startColumn=e.columns[0]),0===e.columns.length&&(0,m._removeFromArray)(this.cellRanges,e),this.dispatchChangedEvent(!0,!0)}selectColumns(e,t,i){return this.addCellRange({columns:e,columnStart:e[0],columnEnd:(0,m._last)(e),rowStartIndex:t.rowIndex,rowStartPinned:t.rowPinned,rowEndIndex:i.rowIndex,rowEndPinned:i.rowPinned})}}],dynamicBeans:{fillHandle:l2,rangeHandle:l5},apiFunctions:{getCellRanges:function(e){return e.rangeSvc?.getCellRanges()??null},addCellRange:function(e,t){e.rangeSvc?.addCellRange(t)},clearRangeSelection:l4,clearCellSelection:l4},dependsOn:[tb,m._KeyboardNavigationModule,m._DragModule],css:[".ag-body-viewport:not(.ag-has-focus) .ag-cell-range-single-cell:not(.ag-cell-inline-editing),.ag-cell-range-selected.ag-cell-range-chart,.ag-cell-range-selected:not(.ag-cell-focus){background-color:var(--ag-range-selection-background-color);&.ag-cell-range-chart{background-color:var(--ag-range-selection-chart-background-color)!important;&.ag-cell-range-chart-category{background-color:var(--ag-range-selection-chart-category-background-color)!important}}}.ag-cell-range-selected-1.ag-cell-range-chart,.ag-cell-range-selected-1.ag-formula-range,.ag-cell-range-selected-1:not(.ag-cell-focus),.ag-root:not(.ag-context-menu-open) .ag-body-viewport:not(.ag-has-focus) .ag-cell-range-selected-1:not(.ag-cell-inline-editing){background-color:var(--ag-range-selection-background-color)}.ag-cell-range-selected-2.ag-cell-range-chart,.ag-cell-range-selected-2.ag-formula-range,.ag-cell-range-selected-2:not(.ag-cell-focus){background-image:linear-gradient(var(--ag-range-selection-background-color),var(--ag-range-selection-background-color))}.ag-cell-range-selected-3.ag-cell-range-chart,.ag-cell-range-selected-3.ag-formula-range,.ag-cell-range-selected-3:not(.ag-cell-focus){background-image:linear-gradient(var(--ag-range-selection-background-color),var(--ag-range-selection-background-color)),linear-gradient(var(--ag-range-selection-background-color),var(--ag-range-selection-background-color))}.ag-cell-range-selected-4.ag-cell-range-chart,.ag-cell-range-selected-4.ag-formula-range,.ag-cell-range-selected-4:not(.ag-cell-focus){background-image:linear-gradient(var(--ag-range-selection-background-color),var(--ag-range-selection-background-color)),linear-gradient(var(--ag-range-selection-background-color),var(--ag-range-selection-background-color)),linear-gradient(var(--ag-range-selection-background-color),var(--ag-range-selection-background-color))}.ag-cell.ag-cell-range-selected:not(.ag-cell-range-single-cell){&.ag-cell-range-top{border-top-color:var(--ag-range-selection-border-color);border-top-style:var(--ag-range-selection-border-style)}&.ag-cell-range-right{border-right-color:var(--ag-range-selection-border-color);border-right-style:var(--ag-range-selection-border-style)}&.ag-cell-range-bottom{border-bottom-color:var(--ag-range-selection-border-color);border-bottom-style:var(--ag-range-selection-border-style)}&.ag-cell-range-left{border-left-color:var(--ag-range-selection-border-color);border-left-style:var(--ag-range-selection-border-style)}}.ag-cell.ag-selection-fill-top,.ag-cell.ag-selection-fill-top.ag-cell-range-selected{border-top:1px dashed;border-top-color:var(--ag-range-selection-border-color)}:where(.ag-ltr) .ag-cell.ag-selection-fill-right,:where(.ag-ltr) .ag-cell.ag-selection-fill-right.ag-cell-range-selected{border-right:1px dashed var(--ag-range-selection-border-color)!important}:where(.ag-rtl) .ag-cell.ag-selection-fill-right,:where(.ag-rtl) .ag-cell.ag-selection-fill-right.ag-cell-range-selected{border-left:1px dashed var(--ag-range-selection-border-color)!important}.ag-cell.ag-selection-fill-bottom,.ag-cell.ag-selection-fill-bottom.ag-cell-range-selected{border-bottom:1px dashed;border-bottom-color:var(--ag-range-selection-border-color)}:where(.ag-ltr) .ag-cell.ag-selection-fill-left,:where(.ag-ltr) .ag-cell.ag-selection-fill-left.ag-cell-range-selected{border-left:1px dashed var(--ag-range-selection-border-color)!important}:where(.ag-rtl) .ag-cell.ag-selection-fill-left,:where(.ag-rtl) .ag-cell.ag-selection-fill-left.ag-cell-range-selected{border-right:1px dashed var(--ag-range-selection-border-color)!important}.ag-fill-handle,.ag-range-handle{background-color:var(--ag-range-selection-border-color);bottom:-1px;height:6px;position:absolute;width:6px}:where(.ag-ltr) .ag-fill-handle,:where(.ag-ltr) .ag-range-handle{right:-1px}:where(.ag-rtl) .ag-fill-handle,:where(.ag-rtl) .ag-range-handle{left:-1px}.ag-fill-handle{cursor:crosshair}:where(.ag-ltr) .ag-range-handle{cursor:nwse-resize}:where(.ag-rtl) .ag-range-handle{cursor:nesw-resize}"]},na={tag:"div",cls:"ag-loading",children:[{tag:"span",ref:"eLoadingIcon",cls:"ag-loading-icon"},{tag:"span",ref:"eLoadingText",cls:"ag-loading-text"}]},nl=class extends m.Component{constructor(){super(na),this.eLoadingIcon=m.RefPlaceholder,this.eLoadingText=m.RefPlaceholder}init(e){e.node.failedLoad?this.setupFailed():this.setupLoading()}setupFailed(){this.eLoadingText.textContent=this.getLocaleTextFunc()("loadingError","ERR")}setupLoading(){let e=(0,m._createIconNoSpan)("groupLoading",this.beans,null);e&&this.eLoadingIcon.appendChild(e),this.eLoadingText.textContent=this.getLocaleTextFunc()("loadingOoo","Loading...")}refresh(e){return!1}},nn="PivotRowTotal_",no=({headerName:e},{headerName:t})=>e&&!t?1:!e&&t?-1:e||t?e<t?-1:+(e>t):0,nd="Exceeded maximum allowed pivot column count.",nh=e=>{let t={};return e.forEach((e,i)=>t[i]=e instanceof Map?nh(e):e),t},nu=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="pivotStage",this.step="pivot",this.refreshProps=["removePivotHeaderRowWhenSingleValueColumn","pivotRowTotals","pivotColumnGroupTotals","suppressExpandablePivotGroups"],this.uniqueValues=new Map,this.lastTimeFailed=!1,this.maxUniqueValues=-1,this.currentUniqueCount=0}wireBeans(e){this.valueSvc=e.valueSvc,this.colModel=e.colModel,this.pivotResultCols=e.pivotResultCols,this.rowGroupColsSvc=e.rowGroupColsSvc,this.valueColsSvc=e.valueColsSvc,this.pivotColsSvc=e.pivotColsSvc,this.pivotColDefSvc=e.pivotColDefSvc}execute(e){this.colModel.isPivotActive()?this.executePivotOn(e):this.executePivotOff(e)}executePivotOff(e){this.aggregationColumnsHashLastTime=null,this.uniqueValues=new Map,this.pivotResultCols.isPivotResultColsPresent()&&(this.pivotResultCols.setPivotResultCols(null,"rowModelUpdated"),e&&(e.active=!1))}executePivotOn(e){let t,i=this.valueColsSvc?.columns.length??1,s=this.gos.get("pivotMaxGeneratedColumns");this.maxUniqueValues=-1===s?-1:s/i;try{t=this.bucketUpRowNodes(e)}catch(e){if(e.message===nd){this.pivotResultCols.setPivotResultCols([],"rowModelUpdated"),this.eventSvc.dispatchEvent({type:"pivotMaxColumnsExceeded",message:e.message}),this.lastTimeFailed=!0;return}throw e}let r=this.setUniqueValues(t),a=this.valueColsSvc?.columns??[],l=a.map(e=>`${e.getId()}-${e.getColDef().headerName}`).join("#"),n=a.map(e=>e.getAggFunc().toString()).join("#"),o=this.aggregationColumnsHashLastTime!==l,d=this.aggregationFuncsHashLastTime!==n;this.aggregationColumnsHashLastTime=l,this.aggregationFuncsHashLastTime=n;let h=(this.rowGroupColsSvc?.columns??[]).map(e=>e.getId()).join("#"),u=h!==this.groupColumnsHashLastTime;this.groupColumnsHashLastTime=h;let c=this.gos.get("pivotRowTotals"),p=this.gos.get("pivotColumnGroupTotals"),g=this.gos.get("suppressExpandablePivotGroups"),m=this.gos.get("removePivotHeaderRowWhenSingleValueColumn"),f=c!==this.pivotRowTotalsLastTime||p!==this.pivotColumnGroupTotalsLastTime||g!==this.suppressExpandablePivotGroupsLastTime||m!==this.removePivotHeaderRowWhenSingleValueColumnLastTime;if(this.pivotRowTotalsLastTime=c,this.pivotColumnGroupTotalsLastTime=p,this.suppressExpandablePivotGroupsLastTime=g,this.removePivotHeaderRowWhenSingleValueColumnLastTime=m,this.lastTimeFailed||r||o||u||d||f){let t=this.pivotColDefSvc.createPivotColumnDefs(this.uniqueValues);this.pivotResultCols.setPivotResultCols(t,"rowModelUpdated"),e&&(e.active=!1)}this.lastTimeFailed=!1}setUniqueValues(e){return!(0,m._jsonEquals)(nh(this.uniqueValues),nh(e))&&(this.uniqueValues=e,!0)}bucketUpRowNodes(e){this.currentUniqueCount=0;let t=new Map;e.forEachChangedNodeDepthFirst(e=>{e.leafGroup&&(e.childrenMapped=null)});let i=e=>{e.leafGroup?this.bucketRowNode(e,t):e.childrenAfterFilter?.forEach(i)};return e.executeFromRootNode(i),t}bucketRowNode(e,t){let i=this.pivotColsSvc?.columns;i?.length===0?e.childrenMapped=null:e.childrenMapped=nh(this.bucketChildren(e.childrenAfterFilter,i,0,t)),e.sibling&&(e.sibling.childrenMapped=e.childrenMapped)}bucketChildren(e,t=[],i,s){let r=new Map,a=t[i],l=-1!==this.maxUniqueValues;if(e.forEach(e=>{let t=this.valueSvc.getKeyForNode(a,e);if((0,m._missing)(t)&&(t=""),!s.get(t)){this.currentUniqueCount+=1,s.set(t,new Map);let e=this.currentUniqueCount>this.maxUniqueValues;if(l&&e)throw Error(nd)}r.has(t)||r.set(t,[]),r.get(t).push(e)}),i===t.length-1)return r;let n=new Map;for(let e of r.keys())n.set(e,this.bucketChildren(r.get(e),t,i+1,s.get(e)));return n}},nc={moduleName:"SharedPivot",version:tv,beans:[class extends m.BeanStub{constructor(){super(...arguments),this.beanName="pivotResultCols"}wireBeans(e){this.colModel=e.colModel,this.visibleCols=e.visibleCols}destroy(){(0,m._destroyColumnTree)(this.beans,this.pivotResultCols?.tree),super.destroy()}isPivotResultColsPresent(){return null!=this.pivotResultCols}lookupPivotResultCol(e,t){if(null==this.pivotResultCols)return null;let i=this.colModel.getColDefCol(t),s=null;for(let t of this.pivotResultCols.list){let r=t.getColDef().pivotKeys,a=t.getColDef().pivotValueColumn,l=(0,m._areEqual)(r,e),n=a===i;l&&n&&(s=t)}return s}getPivotResultCols(){return this.pivotResultCols}getPivotResultCol(e){return this.pivotResultCols?this.colModel.getColFromCollection(e,this.pivotResultCols):null}setPivotResultCols(e,t){if(this.colModel.ready&&(null!=e||null!=this.pivotResultCols)){if(e){this.processPivotResultColDef(e);let i=("api"===t?m._createColumnTree:m._createColumnTreeWithIds)(this.beans,e,!1,this.pivotResultCols?.tree||this.previousPivotResultCols||void 0,t);(0,m._destroyColumnTree)(this.beans,this.pivotResultCols?.tree,i.columnTree);let s=i.columnTree,r=i.treeDepth,a=(0,m._getColumnsFromTree)(s);for(let e of(this.pivotResultCols={tree:s,treeDepth:r,list:a,map:{}},this.pivotResultCols.list))this.pivotResultCols.map[e.getId()]=e;let l=!!this.previousPivotResultCols;this.previousPivotResultCols=null,this.colModel.refreshCols(!l,t)}else this.previousPivotResultCols=this.pivotResultCols?this.pivotResultCols.tree:null,this.pivotResultCols=null,this.colModel.refreshCols(!1,t);this.visibleCols.refresh(t)}}processPivotResultColDef(e){let t=this.gos.get("processPivotResultColDef"),i=this.gos.get("processPivotResultColGroupDef");if(!t&&!i)return;let s=e=>{e.forEach(e=>{(0,m._exists)(e.children)?(i&&i(e),s(e.children)):t&&t(e)})};e&&s(e)}},class extends m.BeanStub{constructor(){super(...arguments),this.beanName="pivotColDefSvc"}wireBeans(e){this.colModel=e.colModel,this.pivotColsSvc=e.pivotColsSvc,this.valueColsSvc=e.valueColsSvc,this.colNames=e.colNames}postConstruct(){let e=()=>this.gos.get("serverSidePivotResultFieldSeparator")??"_";this.fieldSeparator=e(),this.addManagedPropertyListener("serverSidePivotResultFieldSeparator",()=>{this.fieldSeparator=e()});let t=()=>this.gos.get("pivotDefaultExpanded");this.pivotDefaultExpanded=t(),this.addManagedPropertyListener("pivotDefaultExpanded",()=>{this.pivotDefaultExpanded=t()})}createPivotColumnDefs(e){let t=this.createPivotColumnsFromUniqueValues(e),i=function e(t,i=[]){return t.forEach(t=>{void 0!==t.children?e(t.children,i):i.push(t)}),i}(t);return this.addRowGroupTotals(t,i),this.addExpandablePivotGroups(t,i),this.addPivotTotalsToGroups(t,i),t}createPivotColumnsFromUniqueValues(e){let t=this.pivotColsSvc?.columns??[],i=t.length;return this.recursivelyBuildGroup(0,e,[],i,t)}recursivelyBuildGroup(e,t,i,s,r){if(e>=s)return this.buildMeasureCols(i);let{pivotComparator:a}=r[e].getColDef(),l=a?(e,t)=>a(e.headerName,t.headerName):no,n=this.valueColsSvc?.columns;if(n?.length===1&&this.gos.get("removePivotHeaderRowWhenSingleValueColumn")&&e===s-1){let e=[];for(let s of t.keys()){let t=[...i,s],r=this.createColDef(n[0],s,t);r.columnGroupShow="open",e.push(r)}return e.sort(l),e}let o=[];for(let a of t.keys()){let l=-1===this.pivotDefaultExpanded||e<this.pivotDefaultExpanded,n=[...i,a];o.push({children:this.recursivelyBuildGroup(e+1,t.get(a),n,s,r),headerName:a,pivotKeys:n,columnGroupShow:"open",openByDefault:l,groupId:this.generateColumnGroupId(n)})}return o.sort(l),o}buildMeasureCols(e){let t=this.valueColsSvc?.columns??[];return 0===t.length?[this.createColDef(null,"-",e)]:t.map(t=>{let i=this.colNames.getDisplayNameForColumn(t,"header"),s=this.createColDef(t,i,e);return s.columnGroupShow="open",s})}addExpandablePivotGroups(e,t){let i=this.gos.get("suppressExpandablePivotGroups");if(i||this.gos.get("pivotColumnGroupTotals"))return;let s=(e,t,r)=>{if("children"in e){let{valueColsSvc:a}=this,{columns:l=[]}=a??{},n=new Map;e.children.forEach(e=>{s(e,t,n)});let o=!e.children.some(e=>e.children),d=o&&1===l.length&&this.gos.get("removePivotHeaderRowWhenSingleValueColumn");for(let s of l){let r=this.colNames.getDisplayNameForColumn(s,"header"),a=this.createColDef(s,r,e.pivotKeys);a.pivotTotalColumnIds=n.get(s.getColId()),a.columnGroupShow=i?"open":"closed",a.aggFunc=s.getAggFunc(),(!o||d)&&(e.children.push(a),t.push(a))}this.merge(r,n);return}if(!e.pivotValueColumn)return;let a=e.pivotValueColumn.getColId();r.has(a)?r.get(a).push(e.colId):r.set(a,[e.colId])};e.forEach(e=>{s(e,t,new Map)})}addPivotTotalsToGroups(e,t){if(!this.gos.get("pivotColumnGroupTotals"))return;let i="after"===this.gos.get("pivotColumnGroupTotals"),s=this.valueColsSvc?.columns,r=s?.map(e=>e.getAggFunc());if(r&&!(r.length<1)&&this.sameAggFuncs(r)&&s){let r=s[0];e.forEach(e=>{this.recursivelyAddPivotTotal(e,t,r,i)})}}recursivelyAddPivotTotal(e,t,i,s){if(!e.children)return e.colId?[e.colId]:null;let r=[];if(e.children.forEach(e=>{let a=this.recursivelyAddPivotTotal(e,t,i,s);a&&(r=r.concat(a))}),e.children.length>1){let a=this.getLocaleTextFunc()("pivotColumnGroupTotals","Total"),l=this.createColDef(i,a,e.pivotKeys,!0);l.pivotTotalColumnIds=r,l.aggFunc=i.getAggFunc(),l.columnGroupShow=this.gos.get("suppressExpandablePivotGroups")?"open":void 0;let n=e.children;s?n.push(l):n.unshift(l),t.push(l)}return r}addRowGroupTotals(e,t){if(!this.gos.get("pivotRowTotals"))return;let i="after"===this.gos.get("pivotRowTotals"),s=(this.valueColsSvc?.columns??[]).slice();i||s.reverse();let r=s.length>1||!this.gos.get("removePivotHeaderRowWhenSingleValueColumn");for(let a=0;a<s.length;a++){let l=s[a],n=this.colNames.getDisplayNameForColumn(l,"header"),o=this.createColDef(l,n,[]),d=[];for(let e=0;e<t.length;e++){let i=t[e];i.pivotValueColumn===l&&d.push(i.colId)}o.pivotTotalColumnIds=d,o.colId=nn+o.colId;let h=r?{children:[o],pivotKeys:[],groupId:`${nn}_pivotGroup_${l.getColId()}`}:o;t.push(o),i?e.push(h):e.unshift(h)}}recreateColDef(e){let{pivotValueColumn:t,headerName:i,pivotKeys:s,pivotTotalColumnIds:r,columnGroupShow:a,colId:l,valueGetter:n,aggFunc:o}=e;if(!t)return e;let d=this.createColDef(t,i,s,!!r);return d.columnGroupShow=a,d.colId=l,d.valueGetter=n,d.aggFunc=o,d.pivotTotalColumnIds=r,this.gos.get("processPivotResultColDef")?.(d),d}createColDef(e,t,i,s=!1){let r={};return e&&(Object.assign(r,e.getColDef()),r.hide=!1),r.headerName=t,r.colId=this.generateColumnId(i||[],e&&!s?e.getColId():""),r.field=r.colId,r.valueGetter=e=>e.data?.[e.colDef.field],r.pivotKeys=i,r.pivotValueColumn=e,!0===r.filter&&(r.filter="agNumberColumnFilter"),r}sameAggFuncs(e){if(1==e.length)return!0;for(let t=1;t<e.length;t++)if(e[t]!==e[0])return!1;return!0}merge(e,t){t.forEach((t,i)=>{let s=[...e.has(i)?e.get(i):[],...t];e.set(i,s)})}generateColumnGroupId(e){let t=(this.pivotColsSvc?.columns??[]).map(e=>e.getColId());return`pivotGroup_${t.join("-")}_${e.join("-")}`}generateColumnId(e,t){let i=(this.pivotColsSvc?.columns??[]).map(e=>e.getColId());return`pivot_${i.join("-")}_${e.join("-")}_${t}`}createColDefsFromFields(e){let t=new Map;for(let i=0;i<e.length;i++){let s=e[i].split(this.fieldSeparator),r=t;for(let e=0;e<s.length;e++){let t=s[e],i=r.get(t);i||(i=new Map,r.set(t,i)),r=i}}let i=(e,t,s,r)=>{let a=[];for(let[t,l]of s){let s=i(`${e}${this.fieldSeparator}${t}`,t,l,r+1);a.push(s)}if(0===a.length){let i=this.colModel.getColDefCol(t);if(i){let s=this.colNames.getDisplayNameForColumn(i,"header")??t,r=this.createColDef(i,s,void 0,!1);return r.colId=e,r.aggFunc=i.getAggFunc(),r.valueGetter=t=>t.data?.[e],r}return{colId:e,headerName:t,valueGetter:t=>t.data?.[e]}}return this.gos.get("removePivotHeaderRowWhenSingleValueColumn")&&1===a.length&&"colId"in a[0]?(a[0].headerName=t,a[0]):{openByDefault:-1===this.pivotDefaultExpanded||r<this.pivotDefaultExpanded,groupId:e,headerName:t,children:a}},s=[];for(let[e,r]of t){let t=i(e,e,r,0);s.push(t)}return s}},aN],apiFunctions:{isPivotMode:function(e){return e.colModel.isPivotMode()},getPivotResultColumn:function(e,t,i){return e.pivotResultCols?.lookupPivotResultCol(t,i)??null},setValueColumns:function(e,t){e.valueColsSvc?.setColumns(t,"api")},getValueColumns:function(e){return e.valueColsSvc?.columns??[]},removeValueColumns:function(e,t){e.valueColsSvc?.removeColumns(t,"api")},addValueColumns:function(e,t){e.valueColsSvc?.addColumns(t,"api")},setPivotColumns:function(e,t){e.pivotColsSvc?.setColumns(t,"api")},removePivotColumns:function(e,t){e.pivotColsSvc?.removeColumns(t,"api")},addPivotColumns:function(e,t){e.pivotColsSvc?.addColumns(t,"api")},getPivotColumns:function(e){return e.pivotColsSvc?.columns??[]},setPivotResultColumns:function(e,t){e.pivotResultCols?.setPivotResultCols(t,"api")},getPivotResultColumns:function(e){let t=e.pivotResultCols?.getPivotResultCols();return t?t.list:null}},dependsOn:[lo,m._ColumnGroupModule]},np=e=>{let t=e.split(".");if(t.includes("__proto__"))return()=>{};let i=t.length;return i<2?t=>t?.[e]:e=>{let s=0;do if(e=e?.[t[s++]],s===i)return e;while("object"==typeof e)}},ng=String.fromCodePoint(31,41150,8291),nm=class extends m.BeanStub{constructor(){super(...arguments),this.nestedDataGetter=null,this.parentIdGetter=null,this.nonLeafsById=null,this.nodesToUnselect=null,this.fullReload=!1}postConstruct(){this.onPropChange(null)}onPropChange(e){let t=this.gos;if(!e||e.has("treeDataParentIdField")){let e=t.get("treeDataParentIdField"),i=e?np(e):null;this.fullReload||(this.fullReload=this.parentIdGetter!==i),this.parentIdGetter=i,i&&(this.nestedDataGetter=null)}if(!e||e.has("treeDataChildrenField")){let e=this.parentIdGetter?"":t.get("treeDataChildrenField"),i=e?np(e):null;this.fullReload||(this.fullReload=this.nestedDataGetter!==i),this.nestedDataGetter=i}}destroy(){this.nodesToUnselect=null,this.reset(),super.destroy()}reset(){this.clearNonLeafs(),this.deselectHiddenNodes(!1),this.fullReload=!0}clearNonLeafs(){let e=this.nonLeafsById;if(e){for(let t of e.values())t._destroy(!1);e.clear(),this.nonLeafsById=null}}getNonLeaf(e){return this.nonLeafsById?.get(e)}loadGroupData(e){let t=e.key;if(null==t)return e._groupData=null,null;let i={};e._groupData=i;let s=this.beans.showRowGroupCols?.columns;if(s)for(let e=0,r=s.length;e<r;++e)i[s[e].getColId()]=t;return i}execute(e,t){this.fullReload&&this.reset();let{changedRowNodes:i,changedPath:s}=t,r=s?.active?s:void 0,a=this.fullReload||!i&&!r,l=!!i&&this.flagUpdatedNodes(i);(a||l)&&(this.fullReload=!1,this.parentIdGetter?this.loadSelfRef(e,a):this.nestedDataGetter?this.loadNested(e,i,a):this.loadDataPath(e,a));let n=this.initRowsParents(e);this.destroyFillerRows(!!t.animate),this.initRowsChildrenSize(e);let o=this.preprocessRows(e),d=n||(0x80000000&o)!=0;o&=0x7fffffff;let h=this.traverseRoot(e,r);return o>0&&o!==h&&(this.handleCycles(e),this.traverseRoot(e,r)),e.treeNodeFlags=0,this.deselectHiddenNodes(n||a),d}flagUpdatedNodes(e){let{adds:t,updates:i,removals:s}=e,r=s.length>0;if(t.size>0)for(let e of(r=!0,t))e.treeNodeFlags|=0x40000000;if(i.size>0)for(let e of(r=!0,i))e.treeNodeFlags|=0x40000000;return r}initRowsParents(e){let t=e._leafs,i=t.length,s=!1;for(let e=0;e<i;++e)this.initRowParent(t[e])&&(s=!0);return s}initRowParent(e){let t=!1;for(;;){let i=e.parent,s=e.treeParent;if(null===s){i&&(t=!0,this.hideRow(e));break}let r=s.treeNodeFlags+1,a=i!==s;if(a&&(t=!0,r|=0x40000000,e.parent=s),a&&i&&(i.destroyed&&nC(s,i)&&(r|=0x10000000),i.treeNodeFlags|=0x40000000),s.sourceRowIndex>=0||0x20000000&s.treeNodeFlags||null===s.treeParent){s.treeNodeFlags=r;break}s.treeNodeFlags=0x20000000|r|0x40000000&e.treeNodeFlags,e=s}return t}destroyFillerRows(e){let t=this.nonLeafsById;if(t){for(let i of t.values())(null===i.treeParent||(0xfffffff&i.treeNodeFlags)==0)&&(t.delete(i.id),i._destroy(e),this.hideRow(i));0===t.size&&(this.nonLeafsById=null)}}initRowsChildrenSize(e){this.initRowChildrenSize(e);let t=e._leafs,i=t.length;for(let e=0;e<i;++e)this.initRowChildrenSize(t[e]);let s=this.nonLeafsById;if(null!==s)for(let e of s.values())this.initRowChildrenSize(e)}initRowChildrenSize(e){let{childrenAfterGroup:t,_leafs:i,treeNodeFlags:s}=e,r=t?.length,a=0xfffffff&s;if(e.treeNodeFlags=-0x10000000&s|0x80000000*((r||0)!==a),0===a&&e.level>=0){if(t!==m._EmptyArray){e.childrenAfterGroup=m._EmptyArray;let t=e.sibling;t&&(t.childrenAfterGroup=m._EmptyArray)}}else if(r!==a||t===i)if(t&&t!==m._EmptyArray&&t!==i)t.length=a;else{e.childrenAfterGroup=t=Array(a);let i=e.sibling;i&&(i.childrenAfterGroup=t)}}preprocessRows(e){let t=e._leafs,i=t.length,s=0,r=!1;for(let e=0;e<i;++e){let i=t[e];for(;;){let e=i.treeParent;if(null===e)break;++s;let t=e.treeNodeFlags,a=e.childrenAfterGroup,l=0xfffffff&t;if((0x80000000&(t=-0x10000000&t|l+1)||a[l]!==i)&&(t|=0x80000000,a[l]=i,r=!0),e.treeNodeFlags=t,e.data||(0x20000000&e.treeNodeFlags)==0||null===e.treeParent)break;e.treeNodeFlags=-0x20000001&t|0x40000000&i.treeNodeFlags,i=e}}return s|0x80000000*!!r}traverseRoot(e,t){let i=0,s=e.childrenAfterGroup;for(let e=0,r=s.length;e<r;++e)i+=this.traverse(s[e],0,!1,t);return 0x7fffffff&i}traverse(e,t,i,s){let r=e.childrenAfterGroup,a=r.length,l=e.treeNodeFlags;e.treeNodeFlags=0x10000000&l,e.level=t,!!a!==e.group?(sT(e,this.beans,!!a),l|=0x40000000):e.hasChildren()!==!!a&&(e.updateHasChildren(),l|=0x40000000),(-0x40000000&l)!=0&&s?.addParentNode(e),0!==a||e.master?(0x10000000&l)==0&&(e.treeNodeFlags|=0x10000000,e.expanded=aQ(this.beans,e,t)):(e.expanded&&(e.expanded=!1),(0x10000000&l)!=0&&(e.treeNodeFlags&=-0x10000001)),i&&null!==e.rowIndex&&e.clearRowTopAndRowIndex(),i||(i=!1===e.expanded),++t,l&=0x80000000;for(let e=0;e<a;++e){let a=r[e],n=this.traverse(a,t,i,s);l=l+(0x7fffffff&n)|0x80000000&n}return 0x80000000&l&&(e._leafs=void 0),l+1}handleCycles(e){let t=new Set,i=e=>{if(t.has(e))return!1;for(let s of(t.add(e),e.childrenAfterGroup))i(s);return!0};i(e);let s=e.childrenAfterGroup;s.length=0;let r=e._leafs;for(let t=0,a=r.length;t<a;++t){let a=r[t],l=a.treeParent;l&&i(a)?(l.treeNodeFlags|=-0x40000000,a.parent=e,(0,m._removeFromArray)(l.childrenAfterGroup,a),s.push(a),(0,m._warn)(270,{id:a.id,parentId:l?.id??""})):l===e&&s.push(a)}}loadNested(e,t,i){if(!i&&t){for(let e of t.adds)e.key=e.id;return}let s=e._leafs;for(let e=0,t=s.length;e<t;++e){let t=s[e],i=t.id;t.key!==i&&nv(t,i)}}loadSelfRef(e,t){let i=e._leafs,s=i.length;if(!this.gos.get("getRowId")){for(let e=0;e<s;e++)i[e].treeParent=null;return}let r=this.beans.rowModel,a=this.parentIdGetter;for(let l=0;l<s;l++){let s=i[l];if(t||0x40000000&s.treeNodeFlags||s.treeParent?.destroyed){let t,i=a?.(s.data);null!=i&&((t=r.getRowNode(i))||(0,m._warn)(271,{id:s.id,parentId:i})),s.treeParent=t??e;let l=s.id;s.key!==l&&nv(s,l)}else s.treeParent??(s.treeParent=e)}}loadFlattened(e){let t=e._leafs;for(let i=0,s=t.length;i<s;++i){let s=t[i];s.treeParent=e;let r=s.id;s.key!==r&&nv(s,r)}}loadDataPath(e,t){let i,s=this.gos.get("getDataPath");if(!s)return void this.loadFlattened(e);let r=new Map,a=new Map;t||(i=this.loadExistingDataPath(e,r,a));let l=e._leafs;for(let e=0,n=l.length;e<n;++e){let n=l[e];if(!t&&null!==n.treeParent&&(0x40000000&n.treeNodeFlags)==0)continue;let o=s(n.data),d=o?.length;if(!d){(0,m._warn)(185,{data:n.data});continue}let h=o[d-1];n.key!==h&&nv(n,h);let u=o.join(ng);a.set(n,u);let c=r.get(u);void 0===c?r.set(u,n):c!==n&&(i=this.duplicatedPath(r,i,c,n,u))}i&&this.processDuplicatePaths(i,a),this.buildFromPaths(e,r,a)}loadExistingDataPath(e,t,i){let s,r=e._leafs;for(let a=0,l=r.length;a<l;++a){let l=r[a],n=l.treeParent;if(null===n||(0x40000000&l.treeNodeFlags)!=0)continue;let o=l.key,d=n;for(;d&&d!==e&&d!==l;){o=ng+o;let e=i.get(d);if(void 0!==e){o=e+o;break}o=d.key+o,d=d.treeParent}if(d!==l){i.set(l,o);let e=t.get(o);void 0===e?t.set(o,l):e!==l&&(s=this.duplicatedPath(t,s,e,l,o))}}return s}duplicatedPath(e,t,i,s,r){s.sourceRowIndex<i.sourceRowIndex&&e.set(r,s);let a=(t??(t=new Map)).get(r);return void 0===a?t.set(r,[i,s]):a.push(s),t}buildFromPaths(e,t,i){let s=Array(48),r=e._leafs;for(let a=0,l=r.length;a<l;++a){let l=r[a],n=i.get(l);if(void 0===n)continue;let o=this.splitPathKey(s,n),d=0,h=e;for(let e=o-1;e>=0;--e){let i=t.get(n.slice(0,s[e]));if(i){h=i,d=e+1;break}}d<o&&(h=this.buildMissingFillers(t,n,s,o,d,h)),l.treeParent=h}}splitPathKey(e,t){let i=0,s=0,r=t.length;for(;s<r;){let r=t.indexOf(ng,s);if(-1===r)break;e[i++]=r,s=r+3}return i}buildMissingFillers(e,t,i,s,r,a){let l=0,n="row-group";a.sourceRowIndex<0&&a.treeParent&&(l=r,n=a.id);do{let s=0===r?0:i[r-1]+3,o=i[r],d=t.slice(0,o),h=e.get(d);if(void 0===h){let a=0===s?d:t.slice(s,o);n=this.makeFillerIdBase(t,i,r,n,l)+a,h=this.getOrCreateFiller(a,n),e.set(d,h),l=r+1}else h.sourceRowIndex<0&&(n=h.id,l=r+1);h.treeParent=a,a=h,++r}while(r<s)return a}processDuplicatePaths(e,t){for(let i of e.values()){i.sort(nf);let e=i.length,s=Array(e-1);for(let r=1;r<e;++r){let e=i[r];t.delete(e),e.treeParent=null,s[r-1]=e.data}let r=i[0];(0,m._warn)(186,{rowId:r.id,rowData:r.data,duplicateRowsData:s})}}getOrCreateFiller(e,t){let i=this.nonLeafsById??(this.nonLeafsById=new Map),s=i.get(t);return void 0===s&&((s=new m.RowNode(this.beans)).id=t,s.key=e,s.group=!0,s.leafGroup=!1,s.rowGroupIndex=null,i.set(t,s)),s}makeFillerIdBase(e,t,i,s,r){for(;r<i;){let i=r>0?t[r-1]+3:0,a=t[r];s+="-"+r+"-"+e.slice(i,a),++r}return s+"-"+i+"-"}deselectHiddenNodes(e){let t=this.beans.selectionSvc,i=this.nodesToUnselect,s="rowDataChanged";if(i&&(this.nodesToUnselect=null,t?.setNodesSelected({newValue:!1,nodes:i,suppressFinishActions:!0,source:s})),(i||e)&&t?.updateGroupsFromChildrenSelections?.(s),i){let e=t?.getSelectedNodes()??null;this.eventSvc.dispatchEvent({type:"selectionChanged",source:s,selectedNodes:e,serverSideState:null})}}hideRow(e){e.isSelected()&&(this.nodesToUnselect??(this.nodesToUnselect=[])).push(e),e.parent=null,e.group=!1,e.treeParent=null,e.treeNodeFlags=0,e.childrenAfterGroup=m._EmptyArray,e._leafs=void 0,e._groupData=null;let t=e.sibling;t&&(t.childrenAfterGroup=m._EmptyArray),e.updateHasChildren(),null!==e.rowIndex&&e.clearRowTopAndRowIndex()}onShowRowGroupColsSetChanged(){let e=this.beans.rowModel.rootNode._leafs;if(!e)return;for(let t=0,i=e.length;t<i;++t)e[t]._groupData=void 0;let t=this.nonLeafsById;if(t)for(let e of t.values())e._groupData=void 0}},nf=(e,t)=>e.sourceRowIndex-t.sourceRowIndex,nC=(e,t)=>(0x10000000&t.treeNodeFlags)!=0&&(0x10000000&e.treeNodeFlags)==0&&null!==e.treeParent&&e.sourceRowIndex<0&&(e.expanded=t.expanded,!0),nv=(e,t)=>{let i=void 0!==e._groupData;e.key=t,e.groupValue=t;let s=e.sibling;s&&(s.key=t),i&&(e._groupData=void 0,e.setData(e.data))},nb={moduleName:"SharedTreeData",version:tv,dependsOn:[tb,aT,a3,a8]},ny=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="ssrmBlockUtils"}wireBeans(e){this.valueSvc=e.valueSvc,this.showRowGroupCols=e.showRowGroupCols,this.nodeManager=e.ssrmNodeManager,this.expansionSvc=e.expansionSvc,this.serverSideRowModel=e.rowModel,this.storeFactory=e.ssrmStoreFactory}createRowNode(e){let t=new m.RowNode(this.beans),i=null!=e.rowHeight?e.rowHeight:(0,m._getRowHeightAsNumber)(this.beans);return t.setRowHeight(i),t.group=e.group,t.leafGroup=e.leafGroup,t.level=e.level,t.uiLevel=e.level,t.parent=e.parent,t.stub=!0,t.__needsRefreshWhenVisible=!1,t.group&&(t.expanded=!1,t.field=e.field,t.rowGroupColumn=e.rowGroupColumn,t.rowGroupIndex=e.level),t}destroyRowNode(e,t=!1){e.childStore&&!t&&(this.destroyBean(e.childStore),e.childStore=null);let i=e.sibling;i&&!e.footer&&this.destroyRowNode(i,!1),e._destroy(!0),null!=e.id&&this.nodeManager.removeNode(e)}setTreeGroupInfo(e){e.updateHasChildren();let t=this.gos.get("getServerSideGroupKey"),i=e.hasChildren();i&&null!=t&&(e.key=t(e.data)),!i&&null!=e.childStore&&(this.destroyBean(e.childStore),e.childStore=null,e.master||(e.expanded=!1))}setRowGroupInfo(e){if(e.key=this.valueSvc.getValue(e.rowGroupColumn,e,"data"),(null===e.key||void 0===e.key)&&(0,m._doOnce)(()=>{(0,m._warn)(190,{rowGroupId:e.rowGroupColumn?.getId(),data:e.data})},"SSBlock-BadKey"),this.gos.get("groupAllowUnbalanced")&&""===e.key){let t=this.serverSideRowModel.getParams();e.childStore=this.createBean(this.storeFactory.createStore(t,e))}(0,m._getGroupTotalRowCallback)(this.beans.gos)({node:e})&&(aA(e,this.beans),e.sibling&&(e.sibling.uiLevel=e.uiLevel+1))}setMasterDetailInfo(e){let t=this.gos.get("isRowMaster");null!=t?e.master=t(e.data):e.master=!0}updateDataIntoRowNode(e,t){e.updateData(t),this.gos.get("treeData")?(this.setTreeGroupInfo(e),this.setChildCountIntoRowNode(e),this.updateRowFooter(e)):e.group?(this.setChildCountIntoRowNode(e),this.updateRowFooter(e)):this.gos.get("masterDetail")}updateRowFooter(e){if(!e.footer){if(e.group&&(0,m._getGroupTotalRowCallback)(this.beans.gos)({node:e})&&!e.sibling)return void aA(e,this.beans);e.sibling&&aM(e)}}setDataIntoRowNode(e,t,i,s){e.stub=!1;let r=this.gos.get("treeData");e.setDataAndId(t,i);let a=e.group;(r||!a)&&this.gos.get("masterDetail")&&this.setMasterDetailInfo(e),r?this.setTreeGroupInfo(e):a&&this.setRowGroupInfo(e),(r||a)&&(this.setGroupDataIntoRowNode(e),this.setChildCountIntoRowNode(e)),(0,m._exists)(t)&&(e.setRowHeight((0,m._getRowHeightForNode)(this.beans,e,!1,s).height),e.sibling?.setRowHeight((0,m._getRowHeightForNode)(this.beans,e.sibling,!1,s).height))}setChildCountIntoRowNode(e){let t=this.gos.get("getChildCount");t&&e.setAllChildrenCount(t(e.data))}setGroupDataIntoRowNode(e){let t=e.key;e.groupValue=t,e.sibling&&(e.sibling.groupValue=t);let i=this.showRowGroupCols?.columns;if(!i)return;let s=this.gos.get("treeData");for(let r of i){let i=e._groupData;if(i||(e._groupData=i={}),s)i[r.getColId()]=t;else if(r.isRowGroupDisplayed(e.rowGroupColumn.getId())){let t=this.valueSvc.getValue(e.rowGroupColumn,e,"data");i[r.getColId()]=t}}}clearDisplayIndex(e){e.clearRowTopAndRowIndex(),e.hasChildren()&&e.childStore&&e.childStore?.clearDisplayIndexes(),e.master&&e.detailNode&&e.detailNode?.clearRowTopAndRowIndex()}setDisplayIndex(e,t,i,s){let r=this.gos.get("groupAllowUnbalanced")&&e.group&&""===e.key;if((this.gos.get("groupHideOpenParents")&&e.group&&e.expanded||r?(e.setRowIndex(null),e.setRowTop(null)):(e.setRowIndex(t.value++),e.setRowTop(i.value),i.value+=e.rowHeight),e.setUiLevel(s),!e.footer)&&(e.master&&(e.expanded&&e.detailNode?(e.detailNode.setRowIndex(t.value++),e.detailNode.setRowTop(i.value),i.value+=e.detailNode.rowHeight):e.detailNode&&e.detailNode.clearRowTopAndRowIndex()),e.hasChildren()&&e.childStore)){let a=e.childStore;e.expanded||r?a.setDisplayIndexes(t,i,r?s:s+1):a.clearDisplayIndexes()}}extractRowBounds(e,t){let i=e=>({rowHeight:e.rowHeight,rowTop:e.rowTop});if(e.rowIndex===t)return i(e);if(e.hasChildren()&&e.expanded&&e.childStore){let i=e.childStore;if(i.isDisplayIndexInStore(t))return i.getRowBounds(t)}else if(e.master&&e.expanded&&e.detailNode&&e.detailNode.rowIndex===t)return i(e.detailNode)}isPixelInNodeRange(e,t){return!!(0,m._exists)(e.rowTop)&&!!(0,m._exists)(e.rowHeight)&&t>=e.rowTop&&t<e.rowTop+e.rowHeight}getIndexAtPixel(e,t){if(this.isPixelInNodeRange(e,t))return e.rowIndex;let i=e.master&&e.expanded,s=e.detailNode;if(i&&s&&this.isPixelInNodeRange(s,t))return s.rowIndex;if(e.hasChildren()&&e.expanded&&e.childStore){let i=e.childStore;if(i.isPixelInRange(t))return i.getRowIndexAtPixel(t)}return null}createNodeIdPrefix(e){let t=[],i=e;for(;i&&i.level>=0;)""===i.key?t.push("ag-Grid-MissingKey"):t.push(i.key),i=i.parent;if(t.length>0)return t.reverse().join("-")}checkOpenByDefault(e){let t=!!this.expansionSvc?.isNodeExpanded(e),i=e.expanded;!!i!==t?e.setExpanded(t):void 0===i&&(e.expanded=t)}},nw=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="ssrmExpandListener"}postConstruct(){(0,m._isServerSideRowModel)(this.gos)&&this.addManagedEventListeners({rowExpansionStateChanged:this.onRowExpandStateChanged.bind(this)})}onRowExpandStateChanged(){let e=this.beans,t=e.expansionSvc;e.rowModel.forEachNode(e=>{t.updateExpandedState(e)}),this.eventSvc.dispatchEvent({type:"storeUpdated"})}},nS=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="ssrmFilterListener"}wireBeans(e){this.serverSideRowModel=e.rowModel,this.filterManager=e.filterManager,this.listenerUtils=e.ssrmListenerUtils}postConstruct(){(0,m._isServerSideRowModel)(this.gos)&&this.addManagedEventListeners({advancedFilterEnabledChanged:()=>this.onFilterChanged(!0),filterChanged:()=>this.onFilterChanged()})}onFilterChanged(e){let t,i,s=this.serverSideRowModel.getParams();if(!s)return;let r=s.filterModel;if(this.filterManager?.isAdvFilterEnabled()){t=this.filterManager.getAdvFilterModel();let s=e?Object.keys(r??{}):this.getAdvancedFilterColumns(r),a=this.getAdvancedFilterColumns(t);for(let e of s)a.add(e);i=Array.from(a)}else if(t=this.filterManager?.getFilterModel()??{},e){let e=this.getAdvancedFilterColumns(r);for(let i of Object.keys(t))e.add(i);i=Array.from(e)}else i=this.findChangedColumns(r,t);let a={valueColChanged:this.listenerUtils.isSortingWithValueColumn(i),secondaryColChanged:this.listenerUtils.isSortingWithSecondaryColumn(i),changedColumns:i};this.serverSideRowModel.refreshAfterFilter(t,a)}findChangedColumns(e,t){let i={};for(let t of Object.keys(e))i[t]=!0;for(let e of Object.keys(t))i[e]=!0;let s=[];for(let r of Object.keys(i))(0,m._jsonEquals)(e[r],t[r])||s.push(r);return s}getAdvancedFilterColumns(e){let t=new Set;if(!e)return t;let i=e=>{if("join"===e.filterType)for(let t of e.conditions)i(t);else t.add(e.colId)};return i(e),t}},nx=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="ssrmListenerUtils"}wireBeans(e){this.pivotResultCols=e.pivotResultCols,this.valueColsSvc=e.valueColsSvc}isSortingWithValueColumn(e){let t=(this.valueColsSvc?.columns??[]).map(e=>e.getColId());for(let i=0;i<e.length;i++)if(t.indexOf(e[i])>-1)return!0;return!1}isSortingWithSecondaryColumn(e){let t=this.pivotResultCols?.getPivotResultCols();if(!t)return!1;let i=t.list.map(e=>e.getColId());for(let t=0;t<e.length;t++)if(i.indexOf(e[t])>-1)return!0;return!1}},nF=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="ssrmSortSvc"}wireBeans(e){this.sortSvc=e.sortSvc,this.serverSideRowModel=e.rowModel,this.listenerUtils=e.ssrmListenerUtils}postConstruct(){(0,m._isServerSideRowModel)(this.gos)&&this.addManagedEventListeners({sortChanged:this.onSortChanged.bind(this)})}onSortChanged(){let e=this.serverSideRowModel.getParams();if(!e)return;let t=this.sortSvc.getSortModel(),i=e.sortModel,s=this.findChangedColumnsInSort(t,i),r=this.listenerUtils.isSortingWithValueColumn(s),a=this.listenerUtils.isSortingWithSecondaryColumn(s);this.serverSideRowModel.refreshAfterSort(t,{valueColChanged:r,secondaryColChanged:a,changedColumns:s})}findChangedColumnsInSort(e,t){let i=[];for(let s of[e,t])if(s){let e=s.map(e=>e.colId);i=i.concat(e)}return i.filter(i=>{let s=t.find(e=>e.colId===i),r=e.find(e=>e.colId===i);return(s?s.sort:null)!==(r?r.sort:null)||(s?t.indexOf(s):-1)!==(r?e.indexOf(r):-1)})}},nA=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="ssrmNodeManager",this.rowNodes=new Map}addRowNode(e){let t=e.id;this.rowNodes.has(t)&&(0,m._warn)(187,{rowId:t,firstData:this.rowNodes.get(t).data,secondData:e.data}),this.rowNodes.set(t,e)}removeNode(e){let t=e.id;this.rowNodes.delete(t)}destroy(){this.clear(),super.destroy()}clear(){this.rowNodes.clear(),super.destroy()}},nM=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="rowModel",this.started=!1,this.managingPivotResultColumns=!1,this.onRowHeightChanged_debounced=(0,m._debounce)(this,this.onRowHeightChanged.bind(this),100)}wireBeans(e){this.colModel=e.colModel,this.colNames=e.colNames,this.pivotResultCols=e.pivotResultCols,this.rowGroupColsSvc=e.rowGroupColsSvc,this.pivotColsSvc=e.pivotColsSvc,this.valueColsSvc=e.valueColsSvc,this.filterManager=e.filterManager,this.sortSvc=e.sortSvc,this.rowRenderer=e.rowRenderer,this.nodeManager=e.ssrmNodeManager,this.storeFactory=e.ssrmStoreFactory,this.pivotColDefSvc=e.pivotColDefSvc}ensureRowHeightsValid(){return!1}start(){this.started=!0,this.updateDatasource()}destroyDatasource(){this.datasource&&(this.datasource.destroy&&this.datasource.destroy(),this.rowRenderer.datasourceChanged(),this.datasource=void 0)}postConstruct(){let e=this.resetRootStore.bind(this);this.addManagedEventListeners({newColumnsLoaded:this.onColumnEverything.bind(this),storeUpdated:this.onStoreUpdated.bind(this),columnValueChanged:e,columnPivotChanged:e,columnRowGroupChanged:e,columnPivotModeChanged:e}),this.addManagedPropertyListeners(["masterDetail","treeData","removePivotHeaderRowWhenSingleValueColumn","cacheBlockSize"],e),this.addManagedPropertyListeners(["groupAllowUnbalanced","groupTotalRow"],()=>this.onStoreUpdated()),this.addManagedPropertyListener("rowHeight",()=>this.resetRowHeights()),this.verifyProps(),this.addManagedPropertyListener("serverSideDatasource",()=>this.updateDatasource())}updateDatasource(){let e=this.gos.get("serverSideDatasource");e&&this.setDatasource(e)}verifyProps(){(0,m._isRowSelection)(this.gos)&&!this.gos.exists("getRowId")&&(0,m._warn)(188,{feature:"selection"})}setDatasource(e){this.started&&(this.destroyDatasource(),this.datasource=e,this.resetRootStore())}applyRowData(e,t,i){let s=this.getRootStore();if(!s)return;let r=s.getChildStore(i);r&&r.applyRowData(e,t,e.rowData.length)}isLastRowIndexKnown(){let e=this.getRootStore();return!!e&&e.isLastRowIndexKnown()}onColumnEverything(){if(!this.storeParams)return void this.resetRootStore();let e=this.columnsToValueObjects(this.rowGroupColsSvc?.columns),t=this.columnsToValueObjects(this.valueColsSvc?.columns),i=this.columnsToValueObjects(this.pivotColsSvc?.columns),s=e=>{let t={};for(let i of e.oldCols)t[i.id]=i;let i=e.newCols.every(e=>{let i=t[e.id];return i&&delete t[e.id],i&&i.field===e.field&&i.aggFunc===e.aggFunc}),s=!e.allowRemovedColumns&&!!Object.values(t).length;return i&&!s},r=!(0,m._jsonEquals)(this.storeParams.sortModel,this.sortSvc?.getSortModel()??[]),a=!s({oldCols:this.storeParams.rowGroupCols,newCols:e}),l=!s({oldCols:this.storeParams.pivotCols,newCols:i}),n=!!e?.length&&!s({oldCols:this.storeParams.valueCols,newCols:t,allowRemovedColumns:!0});if(r||a||l||n)this.resetRootStore();else{let e=this.createStoreParams();this.storeParams.rowGroupCols=e.rowGroupCols,this.storeParams.pivotCols=e.pivotCols,this.storeParams.valueCols=e.valueCols}}destroyRootStore(){this.rootNode?.childStore&&(this.rootNode.childStore=this.destroyBean(this.rootNode.childStore),this.nodeManager.clear())}refreshAfterSort(e,t){this.storeParams&&(this.storeParams.sortModel=e);let i=this.getRootStore();i&&(i.refreshAfterSort(t),this.onStoreUpdated())}generateSecondaryColumns(e){if(!this.pivotColDefSvc)return void this.gos.assertModuleRegistered("SharedPivot",2);let t=this.pivotColDefSvc.createColDefsFromFields(e);this.managingPivotResultColumns=!0,this.pivotResultCols?.setPivotResultCols(t,"rowModelUpdated")}resetRowHeights(){let e=this.resetRowHeightsForAllRowNodes(),t=(0,m._getRowHeightForNode)(this.beans,this.rootNode);if(this.rootNode.setRowHeight(t.height,t.estimated),this.rootNode.sibling){let e=(0,m._getRowHeightForNode)(this.beans,this.rootNode.sibling);this.rootNode.sibling.setRowHeight(e.height,e.estimated)}e&&this.onRowHeightChanged()}resetRowHeightsForAllRowNodes(){let e=!1;return this.forEachNode(t=>{let i=(0,m._getRowHeightForNode)(this.beans,t);t.setRowHeight(i.height,i.estimated);let s=t.detailNode;if(s){let e=(0,m._getRowHeightForNode)(this.beans,s);s.setRowHeight(e.height,e.estimated)}if(t.sibling){let e=(0,m._getRowHeightForNode)(this.beans,t.sibling);s?.setRowHeight(e.height,e.estimated)}e=!0}),e}resetRootStore(){this.destroyRootStore(),this.rootNode=new m.RowNode(this.beans),this.rootNode.group=!0,this.rootNode.level=-1,this.datasource&&(this.storeParams=this.createStoreParams(),this.rootNode.childStore=this.createBean(this.storeFactory.createStore(this.storeParams,this.rootNode)),this.updateRowIndexesAndBounds()),this.managingPivotResultColumns&&(this.pivotResultCols?.setPivotResultCols(null,"api"),this.managingPivotResultColumns=!1),this.dispatchModelUpdated(!0)}columnsToValueObjects(e=[]){return e.map(e=>({id:e.getId(),aggFunc:e.getAggFunc(),displayName:this.colNames.getDisplayNameForColumn(e,"model"),field:e.getColDef().field}))}createStoreParams(){let e=this.columnsToValueObjects(this.rowGroupColsSvc?.columns),t=this.columnsToValueObjects(this.valueColsSvc?.columns),i=this.columnsToValueObjects(this.pivotColsSvc?.columns),s=(0,m._isGetRowHeightFunction)(this.gos);return{valueCols:t,rowGroupCols:e,pivotCols:i,pivotMode:this.colModel.isPivotMode(),filterModel:this.filterManager?.isAdvFilterEnabled()?this.filterManager?.getAdvFilterModel():this.filterManager?.getFilterModel()??{},sortModel:this.sortSvc?.getSortModel()??[],datasource:this.datasource,lastAccessedSequence:{value:0},dynamicRowHeight:s}}getParams(){return this.storeParams}dispatchModelUpdated(e=!1){this.eventSvc.dispatchEvent({type:"modelUpdated",animate:!e,keepRenderedRows:!e,newPage:!1,newData:!1})}onStoreUpdated(){this.updateRowIndexesAndBounds(),this.dispatchModelUpdated()}onRowHeightChanged(){this.updateRowIndexesAndBounds(),this.dispatchModelUpdated()}updateRowIndexesAndBounds(){let e=this.getRootStore();e&&e.setDisplayIndexes({value:0},{value:0},0)}retryLoads(){let e=this.getRootStore();e&&(e.retryLoads(),this.onStoreUpdated())}getRow(e){let t=this.getRootStore();if(t)return t.getRowUsingDisplayIndex(e)}refreshAfterFilter(e,t){this.storeParams&&(this.storeParams.filterModel=e);let i=this.getRootStore();i&&(i.refreshAfterFilter(t),this.onStoreUpdated())}getRootStore(){return this.rootNode?.childStore}getRowCount(){let e=this.getRootStore();return e?e.getDisplayIndexEnd():0}getTopLevelRowCount(){let e=this.getRootStore();return e?e.getRowCount():1}getTopLevelRowDisplayedIndex(e){let t=this.getRootStore();return t?t.getTopLevelRowDisplayedIndex(e):e}getRowBounds(e){let t=this.getRootStore();return t?t.getRowBounds(e):{rowTop:0,rowHeight:(0,m._getRowHeightAsNumber)(this.beans)}}getBlockStates(){let e=this.getRootStore();if(!e)return;let t={};return e.forEachStoreDeep(e=>{let i=e.getBlockStates();for(let e of Object.keys(i))t[e]=i[e]}),t}getRowIndexAtPixel(e){let t=this.getRootStore();return e<=0||!t?0:t.getRowIndexAtPixel(e)}isEmpty(){return!1}getOverlayType(){let e=this.getRootStore();return e?.getDisplayIndexEnd()===0?this.filterManager?.isAnyFilterPresent()?"noMatchingRows":"noRows":null}isRowsToRender(){return null!=this.getRootStore()&&this.getRowCount()>0}getType(){return"serverSide"}forEachNode(e){let t=this.getRootStore();t&&t.forEachNodeDeep(e)}forEachDisplayedNode(e){this.forEachNode((t,i)=>{!t.stub&&t.displayed&&e(t,i)})}forEachNodeAfterFilterAndSort(e,t=!1){let i=this.getRootStore();i&&i.forEachNodeDeepAfterFilterAndSort(e,void 0,t)}executeOnStore(e,t){if(!this.started)return!1;let i=this.getRootStore();if(!i)return!0;let s=i.getChildStore(e);return s&&t(s),!0}refreshStore(e={}){let t=e.route?e.route:[];this.executeOnStore(t,t=>t.refreshStore(!0==e.purge))}getStoreState(){let e=[],t=this.getRootStore();return t&&t.addStoreStates(e),e}getNodesInRangeForSelection(e,t){let i=e.rowIndex,s=t.rowIndex;if(null===i&&null===s)return[];if(null===s)return e?[e]:[];if(null===i)return[t];let r=[],[a,l]=[i,s].sort((e,t)=>e-t);return(this.forEachNode(e=>{let t=e.rowIndex;null!=t&&!e.stub&&t>=a&&t<=l&&r.push(e)}),r.length!==l-a+1)?null:r}getRowNode(e){let t;return this.forEachNode(i=>{i.id===e&&(t=i),i.detailNode&&i.detailNode.id===e&&(t=i.detailNode)}),t}isRowPresent(e){return!!this.getRowNode(e.id)}setRowCount(e,t){let i=this.getRootStore();i&&i.setRowCount(e,t)}destroy(){this.destroyDatasource(),this.destroyRootStore(),super.destroy()}onRowHeightChangedDebounced(){this.onRowHeightChanged_debounced()}},nR=class extends m.BeanStub{constructor(){super(...arguments),this.name="expand",this.expanded=new Set,this.collapsed=new Set,this.initialState=new Map}setExpandedState({expandedRowGroupIds:e,collapsedRowGroupIds:t}){for(let i of(this.expanded=new Set(e),this.collapsed=new Set(t),this.expanded))this.initialState.set(i,!1);for(let e of this.collapsed)this.initialState.set(e,!0)}getExpandedState(){return{expandedRowGroupIds:Array.from(this.expanded),collapsedRowGroupIds:Array.from(this.collapsed)}}setRowExpanded(e,t){let i=e.id,s=this.initialState.get(i)===t;if(t){this.collapsed.delete(i),s||this.expanded.add(i);return}this.expanded.delete(i),s||this.collapsed.add(i)}isRowExpanded(e){let t=e.id;if(this.expanded.has(t))return!0;if(this.collapsed.has(t))return!1;let i=this.initialState.get(t);if(null!=i)return i;let s=this.getInitialRowState(e);return this.initialState.set(t,s),s}getInitialRowState(e){if(!e.isExpandable())return!1;let t=this.gos.getCallback("isServerSideGroupOpenByDefault");return!!t&&t({data:e.data,rowNode:e})}isRowInitialised(e){return this.initialState.has(e)}expandAll(e){this.beans.rowModel.forEachNode(t=>{this.setRowExpanded(t,e)})}},nT=class extends m.BeanStub{constructor(){super(...arguments),this.name="expandAll",this.allExpanded=void 0,this.flipped=new Set}setExpandedState(e){this.allExpanded=e.expandAll,this.flipped=new Set(e.invertedRowGroupIds)}getExpandedState(){return{expandAll:this.allExpanded,invertedRowGroupIds:Array.from(this.flipped)}}setRowExpanded(e,t){let i=e.id;t===this.allExpanded?this.flipped.delete(i):this.flipped.add(i)}isRowExpanded(e){let t=e.id;return this.allExpanded!==this.flipped.has(t)}isRowInitialised(){return!0}expandAll(e){this.allExpanded=e,this.flipped.clear()}},nP=class extends aB{constructor(){super(...arguments),this.beanName="expansionSvc"}wireBeans(e){this.serverSideRowModel=e.rowModel,this.storeFactory=e.ssrmStoreFactory}postConstruct(){let e=()=>{this.strategy=this.createManagedBean(new nR)};this.addManagedEventListeners({columnRowGroupChanged:e,columnPivotChanged:e,columnPivotModeChanged:e}),this.addManagedPropertyListener("ssrmExpandAllAffectsAllRows",e=>{e.currentValue||(this.strategy=this.createManagedBean(new nR),this.updateAllNodes(),this.dispatchStateUpdatedEvent())}),e()}setExpansionState(e){let t="expandAll"in e;t!==this.isExpandAllStrategy(this.strategy)&&(this.strategy=t?this.createManagedBean(new nT):this.createManagedBean(new nR)),this.strategy.setExpandedState(e),this.dispatchStateUpdatedEvent(),this.updateAllNodes()}getExpansionState(){return this.strategy.getExpandedState()}updateAllNodes(){this.serverSideRowModel.forEachNode(e=>{super.setExpanded(e,this.isNodeExpanded(e))})}isNodeExpanded(e){return this.strategy.isRowExpanded(e)}setExpanded(e,t,i,s){this.strategy.setRowExpanded(e,t),super.setExpanded(e,t,i),this.dispatchStateUpdatedEvent(),this.updateExpandedState(e)}expandAll(e){let t=this.beans.gos.get("ssrmExpandAllAffectsAllRows"),i=!this.isExpandAllStrategy(this.strategy)&&t;this.strategy=i?new nT:this.strategy,this.strategy.expandAll(e),this.updateAllNodes(),this.dispatchStateUpdatedEvent(),this.beans.eventSvc.dispatchEvent({type:"expandOrCollapseAll",source:e?"expandAll":"collapseAll"})}isExpandAllStrategy(e){return"expandAll"===e.name}onGroupExpandedOrCollapsed(){}setDetailsExpansionState(e){let{gos:t}=this.beans;if(!t.get("ssrmExpandAllAffectsAllRows"))return;let i=this.getExpansionState();if(void 0===i.expandAll)return;let s=i.expandAll&&0===i.invertedRowGroupIds.length;if((!i.expandAll&&0===i.invertedRowGroupIds.length)!==s)return s?e.expandAll():e.collapseAll()}dispatchExpandedEvent(e){this.eventSvc.dispatchEvent(e),this.beans.rowRenderer.refreshCells({rowNodes:[e.node]})}updateExpandedState(e){let t=e.childStore;if(e.expanded){if(e.master&&!e.detailNode&&(e.detailNode=this.createDetailNode(e)),!t&&e.hasChildren()){let t=this.serverSideRowModel.getParams();e.childStore=this.createBean(this.storeFactory.createStore(t,e))}}else t&&this.gos.get("purgeClosedRowNodes")&&(e.childStore=this.destroyBean(t))}createDetailNode(e){let t=new m.RowNode(this.beans);t.detail=!0,t.selectable=!1,t.parent=e,(0,m._exists)(e.id)&&(t.id="detail_"+e.id),t.data=e.data,t.level=e.level+1;let i=(0,m._getRowHeightForNode)(this.beans,t).height;return t.rowHeight=i||200,t}},nI=class extends m.BeanStub{constructor(e){super(),this.selectionCtx=e,this.selectedState={selectAll:!1,toggledNodes:new Set},this.selectAllUsed=!1,this.selectedNodes={}}getSelectedState(){return{selectAll:this.selectedState.selectAll,toggledNodes:[...this.selectedState.toggledNodes]}}setSelectedState(e){if("object"!=typeof e||!("selectAll"in e))return void(0,m._error)(116);if("boolean"!=typeof e.selectAll)return void(0,m._error)(117);if(!("toggledNodes"in e)||!Array.isArray(e.toggledNodes))return(0,m._warn)(197);let t={selectAll:e.selectAll,toggledNodes:new Set};e.toggledNodes.forEach(e=>{"string"==typeof e?t.toggledNodes.add(e):(0,m._warn)(196,{key:e})});let i=t.selectAll||t.toggledNodes.size>1;(0,m._isUsingNewRowSelectionAPI)(this.gos)&&!(0,m._isMultiRowSelection)(this.gos)&&i?(0,m._warn)(130):this.selectedState=t}deleteSelectionStateFromParent(e,t){if(0===this.selectedState.toggledNodes.size)return!1;let i=!1;for(let e of t)this.selectedState.toggledNodes.delete(e)&&(i=!0);return i}setNodesSelected(e){let{nodes:t,clearSelection:i,newValue:s,source:r}=e;if(0===t.length)return 0;if(!(0,m._isMultiRowSelection)(this.gos)||i&&s){if(t.length>1)return(0,m._error)(130),0;let e=t[0],i=e.footer?e.sibling:e;return s&&i.selectable?(this.selectedNodes={[i.id]:i},this.selectedState={selectAll:!1,toggledNodes:new Set([i.id])}):(this.selectedNodes={},this.selectedState={selectAll:!1,toggledNodes:new Set}),1}let a=(e,t=s)=>{let i=e.footer?e.sibling:e;t&&i.selectable?this.selectedNodes[i.id]=i:delete this.selectedNodes[i.id],t!==this.selectedState.selectAll&&i.selectable?this.selectedState.toggledNodes.add(i.id):this.selectedState.toggledNodes.delete(i.id)};for(let e of t)a(e);return 1===t.length&&"api"===r&&this.selectionCtx.setRoot(t[0].footer?t[0].sibling:t[0]),1}processNewRow(e){this.selectedNodes[e.id]&&(this.selectedNodes[e.id]=e)}isNodeSelected(e){let t=this.selectedState.toggledNodes.has(e.id);return this.selectedState.selectAll?!t:t}getSelectedNodes(e=!1,t=!0){let{selectedState:{selectAll:i},selectedNodes:s,selectAllUsed:r}=this;return t&&r&&(0,m._warn)(199),e&&i?null:Object.values(s)}getSelectedRows(){return(this.getSelectedNodes()??[]).map(e=>e.data)}getSelectionCount(){return this.selectedState.selectAll?-1:this.selectedState.toggledNodes.size}isEmpty(){return!this.selectedState.selectAll&&!this.selectedState.toggledNodes?.size}selectAllRowNodes(){this.reset(!0)}deselectAllRowNodes(){this.reset(!1)}reset(e){this.selectedState={selectAll:e,toggledNodes:new Set},this.selectedNodes={},this.selectAllUsed||(this.selectAllUsed=e)}getSelectAllState(){return this.selectedState.selectAll?!(this.selectedState.toggledNodes.size>0)||null:this.selectedState.toggledNodes.size>0&&null}},nE=class extends m.BeanStub{constructor(e){super(),this.selectionCtx=e,this.selectedState={selectAllChildren:!1,toggledNodes:new Map}}wireBeans(e){this.rowModel=e.rowModel,this.rowGroupColsSvc=e.rowGroupColsSvc,this.filterManager=e.filterManager,this.selectionSvc=e.selectionSvc}postConstruct(){this.addManagedEventListeners({modelUpdated:()=>this.removeRedundantState(),columnRowGroupChanged:()=>this.selectionSvc.reset("rowGroupChanged")})}getSelectedState(){let{gos:e,rowGroupColsSvc:t,selectedState:i}=this,s=e.get("treeData"),r=(e,i,a)=>{let l={nodeId:a};if((s||t&&i<=t.columns.length)&&(l.selectAllChildren=e.selectAllChildren),e.toggledNodes.size){let t=[];e.toggledNodes.forEach((e,s)=>{let a=r(e,i+1,s);t.push(a)}),l.toggledNodes=t}return l};return r(i,0)}setSelectedState(e){if("selectAll"in e)return void(0,m._error)(111);let t=(e,i)=>{if("object"!=typeof e)throw(0,m._error)(243),Error();if("selectAllChildren"in e&&"boolean"!=typeof e.selectAllChildren)throw(0,m._error)(244),Error();if("toggledNodes"in e){if(!Array.isArray(e.toggledNodes))throw(0,m._error)(245),Error();if(!e.toggledNodes.every(e=>"object"==typeof e&&"nodeId"in e&&"string"==typeof e.nodeId))throw(0,m._error)(246),Error()}let s=e.selectAllChildren??!i,r=e.toggledNodes?.map(e=>[e.nodeId,t(e,s)]);if(r?.some(([,e])=>s===e.selectAllChildren&&0===e.toggledNodes.size))throw(0,m._error)(247),Error();return{selectAllChildren:s,toggledNodes:new Map(r)}};try{this.selectedState=t(e,!!e.selectAllChildren)}catch(e){}}deleteSelectionStateFromParent(e,t){let i=this.selectedState,s=[...e];for(;i&&s.length;)i=i.toggledNodes.get(s.pop());if(!i)return!1;let r=!1;for(let e of t)i?.toggledNodes.delete(e)&&(r=!0);return r&&this.removeRedundantState(),r}setNodesSelected({nodes:e,newValue:t,clearSelection:i,source:s}){if(0===e.length)return 0;let r=i&&t;if(!(0,m._isMultiRowSelection)(this.gos)||r){if(e.length>1)return(0,m._error)(130),0;this.deselectAllRowNodes()}for(let i of e){let e=i.footer?i.sibling:i,s=this.getRouteToNode(e);this.recursivelySelectNode(s,this.selectedState,t)}return this.removeRedundantState(),1===e.length&&"api"===s&&this.selectionCtx.setRoot(e[0].footer?e[0].sibling:e[0]),1}isNodeSelected(e){let t=this.getRouteToNode(e);return this.isNodePathSelected(t,this.selectedState)}isNodePathSelected([e,...t],i){if(0===t.length){let t=i.toggledNodes.has(e.id);if(e.hasChildren()){let t=i.toggledNodes.get(e.id);if(t?.toggledNodes.size)return}return i.selectAllChildren?!t:t}if(i.toggledNodes.has(e.id)){let s=i.toggledNodes.get(e.id);if(s)return this.isNodePathSelected(t,s)}return i.selectAllChildren}getRouteToNode(e){let t=[],i=e;for(;i.parent;)t.push(i),i=i.parent;return t.reverse()}removeRedundantState(){if(this.filterManager?.isAnyFilterPresent())return;let e=(t=this.selectedState,i,s)=>{if(t.toggledNodes.forEach((i,s)=>{e(i,s,t)}),i){let e=this.rowModel.getRowNode(i),s=e?.childStore;if(s?.isLastRowIndexKnown()&&t.toggledNodes.size>=s.getRowCount()){for(let e of t.toggledNodes.entries()){let[t,i]=e;if(i.toggledNodes.size>0||!this.rowModel.getRowNode(t))return}t.selectAllChildren=!t.selectAllChildren,t.toggledNodes.clear()}}let r=0===t.toggledNodes.size,a=s?.selectAllChildren===t.selectAllChildren;r&&a&&s?.toggledNodes.delete(i)};e()}recursivelySelectNode([e,...t],i,s){if(!e)return;if(!t.length){let t=e.selectable;if(i.selectAllChildren===s||!t)return void i.toggledNodes.delete(e.id);let r={selectAllChildren:s,toggledNodes:new Map};return void i.toggledNodes.set(e.id,r)}let r=i.toggledNodes.has(e.id),a=i.toggledNodes.get(e.id)??{selectAllChildren:i.selectAllChildren,toggledNodes:new Map};r||i.toggledNodes.set(e.id,a),this.recursivelySelectNode(t,a,s),i.selectAllChildren===a.selectAllChildren&&0===a.toggledNodes.size&&i.toggledNodes.delete(e.id)}getSelectedNodes(e=!1){if((0,m._warn)(202),this.selectedState.selectAllChildren&&e)return null;let t=[];return this.rowModel.forEachNode(e=>{e.isSelected()&&t.push(e)}),t}processNewRow(){}getSelectedRows(){return this.getSelectedNodes()?.map(e=>e.data)??[]}getSelectionCount(){return -1}isEmpty(){return!this.selectedState.selectAllChildren&&!this.selectedState.toggledNodes?.size}selectAllRowNodes(){this.reset(!0)}deselectAllRowNodes(){this.reset(!1)}reset(e){this.selectedState={selectAllChildren:e,toggledNodes:new Map}}getSelectAllState(){return this.selectedState.selectAllChildren?!(this.selectedState.toggledNodes.size>0)||null:this.selectedState.toggledNodes.size>0&&null}},nD=class extends m.BaseSelectionService{constructor(){super(...arguments),this.beanName="selectionSvc"}postConstruct(){super.postConstruct(),this.addManagedPropertyListeners(["groupSelectsChildren","rowSelection"],()=>{let e=(0,m._getGroupSelectsDescendants)(this.gos),t=e&&this.selectionStrategy instanceof nI?nE:!e&&this.selectionStrategy instanceof nE?nI:void 0;t&&(this.destroyBean(this.selectionStrategy),this.selectionStrategy=this.createManagedBean(new t(this.selectionCtx)),this.shotgunResetNodeSelectionState(),this.dispatchSelectionChanged("api"))}),this.addManagedPropertyListeners(["rowSelection"],()=>{let e=(0,m._getRowSelectionMode)(this.gos);e!==this.selectionMode&&(this.selectionMode=e,this.deselectAllRowNodes({source:"api"}))}),this.selectionMode=(0,m._getRowSelectionMode)(this.gos);let e=(0,m._getGroupSelectsDescendants)(this.gos);this.selectionStrategy=this.createManagedBean(new(e?nE:nI)(this.selectionCtx))}handleSelectionEvent(e,t,i){if(this.isRowSelectionBlocked(t))return 0;let s=0,r=this.inferNodeSelections(t,e.shiftKey,e.metaKey||e.ctrlKey,i);return null==r?0:(this.selectionCtx.selectAll=!1,"select"in r?(r.reset?this.selectionStrategy.deselectAllRowNodes({source:"api"}):this.selectionStrategy.setNodesSelected({nodes:r.deselect,newValue:!1,source:i}),s=this.selectionStrategy.setNodesSelected({nodes:r.select,newValue:!0,source:i})):s=this.selectionStrategy.setNodesSelected({nodes:[r.node],newValue:r.newValue,clearSelection:r.clearSelection,event:e,source:i}),this.shotgunResetNodeSelectionState(i),this.dispatchSelectionChanged(i),s)}getSelectionState(){return this.selectionStrategy.getSelectedState()}setSelectionState(e,t){if(!(0,m._isRowSelection)(this.gos)){e&&(0,m._warn)(132);return}Array.isArray(e)||(e?(this.selectionStrategy.setSelectedState(e),this.shotgunResetNodeSelectionState(),this.dispatchSelectionChanged(t)):this.deselectAllRowNodes({source:t}))}setNodesSelected(e){if(!(0,m._isRowSelection)(this.gos)&&e.newValue)return(0,m._warn)(132),0;let{nodes:t,...i}=e;if(t.length>1&&"multiRow"!==this.selectionMode)return(0,m._warn)(130),0;let s={nodes:t.filter(e=>e.selectable),...i};if(!s.nodes.length)return 0;let r=this.selectionStrategy.setNodesSelected(s);return this.shotgunResetNodeSelectionState(s.source),this.dispatchSelectionChanged(s.source),r}deleteSelectionStateFromParent(e,t){this.selectionStrategy.deleteSelectionStateFromParent(e,t)&&(this.shotgunResetNodeSelectionState(),this.dispatchSelectionChanged("api"))}shotgunResetNodeSelectionState(e){this.beans.rowModel.forEachNode(t=>{if(t.stub)return;let i=this.selectionStrategy.isNodeSelected(t);i!==t.isSelected()&&this.selectRowNode(t,i,void 0,e)})}getSelectedNodes(){return this.selectionStrategy.getSelectedNodes()??[]}getSelectedRows(){return this.selectionStrategy.getSelectedRows()}getSelectionCount(){return this.selectionStrategy.getSelectionCount()}syncInRowNode(e){this.selectionStrategy.processNewRow(e);let t=this.selectionStrategy.isNodeSelected(e);if(!1!=t&&!e.selectable){this.selectionStrategy.setNodesSelected({nodes:[e],newValue:!1,source:"api"}),this.shotgunResetNodeSelectionState(),this.dispatchSelectionChanged("api");return}e.__selected=t}reset(){this.selectionStrategy.deselectAllRowNodes({source:"api"}),this.selectionCtx.reset()}isEmpty(){return this.selectionStrategy.isEmpty()}hasNodesToSelect(){return!0}selectAllRowNodes(e){return(0,m._isRowSelection)(this.gos)?(nk(e),(0,m._isUsingNewRowSelectionAPI)(this.gos)&&!(0,m._isMultiRowSelection)(this.gos))?(0,m._warn)(130):void(this.selectionStrategy.selectAllRowNodes(e),this.selectionCtx.selectAll=!0,this.beans.rowModel.forEachNode(t=>{t.stub||this.selectRowNode(t,!0,void 0,e.source)}),this.dispatchSelectionChanged(e.source)):void(0,m._warn)(132)}deselectAllRowNodes(e){nk(e),this.selectionStrategy.deselectAllRowNodes(e),this.selectionCtx.selectAll=!1,this.beans.rowModel.forEachNode(t=>{t.stub||this.selectRowNode(t,!1,void 0,e.source)}),this.dispatchSelectionChanged(e.source)}getSelectAllState(e){return this.selectionStrategy.getSelectAllState(e)}getBestCostNodeSelection(){return(0,m._warn)(194,{method:"getBestCostNodeSelection"})}updateSelectable(){if(!(0,m._isRowSelection)(this.gos))return;let e=[];this.beans.rowModel.forEachNode(t=>{!this.updateRowSelectable(t,!0)&&t.isSelected()&&e.push(t)}),e.length&&this.setNodesSelected({nodes:e,newValue:!1,source:"selectableChanged"})}dispatchSelectionChanged(e){this.eventSvc.dispatchEvent({type:"selectionChanged",source:e,selectedNodes:this.selectionStrategy instanceof nE?null:this.selectionStrategy.getSelectedNodes(!0,!1),serverSideState:this.getSelectionState()})}updateSelectableAfterGrouping(){return(0,m._error)(194,{method:"updateSelectableAfterGrouping"})}refreshMasterNodeState(){}setDetailSelectionState(){}};function nk({selectAll:e}){("filtered"===e||"currentPage"===e)&&(0,m._warn)(195,{justCurrentPage:"currentPage"===e})}var nL=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="rowChildrenSvc"}getHasChildrenValue(e){let t=this.gos.get("treeData"),i=this.gos.get("isServerSideGroup");return!e.stub&&!e.footer&&(t?!!i&&i(e.data):!!e.group)}},nN=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="lazyBlockLoadingSvc",this.outboundRequests=0,this.cacheLoadingNodesMap=new Map,this.isCheckQueued=!1,this.nextBlockToLoad=void 0}wireBeans(e){this.rowRenderer=e.rowRenderer,this.rowModel=e.rowModel}postConstruct(){this.maxOutboundRequests=(0,m._getMaxConcurrentDatasourceRequests)(this.gos)}subscribe(e){this.cacheLoadingNodesMap.set(e,new Set)}unsubscribe(e){this.cacheLoadingNodesMap.delete(e)}queueLoadCheck(){this.isCheckQueued||(this.isCheckQueued=!0,setTimeout(()=>{this.queueLoadAction(),this.isCheckQueued=!1}))}onLoadComplete(){this.outboundRequests-=1,this.queueLoadCheck()}hasAvailableLoadBandwidth(){return void 0===this.maxOutboundRequests||this.outboundRequests<this.maxOutboundRequests}queueLoadAction(){let e=this.getBlockToLoad();if(!e)return;let t=this.nextBlockToLoad&&this.nextBlockToLoad.cache===e.cache&&this.nextBlockToLoad.index===e.index;if(!t&&(!this.nextBlockToLoad||!t)){this.nextBlockToLoad=e,window.clearTimeout(this.loaderTimeout);let t=Number(this.nextBlockToLoad.index),i=this.nextBlockToLoad.cache,s=e.index+e.cache.getBlockSize();this.loaderTimeout=window.setTimeout(()=>{i.isAlive()&&(this.loaderTimeout=void 0,this.attemptLoad(i,t,s),this.nextBlockToLoad=void 0)},this.gos.get("blockLoadDebounceMillis"))}}attemptLoad(e,t,i){this.hasAvailableLoadBandwidth()&&(this.executeLoad(e,t,i),this.queueLoadCheck())}executeLoad(e,t,i){let s=e.getSsrmParams(),r={startRow:t,endRow:i,rowGroupCols:s.rowGroupCols,valueCols:s.valueCols,pivotCols:s.pivotCols,pivotMode:s.pivotMode,groupKeys:e.store.getParentNode().getRoute()??[],filterModel:s.filterModel,sortModel:s.sortModel},a=this.cacheLoadingNodesMap.get(e),l=()=>{for(let e=0;e<i-t;e++)a.delete(t+e)},n=s=>{this.onLoadComplete(),e.onLoadSuccess(t,i-t,s),l()},o=()=>{this.onLoadComplete(),e.onLoadFailed(t,i-t),l()},d=(0,m._addGridCommonParams)(this.gos,{request:r,success:n,fail:o,parentNode:e.store.getParentNode()});for(let e=0;e<i-t;e++)a.add(t+e);this.outboundRequests+=1,e.getSsrmParams().datasource?.getRows(d)}getBlockToLoad(){let e=this.rowRenderer.firstRenderedRow,t=this.rowRenderer.lastRenderedRow;for(let i=e;i<=t;i++){let e=this.rowModel.getRow(i);if(!e)continue;let t=e.parent?.childStore;if(!t)continue;let s=t.getCache(),r=s.getNodes().getBy("node",e);if(!r)continue;let a=this.cacheLoadingNodesMap.get(s);if(!a?.has(r.index)&&(e.__needsRefreshWhenVisible||e.stub&&!e.failedLoad))return{cache:s,index:s.getBlockStartIndex(r.index)}}let i=null,s=null,r=Number.MAX_SAFE_INTEGER;for(let a of this.cacheLoadingNodesMap.keys())a.getNodesToRefresh().forEach(l=>{if(null==l.rowIndex){s=l,i=a;return}let n=a.getNodes().getBy("node",l);if(!n)return;let o=this.cacheLoadingNodesMap.get(a);if(o?.has(n.index))return;let d=Math.abs(e-l.rowIndex),h=Math.abs(l.rowIndex-t);d<r&&(s=l,r=d,i=a),h<r&&(s=l,r=h,i=a)});if(!i)return;let a=i,l=a.getNodes().getBy("node",s)?.index;return null==l?void 0:{cache:a,index:a.getBlockStartIndex(l)}}isRowLoading(e,t){return this.cacheLoadingNodesMap.get(e)?.has(t)??!1}},nG=class{constructor(...e){this.indexes=e,this.maps=new Map(this.indexes.map(e=>[e,new Map]))}getSize(){return this.maps.get(this.indexes[0]).size}getBy(e,t){return this.maps.get(e).get(t)}set(e){for(let t of this.indexes)this.maps.get(t).set(e[t],e)}delete(e){for(let t of this.indexes)this.maps.get(t).delete(e[t])}clear(){this.maps.forEach(e=>e.clear())}getIterator(e){return this.maps.get(e).values()}forEach(e){let t,i=this.getIterator(this.indexes[0]);for(;(t=i.next())&&!t.done;)e(t.value)}find(e){let t,i=this.getIterator(this.indexes[0]);for(;(t=i.next())&&!t.done;)if(e(t.value))return t.value}filter(e){let t,i=this.getIterator(this.indexes[0]),s=[];for(;(t=i.next())&&!t.done;)e(t.value)&&s.push(t.value);return s}},nO=class extends m.BeanStub{constructor(e,t,i,s){super(),this.live=!0,this.removedNodeCache=new Map,this.store=e,this.numberOfRows=t,this.isLastRowKnown=i,this.storeParams=s}wireBeans(e){this.rowRenderer=e.rowRenderer,this.blockUtils=e.ssrmBlockUtils,this.focusSvc=e.focusSvc,this.nodeManager=e.ssrmNodeManager,this.serverSideRowModel=e.rowModel,this.rowNodeSorter=e.rowNodeSorter,this.sortSvc=e.sortSvc,this.lazyBlockLoadingSvc=e.lazyBlockLoadingSvc,this.colModel=e.colModel}postConstruct(){this.lazyBlockLoadingSvc.subscribe(this),this.nodeMap=new nG("index","id","node"),this.nodeDisplayIndexMap=new Map,this.nodesToRefresh=new Set;let{blockUtils:e,gos:t,store:i}=this;this.defaultNodeIdPrefix=e.createNodeIdPrefix(i.getParentNode()),this.getRowIdFunc=(0,m._getRowIdCallback)(t),this.isMasterDetail=t.get("masterDetail")}destroy(){this.lazyBlockLoadingSvc.unsubscribe(this),this.numberOfRows=0,this.nodeMap.forEach(e=>this.blockUtils.destroyRowNode(e.node)),this.nodeMap.clear(),this.nodeDisplayIndexMap.clear(),this.nodesToRefresh.clear(),this.live=!1,super.destroy()}getRowByDisplayIndex(e){if(!this.store.isDisplayIndexInStore(e))return;let t=this.nodeDisplayIndexMap.get(e);if(t)return(t.stub||t.__needsRefreshWhenVisible)&&this.lazyBlockLoadingSvc.queueLoadCheck(),t;if(this.gos.get("groupHideOpenParents")||this.gos.get("groupAllowUnbalanced")){let t=this.nodeMap.find(t=>!!t.node.childStore?.isDisplayIndexInStore(e));if(t)return t.node.childStore?.getRowUsingDisplayIndex(e)}if(e===this.store.getDisplayIndexStart())return this.createStubNode(0,e);let i=this.nodeDisplayIndexMap.get(e-1);if(i){if(this.isMasterDetail&&i.master&&i.expanded)return i.detailNode;if(i.expanded&&i.childStore?.isDisplayIndexInStore(e))return i.childStore?.getRowUsingDisplayIndex(e);let t=this.nodeMap.getBy("node",i);return this.createStubNode(t.index+1,e)}let s=this.getSurroundingNodesByDisplayIndex(e);if(null==s){let t=this.store.getRowCount()-(this.store.getDisplayIndexEnd()-e);return this.createStubNode(t,e)}let{previousNode:r,nextNode:a}=s;if(r?.node.expanded&&r.node.childStore?.isDisplayIndexInStore(e))return r.node.childStore?.getRowUsingDisplayIndex(e);if(a){let t=a.node.rowIndex-e,i=a.index-t;return this.createStubNode(i,e)}let l=this.store.getRowCount()-(this.store.getDisplayIndexEnd()-e);return this.createStubNode(l,e)}createStubNode(e,t){let i=this.store.getRowBounds(t),s=this.createRowAtIndex(e,null,e=>{e.setRowIndex(t),e.setRowTop(i.rowTop),this.nodeDisplayIndexMap.set(t,e)});if(0===e&&this.gos.get("groupHideOpenParents")){let e=this.store.getParentNode().groupData;if(e)for(let t of Object.keys(e))sR(s,this.colModel,t,e[t])}return this.lazyBlockLoadingSvc.queueLoadCheck(),s}getRowByStoreIndex(e){return this.nodeMap.getBy("index",e)?.node}skipDisplayIndexes(e,t,i){if(0===e)return;let s=(0,m._getRowHeightAsNumber)(this.beans);t.value+=e,i.value+=e*s}setDisplayIndexes(e,t,i){this.nodeDisplayIndexMap.clear();let s={};this.nodeMap.forEach(e=>{s[e.index]=e.node});let r=-1;for(let a of Object.keys(s)){let l=s[a],n=Number(a),o=n-1-r;this.skipDisplayIndexes(o,e,t);let d=0===n;if(l.firstChild!==d&&(l.firstChild=d,l.dispatchRowEvent("firstChildChanged")),d&&this.gos.get("groupHideOpenParents")){let e=this.store.getParentNode().groupData;if(e)for(let t of Object.keys(e))sR(l,this.colModel,t,d?e[t]:void 0)}this.blockUtils.setDisplayIndex(l,e,t,i),null!=l.rowIndex&&this.nodeDisplayIndexMap.set(l.rowIndex,l),r=n}let a=this.numberOfRows-1-r;this.skipDisplayIndexes(a,e,t),this.purgeExcessRows()}getRowCount(){return this.numberOfRows}setRowCount(e,t){this.numberOfRows=e,null!=t&&(this.isLastRowKnown=t,!1===t&&(this.numberOfRows+=1)),this.fireStoreUpdatedEvent()}getNodes(){return this.nodeMap}getNodeCachedByDisplayIndex(e){return this.nodeDisplayIndexMap.get(e)??null}getNodesToRefresh(){return this.nodesToRefresh}getSurroundingNodesByDisplayIndex(e){let t,i;return(this.nodeMap.forEach(s=>{if(e>s.node.rowIndex){(null==i||i.node.rowIndex<s.node.rowIndex)&&(i=s);return}(null==t||t.node.rowIndex>s.node.rowIndex)&&(t=s)}),i||t)?{previousNode:i,nextNode:t}:null}getDisplayIndexFromStoreIndex(e){let t,i,s=this.nodeMap.getBy("index",e);if(s)return s.node.rowIndex;if(this.nodeMap.forEach(s=>{if(e>s.index){(null==i||i.index<s.index)&&(i=s);return}(null==t||t.index>s.index)&&(t=s)}),!t)return this.store.getDisplayIndexEnd()-(this.numberOfRows-e);if(!i)return this.store.getDisplayIndexStart()+e;let r=e-i.index;return(i.node.childStore?.getDisplayIndexEnd()??i.node.rowIndex)+r}createRowAtIndex(e,t,i){let s=this.nodeMap.getBy("index",e);if(s){let{node:i}=s;if(i.__needsRefreshWhenVisible=!1,this.doesNodeMatch(t,i))return this.blockUtils.updateDataIntoRowNode(i,t),this.nodesToRefresh.delete(i),i;if(null==this.getRowIdFunc&&i.hasChildren()&&i.expanded)return this.nodesToRefresh.delete(i),i;this.destroyRowAtIndex(e)}if(t&&null!=this.getRowIdFunc){let i=this.getRowId(t),s=i&&this.removedNodeCache?.get(i);if(s)return this.removedNodeCache?.delete(i),this.blockUtils.updateDataIntoRowNode(s,t),this.nodeMap.set({id:s.id,node:s,index:e}),this.nodesToRefresh.delete(s),s.__needsRefreshWhenVisible=!1,s;let r=this.nodeMap.getBy("id",i);if(r){this.nodeMap.delete(r);let{node:i,index:s}=r;return this.blockUtils.updateDataIntoRowNode(i,t),this.nodeMap.set({id:i.id,node:i,index:e}),this.nodesToRefresh.delete(i),i.__needsRefreshWhenVisible=!1,this.getBlockStartIndex(s)===this.getBlockStartIndex(e)||this.markBlockForVerify(s),i}}let r=this.blockUtils.createRowNode(this.store.getRowDetails());if(null!=t){let e=this.getPrefixedId(this.store.getIdSequence().value++);this.blockUtils.setDataIntoRowNode(r,t,e,void 0),this.blockUtils.checkOpenByDefault(r),this.nodeManager.addRowNode(r)}return this.nodeMap.set({id:r.id,node:r,index:e}),i&&i(r),r}getBlockStates(){let e={},t={};this.nodeMap.forEach(({node:i,index:s})=>{let r=this.getBlockStartIndex(s);i.stub||i.failedLoad||(e[r]=(e[r]??0)+1);let a="loaded";i.failedLoad?a="failed":this.lazyBlockLoadingSvc.isRowLoading(this,r)?a="loading":(this.nodesToRefresh.has(i)||i.stub)&&(a="needsLoading"),t[r]||(t[r]=new Set),t[r].add(a)});let i={loading:4,failed:3,needsLoading:2,loaded:1},s=this.blockUtils.createNodeIdPrefix(this.store.getParentNode()),r={};for(let a of Object.keys(t)){let l=[...t[a]].sort((e,t)=>(i[e]??0)-(i[t]??0))[0],n=Number(a)/this.getBlockSize();r[s?`${s}-${n}`:String(n)]={blockNumber:n,startRow:Number(a),endRow:Number(a)+this.getBlockSize(),pageStatus:l,loadedRowCount:e[a]??0}}return r}destroyRowAtIndex(e){let t=this.nodeMap.getBy("index",e);t&&(this.nodeMap.delete(t),this.nodeDisplayIndexMap.delete(t.node.rowIndex),this.nodesToRefresh.size>0?this.removedNodeCache.set(t.node.id,t.node):this.blockUtils.destroyRowNode(t.node),this.nodesToRefresh.delete(t.node))}getSsrmParams(){return this.store.getSsrmParams()}getPrefixedId(e){return this.defaultNodeIdPrefix?this.defaultNodeIdPrefix+"-"+e:e.toString()}markBlockForVerify(e){let[t,i]=this.getBlockBounds(e);this.nodeMap.filter(e=>e.index>=t&&e.index<i).forEach(({node:e})=>{e.__needsRefreshWhenVisible=!0})}doesNodeMatch(e,t){if(t.stub)return!1;let i=this.getRowId(e);return null===i?t.data===e:t.id===i}purgeStubsOutsideOfViewport(){let{firstRenderedRow:e,lastRenderedRow:t}=this.rowRenderer,i=this.getBlockStartIndex(e),[,s]=this.getBlockBounds(t);this.nodeMap.forEach(e=>{!this.lazyBlockLoadingSvc.isRowLoading(this,e.index)&&!e.node.failedLoad&&e.node.stub&&(e.index<i||e.index>s)&&this.destroyRowAtIndex(e.index)})}getBlocksDistanceFromRow(e,t){let i={};return e.forEach(({node:e,index:s})=>{let r,[a,l]=this.getBlockBounds(s);if(a in i)return;let n=Math.abs(e.rowIndex-t),o=this.nodeMap.getBy("index",[l-1]);o&&(r=Math.abs(o.node.rowIndex-t));let d=null==r||n<r?n:r;i[a]=d}),Object.entries(i)}purgeExcessRows(){if(this.purgeStubsOutsideOfViewport(),null==this.store.getDisplayIndexEnd()||null==this.storeParams.maxBlocksInCache)return;let{firstRenderedRow:e,lastRenderedRow:t}=this.rowRenderer,i=new Set,s=new Set;this.nodeMap.forEach(({index:r,node:a})=>{let l=this.getBlockStartIndex(r);i.add(l),a.rowIndex>=e&&a.rowIndex<=t&&s.add(l)});let r=Math.max(s.size,this.storeParams.maxBlocksInCache??0),a=i.size-r;if(a<=0)return;let l=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;s.forEach(e=>{l>e&&(l=e),n<e&&(n=e)});let o=this.nodeMap.filter(({node:e,index:t})=>{let i=this.getBlockStartIndex(t);return!(i>=l&&i<=n)&&!this.isNodeCached(e)});if(0===o.length)return;let d=this.getBlocksDistanceFromRow(o,e+(t-e)/2),h=this.getBlockSize();d.sort((e,t)=>Math.sign(t[1]-e[1]));for(let e=0;e<Math.min(a,d.length);e++){let t=Number(d[e][0]);for(let e=t;e<t+h;e++){let t=this.nodeMap.getBy("index",e);!t||this.isNodeCached(t.node)||this.destroyRowAtIndex(e)}}}isNodeFocused(e){let t=this.focusSvc.getFocusCellToUseAfterRefresh();return!!t&&null==t.rowPinned&&t.rowIndex===e.rowIndex}isNodeCached(e){let t=e.isExpandable()&&e.expanded,i=this.gos.get("groupAllowUnbalanced")&&""===e.key,s=!!this.beans.editSvc?.isRowEditing(e);return t||this.isNodeFocused(e)||i||s}extractDuplicateIds(e){if(null==this.getRowIdFunc)return[];let t=new Set,i=new Set;return e.forEach(e=>{let s=this.getRowId(e);t.has(s)?i.add(s):t.add(s)}),[...i]}onLoadSuccess(e,t,i){if(!this.live)return;let s=i.groupLevelInfo;if(this.store.setStoreInfo(s),null!=this.getRowIdFunc){let s=this.extractDuplicateIds(i.rowData);if(s.length>0){let i=s.join(", ");(0,m._warn)(205,{duplicateIdText:i}),this.onLoadFailed(e,t);return}}i.pivotResultFields&&this.serverSideRowModel.generateSecondaryColumns(i.pivotResultFields);let r=this.nodesToRefresh.size>0;if(i.rowData.forEach((t,i)=>{let s=e+i,r=this.nodeMap.getBy("index",s);if(r?.node?.stub)return void this.createRowAtIndex(s,t);if(r&&this.doesNodeMatch(t,r.node)){this.blockUtils.updateDataIntoRowNode(r.node,t),this.nodesToRefresh.delete(r.node),r.node.__needsRefreshWhenVisible=!1;return}this.createRowAtIndex(s,t)}),void 0!=i.rowCount&&-1!==i.rowCount)this.numberOfRows=i.rowCount,this.isLastRowKnown=!0;else if(t>i.rowData.length)this.numberOfRows=e+i.rowData.length,this.isLastRowKnown=!0;else if(!this.isLastRowKnown){let t=e+i.rowData.length+1;t>this.numberOfRows&&(this.numberOfRows=t)}this.isLastRowKnown&&this.nodeMap.filter(e=>e.index>=this.numberOfRows).forEach(e=>this.destroyRowAtIndex(e.index)),this.fireStoreUpdatedEvent();let a=0===this.nodesToRefresh.size;r&&a&&this.fireRefreshFinishedEvent()}fireRefreshFinishedEvent(){0===this.nodesToRefresh.size&&(this.removedNodeCache.forEach(e=>{this.blockUtils.destroyRowNode(e)}),this.removedNodeCache=new Map,this.store.fireRefreshFinishedEvent())}isStoreFullyLoaded(){let e=this.isLastRowKnown,t=this.nodeMap.getSize()===this.numberOfRows;if(!e||!t||this.nodesToRefresh.size>0)return;let i=-1;return null==this.nodeMap.find(e=>(i+=1,e.index!==i||!!e.node.__needsRefreshWhenVisible||!!e.node.stub))}isLastRowIndexKnown(){return this.isLastRowKnown}onLoadFailed(e,t){if(!this.live)return;let i=this.nodesToRefresh.size>0;for(let i=e;i<e+t&&i<this.getRowCount();i++){let{node:e}=this.nodeMap.getBy("index",i)??{};e&&this.nodesToRefresh.delete(e),e?.stub||(e&&!e.stub&&this.destroyRowAtIndex(i),e=this.createRowAtIndex(i)),e.__needsRefreshWhenVisible=!1,e.failedLoad=!0}let s=0===this.nodesToRefresh.size;i&&s&&this.fireRefreshFinishedEvent(),this.fireStoreUpdatedEvent()}markNodesForRefresh(){this.nodeMap.forEach(e=>{(!e.node.stub||e.node.failedLoad)&&this.nodesToRefresh.add(e.node)}),this.lazyBlockLoadingSvc.queueLoadCheck(),this.isLastRowKnown&&0===this.numberOfRows&&(this.numberOfRows=1,this.isLastRowKnown=!1,this.fireStoreUpdatedEvent())}isNodeInCache(e){return!!this.nodeMap.getBy("id",e)}fireStoreUpdatedEvent(){this.live&&this.store.fireStoreUpdatedEvent()}getRowId(e){if(null==this.getRowIdFunc)return null;let{level:t}=this.store.getRowDetails(),i=this.store.getParentNode().getRoute()??[];return this.getRowIdFunc({data:e,parentKeys:i.length>0?i:void 0,level:t})}getOrderedNodeMap(){let e={};return this.nodeMap.forEach(t=>e[t.index]=t),e}clearDisplayIndexes(){this.nodeDisplayIndexMap.clear()}clientSideSortRows(){let e=this.sortSvc?.getSortOptions()??[],t=e.some(e=>null!=e.sort),i=this.rowNodeSorter;if(!t||!i)return;let s=Array(this.nodeMap.getSize()),r=this.nodeMap;r.forEach(e=>s[e.index]=e.node),r.clear();let a=i.doFullSortInPlace(s,e);for(let e=0,t=a.length;e<t;++e){let t=a[e];r.set({id:t.id,node:t,index:e})}}updateRowNodes(e){let t=[];return e.forEach(e=>{let i=this.getRowId(e),s=this.nodeMap.getBy("id",i);s&&(this.blockUtils.updateDataIntoRowNode(s.node,e),t.push(s.node))}),t}insertRowNodes(e,t){let i=this.store.getRowCount()-!!this.store.getParentNode().sibling,s=null==t&&this.isLastRowKnown?i:t;if(null==s||i<s)return[];let r={};e.forEach(e=>{let t=this.getRowId(e);t&&this.isNodeInCache(t)||(r[t]=e)});let a=Object.values(r),l=a.length;if(0===l)return[];let n=this.nodeMap.filter(e=>e.index>=s);return n.forEach(e=>this.nodeMap.delete(e)),n.forEach(e=>{this.nodeMap.set({node:e.node,index:e.index+l,id:e.id})}),this.numberOfRows+=l,a.map((e,t)=>this.createRowAtIndex(s+t,e))}removeRowNodes(e,t){let i=[],s=[],r=0,a=[...e],l=this.getOrderedNodeMap(),n=-1;for(let e of Object.keys(l)){n+=1;let t=l[e],o=a.findIndex(e=>e===t.id);if(-1!==o){a.splice(o,1),this.destroyRowAtIndex(Number(e)),i.push(t.node),r+=1;continue}if(0===r)continue;let d=Number(e);n!==d&&s.push(t.node),this.nodeMap.delete(t),this.nodeMap.set({id:t.id,node:t.node,index:d-r})}return null!=t&&t>=0?(this.numberOfRows=t,this.isLastRowKnown=!0):this.numberOfRows-=r,a.length>0&&s.length>0&&(s.forEach(e=>e.__needsRefreshWhenVisible=!0),this.lazyBlockLoadingSvc.queueLoadCheck()),i}getBlockSize(){return this.storeParams.cacheBlockSize||100}getBlockStartIndex(e){return e-e%this.getBlockSize()}getBlockBounds(e){let t=this.getBlockStartIndex(e);return[t,t+this.getBlockSize()]}},nB=class extends m.BeanStub{constructor(e,t,i){super(),this.idSequence={value:0},this.ssrmParams=e,this.parentRowNode=i,this.storeParams=t,this.level=i.level+1,this.group=!!e.rowGroupCols&&this.level<e.rowGroupCols.length,this.leafGroup=!!e.rowGroupCols&&this.level===e.rowGroupCols.length-1,this.info={}}wireBeans(e){this.blockUtils=e.ssrmBlockUtils,this.storeUtils=e.ssrmStoreUtils,this.selectionSvc=e.selectionSvc,this.rowGroupColsSvc=e.rowGroupColsSvc}postConstruct(){let e=1;if(0===this.level&&(e=this.storeUtils.getServerSideInitialRowCount()??1,this.eventSvc.dispatchEventOnce({type:"rowCountReady"})),this.cache=this.createManagedBean(new nO(this,e,!1,this.storeParams)),!this.gos.get("treeData")&&this.group&&this.rowGroupColsSvc){let e=this.ssrmParams.rowGroupCols[this.level];this.groupField=e.field,this.rowGroupColumn=this.rowGroupColsSvc.columns[this.level]}}destroy(){this.displayIndexStart=void 0,this.displayIndexEnd=void 0,this.destroyBean(this.cache),super.destroy()}applyRowData(e,t,i){this.cache.onLoadSuccess(t,i,e)}applyTransaction(e){let t,i,s,r=(0,m._getRowIdCallback)(this.gos);if(!r)return(0,m._warn)(206),{status:m.ServerSideTransactionResultStatus.Cancelled};let a=this.gos.getCallback("isApplyServerSideTransaction");if(a&&!a({transaction:e,parentNode:this.parentRowNode,groupLevelInfo:this.info}))return{status:m.ServerSideTransactionResultStatus.Cancelled};let l=this.cache.isStoreFullyLoaded();if(e.update?.length&&(t=this.cache.updateRowNodes(e.update)),e.add?.length){let t=e.addIndex;null!=t&&t<0&&(t=void 0),i=this.cache.insertRowNodes(e.add,t)}if(e.remove?.length){let t=[...new Set(e.remove.map(e=>r({level:this.level,parentKeys:this.parentRowNode.getRoute()??[],data:e})))];s=this.cache.removeRowNodes(t,e.rowCount)}let n=this.gos.get("serverSideEnableClientSideSort"),o=t?.length||i?.length;return l&&n&&o&&this.cache.clientSideSortRows(),this.updateSelectionAfterTransaction(t,s),{status:m.ServerSideTransactionResultStatus.Applied,update:t,add:i,remove:s}}updateSelectionAfterTransaction(e,t){if(!this.selectionSvc)return;let i=[];for(let t of e??[])t.isSelected()&&!t.selectable&&i.push(t);for(let e of t??[])e.isSelected()&&i.push(e);i.length&&this.selectionSvc.setNodesSelected({newValue:!1,clearSelection:!1,nodes:i,source:"rowDataChanged"})}clearDisplayIndexes(){this.displayIndexStart=void 0,this.displayIndexEnd=void 0,this.cache.getNodes().forEach(e=>this.blockUtils.clearDisplayIndex(e.node)),this.parentRowNode.sibling&&this.blockUtils.clearDisplayIndex(this.parentRowNode.sibling),this.cache.clearDisplayIndexes()}getDisplayIndexStart(){return this.displayIndexStart}getDisplayIndexEnd(){return this.displayIndexEnd}getRowCount(){return this.parentRowNode.sibling?this.cache.getRowCount()+1:this.cache.getRowCount()}setRowCount(e,t){this.cache.setRowCount(e,t)}isDisplayIndexInStore(e){return 0!==this.cache.getRowCount()&&this.displayIndexStart<=e&&e<this.getDisplayIndexEnd()}setDisplayIndexes(e,t,i){this.displayIndexStart=e.value,this.topPx=t.value;let s=this.parentRowNode.level>-1&&(0,m._getGroupTotalRowCallback)(this.gos)({node:this.parentRowNode});s||aM(this.parentRowNode),"top"===s&&(aA(this.parentRowNode,this.beans),this.blockUtils.setDisplayIndex(this.parentRowNode.sibling,e,t,i)),this.cache.setDisplayIndexes(e,t,i),"bottom"===s&&(aA(this.parentRowNode,this.beans),this.blockUtils.setDisplayIndex(this.parentRowNode.sibling,e,t,i)),this.displayIndexEnd=e.value,this.heightPx=t.value-this.topPx}forEachStoreDeep(e,t={value:0}){e(this,t.value++),this.cache.getNodes().forEach(i=>{let s=i.node.childStore;s&&s.forEachStoreDeep(e,t)})}forEachNodeDeep(e,t={value:0}){this.cache.getNodes().forEach(i=>{e(i.node,t.value++);let s=i.node.childStore;s&&s.forEachNodeDeep(e,t)})}forEachNodeDeepAfterFilterAndSort(e,t={value:0},i=!1){let s=this.parentRowNode.level>-1&&(0,m._getGroupTotalRowCallback)(this.gos)({node:this.parentRowNode});for(let r of("top"===s&&e(this.parentRowNode.sibling,t.value++),Object.values(this.cache.getOrderedNodeMap()))){e(r.node,t.value++);let s=r.node.childStore;s&&s.forEachNodeDeepAfterFilterAndSort(e,t,i)}"bottom"===s&&e(this.parentRowNode.sibling,t.value++)}retryLoads(){this.cache.getNodes().forEach(({node:e})=>{e.failedLoad&&(e.failedLoad=!1,e.__needsRefreshWhenVisible=!0,e.stub=!0)}),this.forEachChildStoreShallow(e=>e.retryLoads()),this.fireStoreUpdatedEvent()}getRowUsingDisplayIndex(e){return this.parentRowNode.sibling&&e===this.parentRowNode.sibling.rowIndex?this.parentRowNode.sibling:this.cache.getRowByDisplayIndex(e)}getRowBounds(e){if(!this.isDisplayIndexInStore(e))return null;let t=this.cache.getNodeCachedByDisplayIndex(e);if(t){let i=this.blockUtils.extractRowBounds(t,e);if(i)return i}let{previousNode:i,nextNode:s}=this.cache.getSurroundingNodesByDisplayIndex(e)??{};if(i){let t=this.blockUtils.extractRowBounds(i.node,e);if(null!=t)return t}let r=(0,m._getRowHeightAsNumber)(this.beans);if(s){let t=(s.node.rowIndex-e)*r;return{rowTop:s.node.rowTop-t,rowHeight:r}}return{rowTop:this.topPx+this.heightPx-(this.getDisplayIndexEnd()-e)*r,rowHeight:r}}isPixelInRange(e){return e>=this.topPx&&e<this.topPx+this.heightPx}getRowIndexAtPixel(e){if(e<this.topPx)return this.getDisplayIndexStart();if(e>=this.topPx+this.heightPx)return this.getDisplayIndexEnd()-1;if(this.parentRowNode.sibling&&e>this.parentRowNode.sibling.rowTop&&e<this.parentRowNode.sibling.rowTop+this.parentRowNode.sibling.rowHeight)return this.parentRowNode.sibling.rowIndex;let t=Number.MAX_SAFE_INTEGER,i=null,s=Number.MAX_SAFE_INTEGER,r=null;if(this.cache.getNodes().forEach(({node:a})=>{let l=Math.abs(e-a.rowTop);if(a.rowTop<e){l<t&&(t=l,i=a);return}l<s&&(s=l,r=a)}),i){let t=this.blockUtils.getIndexAtPixel(i,e);if(null!=t)return t}let a=(0,m._getRowHeightAsNumber)(this.beans);if(r){let t=Math.ceil((r.rowTop-e)/a);return r.rowIndex-t}let l=Math.floor((this.topPx+this.heightPx-e)/a);return this.getDisplayIndexEnd()-l}getChildStore(e){return this.storeUtils.getChildStore(e,this,e=>{let t=this.cache.getNodes().find(t=>t.node.key==e);return t?t.node:null})}forEachChildStoreShallow(e){this.cache.getNodes().forEach(({node:t})=>{t.childStore&&e(t.childStore)})}refreshAfterSort(e){if(this.storeUtils.isServerSideSortAllLevels()||this.storeUtils.isServerRefreshNeeded(this.parentRowNode,this.ssrmParams.rowGroupCols,e)){let e=this.cache.isStoreFullyLoaded(),t=this.gos.get("serverSideEnableClientSideSort");if(!(e&&t)){let e=this.cache.getRowCount(),t=this.cache.isLastRowIndexKnown();this.destroyBean(this.cache),this.cache=this.createManagedBean(new nO(this,e,t,this.storeParams));return}this.cache.clientSideSortRows()}this.forEachChildStoreShallow(t=>t.refreshAfterSort(e))}refreshAfterFilter(e){!this.storeUtils.isServerSideOnlyRefreshFilteredGroups()||this.storeUtils.isServerRefreshNeeded(this.parentRowNode,this.ssrmParams.rowGroupCols,e)?this.refreshStore(!0):this.forEachChildStoreShallow(t=>t.refreshAfterFilter(e))}refreshStore(e){if(e){this.destroyBean(this.cache),this.cache=this.createManagedBean(new nO(this,1,!1,this.storeParams)),this.fireStoreUpdatedEvent();return}this.cache.markNodesForRefresh()}getTopLevelRowDisplayedIndex(e){return this.cache.getDisplayIndexFromStoreIndex(e)??e}isLastRowIndexKnown(){return this.cache.isLastRowIndexKnown()}getRowNodesInRange(e,t){return this.cache.getNodes().filter(({node:i})=>i.rowIndex>=e.rowIndex&&i.rowIndex<=t.rowIndex).map(({node:e})=>e)}addStoreStates(e){e.push({route:this.parentRowNode.getRoute()??[],rowCount:this.getRowCount(),lastRowIndexKnown:this.isLastRowIndexKnown(),info:this.info,maxBlocksInCache:this.storeParams.maxBlocksInCache,cacheBlockSize:this.storeParams.cacheBlockSize}),this.forEachChildStoreShallow(t=>t.addStoreStates(e))}getIdSequence(){return this.idSequence}getParentNode(){return this.parentRowNode}getRowDetails(){return{field:this.groupField,group:this.group,leafGroup:this.leafGroup,level:this.level,parent:this.parentRowNode,rowGroupColumn:this.rowGroupColumn}}getSsrmParams(){return this.ssrmParams}setStoreInfo(e){e&&Object.assign(this.info,e)}fireStoreUpdatedEvent(){this.eventSvc.dispatchEvent({type:"storeUpdated"})}fireRefreshFinishedEvent(){this.eventSvc.dispatchEvent({type:"storeRefreshed",route:this.parentRowNode.getRoute()})}getBlockStates(){return this.cache.getBlockStates()}getStoreBounds(){return{topPx:this.topPx,heightPx:this.heightPx}}getCache(){return this.cache}getFirstNode(){let e=this.cache.getNodes().getBy("index",0);return e?.node??null}},nV={moduleName:"ServerSideRowModel",version:tv,rowModels:["serverSide"],beans:[nM,nw,class extends m.BeanStub{constructor(){super(...arguments),this.beanName="ssrmStoreUtils"}wireBeans(e){this.colModel=e.colModel,this.serverSideRowModel=e.rowModel,this.storeFactory=e.ssrmStoreFactory}getChildStore(e,t,i){if(!e?.length)return t;let s=i(e[0]);if(s){if(1===e.length&&!s.childStore){let e=this.serverSideRowModel.getParams();s.childStore=this.createBean(this.storeFactory.createStore(e,s))}let t=e.slice(1,e.length),i=s.childStore;return i?i.getChildStore(t):null}return null}isServerRefreshNeeded(e,t,i){if(i.valueColChanged||i.secondaryColChanged)return!0;let s=e.level+1;if(!(s<t.length))return!0;let r=t[s].id;return i.changedColumns.indexOf(r)>-1||this.colModel.getCols().filter(e=>e.getColDef().showRowGroup&&i.changedColumns.includes(e.getId())).map(e=>e.getColDef().showRowGroup).some(e=>!0===e||e===r)}getServerSideInitialRowCount(){return this.gos.get("serverSideInitialRowCount")}isServerSideSortAllLevels(){return this.gos.get("serverSideSortAllLevels")&&(0,m._isServerSideRowModel)(this.gos)}isServerSideOnlyRefreshFilteredGroups(){return this.gos.get("serverSideOnlyRefreshFilteredGroups")&&(0,m._isServerSideRowModel)(this.gos)}},ny,nA,class extends m.BeanStub{constructor(){super(...arguments),this.beanName="ssrmTxnManager",this.asyncTransactions=[]}wireBeans(e){this.valueCache=e.valueCache,this.serverSideRowModel=e.rowModel,this.selectionSvc=e.selectionSvc}postConstruct(){if(!(0,m._isServerSideRowModel)(this.gos))return}applyTransactionAsync(e,t){null==this.asyncTransactionsTimeout&&this.scheduleExecuteAsync(),this.asyncTransactions.push({transaction:e,callback:t})}scheduleExecuteAsync(){let e=this.gos.get("asyncTransactionWaitMillis");this.asyncTransactionsTimeout=window.setTimeout(()=>{this.executeAsyncTransactions()},e)}executeAsyncTransactions(){if(!this.asyncTransactions)return;let e=[],t=[],i=[],s=!1;for(let r of this.asyncTransactions){let a;if(this.serverSideRowModel.executeOnStore(r.transaction.route,e=>{a=e.applyTransaction(r.transaction)})?void 0==a&&(a={status:m.ServerSideTransactionResultStatus.StoreNotFound}):a={status:m.ServerSideTransactionResultStatus.StoreNotStarted},t.push(a),a.status==m.ServerSideTransactionResultStatus.StoreLoading){i.push(r);continue}r.callback&&e.push(()=>r.callback(a)),a.status===m.ServerSideTransactionResultStatus.Applied&&(s=!0)}e.length>0&&window.setTimeout(()=>{for(let t of e)t()},0),this.asyncTransactionsTimeout=void 0,this.asyncTransactions=i,s&&(this.valueCache?.onDataChanged(),this.eventSvc.dispatchEvent({type:"storeUpdated"})),t.length>0&&this.eventSvc.dispatchEvent({type:"asyncTransactionsFlushed",results:t})}flushAsyncTransactions(){null!=this.asyncTransactionsTimeout&&clearTimeout(this.asyncTransactionsTimeout),this.executeAsyncTransactions()}applyTransaction(e){let t;if(!this.serverSideRowModel.executeOnStore(e.route,i=>{t=i.applyTransaction(e)}))return{status:m.ServerSideTransactionResultStatus.StoreNotStarted};if(!t)return{status:m.ServerSideTransactionResultStatus.StoreNotFound};if(this.valueCache?.onDataChanged(),t.remove&&this.selectionSvc){let i=t.remove.map(e=>e.id);this.selectionSvc.deleteSelectionStateFromParent(e.route||[],i)}return this.eventSvc.dispatchEvent({type:"storeUpdated"}),t}},nS,class extends m.BeanStub{constructor(){super(...arguments),this.beanName="ssrmStoreFactory"}wireBeans(e){this.colModel=e.colModel,this.rowGroupColsSvc=e.rowGroupColsSvc,this.pivotColsSvc=e.pivotColsSvc,this.rowAutoHeight=e.rowAutoHeight}createStore(e,t){let i=this.getStoreParams(e,t);return new nB(e,i,t)}getStoreParams(e,t){let i=this.getLevelSpecificParams(t),s=this.getBlockSize(i);return{cacheBlockSize:s,maxBlocksInCache:this.getMaxBlocksInCache(e,i)}}getMaxBlocksInCache(e,t){let i=t?.maxBlocksInCache!=null?t.maxBlocksInCache:this.gos.get("maxBlocksInCache");if(null!=i&&i>=0)return e.dynamicRowHeight?void(0,m._warn)(203):this.rowAutoHeight?.active?void(0,m._warn)(204):i}getBlockSize(e){let t=e?.cacheBlockSize!=null?e.cacheBlockSize:this.gos.get("cacheBlockSize");return null!=t&&t>0?t:100}getLevelSpecificParams(e){let t=this.gos.getCallback("getServerSideGroupLevelParams");if(t)return t({level:e.level+1,parentRowNode:e.level>=0?e:void 0,rowGroupColumns:this.rowGroupColsSvc?.columns??[],pivotColumns:this.pivotColsSvc?.columns??[],pivotMode:this.colModel.isPivotMode()})}},nx,nD,nN,nL,nP,nF],dependsOn:[tb,m._SortModule,m._SharedRowSelectionModule,nc,nb,{moduleName:"LoadingCellRenderer",version:tv,userComponents:{agLoadingCellRenderer:nl},icons:{groupLoading:"loading"},dependsOn:[tb]}]},n_={moduleName:"ServerSideRowModelApi",version:tv,apiFunctions:{getServerSideSelectionState:function(e){return e.selectionSvc?.getSelectionState()??null},setServerSideSelectionState:function(e,t){e.selectionSvc?.setSelectionState(t,"api")},applyServerSideTransaction:function(e,t){return e.ssrmTxnManager?.applyTransaction(t)},applyServerSideTransactionAsync:function(e,t,i){return e.ssrmTxnManager?.applyTransactionAsync(t,i)},applyServerSideRowData:function(e,t){let i=t.startRow??0,s=t.route??[];i<0?(0,m._warn)(189,{startRow:i}):(0,m._getServerSideRowModel)(e)?.applyRowData(t.successParams,i,s)},retryServerSideLoads:function(e){(0,m._getServerSideRowModel)(e)?.retryLoads()},flushServerSideAsyncTransactions:function(e){return e.ssrmTxnManager?.flushAsyncTransactions()},refreshServerSide:function(e,t){(0,m._getServerSideRowModel)(e)?.refreshStore(t)},getServerSideGroupLevelState:function(e){return(0,m._getServerSideRowModel)(e)?.getStoreState()??[]},resetRowHeights:m.resetRowHeights,onRowHeightChanged:m.onRowHeightChanged},dependsOn:[tb,m._RowModelSharedApiModule,m._CsrmSsrmSharedApiModule,m._SsrmInfiniteSharedApiModule]},nz=/\$?[A-Za-z]+\$?[0-9]+(?::\$?[A-Za-z]+\$?[0-9]+)?/g,nH=/^(\$?)([A-Za-z]+)(\$?)([0-9]+)(?::(\$?)([A-Za-z]+)(\$?)([0-9]+))?$/,nU=/[A-Za-z0-9]/,nW=e=>!!e&&nU.test(e),nK=e=>!!e&&/[A-Za-z]/.test(e),n$=(e,t,i)=>{if(nW((t>0?e[t-1]:null)??void 0))return!1;if(i.endsWith(":"))return!0;let s=t+i.length;return!nW((s<e.length?e[s]:null)??void 0)},nj=(e,t={})=>{let i=t.allowTrailingColon&&e.endsWith(":")?e.slice(0,-1):e,s=nH.exec(i);if(!s)return null;let[,r,a,l,n,o,d,h,u]=s;return{startCol:a,startRow:n,startColAbsolute:"$"===r,startRowAbsolute:"$"===l,...d&&u?{endCol:d,endRow:u,endColAbsolute:"$"===o,endRowAbsolute:"$"===h}:null}},nY=e=>{let t,i=[],s=0;for(nz.lastIndex=0;null!=(t=nz.exec(e));){let r=t[0],a=t.index??0,l=a+r.length;l<e.length&&":"===e[l]&&(r+=":"),n$(e,a,r)&&(i.push({ref:r,start:a,end:a+r.length,index:s}),s+=1)}return i},nq=new Set(["=","+","-","*","/","^",",","(",";","<",">","&"]),nZ=(e,t)=>{for(let i=t-1;i>=0;i--){let t=e[i];if(null!=t&&""!==t.trim())return t}return null},nX=(e,t)=>{let i=t??0;return{tokenClass:`ag-formula-token-color-${i+1}`,rangeClass:`ag-formula-range-color-${i+1}`,colorIndex:i}},nJ=e=>{if(!e)return null;let t=/ag-formula-range-color-(\d+)/.exec(e);if(!t)return null;let i=parseInt(t[1],10);return Number.isFinite(i)?i-1:null},nQ=(e,t)=>{let i=nj(t,{allowTrailingColon:!0});if(!i)return null;let{formula:s}=e,{startCol:r,startRow:a,endCol:l,endRow:n}=i,o=s?.getColByRef(r),d=s?.getColByRef(l??r);if(!o||!d)return null;let h=parseInt(a,10)-1,u=n?parseInt(n,10)-1:h;if(h<0||u<0)return null;let c=e.rowModel;return c?.getFormulaRow(h)&&c.getFormulaRow(u)?{rowStartIndex:h,rowEndIndex:u,columnStart:o,columnEnd:d}:null},n0=(e,t)=>{let{rangeSvc:i,formula:s}=e;if(!i||!s)return null;let r=i.getRangeStartRow(t),a=i.getRangeEndRow(t);if(!r||!a||r.rowPinned||a.rowPinned)return null;let l=Math.min(r.rowIndex,a.rowIndex)+1,n=Math.max(r.rowIndex,a.rowIndex)+1,o=t.columns?.filter(e=>!(0,m.isSpecialCol)(e)&&!!s.getColRef(e));if(!o?.length)return null;let d=[...o],h=d[0],u=d[d.length-1],c=s.getColRef(h),p=s.getColRef(u);return c&&p?c===p&&l===n?`${c}${l}`:`${c}${l}:${p}${n}`:null},n1=(e,t)=>{let i=nY(t),{formula:s}=e;if(!s)return i;let r=[],a=0;for(let t of i)nQ(e,t.ref)&&(r.push({...t,index:a}),a+=1);return r},n2=(e,t)=>n1(e,t).map(({ref:e,index:t})=>({ref:e,index:t})),n5=class extends m.BeanStub{constructor(e){super(),this.field=e,this.functionAutocompleteList=null,this.functionAutocompleteToken=null,this.functionAutocompleteEntries=null,this.functionAutocompleteSearch=null}postConstruct(){this.addManagedElementListeners(this.field.getContentElement(),{keydown:this.onContentKeyDown.bind(this),mouseup:this.updateFunctionAutocomplete.bind(this),focusin:this.updateFunctionAutocomplete.bind(this),focusout:this.closeFunctionAutocomplete.bind(this)}),this.addDestroyFunc(()=>this.closeFunctionAutocomplete())}onPlainValueUpdated(){this.closeFunctionAutocomplete()}onFormulaValueUpdated(){this.updateFunctionAutocomplete()}onContentKeyDown(e){if(this.functionAutocompleteList)switch(e.key){case m.KeyCode.ENTER:case m.KeyCode.TAB:e.preventDefault(),e.stopPropagation(),this.confirmFunctionAutocomplete();return;case m.KeyCode.ESCAPE:e.preventDefault(),e.stopPropagation(),this.closeFunctionAutocomplete();return;case m.KeyCode.UP:case m.KeyCode.DOWN:this.functionAutocompleteList.onNavigationKeyDown(e,e.key);return}switch(e.key){case m.KeyCode.LEFT:case m.KeyCode.RIGHT:case m.KeyCode.PAGE_HOME:case m.KeyCode.PAGE_END:this.scheduleFunctionAutocompleteUpdate()}}scheduleFunctionAutocompleteUpdate(){setTimeout(()=>{this.isAlive()&&this.updateFunctionAutocomplete()})}updateFunctionAutocomplete(){if(!this.isContentFocused())return void this.closeFunctionAutocomplete();let{field:e,beans:t}=this,i=e.getCurrentValue();if(!i.trimStart().startsWith("="))return void this.closeFunctionAutocomplete();let s=e.getCaretOffsetsForAutocomplete(i);if(!s||n3(t,i,s.valueOffset))return void this.closeFunctionAutocomplete();let r=n4(i,s.valueOffset,t.formula??null);if(!r)return void this.closeFunctionAutocomplete();let{prefix:a}=r;if(!a.length)return void this.closeFunctionAutocomplete();let l=this.getFunctionAutocompleteEntries();if(!l.length)return void this.closeFunctionAutocomplete();let n=a.toLocaleLowerCase();l.some(({key:e})=>e.toLocaleLowerCase().startsWith(n))?(this.functionAutocompleteToken=r,this.openFunctionAutocomplete(l),this.functionAutocompleteList&&this.functionAutocompleteSearch!==a&&(this.functionAutocompleteList.setSearch(a),this.functionAutocompleteSearch=a)):this.closeFunctionAutocomplete()}getFunctionAutocompleteEntries(){let e=this.beans.formula,t=e?.active?e.getFunctionNames?.()??[]:[];return this.functionAutocompleteEntries&&this.functionAutocompleteEntries.length===t.length||(this.functionAutocompleteEntries=t.map(e=>({key:e}))),this.functionAutocompleteEntries}openFunctionAutocomplete(e){if(this.functionAutocompleteList||!e.length)return;let t=this.beans.popupSvc;if(!t)return;let i=null,s=()=>{this.functionAutocompleteList&&i&&t.positionPopupByComponent(i)};this.functionAutocompleteList=this.createManagedBean(new tW({autocompleteEntries:e,onConfirmed:()=>this.confirmFunctionAutocomplete(),useStartsWithSearch:!0,autoSizeList:!0,maxVisibleItems:10,onListHeightChanged:s}));let r=this.functionAutocompleteList.getGui();i={ePopup:r,type:"autocomplete",eventSource:this.field.getGui(),position:"under",alignSide:this.gos.get("enableRtl")?"right":"left",keepWithinBounds:!0};let a=t.addPopup({eChild:r,anchorToElement:this.field.getGui(),positionCallback:s,ariaLabel:"Formula functions"});this.functionAutocompleteHidePopup=a.hideFunc,this.functionAutocompleteList.afterGuiAttached()}closeFunctionAutocomplete(){this.functionAutocompleteToken=null,this.functionAutocompleteSearch=null,this.functionAutocompleteList&&(this.functionAutocompleteHidePopup?.(),this.functionAutocompleteHidePopup=void 0,this.destroyBean(this.functionAutocompleteList),this.functionAutocompleteList=null)}confirmFunctionAutocomplete(){let e=this.functionAutocompleteToken,t=this.functionAutocompleteList?.getSelectedValue();if(!e||!t)return void this.closeFunctionAutocomplete();let{field:i}=this,s=i.getCurrentValue(),r=t.key,a=s.slice(0,e.start)+r+s.slice(e.end),l=e.start+r.length,n="("===a[l]?a:a.slice(0,l)+"("+a.slice(l);i.getContentElement().focus({preventScroll:!0}),i.applyFormulaValueChange({currentValue:s,nextValue:n,caret:l+1}),this.closeFunctionAutocomplete()}isContentFocused(){return(0,m._getDocument)(this.beans).activeElement===this.field.getContentElement()}},n4=(e,t,i)=>{if(t<0||t>e.length||n6(e,t))return null;let s=t;for(;s>0&&nW(e[s-1]);)s--;let r=t;for(;r<e.length&&nW(e[r]);)r++;if(s===r)return null;let a=r;if(t!==r){let s=nj(e.slice(t,r));s&&(!i||i.getColByRef(s.startCol))&&(a=t)}let l=e.slice(s,a);if(!l||!nK(l[0])||"$"===e[s-1])return null;let n=nZ(e,s);return null==n||nq.has(n)?{start:s,end:a,prefix:e.slice(s,t)}:null},n3=(e,t,i)=>{for(let s of n1(e,t))if(i>=s.start&&i<=s.end)return!0;return!1},n6=(e,t)=>{let i=!1;for(let s=0;s<t&&s<e.length;s++)if('"'===e[s]){if('"'===e[s+1]){s++;continue}i=!i}return i},n8=class extends m.BeanStub{constructor(e){super(),this.field=e,this.rangeSelectionEnabled=!1,this.trackedRangeRefs=new Map,this.trackedRanges=new Map,this.suppressRangeEvents=!1,this.ignoreNextRangeEvent=!1,this.skipNextValueUpdate=!1,this.suppressSelectionChangeHandling=!1,this.handleEditorDeactivated=()=>{this.rangeSelectionEnabled=!1,this.suppressRangeEvents=!1,this.ignoreNextRangeEvent=!1,this.skipNextValueUpdate=!1,this.clearTrackedRanges(!0)}}postConstruct(){this.addManagedEventListeners({cellSelectionChanged:this.onCellSelectionChanged.bind(this)}),this.addDestroyFunc(()=>this.disableRangeSelectionWhileEditing()),this.addDestroyFunc(()=>this.unregisterActiveEditor())}onValueUpdated(e,t){if(this.skipNextValueUpdate){this.skipNextValueUpdate=!1;return}if(this.isActiveEditor()){if(t){this.enableRangeSelectionWhileEditing()&&(this.skipNextValueUpdate=!0,this.field.setValue(e,!0)),this.syncRangesFromFormula(e);return}this.disableRangeSelectionWhileEditing()}}setEditingCellRef(e,t,i){this.editingColumn=e,this.editingRowIndex=t??void 0,this.editingCellRef=i}setEditorActive(e){e?this.registerActiveEditor():this.unregisterActiveEditor()}withSelectionChangeHandlingSuppressed(e){let t=this.suppressSelectionChangeHandling;this.suppressSelectionChangeHandling=!0;try{e()}finally{this.suppressSelectionChangeHandling=t}}deactivateForFocusLoss(){this.isActiveEditor()&&(this.handleEditorDeactivated(),this.beans.editSvc?.disableRangeSelectionWhileEditing?.(),this.unregisterActiveEditor())}registerActiveEditor(){let e=this.field.getCompId(),{formulaInputManager:t}=this.beans;if(!t||!t.registerActiveEditor(e,this.handleEditorDeactivated))return;this.rangeSelectionEnabled=!1,this.suppressRangeEvents=!1,this.ignoreNextRangeEvent=!1,this.skipNextValueUpdate=!1,this.clearTrackedRanges(!1);let i=this.field.getCurrentValue(),s=i.trimStart().startsWith("=");this.onValueUpdated(i,s)}unregisterActiveEditor(){let e=this.field.getCompId(),{formulaInputManager:t}=this.beans;t&&t.unregisterActiveEditor(e,this.handleEditorDeactivated)}isActiveEditor(){let e=this.field.getCompId(),{formulaInputManager:t}=this.beans;return!!t&&t.isActiveEditor(e)}getTrackedRefCount(e){return this.trackedRangeRefs.get(e)??0}hasTrackedRef(e){return this.getTrackedRefCount(e)>0}addTrackedRef(e){this.trackedRangeRefs.set(e,this.getTrackedRefCount(e)+1)}removeTrackedRef(e){let t=this.getTrackedRefCount(e)-1;t<=0?this.trackedRangeRefs.delete(e):this.trackedRangeRefs.set(e,t)}enableRangeSelectionWhileEditing(){return!this.rangeSelectionEnabled&&(this.rangeSelectionEnabled=!0,this.beans.editSvc?.enableRangeSelectionWhileEditing?.(),!0)}disableRangeSelectionWhileEditing(){(this.rangeSelectionEnabled||this.trackedRangeRefs.size)&&(this.rangeSelectionEnabled=!1,this.beans.editSvc?.disableRangeSelectionWhileEditing?.(),this.clearTrackedRanges(this.isActiveEditor()))}clearTrackedRanges(e=!0){e&&Array.from(this.trackedRangeRefs.keys()).forEach(e=>this.removeRangeForRef(e)),this.trackedRangeRefs.clear(),this.trackedRanges.clear()}getLiveRanges(){return this.beans.rangeSvc?.getCellRanges()??[]}withSuppressedRangeEvents(e){this.suppressRangeEvents=!0,e(),this.suppressRangeEvents=!1}setCellRangesSilently(e){let t=this.beans.rangeSvc;t&&this.withSuppressedRangeEvents(()=>t.setCellRanges(e))}getColorIndexForTokenOrRef(e,t){return this.field.getColorIndexForToken(t??null)??this.field.getColorIndexForRef(e)}normaliseRefForComparison(e){return e?(e.endsWith(":")?e.slice(0,-1):e).replace(/\$/g,"").toUpperCase():null}tagRangeColor(e,t,i){let{rangeClass:s}=nX(t,i);return e.colorClass!==s&&(((e,t,i)=>{if(!e)return;let{rangeClass:s}=nX(t,i);e.colorClass=s})(e,t,i),!0)}trackRange(e,t,i){let s=this.trackedRanges.get(e),r=void 0!==i?i:s?.tokenIndex??null;s?s.ref!==t&&(this.removeTrackedRef(s.ref),this.addTrackedRef(t)):this.addTrackedRef(t),this.trackedRanges.set(e,{ref:t,tokenIndex:r})}getUntrackedFormulaRangesByRef(){let e=new Map;for(let t of this.getLiveRanges()){if(this.trackedRanges.has(t)||null==nJ(t.colorClass))continue;let i=n0(this.beans,t);if(!i||i===this.editingCellRef)continue;let s=e.get(i);s?s.push(t):e.set(i,[t])}return e}syncRangesFromFormula(e){let t=e??this.field.getCurrentValue()??"";if(!this.rangeSelectionEnabled)return void this.clearTrackedRanges();let i=n2(this.beans,t),s=new Map;for(let e of i){let{ref:t,index:i}=e;if(t===this.editingCellRef)continue;let r=s.get(t)??[];r.push(i),s.set(t,r)}for(let e of Array.from(this.trackedRangeRefs.keys()))s.has(e)||this.removeRangeForRef(e);if(!this.beans.rangeSvc)return;let r=new Set(this.getLiveRanges());for(let[e,t]of this.trackedRanges.entries())r.has(e)||(this.trackedRanges.delete(e),this.removeTrackedRef(t.ref));let a=this.getUntrackedFormulaRangesByRef(),l=!1;for(let[e,t]of s.entries()){let i=[];for(let[t,s]of this.trackedRanges.entries())s.ref===e&&i.push(t);let s=a.get(e);for(;i.length<t.length&&s?.length;){let e=s.shift();e&&i.push(e)}for(;i.length>t.length;){let e=i.pop();e&&this.removeTrackedRange(e)}for(;i.length<t.length;){let s=t[i.length],r=this.addRangeForRef(e,!1,s);if(!r)break;i.push(r)}for(let s=0;s<i.length&&s<t.length;s++){let r=i[s],a=t[s];this.trackRange(r,e,a);let n=this.getColorIndexForTokenOrRef(e,a);this.tagRangeColor(r,e,n)&&(l=!0)}}let n=[];for(let e of a.values())e.length&&n.push(...e);if(n.length){let e=this.getLiveRanges(),t=e.filter(e=>!n.includes(e));t.length!==e.length&&(this.setCellRangesSilently(t),l=!0)}l&&this.refreshRangeStyling()}onCellSelectionChanged(e){var t;let i,s;if(!this.isActiveEditor()||!this.rangeSelectionEnabled||!this.beans.editSvc?.isRangeSelectionEnabledWhileEditing?.())return;if(this.ignoreNextRangeEvent){this.ignoreNextRangeEvent=!1;return}if(this.suppressSelectionChangeHandling)return;let{finished:r,started:a}=e,l=this.getLiveRanges(),n=l.filter(e=>!this.isSpecialOnlyRange(e));if(n.length!==l.length){this.setCellRangesSilently(n),this.refocusEditingCell();return}let o=l.length?(0,m._last)(l):null,d=o?n0(this.beans,o):null,h=!!o&&!this.trackedRanges.has(o)&&!!d&&d!==this.editingCellRef,u=this.ensureTrackedRangeColors();if(this.suppressRangeEvents){u&&this.refreshRangeStyling();return}if((a||h)&&this.field.rememberCaret(),!h&&this.handleRemovedRangeTokens()){this.field.restoreCaretAfterToken(),this.refocusEditingCell();return}if(this.updateTrackedRangeTokens())return;let c=(t=this.beans,i=t.rangeSvc?.getCellRanges(),(s=i?.length?i[i.length-1]:null)?n0(t,s):null);if(!c||c===this.editingCellRef)return void this.refocusEditingCell();if(r&&(a||h)){let{action:e,previousRef:t,tokenIndex:i}=this.field.applyRangeInsert(c);if("none"===e){this.keepLatestSelectionOnly(o),this.beans.editSvc?.stopEditing(void 0,{source:"edit"});return}if("replace"===e&&t===c){this.discardLatestRangeForRef(c),this.field.restoreCaretAfterToken(),this.refocusEditingCell();return}this.tagLatestRangeForRef(c,i),this.handleRangeTokenUpdate(t,c,!0,"insert"===e,i),this.syncRangesFromFormula(this.field.getCurrentValue()),this.field.restoreCaretAfterToken(),this.refocusEditingCell();return}if(!a&&!r){let{previousRef:e,tokenIndex:t}=this.field.insertOrReplaceToken(c,!1);this.tagLatestRangeForRef(c,t),this.handleRangeTokenUpdate(e,c,!1,!1),this.refocusEditingCell();return}this.tagLatestRangeForRef(c),r&&(this.field.restoreCaretAfterToken(),this.refocusEditingCell())}keepLatestSelectionOnly(e){e&&!(this.getLiveRanges().length<=1)&&this.setCellRangesSilently([e])}isSpecialOnlyRange(e){let t=e.columns;return!!t?.length&&t.every(e=>(0,m.isSpecialCol)(e))}handleRangeTokenUpdate(e,t,i,s,r){if(i){!s&&e&&e!==t&&this.removeRangeForRef(e,r),this.addRangeForRef(t,!0,r);return}s||!e?this.addTrackedRef(t):e!==t&&(this.removeTrackedRef(e),this.addTrackedRef(t))}addRangeForRef(e,t,i){let s,r=this.beans.rangeSvc;if(r){if(t)s=this.findLatestRangeForRef(e,!0)??this.findLatestRangeForRef(e,!1);else{let t=nQ(this.beans,e);if(!t)return;this.withSuppressedRangeEvents(()=>{s=r.addCellRange(t)})}if(s){let t=this.getColorIndexForTokenOrRef(e,i);this.tagRangeColor(s,e,t),this.trackRange(s,e,i),this.refreshRangeStyling()}return s}}findLatestRangeForRef(e,t){let i=this.getLiveRanges();for(let s=i.length-1;s>=0;s--){let r=i[s];if(n0(this.beans,r)===e&&!(t&&this.trackedRanges.has(r)))return r}}tagLatestRangeForRef(e,t){let{trackedRanges:i}=this,s=this.getLiveRanges(),r=s.length?(0,m._last)(s):null;if(!r)return;let a=i.get(r)?.tokenIndex??null,l=this.getColorIndexForTokenOrRef(e,t??a);this.tagRangeColor(r,e,l),this.refreshRangeStyling()}discardLatestRangeForRef(e){let t=this.getLiveRanges();if(!t.length)return;let i=(0,m._last)(t);if(n0(this.beans,i)===e){if(this.trackedRanges.has(i))return void this.removeTrackedRange(i);this.setCellRangesSilently(t.slice(0,-1))}}ensureTrackedRangeColors(){let e=this.getLiveRanges();if(!e.length)return!1;let t=!1;for(let i of e){let e=this.trackedRanges.get(i),s=e?.ref??n0(this.beans,i);if(!s||!this.hasTrackedRef(s))continue;let r=e?.tokenIndex??null,a=this.field.getColorIndexForToken(r),l=nJ(i.colorClass),n=a??(this.field.hasColorForRef(s)?this.field.getColorIndexForRef(s):this.field.moveColorToRef(void 0,s,l??void 0));null!=n&&(this.tagRangeColor(i,s,n)&&(t=!0),this.trackedRanges.has(i)||this.trackRange(i,s,r))}return t}handleRemovedRangeTokens(){if(!this.beans.rangeSvc||0===this.trackedRanges.size)return!1;let e=this.field.getCurrentValue(),t=n2(this.beans,e).filter(({ref:e})=>e!==this.editingCellRef);if(!t.length)return!1;let i=this.getLiveRanges(),s=new Set(i),r=new Map;for(let e of i){let t=n0(this.beans,e);t&&t!==this.editingCellRef&&r.set(t,(r.get(t)??0)+1)}let a=new Map;for(let e of t){let{ref:t}=e;a.set(t,(a.get(t)??0)+1)}for(let[e,t]of Array.from(a.entries())){let i=t-(r.get(e)??0);i>0?a.set(e,i):a.delete(e)}if(!a.size)return!1;let l=[];for(let[e,t]of Array.from(this.trackedRanges.entries())){if(s.has(e))continue;let{ref:i}=t,r=a.get(i)??0;r<=0||(a.set(i,r-1),l.push({range:e,tracked:t}))}if(!l.length)return!1;l.sort((e,t)=>(t.tracked.tokenIndex??-1)-(e.tracked.tokenIndex??-1));let n=!1;for(let{range:e,tracked:t}of l){let{ref:i,tokenIndex:s}=t;n=this.field.removeTokenRef(i,s??null)||n,this.trackedRanges.delete(e),this.removeTrackedRef(i)}return n&&this.syncRangesFromFormula(this.field.getCurrentValue()),n}refreshRangeStyling(){let{eventSvc:e}=this.beans;e&&(this.ensureTrackedRangeColors(),this.ignoreNextRangeEvent=!0,e.dispatchEvent({type:"cellSelectionChanged",started:!1,finished:!1}))}refocusEditingCell(){let{focusSvc:e}=this.beans,{editingColumn:t,editingRowIndex:i}=this;e&&null!=t&&null!=i&&e.setFocusedCell({column:t,rowIndex:i,rowPinned:null,preventScrollOnBrowserFocus:!0})}removeTrackedRange(e){let t=this.trackedRanges.get(e);if(!t)return;let i=this.getLiveRanges(),s=i.filter(t=>t!==e);s.length!==i.length&&this.setCellRangesSilently(s),this.trackedRanges.delete(e),this.removeTrackedRef(t.ref)}removeRangeForRef(e,t){if(e&&this.hasTrackedRef(e)){if(null!=t){let i=!1;for(let[s,r]of Array.from(this.trackedRanges.entries())){let{ref:a,tokenIndex:l}=r;if(a===e&&l===t){this.removeTrackedRange(s),i=!0;break}}if(!i){for(let[t,i]of Array.from(this.trackedRanges.entries()))if(i.ref===e){this.removeTrackedRange(t);break}}return}for(let[t,i]of Array.from(this.trackedRanges.entries()))i.ref===e&&this.removeTrackedRange(t)}}updateTrackedRangeTokens(){if(!this.beans.rangeSvc)return!1;let e=this.getLiveRanges(),t=this.normaliseRefForComparison(this.editingCellRef),i=!1;for(let s of e){let e=this.trackedRanges.get(s);if(!e)continue;let{ref:r,tokenIndex:a}=e,l=n0(this.beans,s),n=this.normaliseRefForComparison(r),o=this.normaliseRefForComparison(l);if(!l||!o||o===n||o===t)continue;let{colorClass:d}=s,h=this.field.getColorIndexForToken(a??null)??this.field.moveColorToRef(r,l,nJ(d)??void 0),u=this.field.replaceTokenRef(r,l,h,a);null!=u&&(this.tagRangeColor(s,l,h),this.trackRange(s,l,u??a??null),i=!0)}return i&&this.refreshRangeStyling(),i}},n7={"/":"","*":""},n9={"":"/","":"*"},oe=class extends m.AgContentEditableField{constructor(){super({renderValueToElement:!1,className:"ag-formula-input-field"}),this.currentValue="",this.selectionCaretOffset=null,this.lastTokenValueOffset=null,this.lastTokenValueLength=null,this.lastTokenCaretOffset=null,this.focusFromMouseTime=null,this.suppressNextFocusCaretPlacement=!1,this.formulaColorByRef=new Map,this.registerCSS(".ag-formula-token{line-height:var(--ag-line-height,1.6)}.ag-formula-token-color-1{color:var(--ag-formula-token-1-color)}.ag-formula-token-color-2{color:var(--ag-formula-token-2-color)}.ag-formula-token-color-3{color:var(--ag-formula-token-3-color)}.ag-formula-token-color-4{color:var(--ag-formula-token-4-color)}.ag-formula-token-color-5{color:var(--ag-formula-token-5-color)}.ag-formula-token-color-6{color:var(--ag-formula-token-6-color)}.ag-formula-token-color-7{color:var(--ag-formula-token-7-color)}.ag-formula-range-color-1{--ag-range-selection-border-color:var(--ag-formula-token-1-color);--ag-range-selection-background-color:var(--ag-formula-token-1-background-color)}.ag-formula-range-color-2{--ag-range-selection-border-color:var(--ag-formula-token-2-color);--ag-range-selection-background-color:var(--ag-formula-token-2-background-color)}.ag-formula-range-color-3{--ag-range-selection-border-color:var(--ag-formula-token-3-color);--ag-range-selection-background-color:var(--ag-formula-token-3-background-color)}.ag-formula-range-color-4{--ag-range-selection-border-color:var(--ag-formula-token-4-color);--ag-range-selection-background-color:var(--ag-formula-token-4-background-color)}.ag-formula-range-color-5{--ag-range-selection-border-color:var(--ag-formula-token-5-color);--ag-range-selection-background-color:var(--ag-formula-token-5-background-color)}.ag-formula-range-color-6{--ag-range-selection-border-color:var(--ag-formula-token-6-color);--ag-range-selection-background-color:var(--ag-formula-token-6-background-color)}.ag-formula-range-color-7{--ag-range-selection-border-color:var(--ag-formula-token-7-color);--ag-range-selection-background-color:var(--ag-formula-token-7-background-color)}.ag-fill-handle.ag-formula-range-color-1,.ag-range-handle.ag-formula-range-color-1{background-color:var(--ag-formula-token-1-color)}.ag-fill-handle.ag-formula-range-color-2,.ag-range-handle.ag-formula-range-color-2{background-color:var(--ag-formula-token-2-color)}.ag-fill-handle.ag-formula-range-color-3,.ag-range-handle.ag-formula-range-color-3{background-color:var(--ag-formula-token-3-color)}.ag-fill-handle.ag-formula-range-color-4,.ag-range-handle.ag-formula-range-color-4{background-color:var(--ag-formula-token-4-color)}.ag-fill-handle.ag-formula-range-color-5,.ag-range-handle.ag-formula-range-color-5{background-color:var(--ag-formula-token-5-color)}.ag-fill-handle.ag-formula-range-color-6,.ag-range-handle.ag-formula-range-color-6{background-color:var(--ag-formula-token-6-color)}"),this.registerCSS(tV)}postConstruct(){super.postConstruct(),this.rangeSyncFeature=this.createManagedBean(new n8(this)),this.autocompleteFeature=this.createManagedBean(new n5(this)),this.addManagedElementListeners(this.getContentElement(),{input:this.onContentInput.bind(this),focus:this.onContentFocus.bind(this),blur:this.onContentBlur.bind(this),mousedown:this.onContentMouseDown.bind(this)})}setValue(e,t){let i=null==e?"":String(e),{isFormula:s,hasFormulaPrefix:r}=this.getFormulaState(i);return s?this.applyFormulaValue(i,{currentValue:this.getCurrentValue(),silent:t}):this.applyPlainValue(i,{silent:t,dispatch:!0}),this.rangeSyncFeature?.onValueUpdated(i,r),this}getCurrentValue(){let e=od(this.getContentElement());return e!==this.currentValue&&this.setEditorValue(e,!0),this.currentValue}setEditingCellRef(e,t){let i=e?this.beans.formula?.getColRef(e):void 0,s=i&&null!=t&&void 0!==t?`${i}${t+1}`:void 0;s?this.rangeSyncFeature?.setEditingCellRef(e,t,s):this.rangeSyncFeature?.setEditingCellRef(void 0,void 0,void 0)}rememberCaret(){let e=og(this.beans,this.getContentElement(),this.getCurrentValue());this.selectionCaretOffset=e??this.currentValue.length}setEditorValue(e,t=!1){return this.currentValue=e,super.setValue(e,t),this}renderFormula(e){on({beans:this.beans,contentElement:this.getContentElement(),getColorIndexForToken:this.getColorIndexForToken.bind(this),...e})}renderPlainValue(e,t){let i=this.getContentElement(),s=t??og(this.beans,i,this.currentValue);i.textContent=e??"";let r=null!=s?Math.min(s,e.length):null;op(this.beans,i,r)}withSelectionChangeHandlingSuppressed(e){this.rangeSyncFeature?this.rangeSyncFeature.withSelectionChangeHandlingSuppressed(e):e()}getColorIndexForRef(e){if(!ot(this.beans))return null;let t=this.formulaColorByRef.get(e);if(null!=t)return t;let i=this.formulaColorByRef.size%7;return this.formulaColorByRef.set(e,i),i}getColorIndexForToken(e){return ot(this.beans)&&null!=e?e%7:null}hasColorForRef(e){return this.formulaColorByRef.has(e)}moveColorToRef(e,t,i){let s=e&&this.formulaColorByRef.has(e)?this.getColorIndexForRef(e):i??this.formulaColorByRef.get(t)??this.getColorIndexForRef(t);return(e&&e!==t&&this.formulaColorByRef.delete(e),null==s)?null:(this.formulaColorByRef.set(t,s),s)}updateFormulaColorsFromValue(e){if(e=null==e?"":String(e),!ot(this.beans))return void this.formulaColorByRef.clear();let t=oi(this.beans,e),i=t.length!==this.formulaColorByRef.size,s=new Map;t.forEach((e,t)=>{let r=t%7;s.set(e,r),this.formulaColorByRef.get(e)!==r&&(i=!0)}),i&&(this.formulaColorByRef.clear(),s.forEach((e,t)=>this.formulaColorByRef.set(t,e)))}onContentInput(){let e=this.getContentElement(),t=this.getCurrentValue(),i=og(this.beans,e,t),s=od(e),{isFormula:r,hasFormulaPrefix:a}=this.getFormulaState(s);if(!r){this.applyPlainValue(s,{caret:i,dispatch:!0}),this.rangeSyncFeature?.onValueUpdated(s,a);return}this.applyFormulaValue(s,{currentValue:t,caret:i??void 0,dispatch:!0}),this.rangeSyncFeature?.onValueUpdated(s,a)}onContentFocus(){if(this.rangeSyncFeature?.setEditorActive(!0),this.suppressNextFocusCaretPlacement){this.suppressNextFocusCaretPlacement=!1;return}let{focusFromMouseTime:e}=this;this.focusFromMouseTime=null,null==e&&(0,m._placeCaretAtEnd)(this.beans,this.getContentElement())}onContentBlur(e){this.focusFromMouseTime=null;let t=e.relatedTarget,i=t?.closest(".ag-cell-editor"),s=t?.closest(".ag-cell");!(!t||this.getGui().contains(t))&&i&&s&&this.rangeSyncFeature?.deactivateForFocusLoss()}onContentMouseDown(){this.focusFromMouseTime=Date.now()}insertOrReplaceToken(e,t){let i,s=this.getTokenInsertOffsets(t);if(!s)return{};let{caretOffset:r,valueOffset:a}=s,l=t||null==this.lastTokenValueLength?0:this.lastTokenValueLength,n=this.getCurrentValue(),o=n.slice(0,a)+e+n.slice(a+l),d=os(this.beans,o,a)?.index??null;return this.applyFormulaValueChange({currentValue:n,nextValue:o,caret:r+e.length,updateTracking:()=>{i=this.updateLastTokenTracking(e,r,a)}}),{previousRef:i,tokenIndex:d}}removeTokenRef(e,t){let i,s=this.getCurrentValue(),r=n1(this.beans,s);if(null!=t&&(i=r.find(e=>e.index===t))&&i.ref!==e&&(i=void 0),i||(i=r.find(t=>t.ref===e)),!i)return!1;let a=s.slice(0,i.start)+s.slice(i.end),l=Math.min(this.selectionCaretOffset??i.start,a.length);return this.applyFormulaValueChange({currentValue:s,nextValue:a,caret:l,updateTracking:()=>{this.lastTokenValueOffset=null,this.lastTokenValueLength=null,this.lastTokenCaretOffset=l,this.lastTokenRef=void 0}}),!0}applyRangeInsert(e){let t=this.getCurrentValue(),i=this.getCaretOffsets(t);if(!i){let{previousRef:t,tokenIndex:i}=this.insertOrReplaceToken(e,!0);return{action:"insert",previousRef:t,tokenIndex:i}}let{valueOffset:s}=i,r=os(this.beans,t,s);if(r){let{end:t,ref:i}=r;if(i.endsWith(":")&&s===t){let{previousRef:t,tokenIndex:i}=this.insertOrReplaceToken(e,!0);return{action:"insert",previousRef:t,tokenIndex:i}}let{previousRef:a,tokenIndex:l}=this.replaceTokenAtMatch(r,e);return{action:"replace",previousRef:a,tokenIndex:l}}let a=or(t,s);if(a){let i=t.slice(0,a.start)+e+t.slice(a.end),s=os(this.beans,i,a.start)?.index??null,{previousRef:r}=this.replaceTokenAtMatch(a,e,s);return{action:"replace",previousRef:r,tokenIndex:s}}if(!oa(t,s))return{action:"none"};let{previousRef:l,tokenIndex:n}=this.insertOrReplaceToken(e,!0);return{action:"insert",previousRef:l,tokenIndex:n}}restoreCaretAfterToken(){let e=(this.lastTokenCaretOffset??og(this.beans,this.getContentElement(),this.getCurrentValue())??this.currentValue.length)+(this.lastTokenValueLength??0);this.selectionCaretOffset=null,this.suppressNextFocusCaretPlacement=!0,setTimeout(()=>{this.isAlive()&&(this.getContentElement().focus({preventScroll:!0}),(0,m._getDocument)(this.beans).activeElement===this.getContentElement()&&(this.suppressNextFocusCaretPlacement=!1),op(this.beans,this.getContentElement(),e))})}replaceTokenAtMatch(e,t,i){let s=this.getCurrentValue(),r=s.slice(0,e.start)+t+s.slice(e.end);return this.applyFormulaValueChange({currentValue:s,nextValue:r,caret:e.start+t.length,updateTracking:()=>{this.updateLastTokenTracking(t,e.start,e.start)}}),{previousRef:e.ref,tokenIndex:i??e.index}}getValueOffsetFromCaret(e){let t=this.getContentElement(),i=e,s=0;for(let e of Array.from(t.childNodes)){let t=ou(e),r=oh(e).length;if(i<=t)return s+(t===r?i:0);i-=t,s+=r}return this.currentValue.length}getTokenInsertOffsets(e){return this.getCaretOffsets(this.getCurrentValue(),{useCachedCaret:!0,useCachedValueOffset:!e})}getCaretOffsetsForAutocomplete(e){return this.getCaretOffsets(e)}getCaretOffsets(e,t={useCachedCaret:!1,useCachedValueOffset:!1}){let{beans:i}=this,{useCachedCaret:s,useCachedValueOffset:r}=t,a=this.getContentElement(),l=s?this.selectionCaretOffset??og(i,a,e)??this.currentValue.length:og(i,a,e);if(null==l)return null;let n=r&&null!=this.lastTokenValueOffset?this.lastTokenValueOffset:this.getValueOffsetFromCaret(l);return null==n?null:{caretOffset:l,valueOffset:n}}updateLastTokenTracking(e,t,i){let s=this.lastTokenRef;return this.lastTokenValueOffset=i,this.lastTokenValueLength=e.length,this.lastTokenCaretOffset=t,this.lastTokenRef=e,s}getFormulaState(e){let t=e.trimStart().startsWith("=");return{isFormula:this.beans.formula?.isFormula(e)??t,hasFormulaPrefix:t}}dispatchValueChanged(){this.dispatchLocalEvent({type:"fieldValueChanged"})}applyPlainValue(e,t){this.formulaColorByRef.clear(),this.renderPlainValue(e,t.caret),this.setEditorValue(e,t.silent),t.dispatch&&this.dispatchValueChanged(),this.autocompleteFeature?.onPlainValueUpdated()}applyFormulaValue(e,t){this.updateFormulaColorsFromValue(e),this.renderFormula({value:e,currentValue:t.currentValue??this.getCurrentValue(),caret:t.caret??void 0}),this.setEditorValue(e,t.silent),t.dispatch&&this.dispatchValueChanged(),this.autocompleteFeature?.onFormulaValueUpdated()}applyFormulaValueChange(e){let{currentValue:t,nextValue:i,caret:s}=e;this.updateFormulaColorsFromValue(i),e.updateTracking?.(),this.setEditorValue(i),this.renderFormula({currentValue:t,value:i,caret:s}),this.dispatchValueChanged(),this.autocompleteFeature?.onFormulaValueUpdated()}replaceTokenRef(e,t,i,s){let r,a=this.getContentElement();if(null!=s&&(r=a.querySelector(`.ag-formula-token[data-formula-token-index="${s}"]`)??void 0)&&om(r)!==e&&(r=void 0),r||(r=Array.from(a.querySelectorAll(".ag-formula-token")).find(t=>om(t)===e)),!r)return null;let l=oo(a,r),n=oo(a,r,!0);if(null==l||null==n)return null;let o=this.getCurrentValue();null!=i&&this.formulaColorByRef.set(t,i);let d=o.slice(0,n)+t+o.slice(n+e.length),h=of(r);return this.applyFormulaValueChange({currentValue:o,nextValue:d,caret:l+t.length,updateTracking:()=>{this.updateLastTokenTracking(t,l,n)}}),h??s??null}},ot=e=>{let{gos:t,rangeSvc:i}=e;return!!i&&!!t.get("cellSelection")},oi=(e,t)=>{let i=[],s=new Set;for(let r of n1(e,t)){let e=r.ref;s.has(e)||(s.add(e),i.push(e))}return i},os=(e,t,i)=>{for(let s of n1(e,t))if(i>=s.start&&i<=s.end)return{ref:s.ref,start:s.start,end:s.end,index:s.index};return null},or=(e,t)=>{for(let i of nY(e))if(t>=i.start&&t<=i.end)return{ref:i.ref,start:i.start,end:i.end,index:i.index};return null},oa=(e,t)=>{let i=nZ(e,t);return null==i||nq.has(i)},ol=(e,t,i,s)=>{let r,a={"aria-label":e,"data-formula-ref":e,"data-formula-token-index":s.toString()};if(i&&null!=t){let i=nX(e,t);r=i.tokenClass,a["data-formula-range-class"]=i.rangeClass}let l=(0,m._createElement)({tag:"span",cls:"ag-formula-token",attrs:a,children:e});return r&&l.classList.add(r),l},on=e=>{let{beans:t,contentElement:i,currentValue:s,value:r,getColorIndexForToken:a,caret:l}=e,n=l??og(t,i,s),o=r.length;for(let e of(i.textContent="",((e,t,i)=>{let s=[],r=0,a=n1(e,t),l=(0,m._getDocument)(e);for(let e of a){e.start>r&&s.push(l.createTextNode(oC(t.slice(r,e.start))));let a=i(e.index);s.push(ol(e.ref,a,null!=a,e.index)),r=e.end}return r<t.length&&s.push(l.createTextNode(oC(t.slice(r)))),s.length||s.push(l.createTextNode("")),s})(t,r,a)))i.append(e);op(t,i,null!=n?Math.min(n,o):null)},oo=(e,t,i=!1)=>{if(!e.contains(t))return null;let s=0;for(let r of Array.from(e.childNodes)){if(r===t)return s;s+=i?oh(r).length:ou(r)}return null},od=e=>{let t="";return e.childNodes.forEach(e=>{t+=oh(e)}),t},oh=e=>e.nodeType===Node.TEXT_NODE?ov(e.textContent??""):e.nodeType===Node.ELEMENT_NODE?Array.from(e.childNodes).map(e=>oh(e)).join(""):"",ou=e=>e.nodeType===Node.TEXT_NODE?e.textContent?.length??0:e.nodeType===Node.ELEMENT_NODE?Array.from(e.childNodes).reduce((e,t)=>e+ou(t),0):0,oc=(e,t)=>{let i=t;for(let t=0;t<e.childNodes.length;t++){let s=e.childNodes[t],r=ou(s);if(i>r){i-=r;continue}if(s.nodeType===Node.TEXT_NODE)return{node:s,localOffset:i};return oc(s,i)}return{node:e,localOffset:e.childNodes.length}},op=(e,t,i)=>{if(null==i)return;let s=(0,m._getWindow)(e),r=(0,m._getDocument)(e),a=s.getSelection(),l=r.createRange(),{node:n,localOffset:o}=oc(t,i);if(n&&a&&t.isConnected&&n.isConnected){l.setStart(n,o),l.collapse(!0),a.removeAllRanges();try{a.addRange(l)}catch{}}},og=(e,t,i)=>{let s=(0,m._getWindow)(e).getSelection();if(!s||0===s.rangeCount)return i?.length??null;let r=s.getRangeAt(0);if(!t.contains(r.startContainer))return i?.length??null;if(r.startContainer===t){let e=0;for(let i=0;i<r.startOffset;i++)e+=ou(t.childNodes[i]);return e}let a=r.startOffset,l=r.startContainer;for(;l&&l!==t;){let e=l.previousSibling;for(;e;)a+=ou(e),e=e.previousSibling;l=l.parentNode}return a},om=e=>ov(e.textContent??e.dataset.formulaRef??""),of=e=>{let t=e.dataset.formulaTokenIndex;if(!t)return null;let i=parseInt(t,10);return Number.isFinite(i)?i:null},oC=e=>e.replace(/[/*]/g,e=>n7[e]??e),ov=e=>e.replace(/[]/g,e=>n9[e]??e),ob={1:["invalidFormulaValidation","Invalid formula."],2:["formulaParseInvalidCellReference","Invalid cell reference: ${variable}."],3:["formulaParseInvalidRangeEndReference","Invalid range end reference."],4:["formulaParseUnterminatedString","Unterminated string."],5:["formulaParseUnexpectedCharacter","Unexpected character: ${variable}."],6:["formulaParseOperatorStackUnderflow","Operator stack underflow."],7:["formulaParseMissingOperand","Missing operand for '${variable}'."],8:["formulaParseInternalUnexpectedFrameDuringReduction","Internal error: unexpected frame during reduction."],9:["formulaParseInternalUnexpectedFrameBeforeOpenParen","Internal error: unexpected frame before '('."],10:["formulaParseMisplacedComma","Misplaced comma."],11:["formulaParseCommaOutsideFunctionCall","Comma outside of a function call."],12:["formulaParseInternalUnexpectedFrameBeforeCloseParen","Internal error: unexpected frame before ')'."],13:["formulaParseMismatchedParentheses","Mismatched parentheses."],14:["formulaParseUnsupportedOperand","Unsupported operand: ${variable}."],15:["formulaParseMismatchedParenthesesOrUnfinishedFunctionCall","Mismatched parentheses or unfinished function call."],16:["formulaParseInvalidExpression","Invalid expression."],17:["formulaParseFormulasMustBeginWithEquals","Formulas must begin with =."],18:["formulaSerializeStringContainsQuote",'String contains a quote (") which the tokenizer does not support.',"#PARSE!"],19:["formulaSerializeCannotProduceAbsoluteColumnLabelFromId","Cannot produce absolute COLUMN label from id '${variable}'."],20:["formulaSerializeCannotProduceAbsoluteRowIndexFromId","Cannot produce absolute ROW index from id '${variable}'."],21:["formulaSerializeCannotProduceRowIndexFromId","Cannot produce ROW index from id '${variable}'."],22:["formulaSerializeCannotMapColumnIdToA1Label","Cannot map column id '${variable}' to A1 label."],23:["formulaSerializeCannotParseAbsoluteRowIndex","Cannot parse absolute row index '${variable}'."],24:["formulaSerializeCannotMapRowIdToA1Index","Cannot map row id '${variable}' to A1 index."],25:["formulaEvalRangeNotAllowedInScalarContext","Range is not allowed in scalar context."],26:["formulaEvalUnknownReferenceToCell","Unknown reference to cell.","#REF!"],27:["formulaEvalUnsupportedOperation","Unsupported operation ${variable}.","#NAME?"],28:["formulaEvalInvalidAbsoluteRow","Invalid absolute row.","#REF!"],29:["formulaEvalUnrecognisedRowId","Unrecognised row id.","#REF!"],30:["formulaEvalInvalidAbsoluteColumn","Invalid absolute column.","#REF!"],31:["formulaEvalUnrecognisedColumnId","Unrecognised column id.","#REF!"],32:["formulaEvalUnrecognisedRowInRange","Unrecognised row in range.","#REF!"],33:["formulaEvalUnrecognisedReferenceToCell","Unrecognised reference to cell.","#REF!"],34:["formulaEvalIncompleteRangeReference","Incomplete range reference.","#REF!"],35:["formulaFunctionExpectedExactlyArguments","${variable}: expected exactly ${variable} arguments."],36:["formulaFunctionExpectedAtMostArguments","${variable}: expected at most ${variable} arguments."],37:["formulaFunctionExpectedAtLeastArguments","${variable}: expected at least ${variable} arguments."],38:["formulaFunctionInvalidCriteriaWildcardsWithComparator","Invalid criteria: wildcards with comparator.","#VALUE!"],39:["formulaFunctionNonNumericArgument","${variable}: non-numeric argument.","#VALUE!"],40:["formulaFunctionDivisionByZero","${variable}: division by zero.","#DIV/0!"],41:["formulaFunctionCannotCombineDatesWithBigInt","${variable}: cannot combine dates with BigInt.","#VALUE!"],42:["formulaFunctionRequiresAtLeastOneNumericValue","${variable}: requires at least one numeric value.","#PARSE!"],43:["formulaFunctionRequiresAtLeastOneValue","${variable}: requires at least one value."],44:["formulaFunctionAllValuesMustBeNumbers","${variable}: all values must be numbers.","#VALUE!"],45:["formulaFunctionArgumentMustBeRange","${variable}: ${variable} argument must be a range.","#VALUE!"],46:["formulaFunctionArgumentMustBeValue","${variable}: ${variable} argument must be a value.","#VALUE!"],47:["formulaFunctionRangesHaveDifferentSizes","${variable}: ranges have different sizes.","#VALUE!"],48:["formulaFunctionValuesMustBeNumeric","${variable}: values must be numeric.","#VALUE!"],49:["formulaFunctionValuesMustBeIntegers","${variable}: values must be integers.","#VALUE!"],50:["formulaFunctionUnsupportedValueType","${variable}: unsupported value type.","#VALUE!"],51:["formulaServiceCircularReference","Circular reference.","#CIRCREF!"],52:["formulaServiceExpectedParsableFormula","Expected parsable formula.","#PARSE!"],53:["formulaServiceInternalSchedulingError","Internal scheduling error."],54:["formulaFunctionDivNonNumericArgument","DIV: non-numeric argument.","#VALUE!"],55:["formulaFunctionDivDivisionByZero","DIV: division by zero.","#DIV/0!"],56:["formulaFunctionSumCannotCombineDatesWithBigInt","SUM: cannot combine dates with BigInt.","#VALUE!"],57:["formulaFunctionSumRequiresAtLeastOneNumericValue","SUM: requires at least one numeric value.","#PARSE!"],58:["formulaFunctionAvgRequiresAtLeastOneValue","AVG: requires at least one value."],59:["formulaFunctionMedianAllValuesMustBeNumbers","MEDIAN: all values must be numbers.","#VALUE!"],60:["formulaFunctionMedianRequiresAtLeastOneValue","MEDIAN: requires at least one value."],61:["formulaFunctionSumifFirstArgumentMustBeRange","SUMIF: first argument must be a range.","#VALUE!"],62:["formulaFunctionSumifSecondArgumentMustBeValue","SUMIF: second argument must be a value (criteria).","#VALUE!"],63:["formulaFunctionSumifThirdArgumentMustBeRange","SUMIF: third argument must be a range (sum_range).","#VALUE!"],64:["formulaFunctionSumifRangesHaveDifferentSizes","SUMIF: ranges have different sizes.","#VALUE!"],65:["formulaFunctionCountifFirstArgumentMustBeRange","COUNTIF: first argument must be a range.","#VALUE!"],66:["formulaFunctionCountifSecondArgumentMustBeValue","COUNTIF: second argument must be a value (criteria).","#VALUE!"],67:["formulaFunctionConcatUnsupportedValueType","CONCAT: unsupported value type.","#VALUE!"],68:["formulaFunctionMinRequiresAtLeastOneValue","MIN: requires at least one value."],69:["formulaFunctionMaxRequiresAtLeastOneValue","MAX: requires at least one value."],70:["formulaFunctionPercentNonNumericArgument","PERCENT: non-numeric argument.","#VALUE!"],71:["formulaFunctionPowerNonNumericArgument","POWER: non-numeric argument.","#VALUE!"]},oy=e=>{if(e?.length)return e.map(e=>String(e))},ow=e=>ob[e],oS=class extends m.AgAbstractCellEditor{constructor(){super({tag:"div",cls:"ag-cell-edit-wrapper"}),this.eEditor=m.RefPlaceholder,this.focusAfterAttached=!1}initialiseEditor(e){let t,i=this.createManagedBean(new oe);this.eEditor=i,i.addCss("ag-cell-editor"),this.appendChild(i),this.addManagedElementListeners(i.getContentElement(),{keydown:t=>this.onFormulaInputKeyDown(t,e.onKeyDown)});let{eventKey:s,cellStartedEdit:r}=e;r?(this.focusAfterAttached=!0,t=s===m.KeyCode.BACKSPACE||s===m.KeyCode.DELETE?"":s&&1===s.length?s:this.getStartValue(e)):t=this.getStartValue(e);let a=null==t?"":String(t);this.eEditor.setEditingCellRef(e.column,e.rowIndex),this.eEditor.setValue(a,!0)}onFormulaInputKeyDown(e,t){let{key:i}=e;if(i!==m.KeyCode.TAB||e.defaultPrevented)return;let{focusSvc:s}=this.beans,r=s?.getFocusedCell();this.eEditor.withSelectionChangeHandlingSuppressed(()=>{t?.(e)});let a=s?.getFocusedCell(),l=!1;if(r&&a){let{rowIndex:e,rowPinned:t,column:i}=r,{rowIndex:s,rowPinned:n,column:o}=a;l=e!==s||t!==n||i!==o}let{defaultPrevented:n}=e;(n||l)&&e.preventDefault(),e.stopPropagation()}getStartValue(e){let{value:t}=e;return t?.toString()??t}isPopup(){return!1}afterGuiAttached(){if(!this.focusAfterAttached)return;let{beans:e,eEditor:t}=this;(0,m._isBrowserSafari)()||this.focusIn(),(0,m._placeCaretAtEnd)(e,t.getContentElement())}focusIn(){this.eEditor.getContentElement().focus({preventScroll:!0})}getValue(){let e=this.eEditor.getCurrentValue(),{value:t,parseValue:i}=this.params;return"string"==typeof e&&this.isFormulaText(e)?e:null==e&&null==t?t:i(String(e))}getValidationElement(){return this.eEditor.getContentElement()}getValidationErrors(){let{params:e}=this,t=this.eEditor.getCurrentValue(),i=this.getLocaleTextFunc(),{getValidationErrors:s,validateFormulas:r}=e,a=null;return((!0===r||s)&&"string"==typeof t&&this.isFormulaText(t)&&(this.beans.formula?.normaliseFormula(t,!0)||(a=[((e,t,i)=>{let[s,r]=ow(t);return e(s,r,oy(i))})(i,1)])),s)?s({value:t,internalErrors:a,cellEditorParams:e}):a}isFormulaText(e){let t=null==e?"":String(e);return this.beans.formula?.isFormula(t)??t.trimStart().startsWith("=")}},ox=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="formulaDataSvc",this.hasSource=!1}postConstruct(){let e=this.gos.get("formulaDataSource");e&&this.setDataSource(e)}hasDataSource(){return this.hasSource}getFormula(e){let t=this.dataSource?.getFormula(e);return(0,m._isExpressionString)(t)?t:void 0}setFormula(e){this.dataSource?.setFormula(e)}setDataSource(e){this.dataSource=e,this.hasSource=!0,e.init?.(this.createInitParams())}createInitParams(){return(0,m._addGridCommonParams)(this.gos,{})}destroy(){this.dataSource?.destroy?.(),super.destroy()}},oF=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="formulaInputManager",this.activeEditor=null,this.activeEditorDeactivate=null}postConstruct(){this.registerRangeSelectionExtension()}registerActiveEditor(e,t){if(this.activeEditor===e&&this.activeEditorDeactivate===t)return!1;let i=this.activeEditorDeactivate;return i&&i!==t&&i(),this.activeEditor=e,this.activeEditorDeactivate=t,!0}unregisterActiveEditor(e,t){this.activeEditor===e&&this.activeEditorDeactivate===t&&(this.activeEditor=null,this.activeEditorDeactivate=null)}isActiveEditor(e){return this.activeEditor===e}shouldSuppressRangeSelection(e){return!!e?.closest&&(null!=this.activeEditor?!!e.closest(".ag-cell-editor"):!!e.closest(".ag-formula-input-field"))}registerRangeSelectionExtension(){let e=this.beans.rangeSvc;e&&(e.registerRangeSelectionExtension(this),this.addDestroyFunc(()=>e.unregisterRangeSelectionExtension?.(this)))}},oA=[{symbol:"%",fixity:"postfix",precedence:100},{symbol:"-",fixity:"prefix",precedence:90},{symbol:"+",fixity:"prefix",precedence:90},{symbol:"^",fixity:"infix",precedence:80,associativity:"right"},{symbol:"*",fixity:"infix",precedence:70,associativity:"left",isAssociative:!0},{symbol:"/",fixity:"infix",precedence:70,associativity:"left"},{symbol:"+",fixity:"infix",precedence:60,associativity:"left",isAssociative:!0},{symbol:"-",fixity:"infix",precedence:60,associativity:"left"},{symbol:"&",fixity:"infix",precedence:55,associativity:"left",isAssociative:!0},{symbol:"=",fixity:"infix",precedence:50,associativity:"left"},{symbol:"<>",fixity:"infix",precedence:50,associativity:"left"},{symbol:">=",fixity:"infix",precedence:50,associativity:"left"},{symbol:"<=",fixity:"infix",precedence:50,associativity:"left"},{symbol:">",fixity:"infix",precedence:50,associativity:"left"},{symbol:"<",fixity:"infix",precedence:50,associativity:"left"}],oM=new Map;for(let e of oA){let t=oM.get(e.symbol)??[];t.push(e),oM.set(e.symbol,t)}function oR(e,t){let i=oM.get(e)??[];return t?i.find(e=>e.fixity===t):i[0]}var oT=[...new Set(oA.map(e=>e.symbol))].sort((e,t)=>t.length-e.length),oP=class extends Error{constructor(e,t,i){const s="string"==typeof e,r=!s&&Array.isArray(t)?(e=>{if(e?.length)return e.map(e=>String(e))})(t):void 0;if(super(s?e:((e,t)=>{let[,i]=ow(e);var s=oy(t);if(!s?.length)return i;let r=i,a=0;for(;a<s.length&&-1!==r.indexOf("${variable}");)r=r.replace("${variable}",s[a++]);return r})(e,r)),this.name="FormulaError",s)this.type="string"==typeof t?t:"#ERROR!",this.errorId=null,this.localeKey=null,this.defaultMessage=e,this.variableValues=void 0;else{const[t,s,a]=ow(e);this.type=i??a??"#ERROR!",this.errorId=e,this.localeKey=t,this.defaultMessage=s,this.variableValues=r}}getTranslatedMessage(e){return this.localeKey?e(this.localeKey,this.defaultMessage,this.variableValues):this.message}},oI=class extends oP{constructor(e,t,i,s){super(e,s,"#PARSE!"),this.errorStart=t,this.errorEnd=i}},oE=(e,t,i)=>{let s=t.trim();if(s.startsWith('"')&&s.endsWith('"')&&s.length>2)return s.slice(1,-1);if("true"===s.toLowerCase())return!0;if("false"===s.toLowerCase())return!1;let r=Number(s);if(!isNaN(r))return r;let a=nj(s);if(a){let{startCol:t,startRow:r,startColAbsolute:l,startRowAbsolute:n,endCol:o,endRow:d,endColAbsolute:h,endRowAbsolute:u}=a,c=(t,i,r,a,l)=>{let n=t||l?i.toUpperCase():e.formula?.getColByRef(i)?.colId,o=r||l?a:(0,m._getClientSideRowModel)(e)?.getFormulaRow(Number(a)-1)?.id;if(null==n||null==o)throw new oI(2,0,0,[s]);return{column:{id:n,absolute:t},row:{id:o,absolute:r}}},p=c(l,t,n,r,i);if(o&&d){let e=c(h??!1,o,u??!1,d,i);p.endColumn=e.column,p.endRow=e.row}return p}return null},oD=(e,t,i=!1)=>{if(!(0,m._isExpressionString)(t))throw new oI(17,0,1);return function e(t){if("operation"===t.type){let i=t.operands.map(e),s={type:"operation",operation:t.operation,operands:i};return function(e){if(!ok(e,"REF"))return null;let t=e.operands;if(2!==t.length&&4!==t.length)return null;let i=oG(t[0]),s=oO(t[1]);if(!i||!s)return null;let r={column:i,row:s};if(4===t.length){let e=oG(t[2]),i=oO(t[3]);if(!e||!i)return null;r.endColumn=e,r.endRow=i}return{type:"operand",value:r}}(s)??s}return t}(function(e,t,i){let s=function(e){let t=[],i=0,s=(e,t)=>{let i=t,s=()=>"$"===e[i]&&(i++,!0),r=()=>{let t=i;return(s(),(()=>{let t=i;for(;i<e.length&&/[A-Za-z]/.test(e[i]);)i++;return i>t})())?(s(),!!(()=>{let t=i;for(;i<e.length&&/[0-9]/.test(e[i]);)i++;return i>t})()||(i=t,!1)):(i=t,!1)};if(!r())return 0;if(":"===e[i]){let e=i;if(i++,!r())throw new oI(3,e,i)}let a=e.slice(t,i);return n$(e,t,a)?i-t:0};for(;i<e.length;){let r=e[i];if(/\s/.test(r)){i++;continue}if('"'===r){let s=i+1;for(;s<e.length&&'"'!==e[s];)s++;if(s>=e.length)throw new oI(4,i,e.length);t.push(e.slice(i,s+1)),i=s+1;continue}if(/[0-9]/.test(r)||"."===r&&/[0-9]/.test(e[i+1])){let s=i+1;for(;s<e.length&&/[0-9.]/.test(e[s]);)s++;t.push(e.slice(i,s)),i=s;continue}if("$"===r||nK(r)){let r=s(e,i);if(r>0){t.push(e.slice(i,i+r)),i+=r;continue}let a=i+1;for(;a<e.length&&nW(e[a]);)a++;t.push(e.slice(i,a)),i=a;continue}if("("===r||")"===r||","===r){t.push(r),i++;continue}let a=oT.find(t=>e.startsWith(t,i));if(!a)throw new oI(5,i,i+1,[r]);t.push(a),i+=a.length}return t}(t),r=[],a=[],l=()=>{let e=a.pop();if(!e)throw new oI(6,0,0);if("op"===e.kind){let t=e.def;if("infix"!==t.fixity){let e=r.pop();if(!e)throw new oI(7,0,0,[t.symbol]);return"+"===t.symbol&&"prefix"===t.fixity?void r.push(e):"postfix"===t.fixity&&"%"===t.symbol?void r.push({type:"operation",operation:t.symbol,operands:[e]}):void("-"===t.symbol&&"prefix"===t.fixity?r.push({type:"operation",operation:"-",operands:[{type:"operand",value:0},e]}):r.push({type:"operation",operation:t.symbol,operands:[e]}))}let i=r.pop(),s=r.pop();if(!s||!i)throw new oI(7,0,0,[t.symbol]);return void r.push({type:"operation",operation:t.symbol,operands:[s,i]})}throw new oI(8,0,0)},n=0;for(;n<s.length;){let t=s[n];if(nK(t[0])&&"("===s[n+1]){a.push({kind:"function",name:t,args:[]}),a.push({kind:"parenthesis",outLen:r.length}),n+=2;continue}if("("===t){a.push({kind:"parenthesis",outLen:r.length}),n++;continue}if(","===t){for(;;){let e=a[a.length-1];if(!e||"parenthesis"===e.kind)break;if("op"===e.kind)l();else throw new oI(9,n,n+1)}let e=a[a.length-1];if(!e||"parenthesis"!==e.kind)throw new oI(10,n,n+1);let t=a[a.length-2];if(!t||"function"!==t.kind)throw new oI(11,n,n+1);r.length>e.outLen&&t.args.push(r.pop()),n++;continue}if(")"===t){for(;;){let e=a[a.length-1];if(!e||"parenthesis"===e.kind)break;if("op"===e.kind)l();else throw new oI(12,n,n+1)}let e=a[a.length-1];if(!e||"parenthesis"!==e.kind)throw new oI(13,n,n+1);let t=e.outLen;if(a.pop(),a[a.length-1]?.kind==="function"){let e=a.pop();r.length>t&&e.args.push(r.pop()),r.push({type:"operation",operation:e.name,operands:e.args})}n++;continue}let d=oM.has(t)?function(e,t){let i=oM.get(e);if(!i)return null;let s=void 0!==t&&oM.has(t),r="("===t||","===t;return(void 0===t||s||r||"("===t)&&")"!==t?i.find(e=>"prefix"===e.fixity)??i.find(e=>"infix"===e.fixity)??null:i.find(e=>"postfix"===e.fixity)??i.find(e=>"infix"===e.fixity)??null}(t,s[n-1]):null;if(d){for(;;){var o;let e=a[a.length-1];if(!e||"op"!==e.kind||(o=e.def,"infix"!==o.fixity||"infix"!==d.fixity?0:"right"===o.associativity&&o.precedence===d.precedence?1:!(o.precedence>=d.precedence)))break;l()}a.push({kind:"op",def:d}),n++;continue}let h=oE(e,t,i);if(null==h)throw new oI(14,0,t.length,[t]);r.push({type:"operand",value:h}),n++}for(;a.length;)if("op"===a[a.length-1].kind)l();else throw new oI(15,0,0);if(1!==r.length)throw new oI(16,0,0);return r[0]}(e,t.slice(1).trim(),i))};function ok(e,t){return"operation"===e.type&&e.operation.toUpperCase()===t.toUpperCase()}function oL(e,t=!1){return e&&"operand"===e.type?!!e.value:t}function oN(e){if(!e||"operand"!==e.type)return null;let t=e.value;return"string"==typeof t?t:"number"==typeof t||"boolean"==typeof t?String(t):null}function oG(e){if(!ok(e,"COLUMN"))return null;let t=oN(e.operands[0]);return null==t?null:{id:t,absolute:oL(e.operands[1],!1)}}function oO(e){if(!ok(e,"ROW"))return null;let t=oN(e.operands[0]);return null==t?null:{id:t,absolute:oL(e.operands[1],!1)}}function oB(e,t){let i=e.colModel.getColById(t);return i?e.formula?.getColRef(i)??null:null}function oV(e,t){let i=e.rowModel?.getRowNode?.(t);return i?.formulaRowIndex!=null?i.formulaRowIndex+1:null}function o_(e,t){return(0,m._getClientSideRowModel)(e)?.getFormulaRow?.(t-1)?.id??null}function oz(e){if(e.includes('"'))throw new oP(18);return`"${e}"`}function oH(e,t){if(t.absolute)return t.id;let i=oB(e,t.id);if(i)return i.toUpperCase();throw new oP(22,[t.id])}function oU(e,t){if(t.absolute){let e=Number(t.id);if(Number.isFinite(e)&&e>=1)return e;throw new oP(23,[t.id])}let i=oV(e,t.id);if(null!=i)return i;throw new oP(24,[t.id])}function oW(e){if("operation"!==e.type||"-"!==e.operation||2!==e.operands.length)return null;let[t,i]=e.operands;return"operand"===t.type&&0===t.value?i:null}function oK(e,t,i){if("operation"!==t.type||oW(t))return!1;let s=oR(t.operation,"infix");if(!s||"infix"!==s.fixity)return!1;let r=e.precedence,a=s.precedence;if(a<r)return!0;if(a>r)return!1;if("right"===e.associativity){let t=s.symbol===e.symbol;return"left"===i&&t}return!0!==e.isAssociative&&"right"===i}function o$(e,t,i,s){return"="+function t(r){if("operand"===r.type){let t,a,l,n=r.value;return"string"==typeof n?oz(n):"number"==typeof n?String(n):"boolean"==typeof n?n?"TRUE":"FALSE":i?(t=t=>`COLUMN(${oz(function(e,t){let i=/^[A-Za-z]+$/.test(t.id);if(t.absolute){if(i)return t.id.toUpperCase();let s=oB(e,t.id);if(s)return s.toUpperCase();throw new oP(19,[t.id])}if(i){var s;let i=(s=t.id,e.formula?.getColByRef?.(s)?.colId??null);if(i)return i}return t.id}(e,t))}${t.absolute?",true":""})`,a=t=>`ROW(${oz(function(e,t){let{id:i,absolute:s}=t;if(s){if(null==o_(e,Number(i)))throw new oP(20,[i])}else if(null==oV(e,i))throw new oP(21,[i]);return i}(e,t))}${t.absolute?",true":""})`,l=`REF(${t(n.column)},${a(n.row)}`,n.endColumn&&n.endRow?`${l},${t(n.endColumn)},${a(n.endRow)})`:`${l})`):function(e,t,i){let s=(e,t)=>(e?"$":"")+String(t),r=i?t.column.id:oH(e,t.column),a=i?t.row.id:oU(e,t.row),l=s(t.column.absolute,r)+s(t.row.absolute,a);if(t.endColumn&&t.endRow){let r=i?t.endColumn.id:oH(e,t.endColumn),a=i?t.endRow.id:oU(e,t.endRow);return`${l}:${s(t.endColumn.absolute,r)}${s(t.endRow.absolute,a)}`}return l}(e,n,s)}let a=oW(r);if(a){let e=t(a);return!function(e){if("operation"!==e.type)return!1;let t=oR(e.operation,"infix");return!!t&&"^"!==t.symbol}(a)?`-${e}`:`-(${e})`}let l=r.operation.toUpperCase();if(1===r.operands.length){let e=r.operands[0],i=oR(l,"postfix");if(i)return`${t(e)}${i.symbol}`;let s=oR(l,"prefix");if(s){var n;let i=t(e);return"operation"===(n=e).type&&oR(n.operation,"infix")?`${s.symbol}(${i})`:`${s.symbol}${i}`}return`${l}(${t(e)})`}if(2===r.operands.length){let e=oR(l,"infix");if(e){let[i,s]=r.operands,a=oK(e,i,"left")?`(${t(i)})`:t(i),l=oK(e,s,"right")?`(${t(s)})`:t(s);return`${a}${e.symbol}${l}`}}return`${l}(${r.operands.map(t).join(",")})`}(t)}function oj(e){return!!(e.endColumn&&e.endRow)}function oY(e,t){let{row:i,column:s}=t,r=i.absolute?(0,m._getClientSideRowModel)(e)?.getFormulaRow(Number(i.id)-1):e.rowModel.getRowNode(i.id),a=s.absolute?e.formula.getColByRef(s.id):e.colModel.getColById(s.id);return r&&a?{row:r,column:a}:null}function oq(e,t,i,s){var r,a,l,n;if("operand"===t.type){let s=t.value;if("object"!=typeof s)return s;if(oj(s))throw new oP(25);let r=oY(e,s);if(!r)throw new oP(26);return i(r)}let o=e.formula?.getFunction(t.operation);if(!o)throw new oP(27,[t.operation]);let{args:d,values:h}=(r=e,a=t.operands,l=i,n=s,{args:{[Symbol.iterator]:()=>new oX(r,a,l,n)},values:{[Symbol.iterator]:()=>new oJ(r,a,l,n)}});return o({row:s.row,column:s.column,args:d,values:h})}function oZ(e,t,i,s){if("operand"===t.type){let s=t.value;if("object"!=typeof s)return{kind:"value",value:s};if(oj(s)){var r,a,l;let t,n,o,d,h,u;return r=e,a=s,l=i,t=oQ(r,a.row),n=a.endRow?oQ(r,a.endRow):t,o=Math.min(t,n),d=Math.max(t,n),h=o0(r,a.column),u=a.endColumn?o0(r,a.endColumn):h,{kind:"range",rowStart:o,rowEnd:d,colStart:h,colEnd:u,[Symbol.iterator]:()=>new o1(r,o,d,h,u,l)}}let n=oY(e,s);if(!n)throw new oP(26);return{kind:"value",value:i(n)}}return{kind:"value",value:oq(e,t,i,s)}}var oX=class{constructor(e,t,i,s){this.beans=e,this.operandNodes=t,this.getCellValue=i,this.caller=s,this.i=0,this.res={done:!1,value:void 0}}next(){return this.i>=this.operandNodes.length?(this.res.done=!0,this.res.value=void 0):(this.res.done=!1,this.res.value=oZ(this.beans,this.operandNodes[this.i++],this.getCellValue,this.caller)),this.res}[Symbol.iterator](){return this}},oJ=class{constructor(e,t,i,s){this.beans=e,this.operandNodes=t,this.getCellValue=i,this.caller=s,this.i=0,this.inner=null,this.res={done:!1,value:void 0}}next(){for(;;){if(this.inner){let e=this.inner.next();if(!e.done)return this.res.done=!1,this.res.value=e.value,this.res;this.inner=null;continue}if(this.i>=this.operandNodes.length)return this.res.done=!0,this.res.value=void 0,this.res;let e=oZ(this.beans,this.operandNodes[this.i++],this.getCellValue,this.caller);if("value"===e.kind)return this.res.done=!1,this.res.value=e.value,this.res;this.inner=e[Symbol.iterator]()}}[Symbol.iterator](){return this}};function oQ(e,t){if(t.absolute){let e=Number(t.id)-1;if(!Number.isFinite(e)||e<0)throw new oP(28);return e}let i=e.rowModel?.getRowNode?.(t.id);if(i?.formulaRowIndex==null)throw new oP(29);return i.formulaRowIndex}function o0(e,t){if(t.absolute){let i=e.formula?.getColByRef(t.id);if(!i)throw new oP(30);return i}let i=e.colModel.getColById(t.id);if(!i)throw new oP(31);return i}var o1=class{constructor(e,t,i,s,r,a){this.beans=e,this.rowStartIndex=t,this.rowEndIndex=i,this.colStart=s,this.colEnd=r,this.getCellValue=a,this.cols=null,this.currentRowIndex=this.rowStartIndex,this.currentColIdx=-1,this.colStartIdx=-1,this.colEndIdx=-1,this.res={done:!1,value:void 0}}initColsOnce(){if(this.cols)return;this.cols=this.beans.colModel.getCols()??[];let e=o2(this.beans,this.colStart,this.colEnd);if(!e){this.colStartIdx=-1,this.colEndIdx=-1;return}[this.colStartIdx,this.colEndIdx]=e,this.currentColIdx=this.colStartIdx}next(){if(!this.cols&&(this.initColsOnce(),this.colStartIdx<0))return this.res.done=!0,this.res;if(this.currentRowIndex<=this.rowEndIndex){let e=(0,m._getClientSideRowModel)(this.beans)?.getFormulaRow(this.currentRowIndex);if(!e)throw new oP(32);let t=this.cols[this.currentColIdx];return this.currentColIdx<this.colEndIdx?this.currentColIdx++:(this.currentColIdx=this.colStartIdx,this.currentRowIndex++),this.res.value=this.getCellValue({row:e,column:t}),this.res}return this.res.done=!0,this.res.value=void 0,this.res}};function o2(e,t,i){let s=e.colModel.getCols()??[],r=null,a=null;for(let e=0;e<s.length&&(null===r||null===a);e++){let l=s[e];if(l===i&&(a=e),l===t&&(r=e),null!==a&&null!==r)break}return null===r||null===a?null:[Math.min(r,a),Math.max(r,a)]}function o5(e,t,i){let s=e[Symbol.iterator](),r=Array(i);for(let e=0;e<i;e++){let a=s.next();if(a.done)throw new oP(35,[t,i]);r[e]=a.value}if(!s.next().done)throw new oP(35,[t,i]);return r}function o4(e){return{*[Symbol.iterator](){for(let t of e)null!=t&&""!==t&&(yield t)}}}var o3=["<=",">=","<>","<",">","="];function o6(e){if("number"==typeof e&&Number.isFinite(e))return e;if(e instanceof Date)return+e;if("string"==typeof e){let t=Number(e);if(!Number.isNaN(t))return t}return null}function o8(e){if(null==e)return"";switch(typeof e){case"string":return e;case"number":return String(e);case"boolean":return e?"TRUE":"FALSE"}return e instanceof Date?String(+e):String(e)}var o7=(e,t,i)=>{let s=o6(t),r=o6(i);switch((null==s||null==r)&&(s=t,r=o8(i).toUpperCase()),e){case"<":return r<s;case">":return r>s;case"<=":return r<=s;case">=":return r>=s;case"=":return r===s;case"<>":return r!==s}return!1},o9=(e,t,i)=>{let s=o8(i),r=t.test(s);return"="===e?r:!r},de=e=>null==e||""===e;function dt(e){if("number"==typeof e)return t=>o6(t)===e;if("string"!=typeof e)return t=>e===t;let t=e.trim();if(""===t)return de;let i=function(e){for(let t of o3)if(e.startsWith(t))return t;return null}(t),s=i?t.substring(i.length):t;if(!/[*?]/.test(s))return o7.bind(null,i??"=",s.toUpperCase());if(i&&"="!==i&&"<>"!==i)throw new oP(38);let r=function(e){let t="^";for(let i=0;i<e.length;i++){let s=e[i];if("~"===s&&i+1<e.length&&("*"===e[i+1]||"?"===e[i+1])){t+="\\"+e[++i];continue}if("*"===s){t+=".*";continue}if("?"===s){t+=".";continue}/[-/\\^$*+?.()|[\]{}]/.test(s)?t+="\\"+s:t+=s}return RegExp(t+="$","i")}(s);return o9.bind(null,i??"=",r)}var di=(e,t,i)=>{let s;if(!i||0===t||i.absolute)return;let{visibleCols:r,colModel:a}=e,l=r.allCols,n=function(e,t,i){let s=e.getColById(i);if(!s)return null;let r=t.indexOf(s);return r>=0?r:null}(a,l,i.id);if(null==n)return;let o=n+t;if(o<0)return;let d=(s=l[o])?s.getId()??null:null;d&&(i.id=d)},ds=(e,t,i,s)=>{if(!i||0===t||i.absolute)return;if(s){let e=Number(i.id);if(!Number.isFinite(e))return;i.id=String(e+t);return}let r=oV(e,i.id);if(null==r)return;let a=r+t;if(a<1)return;let l=o_(e,a);l&&(i.id=l)},dr=(e,t,i,s,r)=>{if("operand"===t.type){let{value:a}=t;if(!(a&&"object"==typeof a&&null!==a&&"row"in a&&"column"in a))return;let{row:l,column:n,endRow:o,endColumn:d}=a;ds(e,i,l,r),di(e,s,n),ds(e,i,o,r),di(e,s,d);return}if("operation"===t.type)for(let a of t.operands)dr(e,a,i,s,r)};function da(e){return new Date(864e5*e)}function dl(e){return e instanceof Date}function dn(e,t){if("bigint"==typeof t){let i=Number(t);if(Number.isFinite(i))return i;throw new oP(48,[e])}if("number"==typeof t&&Number.isFinite(t))return t;if(dl(t))return t.getTime()/864e5;if("boolean"==typeof t)return+!!t;if("string"==typeof t){let e=Number(t.trim());if(Number.isFinite(e))return e}throw new oP(48,[e])}function dd(e,t){return"bigint"==typeof t?t:dn(e,t)}function dh(e,t){if("bigint"==typeof t)return t;if(!Number.isFinite(t)||!Number.isInteger(t))throw new oP(49,[e]);return BigInt(t)}var du=({values:e})=>{let t=1,i=null;for(let s of o4(e)){let e=dd("PRODUCT",s);if("bigint"==typeof e){if(i??(i=dh("PRODUCT",t)),0n===e)return 0n;i*=e;continue}if(null!=i){i*=dh("PRODUCT",e);continue}if(0===e)return 0;t*=e}return i??t},dc=({values:e})=>{let t=!1,i=0,s=null,r=!1;for(let a of o4(e)){t||(t=dl(a));let e=dd("SUM",a);if("bigint"==typeof e){if(t)throw new oP(56);s??(s=dh("SUM",i)),s+=e,r=!0;continue}if("bigint"==typeof s){if(t)throw new oP(56);s+=dh("SUM",e),r=!0;continue}i+=e,r=!0}if(!r)throw new oP(57);return"bigint"==typeof s?s:t?da(i):i},dp=({values:e})=>{let[t,i]=o5(e,"POWER",2),s=dn("POWER",t),r=dn("POWER",i);if(null==s||null==r)throw new oP(71);return Math.pow(s,r)},dg=({values:e})=>{let t="";for(let i of e)if(null!=i)switch(typeof i){case"string":t+=i;break;case"number":t+=String(i);break;case"boolean":t+=i?"TRUE":"FALSE";break;case"object":t+=i.toString();break;default:throw new oP(67)}return t},dm={IF:({values:e})=>{let[t,i,s]=o5(e,"IF",3);return t?i:s},NOW:()=>new Date,TODAY:()=>{let e=new Date;return new Date(e.getFullYear(),e.getMonth(),e.getDate())},PRODUCT:du,SUM:dc,ADD:dc,SUMIF:({args:e})=>{let[t,i,s]=function(e,t,i,s){let r=[];for(let i of e)if(r.push(i),r.length>3)throw new oP(36,[t,3]);if(r.length<2)throw new oP(37,[t,2]);return r}(e,"SUMIF",0,0);if("range"!==t.kind)throw new oP(61);if("value"!==i.kind)throw new oP(62);if(s&&"range"!==s.kind)throw new oP(63);let r=dt(i.value);if(!s){let e=0,i=null;for(let s of t)if(r(s)){let t=dd("SUMIF",s);"bigint"==typeof t?(i??(i=dh("SUMIF",e)),i+=t):null!=i?i+=dh("SUMIF",t):e+=t}return i??e}if(t.rowEnd-t.rowStart!=s.rowEnd-s.rowStart)throw new oP(64);let a=t[Symbol.iterator](),l=s[Symbol.iterator](),n=0,o=null;for(;;){let e=a.next(),t=l.next();if(e.done||t.done){if(e.done!==t.done)throw new oP(64);break}if(r(e.value)){let e=dd("SUMIF",t.value);"bigint"==typeof e?(o??(o=dh("SUMIF",n)),o+=e):null!=o?o+=dh("SUMIF",e):n+=e}}return o??n},POWER:dp,MIN:({values:e})=>{let t=null;for(let i of e)null!=i&&(null===t||i<t)&&(t=i);if(null===t)throw new oP(68);return t},MAX:({values:e})=>{let t=null;for(let i of e)null!=i&&(null===t||i>t)&&(t=i);if(null===t)throw new oP(69);return t},AVERAGE:({values:e})=>{let t=0,i=0,s=!0;for(let r of o4(e)){let e=dn("AVG",r);null!=e&&(t+=e,i++,s&&(s=dl(r)))}if(0===i)throw new oP(58);let r=t/i;return s?da(r):r},MEDIAN:({values:e})=>{let t=!0,i=[];for(let s of o4(e)){let e=dn("MEDIAN",s);if(null==e)throw new oP(59);i.push(e),t&&(t=dl(s))}if(0===i.length)throw new oP(60);i.sort((e,t)=>e-t);let s=Math.floor(i.length/2),r=i.length%2==1?i[s]:(i[s-1]+i[s])/2;return t?da(r):r},COUNT:({values:e})=>{let t=0;for(let i of e)null!=i&&""!==i&&!isNaN(i)&&t++;return t},COUNTA:({values:e})=>{let t=0;for(let i of e)null!=i&&""!==i&&t++;return t},COUNTBLANK:({values:e})=>{let t=0;for(let i of e)(null==i||""===i)&&t++;return t},COUNTIF:({args:e})=>{let[t,i]=o5(e,"COUNTIF",2);if("range"!==t.kind)throw new oP(65);if("value"!==i.kind)throw new oP(66);let s=dt(i.value),r=0;for(let e of t)s(e)&&r++;return r},RAND:()=>Math.random(),CONCAT:dg,CONCATENATE:dg,"+":dc,"-":({values:e})=>{let[t,i]=o5(o4(e),"MINUS",2),s=dl(t),r=dl(i);if(s||r){let e=dn("MINUS",t),a=dn("MINUS",i);return s&&!r?da(e-a):e-a}let a=dd("MINUS",t),l=dd("MINUS",i);return"bigint"==typeof a||"bigint"==typeof l?dh("MINUS",a)-dh("MINUS",l):a-l},"*":du,"/":({values:e})=>{let[t,i]=o5(o4(e),"DIVIDE",2),s=dn("DIV",t),r=dn("DIV",i);if(null==s||null==r)throw new oP(54);if(0===r)throw new oP(55);return s/r},"^":dp,"%":({values:e})=>{let[t]=o5(e,"PERCENT",1),i=dn("PERCENT",t);if(null==i)throw new oP(70);return i/100},"=":({values:e})=>{let[t,i]=o5(e,"EQUALS",2);return t===i},"&":dg,"<>":({values:e})=>{let[t,i]=o5(e,"NOT_EQUALS",2);return t!==i},">":({values:e})=>{let[t,i]=o5(e,"GT",2);return t>i},">=":({values:e})=>{let[t,i]=o5(e,"GTE",2);return t>=i},"<":({values:e})=>{let[t,i]=o5(e,"LT",2);return t<i},"<=":({values:e})=>{let[t,i]=o5(e,"LTE",2);return t<=i}},df=class{constructor(e,t,i,s){this.rowNode=e,this.column=t,this.formulaString=i,this.beans=s,this.error=null,this.ast=null,this.astStale=!0,this._value=void 0,this._valueStale=!0}setFormulaString(e){this.formulaString!==e&&(this.formulaString=e,this.astStale=!0,this._valueStale=!0)}setComputedValue(e){this._value=e,this._valueStale=!1,this.error=null}setError(e){this.error=e,this._valueStale=!1}isValueReady(){return!this._valueStale}getValue(){return this.error?.type??this._value}getError(){return this.error}getAst(){if(!this.astStale)return this.ast;let e=oD(this.beans,this.formulaString);return this.ast=e??null,this.astStale=!1,this.ast}},dC=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="formula",this.cachedResult=new WeakMap,this.colRefMap=new Map,this.functionNames=null,this.active=!1}setFormulasActive(e){let t=e.list.some(e=>e.isAllowFormula())&&this.checkForIncompatibleServices(e);t!==this.active&&(this.active=t,this.refreshFormulas(!0))}checkForIncompatibleServices(e){return this.gos.get("masterDetail")?((0,m._warn)(295,{blockedService:"Master Detail"}),!1):this.gos.get("treeData")?((0,m._warn)(295,{blockedService:"Tree Data"}),!1):this.gos.get("enableCellExpressions")?((0,m._warn)(295,{blockedService:"Cell Expressions"}),!1):e.list.every(e=>e.isAllowPivot()||e.isPivotActive()?((0,m._warn)(295,{blockedService:"Column Pivoting"}),!1):e.isAllowRowGroup()||e.isRowGroupActive()?((0,m._warn)(295,{blockedService:"Row Groups"}),!1):!(e.isAllowValue()||e.isValueActive()||e.getAggFunc())||((0,m._warn)(295,{blockedService:"Value Aggregation"}),!1))}postConstruct(){this.setupFunctions();let e=()=>{this.active&&this.refreshFormulas(!0)},t=()=>{this.active&&this.setupColRefMap()};this.addManagedPropertyListeners(["masterDetail","enableCellExpressions"],e=>{let{colModel:t}=this.beans;t.cols?.list.some(e=>e.isAllowFormula())&&t.refreshAll((0,m._convertColumnEventSourceType)(e.source))}),this.addManagedListeners(this.beans.eventSvc,{modelUpdated:e,cellValueChanged:e,rowDataUpdated:e,newColumnsLoaded:t,columnMoved:t})}updateFormulaByOffset(e){let{value:t,rowDelta:i=0,columnDelta:s=0,useRefFormat:r=!0}=e,{beans:a}=this;try{let e=!r,l=oD(a,t,e);return dr(a,l,i,s,e),o$(a,l,r,e)}catch{return t}}setupFunctions(){this.supportedOperations=new Map,Object.keys(dm).forEach(e=>{this.supportedOperations.set(e,dm[e])}),this.functionNames=null;let e=this.gos.get("formulaFuncs");e&&Object.keys(e).forEach(t=>{this.supportedOperations.set(t.toUpperCase(),e[t].func)})}getFunctionNames(){if(this.functionNames)return this.functionNames;let e=[];for(let t of this.supportedOperations.keys())nK(t[0])&&[...t].every(e=>nW(e))&&e.push(t);return e.sort((e,t)=>e.localeCompare(t)),this.functionNames=e,e}setupColRefMap(){if(!this.active){this.colRefMap=new Map;return}let e="abcdefghijklmnopqrstuvwxyz",t=e.length,i=this.beans.colModel.getCols(),s=new Map,r=0;i?.forEach(i=>{if(!i.isPrimary())return;let a="",l=r++;for(;a=e[l%t]+a,!(l<t);)l=Math.floor(l/t)-1;i.formulaRef!==a.toUpperCase()&&(i.formulaRef=a.toUpperCase(),i.dispatchColEvent("formulaRefChanged","api")),s.set(a.toUpperCase(),i)}),this.colRefMap=s,this.refreshFormulas(!0)}getColByRef(e){return this.colRefMap.get(e.toUpperCase())??null}getColRef(e){for(let[t,i]of this.colRefMap.entries())if(i===e)return t;return null}refreshFormulas(e){this.cachedResult=new WeakMap,e&&this.beans.rowRenderer.refreshCells({suppressFlash:!0,force:!0})}isFormula(e){return this.active&&(0,m._isExpressionString)(e)}normaliseFormula(e,t=!1){let{beans:i}=this;try{let s=oD(i,e);return o$(i,s,!t,!1)}catch{return null}}getFormulaError(e,t){let i=this.cachedResult.get(t),s=i?.get(e);return s?.error??null}getFunction(e){return this.supportedOperations.get(e.toUpperCase())}ensureCellFormula(e,t){let i=this.cachedResult.get(e),s=i?.get(t);if(s)return s;let r=this.getFormulaFromDataSource(e,t)??this.fetchRawValue(t,e);return"string"!=typeof r||"="!==r[0]?null:(s=new df(e,t,r,this.beans),i||(i=new Map,this.cachedResult.set(e,i)),i.set(t,s),s)}getFormulaFromDataSource(e,t){let i=this.beans.formulaDataSvc;if(i?.hasDataSource())return i.getFormula({column:t,rowNode:e})}coerceFormulaValue(e,t){let i=this.beans.dataTypeSvc?.getBaseDataType(e);if("bigint"===i)return this.toBigIntValue(t)??t;if("number"===i&&"bigint"==typeof t){let e=Number(t);return Number.isFinite(e)?e:t}return t}toBigIntValue(e){return"bigint"==typeof e?e:"number"==typeof e?Number.isFinite(e)&&Number.isInteger(e)?BigInt(e):null:null}fetchRawValue(e,t){return this.beans.valueSvc.getValue(e,t,"data")}getVisitorContext(){if(this.activeCtx)return this.activeCtx;let e=new Map,t=t=>{for(let[i,s]of e)for(let e of s){let s=this.ensureCellFormula(i,e);s?.setError(t)}};return this.activeCtx={setVisited:(t,i)=>{let s=e.get(t);s&&(s.delete(i),0===s.size&&e.delete(t))},setVisiting:(t,i)=>{let s=e.get(t);if(s?.has(i))throw new oP(51);s||(s=new Set,e.set(t,s)),s.add(i)},errorAllVisitors:t}}makeFormulaFrame(e){let t=this.ensureCellFormula(e.row,e.column).getAst();if(!t)throw new oP(52);let i=function*(e,t,i){let s=[t];for(;s.length;){let t=s.pop();if("operand"===t.type){let s=t.value;if("object"!=typeof s||null==s)continue;if(!s.endColumn&&!s.endRow){let t=oY(e,s);if(!t)throw new oP(33);let r=i(t.row,t.column);if(!r||r.isValueReady())continue;yield t;continue}if(!s.endColumn||!s.endRow)throw new oP(34);let r=oQ(e,s.row),a=oQ(e,s.endRow),l=Math.min(r,a),n=Math.max(r,a),o=o0(e,s.column),d=o0(e,s.endColumn);for(let t of function*(e,t,i,s,r){let a=e.colModel.getCols()??[],l=o2(e,s,r);if(null==l)return;let[n,o]=l;for(let s=t;s<=i;s++){let t=(0,m._getClientSideRowModel)(e)?.getFormulaRow(s);if(t)for(let e=n;e<=o;e++)yield{row:t,column:a[e]}}}(e,l,n,o,d)){let e=i(t.row,t.column);!e||e.isValueReady()||(yield t)}continue}for(let e=0;e<t.operands.length;e++)s.push(t.operands[e])}}(this.beans,t,this.ensureCellFormula.bind(this));return{address:e,ast:t,unresolvedDepIterator:i}}resolveValue(e,t){let i=this.ensureCellFormula(t,e);if(!i)return this.fetchRawValue(e,t);if(i.isValueReady())return i.getValue();let s=!!this.activeCtx,{setVisited:r,setVisiting:a,errorAllVisitors:l}=this.getVisitorContext(),n=[];try{for(a(t,e),n.push(this.makeFormulaFrame({row:t,column:e}));n.length;){let{address:e,ast:t,unresolvedDepIterator:i}=n[n.length-1],{row:s,column:l}=e,o=this.ensureCellFormula(s,l);if(o.isValueReady()){if(n.pop(),r(s,l),o.error)throw o.error;continue}let d=i.next();if(!d.done){let e=d.value,t=this.ensureCellFormula(e.row,e.column);if(!t||t.isValueReady())continue;a(e.row,e.column),n.push(this.makeFormulaFrame(e));continue}let h=oq(this.beans,t,e=>{let t=this.ensureCellFormula(e.row,e.column);if(t){if(!t.isValueReady())throw new oP(53);let e=t.getError();if(e)throw e;return t.getValue()}return this.fetchRawValue(e.column,e.row)},{row:s,column:l}),u=this.coerceFormulaValue(l,h),c=o.getError();if(c)throw r(s,l),c;o.setComputedValue(u),r(s,l),n.pop()}if(!i.isValueReady())throw new oP(53);return i.getValue()}catch(t){let e=t instanceof oP?t:new oP(String(t?.message??t));return l(e),e.type}finally{s||(this.activeCtx=null)}}},dv=Symbol("WrappedFunctionMarker"),db=(e,t)=>{if(e[dv])return e;let i=(...i)=>t(e,...i);return i[dv]=dv,i};function dy(e){return{content:`${e.xValue} ${e.yValue}`}}function dw(e){return{content:`${e.yValue}`}}var dS=class extends m.Component{constructor(){super({tag:"div",cls:"ag-sparkline-wrapper",children:[{tag:"span",ref:"eSparkline"}]}),this.eSparkline=m.RefPlaceholder,this.cachedWidth=0,this.cachedHeight=0,this.dataRef=[],this.processedData=[]}postConstruct(){this.env=this.beans.environment,this.addManagedPropertyListeners(["chartThemeOverrides","chartThemes","styleNonce"],()=>this.refresh(this.params))}createListener(e=!0){return()=>this.updateSize(this.params?.column?.getActualWidth()??0,(this.params?.node.rowHeight??0)-2,e)}initGridObserver(){let e=this.createListener(),t=this.createListener(!1),i=this.params?.column,s=this.params?.node;i.__addEventListener("columnStateUpdated",e),s.__addEventListener("heightChanged",e),this.addDestroyFunc(()=>{i.__removeEventListener("columnStateUpdated",e),s.__removeEventListener("heightChanged",e)}),t()}updateSize(e,t,i=!0){if((e-=this.env.getCellPadding())!==this.cachedWidth||t!==this.cachedHeight){this.cachedWidth=e,this.cachedHeight=t;let s=this.refresh.bind(this);i?(0,m._batchCall)(()=>this.isAlive()&&s()):s()}}init(e){this.params=e,this.initGridObserver()}refresh(e=this.params){var t;this.params=e;let i=this.cachedWidth,s=this.cachedHeight,r=this.gos.get("styleNonce");if(!this.sparklineInstance&&e&&i>0&&s>0){if(this.sparklineOptions={container:this.eSparkline,width:i,height:s,...e.sparklineOptions,...r?{styleNonce:r}:{},data:this.processData(e.value)},(t=this.sparklineOptions).type??(t.type="line"),this.sparklineOptions.tooltip?.renderer)this.wrapTooltipRenderer();else{let e=this.getDefaultTooltipRenderer();this.sparklineOptions.tooltip={...this.sparklineOptions.tooltip,renderer:e}}let a=this.sparklineOptions?.theme;return"bar"===this.sparklineOptions.type&&this.sparklineOptions.itemStyler?this.wrapItemStyler(this.sparklineOptions):a?.overrides?.bar?.series?.itemStyler&&this.wrapItemStyler(a.overrides.bar.series),this.sparklineInstance=e.createSparkline(this.sparklineOptions),!0}return!!this.sparklineInstance&&(this.sparklineInstance.update({...this.sparklineOptions,data:this.processData(e?.value),width:i,height:s,...r?{styleNonce:r}:{}}),!0)}processData(e){return e?.length?(this.dataRef!==e&&(this.dataRef=e,this.processedData=Array.isArray(e[0])?e.filter(e=>null!=e):e),this.processedData):e??[]}createContext(){return{data:this.params?.data,cellData:this.params?.value}}getDefaultTooltipRenderer(e){let t=e?.title,i=this.sparklineOptions.xKey,s=Array.isArray(this.sparklineOptions.data?.[0]);return!t&&(i||s)?dy:dw}wrapItemStyler(e){e.itemStyler=db(e.itemStyler,(e,t)=>e({...t,context:this.createContext()}))}wrapTooltipRenderer(){this.sparklineOptions.tooltip={...this.sparklineOptions.tooltip,renderer:db(this.sparklineOptions.tooltip.renderer,(e,t)=>{let i=e({...t,context:this.createContext()});return"string"==typeof i?i:{...this.getDefaultTooltipRenderer(i)(t),...i}})}}destroy(){super.destroy(),this.sparklineInstance?.destroy()}},dx={tag:"span",cls:"ag-find-cell"},dF=class extends m.Component{constructor(){super(dx)}init(e){this.refresh(e)}refresh(e){let{node:t,column:i}=e,{findSvc:s,valueSvc:r}=this.beans,{value:a,valueFormatted:l}=r.getValueForDisplay({column:i,node:t,includeValueFormatted:!0,from:"edit"}),n=l??a??"",o=this.getGui();(0,m._clearElement)(o);let d=s?.getParts({value:n,node:t,column:i??null});if(d){let e=!1;for(let{value:t,match:i,activeMatch:s}of d){let r=(0,m._toString)(t)??"";if(i){let t=(0,m._createElement)({tag:"mark",cls:"ag-find-match"});t.textContent=r,s&&(t.classList.add("ag-find-active-match"),e=!0),o.appendChild(t)}else o.appendChild(document.createTextNode(r))}o.classList.toggle("ag-find-cell-active-match",e)}else o.textContent=(0,m._toString)(n)??"",o.classList.remove("ag-find-cell-active-match");return!0}};function dA(e){return e?.toLocaleLowerCase()}function dM(e,t,i){let s=t((0,m._toString)(i)),r=0;if(s?.length){let t=-1;for(;;)if(-1!=(t=s.indexOf(e,t+1)))r++;else break}return r}var dR=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="findSvc",this.active=!1,this.topMatches=new Map,this.topNodes=[],this.topNumMatches=0,this.centerMatches=new Map,this.centerNodes=[],this.centerNumMatches=0,this.bottomMatches=new Map,this.bottomNodes=[],this.caseFormat=dA,this.scrollOnRefresh=!1,this.totalMatches=0}postConstruct(){if(!(0,m._isClientSideRowModel)(this.gos))return;let e=this.refresh.bind(this,!1),t=this.refresh.bind(this,!0),i=(0,m._debounce)(this,()=>{this.isAlive()&&t()},0);this.refreshDebounced=i,this.addManagedPropertyListener("findSearchValue",e),this.addManagedPropertyListener("findOptions",({currentValue:t,previousValue:i})=>{(0,m._jsonEquals)(t,i)||e()}),this.addManagedPropertyListeners(["groupSuppressBlankHeader","showOpenedGroup"],t),this.addManagedEventListeners({modelUpdated:t,displayedColumnsChanged:t,pinnedRowDataChanged:t,cellValueChanged:i,rowNodeDataChanged:i,cellEditingStopped:i,cellEditValuesChanged:i,batchEditingStopped:i});let s=this.beans.rowSpanSvc;s&&this.addManagedListeners(s,{spannedCellsUpdated:i}),e()}next(){this.findAcrossContainers(!1,["top",null,"bottom"],1,1)}previous(){this.findAcrossContainers(!0,["bottom",null,"top"],this.totalMatches,-1)}goTo(e,t){if(!t&&e===this.activeMatch?.numOverall)return;let{topMatches:i,topNumMatches:s,centerMatches:r,centerNumMatches:a,bottomMatches:l}=this;e<=s?this.goToInContainer(i,e,0):e<=a?this.goToInContainer(r,e,s):this.goToInContainer(l,e,s+a)}clearActive(){this.activeMatch&&this.setActive(void 0)}isMatch(e,t){return this.active&&!!this.getMatches(e.rowPinned).get(e)?.some(([e])=>e===t)}getNumMatches(e,t){return this.getMatches(e.rowPinned).get(e)?.find(([e])=>e===t)?.[1]??0}getParts(e){let{value:t,node:i,column:s,precedingNumMatches:r}=e,a=this.findSearchValue,l=(0,m._toString)(t)??"";if((0,m._missing)(a))return[{value:l}];let n=this.caseFormat(l)??"",o=this.getActiveMatchNum(i,s)-(r??0),d=0,h=0,u=a.length,c=[];for(;;){let e=n.indexOf(a,d);if(-1==e)return d<l.length&&c.push({value:l.slice(d)}),c;{h++,e>d&&c.push({value:l.slice(d,e)});let t=e+u;c.push({value:l.slice(e,t),match:!0,activeMatch:h===o}),d=t}}}registerDetailGrid(e,t){let i=this.gos;if(!(0,m._isClientSideRowModel)(i))return;let s=()=>i.get("findOptions")?.searchDetail,r=t=>{let i=this.centerMatches.get(e)?.[0];t!==(i?.[1]??0)&&this.refreshDebounced()};t.addEventListener("findChanged",e=>{!t.isDestroyed()&&this.isAlive()&&this.active&&s()&&r(e.totalMatches)}),t.addEventListener("gridPreDestroyed",()=>{if(!this.isAlive()||!this.active||!s())return;let t=e.parent,a=this.findSearchValue;t&&a&&r(i.get("detailCellRendererParams")?.getFindMatches?.({node:t,data:t.data,findSearchValue:i.get("findSearchValue"),updateMatches:this.refreshDebounced,getMatchesForValue:e=>dM(a,this.caseFormat,e)})??0)}),s()&&t.setGridOption("findSearchValue",i.get("findSearchValue"))}refresh(e){let t,i,s=new Set([...this.topNodes,...this.centerNodes,...this.bottomNodes]);this.topNodes=[],this.centerNodes=[],this.bottomNodes=[];let{topNodes:r,topMatches:a,centerMatches:l,centerNodes:n,bottomNodes:o,bottomMatches:d,beans:{gos:h,visibleCols:u,rowModel:c,valueSvc:p,pinnedRowModel:g,pagination:f,rowSpanSvc:C,masterDetailSvc:v,colModel:b},findSearchValue:y}=this,w=h.get("findOptions"),S=w?.caseSensitive?e=>e??void 0:dA;this.caseFormat=S;let x=h.get("findSearchValue"),F=S(x?.trim());this.findSearchValue=F,a.clear(),l.clear(),d.clear();let A=e?this.activeMatch:void 0;this.activeMatch=void 0;let M=h.get("masterDetail")&&w?.searchDetail&&v;if((0,m._missing)(F)){if(this.active=!1,this.topNumMatches=0,this.centerNumMatches=0,this.totalMatches=0,this.refreshRows(s),M){let e=v.store;for(let t of Object.keys(e))e[t]?.api?.findClearActive()}(0,m._missing)(y)||this.dispatchFindChanged();return}let R=u.allCols,T=h.getCallback("isFullWidthRow"),P=h.get("detailCellRendererParams"),I=h.get("fullWidthCellRendererParams"),E=h.get("groupRowRendererParams"),D=a_(h),k=b.isPivotMode(),L=0,N=!1,G=(e,r,a,l)=>{if(!a)return;let n=t.get(e);!n&&(n=[],t.set(e,n),i.push(e),l||s.add(e)),n.push([r,a]),L+=a},O=e=>{if(N){let t=e.rowIndex,i=e.parent;for(;null==t&&i;)t=i.rowIndex,i=i.parent;if(null==t||!f.isRowInPage(t))return}let t=e.hasChildren();if(!aU(D,e,t,k,az(D,e,t),aH(D,e,t)))return;let i=e.data;if(T?.({rowNode:e})){if(I){let t=I.getFindMatches?.({node:e,data:i,findSearchValue:x,updateMatches:this.refreshDebounced,getMatchesForValue:e=>dM(F,S,e)})??0;G(e,null,t)}return}if((0,m._isFullWidthGroupRow)(h,e,k)){let t,s=E?.getFindText;if(s){let r=p.getValueForDisplay({node:e,from:"batch"}).value;t=s((0,m._addGridCommonParams)(h,{value:r,node:e,data:i,column:null,colDef:null,getValueFormatted:()=>{let{valueFormatted:t}=p.getValueForDisplay({node:e,includeValueFormatted:!0,from:"batch"});return t}}))}else{let{value:i,valueFormatted:s}=p.getValueForDisplay({node:e,includeValueFormatted:!0,from:"batch"});t=s??i}G(e,null,dM(F,S,t));return}let s=e.level>0&&h.get("groupHideOpenParents")&&e.parent?.getFirstChild()===e&&!e.parent?.expanded;for(let t of R){let r;if((0,m.isSpecialCol)(t))continue;let a=C?.getCellSpan(t,e);if(a&&a.firstNode!==e||t.colDef.showRowGroup&&s)continue;let l=t.colDef,n=l.getFindText;if(n){let s=p.getValueForDisplay({column:t,node:e,from:"batch"}).value;r=n((0,m._addGridCommonParams)(h,{value:s,node:e,data:i,column:t,colDef:l,getValueFormatted:()=>{let{valueFormatted:i}=p.getValueForDisplay({column:t,node:e,includeValueFormatted:!0,from:"batch"});return i}}))}else{let{value:i,valueFormatted:s}=p.getValueForDisplay({column:t,node:e,includeValueFormatted:!0,from:"batch"});r=s??i}G(e,t,dM(F,S,r))}if(e.master&&M){let t=e.detailNode;if(t){let e=t.detailGridInfo?.api;if(e){e.setGridOption("findSearchValue",x),G(t,null,e.findGetTotalMatches());return}}if(P){let s=P.getFindMatches?.({node:e,data:i,findSearchValue:x,updateMatches:this.refreshDebounced,getMatchesForValue:e=>dM(F,S,e)})??0;G(t??{parent:e,dummy:!0},null,s,!t)}}};t=a,i=r,g?.forEachPinnedRow("top",O),this.topNumMatches=L;let B=L;t=l,i=n,L=0,N=!!f&&!!w?.currentPageOnly,c.forEachNodeAfterFilterAndSort(O,!0),this.centerNumMatches=L,B+=L,t=d,i=o,L=0,N=!1,g?.forEachPinnedRow("bottom",O),B+=L,this.totalMatches=B,this.active=!0,this.refreshRows(s),A&&this.resetActiveMatch(A),this.dispatchFindChanged()}resetActiveMatch(e){let{column:t,numInMatch:i}=e,s=e.node;if(s.dummy){let e=s.parent?.detailNode;if(!e)return;s=e}let r=s.rowPinned??null;if(!this.getMatches(r)?.get(s)?.some(([e,s])=>e===t&&s>=i))return;let a=0;null==r?a=this.topNumMatches:"bottom"===r&&(a=this.topNumMatches+this.centerNumMatches),(()=>{let e=this.getMatches(r);for(let r of e.keys()){let l=r===s;for(let[s,n]of e.get(r)){if(l&&s===t){a+=i;return}a+=n}}})();let l={...e,node:s,numOverall:a};this.activeMatch=l,this.refreshRows(new Set([s]),null==t?void 0:new Set([t])),this.scrollOnRefresh&&(this.scrollOnRefresh=!1,this.scrollToActive(l)),this.setDetailActive(l)}refreshRows(e,t){e.size&&this.beans.rowRenderer.refreshCells({rowNodes:[...e],columns:t?[...t]:void 0,force:!0,suppressFlash:!0})}findAcrossContainers(e,t,i,s){if(!this.totalMatches)return void this.setActive();let r=this.activeMatch,a=t;if(r){let{column:i,node:l,numInMatch:n,numOverall:o}=r,d=l.rowPinned??null,h=o+s;if(this.findInContainer(d,e,h,l,i,n))return;let u=t.indexOf(d),c=t.length;if(t.slice(u+1,c).some(t=>this.findInContainer(t,e,h)))return;a=t.slice(0,u+1)}a.some(t=>this.findInContainer(t,e,i))}findInContainer(e,t,i,s,r,a){let l,n=this.getMatches(e),o=this.getRowNodes(e),d=t?-1:1;if(null!=s){let e=n.get(s),l=e?.findIndex(([e])=>e===r);if(null!=l&&-1!=l){let[r,n]=e[l];if(t?a>1:a<n)return this.setActive({column:r,node:s,numInMatch:a+d,numOverall:i}),!0}let o=null!=l&&-1!=l?e?.[l+d]:void 0;if(o){let[e,r]=o;return this.setActive({column:e,node:s,numInMatch:t?r:1,numOverall:i}),!0}}if(null==s)l=o[t?o.length-1:0];else{let e=o.findIndex(e=>e===s);l=o[e+d]}if(null==l)return!1;let h=n.get(l),u=h?.[t?h.length-1:0];if(u){let[e,s]=u;return this.setActive({column:e,node:l,numInMatch:t?s:1,numOverall:i}),!0}return!1}dispatchFindChanged(){let{eventSvc:e,activeMatch:t,totalMatches:i,findSearchValue:s}=this;e.dispatchEvent({type:"findChanged",activeMatch:t,totalMatches:i,findSearchValue:s})}setActive(e){if(e&&null==e.node.rowIndex){let t=e.node,i=t.footer?t.sibling:t.parent;for(;i&&-1!==i.level;)i.expanded=!0,i=i.parent;this.activeMatch=e,this.scrollOnRefresh=!0,this.beans.expansionSvc?.onGroupExpandedOrCollapsed();return}let t=this.activeMatch;this.activeMatch=e,this.refreshAndScrollToActive(e,t),e&&this.setDetailActive(e),this.dispatchFindChanged()}setDetailActive({node:e,numInMatch:t}){e.detail&&e.detailGridInfo?.api?.findGoTo(t)}refreshAndScrollToActive(e,t){if(e||t){let i=new Set,s=new Set,r=!1,a=e=>{if(!e)return;let{node:t,column:a}=e;i.add(t),null==a?r=!0:s.add(a)};a(e),a(t),this.refreshRows(i,r?void 0:s)}e&&this.scrollToActive(e)}scrollToActive({node:{rowPinned:e,rowIndex:t},column:i}){let{ctrlsSvc:s,pagination:r,gos:a}=this.beans,l=s.getScrollFeature();null==e&&null!=t&&(!r||a.get("findOptions")?.currentPageOnly||r.isRowInPage(t)||r.goToPageWithIndex(t),l.ensureIndexVisible(t)),l.ensureColumnVisible(i)}goToInContainer(e,t,i){let s=i;for(let i of e.keys())for(let[r,a]of e.get(i)){if(t<=s+a)return void this.setActive({column:r,node:i,numInMatch:t-s,numOverall:t});s+=a}}getMatches(e){return"top"===e?this.topMatches:"bottom"===e?this.bottomMatches:this.centerMatches}getRowNodes(e){return"top"===e?this.topNodes:"bottom"===e?this.bottomNodes:this.centerNodes}getActiveMatchNum(e,t){let i=this.activeMatch;return null!=i&&i.node===e&&i.column===t?i.numInMatch:0}destroy(){this.topMatches.clear(),this.topNodes.length=0,this.centerMatches.clear(),this.centerNodes.length=0,this.bottomMatches.clear(),this.bottomNodes.length=0,this.activeMatch=void 0,super.destroy()}},dT={moduleName:"BatchEdit",version:tv,beans:[],apiFunctions:{isBatchEditing:function(e){return e.editSvc?.isBatchEditing()??!1},startBatchEdit:function({editSvc:e,gos:t,rowModel:i}){(0,m._isClientSideRowModel)(t,i)?e?.startBatchEditing():(0,m._warn)(289,{rowModelType:t.get("rowModelType")})},cancelBatchEdit:function({editSvc:e}){e?.stopBatchEditing({cancel:!0,source:"api",forceCancel:!0})},commitBatchEdit:function({editSvc:e}){e?.stopBatchEditing({source:"api",forceStop:!0,commit:!0})}},dependsOn:[m._EditCoreModule,tb],css:[]},dP=class extends m.BeanStub{constructor(e){super(),this.beanName="agChartsExports",this.isEnterprise=!1,this.create=e.create,this._Theme=e._Theme,this._Scene=e._Scene,this.isEnterprise=e.isEnterprise,this._Util=e._Util}};function dI(e){return null!=e.chart?e.chart:e}var dE=new Set(["__proto__","constructor","prototype"]);function dD(e,t,i){if(null==e)return i;let s=t.split("."),r=e;for(;s.length>1;)if(null==(r=r[s.shift()]))return i;let a=r[s[0]];return null!=a?a:i}var dk={column:"bar",groupedColumn:"bar",stackedColumn:"bar",normalizedColumn:"bar",bar:"bar",groupedBar:"bar",stackedBar:"bar",normalizedBar:"bar",line:"line",stackedLine:"line",normalizedLine:"line",scatter:"scatter",bubble:"bubble",pie:"pie",donut:"donut",doughnut:"donut",area:"area",stackedArea:"area",normalizedArea:"area",histogram:"histogram",radarLine:"radar-line",radarArea:"radar-area",nightingale:"nightingale",radialColumn:"radial-column",radialBar:"radial-bar",sunburst:"sunburst",rangeBar:"range-bar",rangeArea:"range-area",boxPlot:"box-plot",treemap:"treemap",heatmap:"heatmap",waterfall:"waterfall",funnel:"funnel",coneFunnel:"cone-funnel",pyramid:"pyramid"},dL=new Set(["columnLineCombo","areaColumnCombo","customCombo"]),dN=["grouped","stacked","normalized"],dG={area:{isCartesian:!0,canInvert:!0},bar:{isCartesian:!0,canInvert:!0},histogram:{isCartesian:!0},line:{isCartesian:!0,canInvert:!0},pie:{isPie:!0},donut:{isPie:!0,canInvert:!0},scatter:{isCartesian:!0},bubble:{isCartesian:!0},"radial-column":{isPolar:!0,isEnterprise:!0,isRadial:!0,canInvert:!0},"radial-bar":{isPolar:!0,isEnterprise:!0,isRadial:!0,canInvert:!0},"radar-line":{isPolar:!0,isEnterprise:!0,canInvert:!0},"radar-area":{isPolar:!0,isEnterprise:!0,canInvert:!0},nightingale:{isPolar:!0,isEnterprise:!0,canInvert:!0},"range-bar":{isCartesian:!0,isStatistical:!0,isEnterprise:!0,canSwitchDirection:!0},"range-area":{isCartesian:!0,isStatistical:!0,isEnterprise:!0},"box-plot":{isCartesian:!0,isStatistical:!0,isEnterprise:!0,canSwitchDirection:!0},treemap:{isEnterprise:!0,isHierarchical:!0},sunburst:{isEnterprise:!0,isHierarchical:!0},heatmap:{isCartesian:!0,isEnterprise:!0},waterfall:{isCartesian:!0,isEnterprise:!0,canSwitchDirection:!0},funnel:{isCartesian:!0,isEnterprise:!0,canSwitchDirection:!0},"cone-funnel":{isCartesian:!0,isEnterprise:!0,canSwitchDirection:!0},pyramid:{isCartesian:!0,isEnterprise:!0,canSwitchDirection:!0}};function dO(e,t){return!!dG[e]?.[t]}var dB=new Set(["stackedColumn","normalizedColumn","stackedBar","normalizedBar"]);function dV(e){return dO(e,"isCartesian")}function d_(e){return"funnel"===e||"cone-funnel"===e||"pyramid"===e}function dz(e){return dO(e,"isPolar")}function dH(e){return dO(e,"isHierarchical")}function dU(e){return"doughnut"===e?"donut":e}function dW(e){return dk[e]??"line"}function dK(e){return dO(e,"isPie")}function d$(e){return dH(dW(e))?void 0:1}function dj(e){return dH(dW(e))?2:"pie"===e||"waterfall"===e||"histogram"===e||"funnel"===e||"coneFunnel"===e||"pyramid"===e?1:void 0}function dY(e){return!dL.has(e)&&dO(dW(e),"canInvert")}function dq(e){switch(e){case"groupedColumn":case"stackedColumn":case"normalizedColumn":case"groupedBar":case"stackedBar":case"normalizedBar":case"stackedLine":case"normalizedLine":case"stackedArea":case"normalizedArea":return`${e}Full`;case"doughnut":return"donut";case"areaColumnCombo":return"AreaColumnCombo";default:return e}}var dZ=["number","category","grouped-category","log","time"];function dX(e,t){return Object.keys(t.themes).includes(e)}var dJ=dZ.reduce((e,t)=>({...e,[t]:{title:{_enabledFromTheme:!0}}}),{});function dQ(e,t){let{customChartThemes:i}=e,s=i?.[t];return s||(0,m._warn)(140,{name:t}),s}function d0(e){let t={unhighlightedSeries:{opacity:1},highlightedItem:{strokeWidth:2}};return e||(t.unhighlightedItem={opacity:1}),t}var d1=class{constructor(e){this.chartProxyParams=e,this.clearThemeOverrides=!1,this.agChartsExports=e.agChartsExports,this.chart=e.chartInstance,this.chartType=e.chartType,this.crossFiltering=e.crossFiltering,this.crossFilterCallback=e.crossFilterCallback,this.standaloneChartType=dW(this.chartType),null==this.chart?this.chart=e.agChartsExports.create(this.getCommonChartOptions()):this.clearThemeOverrides=!0}crossFilteringReset(){}update(e){this.getChartRef().update(this.getUpdateOptions(e,this.getCommonChartOptions(e.updatedOverrides)))}updateThemeOverrides(e){this.getChartRef().updateDelta({theme:{overrides:e}})}getChart(){return dI(this.chart)}getChartRef(){return this.chart}downloadChart(e,t,i){let{chart:s}=this,r=dI(s),a=t||r.title.node.getPlainText(),{width:l,height:n}=e||{};s.download({width:l,height:n,fileName:a,fileFormat:i})}getChartImageDataURL(e){return this.getChart().getCanvasDataURL(e)}getChartOptions(){return this.chart.getOptions()}getChartThemeOverrides(){return this.getChartOptions().theme.overrides??{}}getChartPalette(){return this.agChartsExports._Theme.getChartTheme(this.getChartOptions().theme).palette}setPaired(e){let t=dW(this.chartProxyParams.chartType);this.chart.updateDelta({theme:{overrides:{[t]:{paired:e}}}})}isPaired(){let e=dW(this.chartProxyParams.chartType);return dD(this.getChartThemeOverrides(),`${e}.paired`,!0)}lookupCustomChartTheme(e){return dQ(this.chartProxyParams,e)}getSeriesGroupType(){}transformCategoryData(e,t){return e.map((e,i)=>{let s=e[t],r=s?.toString?s.toString():"",a={...e};return a[t]={id:i,value:s,toString:()=>r},a})}getCommonChartOptions(e){let t=this.clearThemeOverrides?{}:this.chart?.getOptions()??{},i=null!=this.chart?this.getActiveFormattingPanelOverrides():void 0;this.clearThemeOverrides=!1;let s=this.chartProxyParams.styleNonce,r=function(e,t,i,s,r){var a,l,n,o,d,h;let u,c,p,g,m,{chartOptionsToRestore:f,chartPaletteToRestore:C,chartThemeToRestore:v,agChartsExports:b}=e,y=(u=(a=e).getChartThemeName(),(c=a.getChartThemes()).includes(u)||(u=c[0]),u),w=dX(y,b._Theme),S=w?{baseTheme:y}:dQ(e,y)??{},x=e.getGridOptionsChartThemeOverrides(),F=e.apiChartThemeOverrides,A=dW(e.chartType),M=e.crossFiltering?function(e,t,i){let s={tooltip:{delay:500},legend:{listeners:{legendItemClick:t=>{let i=e.getChart(),s=[t.seriesId,`${t.seriesId}-filtered-out`];for(let e of i.series.filter(e=>s.includes(e.id)))e.toggleSeriesItem(void 0,"category",t.itemId,void 0)}}},listeners:{click:e=>t.crossFilterCallback(e,!0)}};if("pie"===i||"donut"===i)return{[i]:{series:{fills:{$applyCycle:[{$cacheMax:{$size:{$path:["./data",{$path:"/data"}]}}},{$palette:"fills"},{$if:[{$eq:[{$value:"$parentIndex"},0]},{$mix:[{$value:"$1"},{$ref:"backgroundColor"},.7]},{$value:"$1"}]}]},strokes:{$applyCycle:[{$cacheMax:{$size:{$path:["./data",{$path:"/data"}]}}},{$palette:"strokes"},{$if:[{$eq:[{$value:"$parentIndex"},0]},{$mix:[{$value:"$1"},{$ref:"backgroundColor"},.7]},{$value:"$1"}]}]}},...s}};let r={};return"line"!==i&&(r.fill={$if:[{$isEven:[{$value:"$index"}]},{$palette:"fill"},{$mix:[{$path:["../$prevIndex/fill",{$palette:"fill"}]},{$ref:"backgroundColor"},.7]}]}),{[i]:{series:{stroke:{$if:[{$isEven:[{$value:"$index"}]},{$palette:"stroke"},{$mix:[{$path:["../$prevIndex/fill",{$palette:"stroke"}]},{$ref:"backgroundColor"},.7]}]},...r},...s}}}(t,e,A):void 0,R=[w?(l=e,n=i,o=(m=e=>!!e&&Object.keys(e).some(t=>dD(e[t],"title.enabled",!1)))(x)||m(F),p=l.getExtraPaddingDirections(),{common:{...n?{animation:{duration:500}}:void 0,axes:dJ,padding:{top:!o&&p.includes("top")?40:20,right:p.includes("right")?30:20,bottom:p.includes("bottom")?40:20,left:p.includes("left")?30:20}}}):void 0,{pie:{series:{title:{_enabledFromTheme:!0},calloutLabel:{_enabledFromTheme:!0},sectorLabel:{enabled:!1,_enabledFromTheme:!0}}},donut:{series:{title:{_enabledFromTheme:!0},calloutLabel:{_enabledFromTheme:!0},sectorLabel:{enabled:!1,_enabledFromTheme:!0}}}},s,M,x,F,{...f??{}},r].filter(e=>!!e).reduce((e,t)=>({baseTheme:e,overrides:t}),S);return C&&y===v&&(d=C,h=e.agChartsExports._Theme.getChartTheme(S).palette,!((g=(e,t)=>e===t||e?.length===t?.length&&(e?.every((e,i)=>e===t?.[i])??!1))(d.fills,h.fills)&&g(d.strokes,h.strokes)))&&(R.palette=C),R}(this.chartProxyParams,this,this.agChartsExports.isEnterprise,this.getChartThemeDefaults(),e??i);return{...t,mode:"integrated",...s?{styleNonce:s}:{},suppressFieldDotNotation:!0,theme:r,container:this.chartProxyParams.parentElement}}getChartThemeDefaults(){let e={enabled:!0,snap:!0,label:{enabled:!1}},t=this.agChartsExports.isEnterprise?{zoom:{enabled:!0},animation:{enabled:!0,duration:500},axes:{number:{crosshair:e},category:{crosshair:e},log:{crosshair:e},time:{crosshair:e}}}:{};t.minHeight=0,t.minWidth=0,t.navigator={enabled:!1,height:18},t.context=this.chartProxyParams.context;let i={common:t};return this.setSeriesChartThemeDefaults(i),i}setSeriesChartThemeDefaults(e){let t=this.getSeriesChartThemeDefaults();t&&(e[this.standaloneChartType]=t)}getSeriesChartThemeDefaults(){}getActiveFormattingPanelOverrides(){if(this.clearThemeOverrides)return{};let e=this.chart?.getOptions().theme;return e?.overrides??{}}destroy({keepChartInstance:e=!1}={}){if(e)return this.chart.resetAnimations(),this.chart;this.destroyChart()}destroyChart(){this.chart&&(this.chart.destroy(),this.chart=void 0)}},d2=class extends d1{constructor(){super(...arguments),this.crossFilteringAllPoints=new Set,this.crossFilteringSelectedPoints=[]}getUpdateOptions(e,t){let i=this.getAxes(e,t);return{...t,data:this.getData(e,i),axes:i,series:this.getSeries(e)}}getData(e,t){let i=["area","line"].includes(this.standaloneChartType);return this.crossFiltering&&i?this.getCrossFilterData(e):this.getDataTransformedData(e,t)}getDataTransformedData(e,t){let i=t.x.type,{categories:s,data:r}=e,[a]=s;switch(i){case"category":return this.transformCategoryData(r,a.id);case"time":return this.transformTimeData(r,a.id,a.convertTime);default:return r}}getXAxisType(e){return e.grouping?"grouped-category":this.isXAxisOfType(e,"time",e=>e instanceof Date)?"time":this.isXAxisOfType(e,"number")?"number":"category"}isXAxisOfType(e,t,i){let[s]=e.categories;if(s?.chartDataType)return s.chartDataType===t;if(!i)return!1;let r=e.data[0];return!!r&&i(r[s.id])}transformTimeData(e,t,i){return e[0]?.[t]instanceof Date?e:e.map(e=>{let s=e[t];return"string"==typeof s?{...e,[t]:i?i(s):(0,m._parseDateTimeFromString)(s)}:e})}crossFilteringReset(){this.crossFilteringSelectedPoints=[],this.crossFilteringAllPoints.clear()}crossFilteringPointSelected(e){return 0==this.crossFilteringSelectedPoints.length||this.crossFilteringSelectedPoints.includes(e)}crossFilteringDeselectedPoints(){return this.crossFilteringSelectedPoints.length>0&&this.crossFilteringAllPoints.size!==this.crossFilteringSelectedPoints.length}extractLineAreaCrossFilterSeries(e,t){let[i]=t.categories,s=e=>"area"===this.standaloneChartType?t.getCrossFilteringContext().lastSelectedChartId===t.chartId?e+"-total":e:e+"-total";return e.map(e=>(e.yKey=s(e.yKey),e.listeners={seriesNodeClick:t=>{let i=t.datum[e.xKey],s=t.event.metaKey||t.event.ctrlKey;this.crossFilteringAddSelectedPoint(s,i),this.crossFilterCallback(t)}},e.marker={itemStyler:e=>{let t=e.datum[i.id],s="highlighted-item"===e.highlightState;return{fill:s?"yellow":e.fill,size:s?14:8*!!this.crossFilteringPointSelected(t)}}},"area"===this.standaloneChartType&&(e.fillOpacity=this.crossFilteringDeselectedPoints()?.3:1),"line"===this.standaloneChartType&&(e.strokeOpacity=this.crossFilteringDeselectedPoints()?.3:1),e))}getCrossFilterData(e){this.crossFilteringAllPoints.clear();let[t]=e.categories,i=e.fields[0].colId,s=`${i}-filtered-out`,r=e.getCrossFilteringContext().lastSelectedChartId;return e.data.map(a=>{let l=a[t.id];this.crossFilteringAllPoints.add(l);let n=this.crossFilteringPointSelected(l);return"area"===this.standaloneChartType&&r===e.chartId&&(a[`${i}-total`]=n?a[i]:a[i]+a[s]),"line"===this.standaloneChartType&&(a[`${i}-total`]=n?a[i]:a[i]+a[s]),a})}crossFilteringAddSelectedPoint(e,t){e?this.crossFilteringSelectedPoints.push(t):this.crossFilteringSelectedPoints=[t]}isHorizontal(e){let t=this.standaloneChartType;if("waterfall"!==t&&"box-plot"!==t&&"range-bar"!==t)return!1;let i=e.theme,s=e=>{let i=e?.overrides?.[t]?.series?.direction;return null!=i?"horizontal"===i:"object"==typeof e?.baseTheme&&s(e.baseTheme)};return s(i)}getSeriesChartThemeDefaults(){return{series:{highlight:d0(this.crossFiltering)}}}},d5=class extends d2{getSeries(e){let t=e.fields[0];return[{type:this.standaloneChartType,xKey:t.colId,xName:t.displayName,yName:this.chartProxyParams.translate("histogramFrequency"),areaPlot:!1}]}getAxes(e){return{x:{type:"number",position:"bottom"},y:{type:"number",position:"left"}}}},d4=class extends d2{getAxes(e,t){let i=this.isHorizontal(t);return{[i?"y":"x"]:{type:this.getXAxisType(e),position:i?"left":"bottom"},[i?"x":"y"]:{type:"number",position:i?"bottom":"left"}}}getSeries(e){let[t]=e.categories,[i]=e.fields;return[{type:this.standaloneChartType,xKey:t.id,xName:t.name,yKey:i.colId,yName:i.displayName??void 0}]}},d3=class extends d1{getUpdateOptions(e,t){return{...t,data:this.transformFunnelCategories(e),series:this.getSeries(e)}}transformFunnelCategories(e){let{data:t}=e,[{id:i}]=e.categories;return t.map((e,t)=>({...e,[i]:{name:e[i],id:t,toString:()=>String(e[i])}}))}getSeriesChartThemeDefaults(){let e={crosshair:{enabled:!1}};return{zoom:{enabled:!1},..."pyramid"!==this.chartType&&{axes:{category:e,number:e}}}}getSeries(e){let[{id:t}]=e.categories,[{colId:i}]=e.fields;return[{type:this.standaloneChartType,stageKey:t,valueKey:i}]}},d6="AG-GRID-DEFAULT-LABEL-KEY";function d8(e,t=null,i){let{depth:s,rootValues:r,value:a,children:l}=e;if(r)return r.map(e=>({[d6]:t,...e}));if(0===s)return[{[d6]:t,...a}];let n=[];for(let[e,t]of l.entries())n.push(...d8(t,e,!0));return i?[{[d6]:t,children:n,...a??{}}]:n}function d7(e,t,i){let s={depth:0,children:new Map};for(let r of e){let e=t(r);!function e(t,i,s,r,a){if(r===i)return 0===r?(a.rootValues||(a.rootValues=[]),a.rootValues.push(t)):a.value=t,a;{let l=s(t,r),n=e(t,i,s,r+1,a.children.get(l)||{depth:0,children:new Map});return a.children.set(l,n),a.depth=Math.max(1+n.depth,a.depth),a}}(r,e,i,0,s)}return s}var d9=class extends d1{getUpdateOptions(e,t){let{fields:i}=e,[s,r]=i;return{...t,series:this.getSeries(s,r),data:this.getData(e,s,r)}}getSeriesChartThemeDefaults(){return{gradientLegend:{gradient:{preferredLength:200},position:"right"}}}getSeries(e,t){return[{type:this.standaloneChartType,labelKey:d6,sizeKey:e?.colId,sizeName:e?.displayName??void 0,colorKey:t?.colId,colorName:t?.displayName??void 0}]}getData(e,t,i){var s,r;let{categories:a,data:l,groupData:n,grouping:o}=e;if(o)return s=i?l.concat(n?.map(e=>{let i={...e};return delete i[t.colId],i})??[]):l,r=e=>e[m.GROUP_AUTO_COLUMN_ID]?.value??null,d8(d7(s,function(e){return r(e)?.length??0},function(e,t){let i=r(e);return i?i[t]:i}));{let e=a.map(({id:e})=>e);return d8(d7(l,function(t){return e.length},function(t,i){var s;return null==(s=t[e[i]])?null:String(s)}))}}},he=class extends d1{getAxes(e){let t="radial-bar"===this.standaloneChartType;return{angle:{type:t?"angle-number":"angle-category"},radius:{type:t?"radius-category":"radius-number"}}}getSeries(e){let{fields:t,categories:i,seriesGroupType:s}=e,[r]=i,a="radial-bar"===this.standaloneChartType,l=this.getSeriesGroupTypeOptions(s);return t.map(e=>({type:this.standaloneChartType,angleKey:a?e.colId:r.id,angleName:a?e.displayName??void 0:r.name,radiusKey:a?r.id:e.colId,radiusName:a?r.name:e.displayName??void 0,...l}))}getSeriesGroupType(){let e=this.standaloneChartType;if(!["nightingale","radial-bar","radial-column"].includes(e))return;let t=this.getChart().series?.[0]?.properties.toJson(),i=()=>t.normalizedTo?"normalized":"stacked";return"nightingale"===e?t.grouped?"grouped":i():t.stacked?i():"grouped"}getUpdateOptions(e,t){let i=this.getAxes(e);return{...t,data:this.getData(e,i),axes:i,series:this.getSeries(e)}}getData(e,t){if("angle-category"!==t.angle.type&&"radius-category"!==t.radius.type)return e.data;{let[t]=e.categories;return this.transformCategoryData(e.data,t.id)}}getSeriesGroupTypeOptions(e){return e?{grouped:"grouped"===e||void 0,stacked:"grouped"!==e||void 0,normalizedTo:"normalized"===e?100:void 0}:{}}getSeriesChartThemeDefaults(){return{series:{highlight:d0(this.crossFiltering)}}}},ht=class extends d1{getUpdateOptions(e,t){let i="AG-GRID-DEFAULT-HEATMAP-SERIES-KEY",s="AG-GRID-DEFAULT-HEATMAP-VALUE-KEY",r="AG-GRID-DEFAULT-HEATMAP-CATEGORY-KEY";return{...t,series:this.getSeries(e,i,s,r),data:this.getData(e,i,s,r)}}getSeries(e,t,i,s){let[r]=e.categories;return[{type:this.standaloneChartType,yKey:s,xKey:t,colorKey:i,yName:r.name,xName:void 0,colorName:void 0}]}getData(e,t,i,s){var r,a;let[l]=e.categories;return r=e.data,a=(r,a)=>{let n=r[l.id],o=null==n?"":String(n),d={id:a,value:n,toString:()=>o};return e.fields.map(({colId:e,displayName:a})=>({...r,[t]:a,[i]:r[e],[s]:d}))},r.reduce((e,t,i,s)=>e.concat(a(t,i,s)),[])}getSeriesChartThemeDefaults(){return{gradientLegend:{gradient:{preferredLength:200},position:"right"},series:{tooltip:{renderer:hi}}}}};function hi(e){let{xKey:t,yKey:i,colorKey:s,yName:r,datum:a}=e;return{title:"",data:[{label:r,value:a[i]},{label:a[t],value:s&&a[s]}].map(({label:e,value:t})=>({label:String(e),value:String(t)}))}}var hs=class extends m.BeanStub{wireBeans(e){this.sortSvc=e.sortSvc,this.gridRowModel=e.rowModel,this.colModel=e.colModel,this.valueSvc=e.valueSvc,this.pivotResultCols=e.pivotResultCols,this.rowNodeSorter=e.rowNodeSorter}getData(e){if(e.crossFiltering){if(e.grouping)return(0,m._warn)(141),{chartData:[],colNames:{}};if(!(0,m._isClientSideRowModel)(this.gos))return(0,m._warn)(142),{chartData:[],colNames:{}}}(0,m._isServerSideRowModel)(this.gos)&&e.pivoting&&this.updatePivotKeysForSSRM();let t=this.extractRowsFromGridRowModel(e);return t.chartData=this.aggregateRowsByDimension(e,t.chartData),t}extractRowsFromGridRowModel(e){let t,i,{crossFiltering:s,startRow:r,endRow:a,valueCols:l,dimensionCols:n,grouping:o,crossFilteringSort:d,combineGroupValues:h}=e,u=[],c={},p={},g={},m={},f=[];if(s)m=this.getFilteredRowNodes(),t=(f=this.getAllRowNodes(d)).length;else{let e=this.gridRowModel.getRowCount()-1;t=r===a&&0===r&&0===n.length&&0===l.length?0:(a>=0?Math.min(a,e):e)-r+1}if(t>0)for(let e of l){let t=[],i=e.getColDef().pivotKeys;i&&(t=i.slice());let s=e.getColDef().headerName;s&&t.push(s),t.length>0&&(c[e.getId()]=t)}let C=0,v=0,b={};for(let i=0;i<t;i++){let t=s?f[i]:this.gridRowModel.getRow(i+r);if(t.footer||t.detail){C++;continue}let a={node:t};for(let e of n){let s=e.colId,r=this.colModel.getCol(s);if(r){let e=this.valueSvc.getValue(r,t,"data");if(o){let r=e?.toString?String(e.toString()):" ",l=this.getGroupLabels(t,r),n=l.slice().reverse(),o={value:n,id:v++,toString:()=>n.filter(Boolean).join(" - ")};if(h){let e=o.toString(),t=b[e];t?o=t:b[e]=o}a[s]=o,t.group&&(p[l.toString()]=i-C);let d=l.slice(1,l.length).toString();d&&(g[d]=p[d])}else a[s]=e}else a[hn]=i+1}for(let i of l){let r=i.getColId();if(s){let s=r+"-filtered-out",l=this.valueSvc.getValue(i,t,"data"),n=l;null!=l&&("function"==typeof l.toNumber?n=l.toNumber():"number"==typeof l.value&&(n=l.value)),m[t.id]?(a[r]=n,a[s]=e.aggFunc||e.isScatter?void 0:0):(a[r]=e.aggFunc||e.isScatter?void 0:0,a[s]=n)}else{let e=this.valueSvc.getValue(i,t,"data");e&&"number"==typeof e.value&&(e=e.value),e&&Object.prototype.hasOwnProperty.call(e,"toString")&&(e=parseFloat(e.toString())),a[r]=null!=e&&"function"==typeof e.toNumber?e.toNumber():e}}u.push(a)}if(o){let e=Object.values(g),t=u;u=[],i=[];for(let s=0;s<t.length;s++)(e.includes(s)?i:u).push(t[s])}return{chartData:u,colNames:c,groupChartData:i}}aggregateRowsByDimension(e,t){let i=e.dimensionCols;if(!e.aggFunc||0===i.length)return t;let s=(0,m._last)(i),r=s?.colId,a={},l=[];for(let e of t){let t=a;for(let s of i){let a=s.colId,n=e[a];if(a===r){let s=t[n];if(!s){for(let t of(s={__children:[]},i)){let i=t.colId;s[i]=e[i]}t[n]=s,l.push(s)}s.__children.push(e)}else t[n]||(t[n]={}),t=t[n]}}if(this.gos.assertModuleRegistered("SharedAggregation",1))for(let t of l)for(let i of e.valueCols){let s=i.getColId();if(e.crossFiltering){let r=t.__children.filter(e=>void 0!==e[s]).map(e=>e[s]),a=ay({beans:this.beans,values:r,aggFuncOrString:e.aggFunc,column:i,rowNode:void 0,pivotResultColumn:void 0,aggregatedChildren:[]});t[s]=a&&void 0!==a.value?a.value:a;let l=`${s}-filtered-out`,n=t.__children.filter(e=>void 0!==e[l]).map(e=>e[l]),o=ay({beans:this.beans,values:n,aggFuncOrString:e.aggFunc,column:i,rowNode:void 0,pivotResultColumn:void 0,aggregatedChildren:[]});t[l]=o&&void 0!==o.value?o.value:o}else{let r=t.__children.map(e=>e[s]),a=ay({beans:this.beans,values:r,aggFuncOrString:e.aggFunc,column:i,rowNode:void 0,pivotResultColumn:void 0,aggregatedChildren:[]});t[s]=a&&void 0!==a.value?a.value:a}}return l}updatePivotKeysForSSRM(){let e=this.pivotResultCols?.getPivotResultCols()?.list;if(!e)return;let t=this.extractPivotKeySeparator(e);for(let i of e)if(""===t)i.getColDef().pivotKeys=[];else{let e=i.getColId().split(t);i.getColDef().pivotKeys=e.slice(0,e.length-1)}}extractPivotKeySeparator(e){if(0===e.length)return"";let t=(e,i)=>{let s=e.getGroupId();return e.getParent()?t(e.getParent(),s):i.split(s)[1][0]},i=e[0];return null==i.getParent()?"":t(i.getParent(),i.getColId())}getGroupLabels(e,t){let i=[t];for(;e&&0!==e.level;)if(e=e.parent)if(e.group){let t=this.colModel.getCol(m.GROUP_AUTO_COLUMN_ID);if(t){let s=this.valueSvc.getValue(t,e,"data"),r=s?.toString?String(s.toString()):" ";i.push(r)}}else i.push(e.key);return i}getFilteredRowNodes(){let e={};return this.gridRowModel.forEachNodeAfterFilterAndSort(t=>{e[t.id]=t}),e}getAllRowNodes(e){let t=[];this.gridRowModel.forEachNode(e=>{t.push(e)});let i=this.rowNodeSorter;if(!i)return t;let s=!0===e?this.sortSvc?.getSortOptions():e;return s&&0!=s.length?i.doFullSortInPlace(t,s):t}},hr=class extends m.BeanStub{constructor(){super(...arguments),this.valueColsWithoutSeriesType=new Set}wireBeans(e){this.colModel=e.colModel,this.colNames=e.colNames,this.valueSvc=e.valueSvc}postConstruct(){let e=()=>this.valueColsWithoutSeriesType.clear();this.addManagedEventListeners({newColumnsLoaded:e,rowDataUpdated:e})}getColumn(e){return this.colModel.getColDefCol(e)}getAllDisplayedColumns(){return this.beans.visibleCols.allCols}getColDisplayName(e){return this.colNames.getDisplayNameForColumn(e,"chart")}getColGroupDisplayName(e){return this.colNames.getDisplayNameForColumnGroup(e,"chart")}getRowGroupColumns(){return this.beans.rowGroupColsSvc?.columns??[]}getGroupDisplayColumns(){return this.beans.showRowGroupCols?.columns??[]}isPivotMode(){return this.colModel.isPivotMode()}isPivotActive(){return this.colModel.isPivotActive()}getChartColumns(){let e=this.colModel.getCols(),t=new Set,i=new Set;for(let s of e){let e=s.getColDef(),r=e.chartDataType;if(r)switch(r){case"category":case"time":t.add(s);continue;case"series":i.add(s);continue;case"excluded":continue;default:(0,m._warn)(153,{chartDataType:r})}if("ag-Grid-AutoColumn"===e.colId){t.add(s);continue}if(!s.isPrimary()){i.add(s);continue}(this.isInferredValueCol(s)?i:t).add(s)}return{dimensionCols:t,valueCols:i}}isInferredValueCol(e){let t=e.getColId();if("ag-Grid-AutoColumn"===t)return!1;let i=(0,m._getRowNode)(this.beans,{rowIndex:0,rowPinned:null});if(!i)return this.valueColsWithoutSeriesType.has(t);let s=this.valueSvc.getValue(e,i,"data");null==s&&(s=this.extractLeafData(i,e)),null!=s&&("function"==typeof s.toNumber?s=s.toNumber():"number"==typeof s.value&&(s=s.value));let r="number"==typeof s||"number"===e.colDef.cellDataType||["series","time"].includes(e.colDef.chartDataType);return r?this.valueColsWithoutSeriesType.add(t):null==s&&"number"!==e.colDef.cellDataType&&(0,m._warn)(265,{colId:t}),r}extractLeafData(e,t){let i=e.data&&this.valueSvc.getValue(t,e,"data");if(null!=i)return i;let s=e.childrenAfterGroup;if(s)for(let e=0,i=s.length;e<i;++e){let i=s[e],r=this.extractLeafData(i,t);if(null!=r)return r}return null}destroy(){this.valueColsWithoutSeriesType.clear(),super.destroy()}},ha=new Set(["line","groupedColumn","stackedColumn","area","stackedArea"]),hl=class extends m.BeanStub{constructor(e){super(),this.suppressComboChartWarnings=!1,this.chartDataModel=e,this.seriesChartTypes=e.params.seriesChartTypes??[]}postConstruct(){this.initComboCharts()}update(e){this.seriesChartTypes=e??this.seriesChartTypes,this.initComboCharts(),this.updateSeriesChartTypes()}initComboCharts(){let e=this.seriesChartTypes&&this.seriesChartTypes.length>0;("customCombo"===this.chartDataModel.chartType||e)&&(this.chartDataModel.chartType="customCombo",this.savedCustomSeriesChartTypes=this.seriesChartTypes||[])}updateSeriesChartTypes(){if(this.chartDataModel.isComboChart()){if(this.seriesChartTypes=this.seriesChartTypes.map(e=>{let t=["groupedColumn","stackedColumn","stackedArea"].includes(e.chartType);return e.secondaryAxis=!t&&e.secondaryAxis,e}),"customCombo"===this.chartDataModel.chartType)return void this.updateSeriesChartTypesForCustomCombo();this.updateChartSeriesTypesForBuiltInCombos()}}updateSeriesChartTypesForCustomCombo(){this.seriesChartTypes&&this.seriesChartTypes.length>0||this.suppressComboChartWarnings||(0,m._warn)(150),this.seriesChartTypes=this.seriesChartTypes.map(e=>(ha.has(e.chartType)||((0,m._warn)(151,{chartType:e.chartType}),e.chartType="line"),e));let e=e=>{this.savedCustomSeriesChartTypes&&0!==this.savedCustomSeriesChartTypes.length||(this.savedCustomSeriesChartTypes=this.seriesChartTypes);let t=this.savedCustomSeriesChartTypes.find(t=>t.colId===e.colId);return t||(e.selected&&!this.suppressComboChartWarnings&&(0,m._warn)(152,{colId:e.colId}),{colId:e.colId,chartType:"line",secondaryAxis:!1})},t=this.chartDataModel.valueColState.map(e);this.seriesChartTypes=t,this.savedCustomSeriesChartTypes=t,this.suppressComboChartWarnings=!0}updateChartSeriesTypesForBuiltInCombos(){let{chartType:e,valueColState:t}=this.chartDataModel,i="columnLineCombo"===e?"groupedColumn":"stackedArea",s="columnLineCombo"===e?"line":"groupedColumn",r=t.filter(e=>e.selected),a=Math.ceil(r.length/2);this.seriesChartTypes=r.map((e,t)=>({colId:e.colId,chartType:t>=a?s:i,secondaryAxis:!1}))}},hn="AG-GRID-DEFAULT-CATEGORY",ho=class extends m.BeanStub{constructor(e){super(),this.unlinked=!1,this.chartData=[],this.valueColState=[],this.dimensionColState=[],this.colNames={},this.crossFiltering=!1,this.crossFilteringSort=!0,this.grouping=!1,this.useGroupColumnAsCategory=!1,this.params=e,this.chartId=e.chartId,this.setParams(e)}wireBeans(e){this.rangeSvc=e.rangeSvc,this.chartTranslation=e.chartTranslation}setParams(e){let{chartType:t,pivotChart:i,chartThemeName:s,switchCategorySeries:r,aggFunc:a,cellRange:l,suppressChartRanges:n,unlinkChart:o,crossFiltering:d,crossFilteringSort:h,seriesGroupType:u,useGroupColumnAsCategory:c}=e;this.chartType=t,this.pivotChart=i??!1,this.chartThemeName=s,this.switchCategorySeries=!!r,this.aggFunc=a,this.referenceCellRange=l,this.suppliedCellRange=l,this.suppressChartRanges=n??!1,this.unlinked=!!o,this.crossFiltering=!!d,this.crossFilteringSort=h??!0,this.seriesGroupType=u,this.useGroupColumnAsCategory=!!c}postConstruct(){this.datasource=this.createManagedBean(new hs),this.chartColSvc=this.createManagedBean(new hr),this.comboChartModel=this.createManagedBean(new hl(this)),this.updateCellRanges({setColsFromRange:!0}),this.updateData()}updateModel(e){let{cellRange:t,seriesChartTypes:i}=e;t!==this.suppliedCellRange&&(this.dimensionCellRange=void 0,this.valueCellRange=void 0),this.setParams(e),this.updateSelectedDimensions(t?.columns),this.updateCellRanges({setColsFromRange:!0}),(this.isComboChart()||i)&&this.comboChartModel.update(i),this.unlinked||this.updateData()}updateCellRanges(e){let{updatedColState:t,resetOrder:i,maintainColState:s,setColsFromRange:r}=e??{};this.valueCellRange&&(this.referenceCellRange=this.valueCellRange);let{dimensionCols:a,valueCols:l}=this.chartColSvc.getChartColumns(),n=this.getAllColumnsFromRanges();t&&this.updateColumnState(t,i),this.setDimensionCellRange(a,n,t),this.setValueCellRange(l,n,r),t||s||(this.resetColumnState(),this.syncDimensionCellRange()),this.comboChartModel.updateSeriesChartTypes()}updateData(){let{startRow:e,endRow:t}=this.getRowIndexes();this.pivotChart&&this.resetColumnState(),this.grouping=this.isGrouping();let i={aggFunc:this.aggFunc,dimensionCols:this.getSelectedDimensions(),grouping:this.grouping,pivoting:this.isPivotActive(),crossFiltering:this.crossFiltering,crossFilteringSort:this.getCrossFilteringSort(),valueCols:this.getSelectedValueCols(),startRow:e,endRow:t,isScatter:["scatter","bubble"].includes(this.chartType),combineGroupValues:dO(dW(this.chartType),"isStatistical")},{chartData:s,colNames:r,groupChartData:a}=this.datasource.getData(i);this.chartData=s,this.groupChartData=a,this.colNames=r,this.categoryAxisType=void 0}isGrouping(){let e=this.gos.get("treeData"),t=e?null:this.chartColSvc.getRowGroupColumns(),i=e||t&&t.length>0,s=this.getSelectedDimensions().map(({colId:e})=>e),r=this.chartColSvc.getGroupDisplayColumns().map(e=>e.getColId()).some(e=>s.includes(e));return!!i&&r}getSelectedValueCols(){return this.valueColState.filter(e=>e.selected).map(e=>e.column)}getSelectedDimensions(){return this.dimensionColState.filter(e=>e.selected)}getValueColState(){return this.valueColState.map(this.displayNameMapper.bind(this))}displayNameMapper(e){let{column:t}=e;if(t){let i=this.getColDisplayName(t);e.displayName=this.isPivotMode()?this.getPivotDisplayName(t,i):i}else{let i=this.colNames[e.colId];e.displayName=i?i.join(" - "):this.getColDisplayName(t)}return e}getPivotDisplayName(e,t){let i=!1,s=[t],r=e=>{if(!e)return;let t=this.chartColSvc.getColGroupDisplayName(e);t?.length?(s.unshift(t),r(e.getParent())):i=!0};if(r(e.getParent()),i){let t=this.colNames[e.getColId()];t&&(s=t)}return s.join(" - ")}getColDisplayName(e){return this.chartColSvc.getColDisplayName(e)}isPivotMode(){return this.chartColSvc.isPivotMode()}getChartDataType(e){let t=this.chartColSvc.getColumn(e);return t?t.getColDef().chartDataType:void 0}getConvertTime(e){let t=this.chartColSvc.getColumn(e);if(t?.colDef.cellDataType==="dateString")return this.beans.dataTypeSvc?.getDateParserFunction(t)}isPivotActive(){return this.chartColSvc.isPivotActive()}createCellRange(e,...t){return{id:this.chartId,startRow:this.referenceCellRange.startRow,endRow:this.referenceCellRange.endRow,columns:t,startColumn:e===m.CellRangeType.DIMENSION||null==this.referenceCellRange.startColumn?t[0]:this.referenceCellRange.startColumn,type:e}}getAllColumnsFromRanges(){if(this.pivotChart)return new Set(this.chartColSvc.getAllDisplayedColumns());let e=this.dimensionCellRange||this.valueCellRange?[]:this.referenceCellRange.columns;return this.dimensionCellRange&&e.push(...this.dimensionCellRange.columns),this.valueCellRange&&e.push(...this.valueCellRange.columns),new Set(e)}getRowIndexes(){let e=0,t=0,{rangeSvc:i,valueCellRange:s,dimensionCellRange:r}=this,a=s||r;if(i&&a){e=i.getRangeStartRow(a).rowIndex;let s=i.getRangeEndRow(a);t="bottom"===s.rowPinned?-1:s.rowIndex}return{startRow:e,endRow:t}}resetColumnState(){let{dimensionCols:e,valueCols:t}=this.chartColSvc.getChartColumns(),i=this.getAllColumnsFromRanges(),s=this.valueColState.length<1;this.dimensionColState=[],this.valueColState=[];let r=dH(dW(this.chartType)),a=!1,l=1,n=this.suppliedCellRange.columns[0],o=this.gos.get("treeData"),d=o?null:this.chartColSvc.getRowGroupColumns(),h=o||d&&d.length>0;e.forEach(e=>{let t=(0,m.isColumnGroupAutoCol)(e),s=this.crossFiltering&&this.aggFunc?n.getColId()===e.getColId():this.useGroupColumnAsCategory&&h&&t||(!a||r)&&i.has(e);this.dimensionColState.push({column:e,colId:e.getColId(),displayName:this.getColDisplayName(e),selected:s,order:l++}),s&&(a=!0)});let u={colId:hn,displayName:this.chartTranslation.translate("defaultCategory"),selected:!a,order:0};this.dimensionColState.unshift(u);let c=this.referenceCellRange.columns.filter(e=>t.has(e));t.forEach(e=>{s&&this.referenceCellRange.columns.includes(e)&&(e=c.shift()),this.valueColState.push({column:e,colId:e.getColId(),displayName:this.getColDisplayName(e),selected:i.has(e),order:l++})})}updateColumnState(e,t){let i=t=>t.colId===e.colId,{dimensionColState:s,valueColState:r}=this,a=s.find(i),l=r.find(i);if(a)if(dH(dW(this.chartType)))a.selected=e.selected;else{let t=e.selected?a:s.filter(e=>e!==a).find(({selected:e})=>e);s.forEach(e=>e.selected=e===t)}else l&&(l.selected=e.selected);let n=[...s,...r],o=[];t||(n.forEach((t,i)=>{i===e.order&&o.push(e.colId),t.colId!==e.colId&&o.push(t.colId)}),n.forEach(e=>{let t=o.indexOf(e.colId);e.order=t>=0?o.indexOf(e.colId):n.length-1})),this.reorderColState()}reorderColState(){let e=(e,t)=>e.order-t.order;this.dimensionColState.sort(e),this.valueColState.sort(e)}setDimensionCellRange(e,t,i){this.dimensionCellRange=void 0;let s=dH(dW(this.chartType));if(!i&&!this.dimensionColState.length){let i=[];e.forEach(e=>{(!(i.length>0)||s)&&t.has(e)&&i.push(e)}),i.length>0&&(this.dimensionCellRange=this.createCellRange(m.CellRangeType.DIMENSION,...i));return}let r=i?[i]:[];if(this.crossFiltering&&this.aggFunc){let e=this.suppliedCellRange.columns[0];r=this.dimensionColState.filter(t=>t.colId===e.getColId())}else(s||0===r.length||r.some(({column:t})=>!t||!e.has(t)))&&(r=this.dimensionColState.filter(e=>e.selected));let a=1===r.length&&r[0].colId===hn,l=r.map(({column:e})=>e).filter(e=>null!=e);l.length>0&&!a&&(this.dimensionCellRange=this.createCellRange(m.CellRangeType.DIMENSION,...l))}setValueCellRange(e,t,i){this.valueCellRange=void 0;let s=[],r=dj(this.chartType),a=0;if(e.forEach(e=>{i?(null==r||a<r)&&t.has(e)&&(s.push(e),a++):this.valueColState.some(t=>t.selected&&t.colId===e.getColId())&&s.push(e)}),s.length>0){let e=[];this.valueColState.length>0?e=this.valueColState.map(e=>e.colId):t.forEach(t=>e.push(t.getColId())),s.sort((t,i)=>e.indexOf(t.getColId())-e.indexOf(i.getColId())),this.valueCellRange=this.createCellRange(m.CellRangeType.VALUE,...s)}}resetCellRanges(e,t){if(!e&&!t)return;let{dimensionCols:i,valueCols:s}=this.chartColSvc.getChartColumns(),r=this.getAllColumnsFromRanges();e&&this.setDimensionCellRange(i,r),t&&this.setValueCellRange(s,r)}updateSelectedDimensions(e){let t=new Set(e.map(e=>e.getColId()));if(dH(dW(this.chartType))){let e=new Set(this.dimensionColState.filter(e=>t.has(e.colId)).map(e=>e.colId));this.dimensionColState=this.dimensionColState.map(t=>({...t,selected:e.has(t.colId)}))}else{let e=(this.dimensionColState.find(e=>t.has(e.colId))||this.dimensionColState[0]).colId;this.dimensionColState=this.dimensionColState.map(t=>({...t,selected:t.colId===e}))}}syncDimensionCellRange(){let e=this.getSelectedDimensions();if(0===e.length)return;let t=e.map(({column:e})=>e).filter(e=>null!=e);t.length>0&&(this.dimensionCellRange=this.createCellRange(m.CellRangeType.DIMENSION,...t))}isComboChart(e){var t;return t=e??this.chartType,dL.has(t)}getCrossFilteringSort(){let e=this.crossFilteringSort;if("boolean"==typeof e)return e;let t=[];return e.forEach(({sort:e,colId:i})=>{let s=this.chartColSvc.getColumn(i);s&&t.push({sort:e,column:s,type:(0,m._normalizeSortType)(s.getSortDef()?.type)})}),t}},hd=class extends d2{getAxes(e,t){return{x:{type:this.getXAxisType(e),position:this.isHorizontal(t)?"left":"bottom"},y:{type:"number",position:this.isHorizontal(t)?"bottom":"left"}}}computeSeriesStatistics(e,t){let{data:i,fields:s}=e,[r]=e.categories,a=r.id||hn;return Array.from(this.groupDataByCategory(a,i)).map(([e,i])=>{let a={[r.id]:e};return s.forEach((e,s)=>{let r=i.map(t=>t[e.colId]).filter(e=>"number"==typeof e&&!isNaN(e)),l=t(r);for(let e of Object.keys(l))a[`${e}:${s}`]=r.length>0?l[e]:null}),a})}groupDataByCategory(e,t){return t.reduce((t,i)=>{let s=(t=>{if(e===hn)return 1;let i=t[e];return null==i?"":i instanceof Date?i.getTime():i})(i),r=t.get(s);return r?r.push(i):t.set(s,[i]),t},new Map)}},hh=class extends hd{getSeries(e){let[t]=e.categories;return e.fields.map((e,i)=>({type:this.standaloneChartType,xKey:t.id,xName:t.name,yName:e.displayName??void 0,minName:"Min",q1Name:"Q1",medianName:"Median",q3Name:"Q3",maxName:"Max",minKey:`min:${i}`,q1Key:`q1:${i}`,medianKey:`median:${i}`,q3Key:`q3:${i}`,maxKey:`max:${i}`}))}getData(e){return this.computeSeriesStatistics(e,e=>{let t=e.sort((e,t)=>e-t);return{min:t[0],q1:this.quantile(t,.25),median:this.quantile(t,.5),q3:this.quantile(t,.75),max:t[t.length-1]}})}quantile(e,t){let i=(e.length-1)*t,s=Math.floor(i);return void 0!==e[s+1]?e[s]+(i-s)*(e[s+1]-e[s]):e[s]}},hu=class extends hd{getSeries(e){let[t]=e.categories;return e.fields.map((e,i)=>({type:this.standaloneChartType,xKey:t.id,xName:t.name,yName:e.displayName??void 0,yLowName:"Min",yHighName:"Max",yLowKey:`min:${i}`,yHighKey:`max:${i}`}))}getData(e){return this.computeSeriesStatistics(e,e=>({min:Math.min(...e),max:Math.max(...e)}))}},hc=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="enterpriseChartProxyFactory"}createChartProxy(e){switch(e.chartType){case"histogram":return new d5(e);case"radarLine":case"radarArea":case"nightingale":case"radialColumn":case"radialBar":return new he(e);case"rangeBar":case"rangeArea":return new hu(e);case"boxPlot":return new hh(e);case"treemap":case"sunburst":return new d9(e);case"heatmap":return new ht(e);case"waterfall":return new d4(e);case"funnel":case"coneFunnel":case"pyramid":return new d3(e)}}},hp=class extends m.BeanStub{constructor(e,t,i,s){super(),this.chartController=e,this.eGui=t,this.cssClass=i,this.createPanels=s,this.panels=[]}postConstruct(){this.addManagedListeners(this.chartController,{chartUpdated:()=>this.refreshPanels(!0),chartApiUpdate:()=>this.refreshPanels(!1)})}addComponent(e){this.createBean(e),this.panels.push(e),e.addCss(this.cssClass),this.eGui.appendChild(e.getGui())}refreshPanels(e){let t=this.chartController.getChartType(),i=this.chartController.isGrouping(),s=dW(t);e&&t===this.chartType&&i===this.isGrouping||(this.destroyPanels(),this.createPanels(t,s),this.chartType=t,this.isGrouping=i)}destroyPanels(){for(let e of this.panels)(0,m._removeFromParent)(e.getGui()),this.destroyBean(e);this.panels=[]}destroy(){this.destroyPanels(),super.destroy()}},hg=class extends m.Component{constructor(e){super(),this.chartMenuParamsFactory=e}wireBeans(e){this.chartTranslation=e.chartTranslation}postConstruct(){let e=this.chartMenuParamsFactory.addEnableParams("animation.enabled",{cssIdentifier:"charts-advanced-settings-top-level",direction:"vertical",suppressOpenCloseIcons:!0,title:this.chartTranslation.translate("animation"),suppressEnabledCheckbox:!0,useToggle:!0}),t=this.chartMenuParamsFactory.getDefaultNumberInputParams("animation.duration","durationMillis",{min:0});this.setTemplate(`<div>
            <ag-group-component data-ref="animationGroup">
                <ag-input-number-field data-ref="animationHeightInput"></ag-input>
            </ag-group-component>
        </div>`,[tC,m.AgInputNumberFieldSelector],{animationGroup:e,animationHeightInput:t})}},hm=class extends tr{constructor(e){super({...e,dialogCallbacks:tO})}},hf={selector:"AG-COLOR-PICKER",component:hm},hC=class extends m.Component{constructor(e){super(),this.chartMenuParamsFactory=e}wireBeans(e){this.chartTranslation=e.chartTranslation}postConstruct(){let e=this.chartMenuParamsFactory.addEnableParams("crosshair.enabled",{cssIdentifier:"charts-advanced-settings-top-level",direction:"vertical",suppressOpenCloseIcons:!0,title:this.chartTranslation.translate("crosshair"),suppressEnabledCheckbox:!0,useToggle:!0}),t=this.chartMenuParamsFactory.getDefaultCheckboxParams("crosshair.label.enabled","crosshairLabel"),i=this.chartMenuParamsFactory.getDefaultCheckboxParams("crosshair.snap","crosshairSnap"),s=this.chartMenuParamsFactory.getDefaultColorPickerParams("crosshair.stroke","color");this.setTemplate(`<div>
            <ag-group-component data-ref="crosshairGroup">
                <ag-checkbox data-ref="crosshairLabelCheckbox"></ag-checkbox>
                <ag-checkbox data-ref="crosshairSnapCheckbox"></ag-checkbox>
                <ag-color-picker data-ref="crosshairStrokeColorPicker"></ag-color-picker>
            </ag-group-component>
        </div>`,[tC,m.AgCheckboxSelector,hf],{crosshairGroup:e,crosshairLabelCheckbox:t,crosshairSnapCheckbox:i,crosshairStrokeColorPicker:s})}},hv=class extends m.Component{constructor(e){super(),this.chartMenuParamsFactory=e}wireBeans(e){this.chartTranslation=e.chartTranslation}postConstruct(){let e=this.chartMenuParamsFactory.addEnableParams("navigator.enabled",{cssIdentifier:"charts-advanced-settings-top-level",direction:"vertical",suppressOpenCloseIcons:!0,title:this.chartTranslation.translate("navigator"),suppressEnabledCheckbox:!0,useToggle:!0}),t=this.chartMenuParamsFactory.getDefaultSliderParams("navigator.height","height",60);t.minValue=10;let i=this.chartMenuParamsFactory.getDefaultCheckboxParams("navigator.miniChart.enabled","miniChart");this.setTemplate(`<div>
            <ag-group-component data-ref="navigatorGroup">
                <ag-slider data-ref="navigatorHeightSlider"></ag-slider>
                <ag-checkbox data-ref="navigatorMiniChartCheckbox"></ag-checkbox>
            </ag-group-component>
        </div>`,[tC,e7,m.AgCheckboxSelector],{navigatorGroup:e,navigatorHeightSlider:t,navigatorMiniChartCheckbox:i})}},hb=class extends m.Component{constructor(e){super(),this.chartMenuParamsFactory=e,this.zoomScrollingStepInput=m.RefPlaceholder}wireBeans(e){this.chartTranslation=e.chartTranslation}postConstruct(){let e,t=this.chartMenuParamsFactory.addEnableParams("zoom.enabled",{cssIdentifier:"charts-advanced-settings-top-level",direction:"vertical",suppressOpenCloseIcons:!0,title:this.chartTranslation.translate("zoom"),suppressEnabledCheckbox:!0,useToggle:!0}),i=this.chartMenuParamsFactory.getDefaultCheckboxParams("zoom.enableScrolling","scrollingZoom"),s=this.chartMenuParamsFactory.getDefaultSliderParams("zoom.scrollingStep","scrollingStep",1);s.step=.01,s.minValue=s.step;let r=this.chartMenuParamsFactory.getDefaultCheckboxParams("zoom.enableSelecting","selectingZoom");e=i.onValueChange,i.onValueChange=t=>{e&&(e(t),this.zoomScrollingStepInput.setDisabled(!t))},this.setTemplate(`<div>
            <ag-group-component data-ref="zoomGroup">
                <ag-checkbox data-ref="zoomSelectingCheckbox"></ag-checkbox>
                <ag-checkbox data-ref="zoomScrollingCheckbox"></ag-checkbox>
                <ag-slider data-ref="zoomScrollingStepInput"></ag-slider>
            </ag-group-component>
        </div>`,[tC,m.AgCheckboxSelector,e7],{zoomGroup:t,zoomScrollingCheckbox:i,zoomScrollingStepInput:s,zoomSelectingCheckbox:r}),this.zoomScrollingStepInput.setDisabled(!i.value)}},hy=["navigator","zoom","animation","crosshair"],hw=class extends m.Component{constructor(e){super('<div class="ag-chart-advanced-settings-wrapper"></div>'),this.chartMenuContext=e}postConstruct(){this.chartPanelFeature=this.createManagedBean(new hp(this.chartMenuContext.chartController,this.getGui(),"ag-chart-advanced-settings-section",(e,t)=>this.createPanels(e,t))),this.chartPanelFeature.refreshPanels()}createPanels(e,t){for(let e of hy){if(!this.isGroupPanelShownForSeries(e,t))continue;let i=this.createPanel(e);this.chartPanelFeature.addComponent(i)}}isGroupPanelShownForSeries(e,t){return"animation"===e||dV(t)&&!d_(t)}createPanel(e){let{chartMenuParamsFactory:t,chartAxisMenuParamsFactory:i}=this.chartMenuContext;switch(e){case"navigator":return new hv(t);case"zoom":return new hb(t);case"animation":return new hg(t);case"crosshair":return new hC(i)}}},hS=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="advSettingsMenuFactory"}showMenu(e,t){this.hideMenu();let i=this.createBean(new hx(e));this.activeDialog=this.createBean(new tB({title:this.beans.chartTranslation.translate("advancedSettings"),component:i,width:300,height:400,resizable:!0,movable:!0,centered:!0,closable:!0,afterGuiAttached:()=>{(0,m._findFocusableElements)(i.getGui())[0]?.focus()},closedCallback:()=>{this.activeMenu=this.destroyBean(this.activeMenu),this.activeDialog=void 0,t?.focus({preventScroll:!0})}})),this.activeMenu=i}hideMenu(){this.activeDialog&&this.destroyBean(this.activeDialog)}destroy(){this.activeMenu=this.destroyBean(this.activeMenu),this.activeDialog=this.destroyBean(this.activeDialog),super.destroy()}},hx=class extends m.TabGuardComp{constructor(e){super('<div class="ag-chart-advanced-settings"></div>'),this.chartMenuContext=e}postConstruct(){this.advancedSettingsPanel=this.createManagedBean(new hw(this.chartMenuContext)),this.getGui().appendChild(this.advancedSettingsPanel.getGui()),this.initialiseTabGuard({onTabKeyDown:this.onTabKeyDown.bind(this),focusTrapActive:!0})}onTabKeyDown(e){if(e.defaultPrevented)return;e.preventDefault();let t=e.shiftKey,i=this.advancedSettingsPanel.getGui(),s=(0,m._findNextFocusableElement)(this.beans,i,!1,t);if(s)s.focus();else{let e=(0,m._findFocusableElements)(i);e.length&&e[t?e.length-1:0].focus()}}},hF=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="chartMenuListFactory"}wireBeans(e){this.popupSvc=e.popupSvc,this.chartMenuSvc=e.chartMenuSvc,this.chartTranslation=e.chartTranslation}showMenuList(e){let{eventSource:t,showMenu:i,chartMenuContext:s}=e,r=this.chartMenuSvc.doChartToolPanelsExist(s.chartController),a=this.mapWithStockItems(this.getMenuItems(s.chartController,r),s,i,t,r);if(!a.length)return;let l=this.createBean(new hA(a));this.activeChartMenuList=l;let n=-1,o="left";this.gos.get("enableRtl")&&(n=1,o="right");let d=l.getGui();this.popupSvc.addPopup({modal:!0,eChild:d,closeOnEsc:!0,closedCallback:()=>{this.destroyBean(l),this.activeChartMenuList=void 0,(0,m._isNothingFocused)(this.beans)&&t.focus({preventScroll:!0})},afterGuiAttached:e=>l.afterGuiAttached(e),positionCallback:()=>{this.popupSvc.positionPopupByComponent({type:"chartMenu",eventSource:t,ePopup:d,alignSide:o,nudgeX:4*n,nudgeY:4,position:"under",keepWithinBounds:!0})},ariaLabel:"Chart Menu"})}getMenuItems(e,t){let i=[...t?["chartEdit"]:[],...e.isEnterprise()?["chartAdvancedSettings"]:[],e.isChartLinked()?"chartUnlink":"chartLink","chartDownload"],s=this.gos.get("chartMenuItems");return s?Array.isArray(s)?s:s((0,m._addGridCommonParams)(this.gos,{defaultItems:i,chartId:e.getChartId()})):i}mapWithStockItems(e,t,i,s,r){if(!e)return[];let a=[];for(let l of e){let e;if(!(e="string"==typeof l?this.getStockMenuItem(l,t,i,s,r):{...l}))continue;let{subMenu:n}=e;Array.isArray(n)&&(e.subMenu=this.mapWithStockItems(n,t,i,s,r)),a.push(e)}return a}getStockMenuItem(e,t,i,s,r){switch(e){case"chartEdit":return r?this.createMenuItem(this.chartTranslation.translate("chartEdit"),"chartsMenuEdit",i):null;case"chartAdvancedSettings":return this.createMenuItem(this.chartTranslation.translate("chartAdvancedSettings"),"chartsMenuAdvancedSettings",()=>this.chartMenuSvc.openAdvancedSettings(t,s));case"chartUnlink":return t.chartController.isChartLinked()?this.createMenuItem(this.chartTranslation.translate("chartUnlink"),"unlinked",()=>this.chartMenuSvc.toggleLinked(t)):null;case"chartLink":return t.chartController.isChartLinked()?null:this.createMenuItem(this.chartTranslation.translate("chartLink"),"linked",()=>this.chartMenuSvc.toggleLinked(t));case"chartDownload":return this.createMenuItem(this.chartTranslation.translate("chartDownload"),"chartsDownload",()=>this.chartMenuSvc.downloadChart(t))}return null}createMenuItem(e,t,i){return{name:e,icon:(0,m._createIconNoSpan)(t,this.beans,null),action:i}}destroy(){this.destroyBean(this.activeChartMenuList),super.destroy()}},hA=class extends m.Component{constructor(e){super(`
            <div data-ref="eChartsMenu" role="presentation" class="ag-menu ag-chart-menu-popup"></div>
        `),this.menuItems=e,this.eChartsMenu=m.RefPlaceholder}postConstruct(){this.mainMenuList=this.createManagedBean(new sL(0)),this.mainMenuList.addMenuItems(this.menuItems),this.mainMenuList.addEventListener("closeMenu",this.onHidePopup.bind(this)),this.eChartsMenu.appendChild(this.mainMenuList.getGui())}onHidePopup(){this.hidePopupFunc?.()}afterGuiAttached({hidePopup:e}){e&&(this.hidePopupFunc=e,this.addDestroyFunc(e)),(0,m._focusInto)(this.mainMenuList.getGui())}},hM=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="chartCrossFilterSvc"}filter(e,t=!1){let i=this.beans.filterManager,s=i?.getFilterModel()??{};if(t){Object.keys(s).length>0&&i?.setFilterModel(null);return}let r=hR(e);r.indexOf("-filtered-out")&&(r=r.replace("-filtered-out","")),this.updateFilters(s,e,r)}updateFilters(e,t,i){let s=hR(t),r=this.convertRawValue(i,t.datum[s]);if(void 0===r)return;let a=this.beans.filterManager;a?.getColumnFilterInstance(i).then(s=>{let l,n=s?.filterType,o=e=>e;if("multi"===n){let e=function(e){let t=e.getNumChildFilters();for(let i=0;i<t;i++){let s=e.getChildFilterInstance(i);if(s?.filterType==="set")return{setFilter:s,processModel:e=>(function(e,t,i){let s=Array(i);for(let r=0;r<i;r++)s[r]=r===t?e:null;return{filterType:"multi",filterModels:s}})(e,i,t)}}return{}}(s);l=e.setFilter,o=e.processModel??o}else"set"===n&&(l=s);if(!l)return void(0,m._warn)(154,{colId:i});let d=t.event.metaKey||t.event.ctrlKey,h=o(l.getFilterHandler().getCrossFilterModel((e,t,i)=>(function(e,t,i,s){let r;if(e)if(i.has(t)&&(null==s||s.includes(t)))if(r=[],null==s)for(let e of i)e!==t&&r.push(e);else for(let e of s)e!==t&&i.has(e)&&r.push(e);else{if(null==s)r=Array.from(i);else for(let e of(r=[],s))i.has(e)&&r.push(e);r.push(t)}else r=[t];return{filterType:"set",values:r}})(d,e(r),t,i))),u=d?{...e}:{};u[i]=h,a?.setFilterModel(u)})}convertRawValue(e,t){let{colModel:i,dataTypeSvc:s}=this.beans,r=i.getColById(e),a=r?.colDef;return a&&s&&"time"===a.chartDataType&&"dateString"===a.cellDataType?s.getDateFormatterFunction(r)(t):t}};function hR(e){return e.xKey||e.calloutLabelKey}var hT=["chartUnlink","chartLink","chartDownload","chartMenu"],hP={settings:"chartSettings",data:"chartData",format:"chartFormat"},hI=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="chartMenuSvc"}wireBeans(e){this.advSettingsMenuFactory=e.advSettingsMenuFactory}downloadChart(e,t,i,s){e.chartController.getChartProxy().downloadChart(t,i,s)}toggleLinked(e){e.chartController.detachChartRange()}openAdvancedSettings(e,t){this.advSettingsMenuFactory?.showMenu(e,t)}hideAdvancedSettings(){this.advSettingsMenuFactory?.hideMenu()}getChartToolbarOptions(){let e=["chartMenu"],t=this.gos.getCallback("getChartToolbarItems");return t?t({defaultItems:e}).filter(e=>!!hT.includes(e)||((0,m._warn)(155,{option:e}),!1)):e}getChartToolPanels(e){let t=this.gos.get("chartToolPanelsDef"),i=t?.panels?.map(e=>{let t=hP[e];return t||(0,m._warn)(156,{panel:e}),t}).filter(e=>!!e)??Object.values(hP);e.isPivotChart()&&(i=i.filter(e=>"chartData"!==e));let s=t?.defaultToolPanel,r=s&&hP[s]||i[0];return{panels:i,defaultPanel:r}}doesChartToolbarExist(){return this.getChartToolbarOptions().length>0}doChartToolPanelsExist(e){let{panels:t}=this.getChartToolPanels(e);return t.length>0}},hE={pivotChartTitle:"Pivot Chart",rangeChartTitle:"Range Chart",settings:"Chart",data:"Set Up",format:"Customize",categories:"Categories",defaultCategory:"(None)",series:"Series",switchCategorySeries:"Switch Category / Series",categoryValues:"Category Values",seriesLabels:"Series Labels",aggregate:"Aggregate",xyValues:"X Y Values",paired:"Paired Mode",axis:"Axis",xAxis:"Horizontal Axis",yAxis:"Vertical Axis",polarAxis:"Polar Axis",radiusAxis:"Radius Axis",navigator:"Navigator",zoom:"Zoom",animation:"Animation",crosshair:"Crosshair",color:"Color",thickness:"Thickness",preferredLength:"Preferred Length",xType:"X Type",axisType:"Axis Type",automatic:"Automatic",category:"Category",number:"Number",time:"Time",timeFormat:"Time Format",autoRotate:"Auto Rotate",labelRotation:"Rotation",circle:"Circle",polygon:"Polygon",square:"Square",cross:"Cross",diamond:"Diamond",plus:"Plus",triangle:"Triangle",heart:"Heart",orientation:"Orientation",fixed:"Fixed",parallel:"Parallel",perpendicular:"Perpendicular",radiusAxisPosition:"Position",ticks:"Ticks",gridLines:"Grid Lines",width:"Width",height:"Height",length:"Length",padding:"Padding",spacing:"Spacing",chartStyle:"Chart Style",title:"Title",chartTitles:"Titles",chartTitle:"Chart Title",chartSubtitle:"Subtitle",horizontalAxisTitle:"Horizontal Axis Title",verticalAxisTitle:"Vertical Axis Title",polarAxisTitle:"Polar Axis Title",titlePlaceholder:"Chart Title",background:"Background",font:"Font",weight:"Weight",top:"Top",right:"Right",bottom:"Bottom",left:"Left",labels:"Labels",calloutLabels:"Callout Labels",sectorLabels:"Sector Labels",positionRatio:"Position Ratio",size:"Size",shape:"Shape",minSize:"Minimum Size",maxSize:"Maximum Size",legend:"Legend",position:"Position",markerSize:"Marker Size",markerStroke:"Marker Stroke",markerPadding:"Marker Padding",itemSpacing:"Item Spacing",itemPaddingX:"Item Padding X",itemPaddingY:"Item Padding Y",layoutHorizontalSpacing:"Horizontal Spacing",layoutVerticalSpacing:"Vertical Spacing",strokeWidth:"Stroke Width",offset:"Offset",offsets:"Offsets",tooltips:"Tooltips",callout:"Callout",markers:"Markers",shadow:"Shadow",blur:"Blur",xOffset:"X Offset",yOffset:"Y Offset",lineWidth:"Line Width",lineDash:"Line Dash",lineDashOffset:"Dash Offset",scrollingZoom:"Scrolling",scrollingStep:"Scrolling Step",selectingZoom:"Selecting",durationMillis:"Duration (ms)",crosshairLabel:"Label",crosshairSnap:"Snap to Node",normal:"Normal",bold:"Bold",italic:"Italic",boldItalic:"Bold Italic",predefined:"Predefined",fillOpacity:"Fill Opacity",strokeColor:"Line Color",strokeOpacity:"Line Opacity",miniChart:"Mini-Chart",histogramBinCount:"Bin count",connectorLine:"Connector Line",seriesItems:"Series Items",seriesItemType:"Item Type",seriesItemPositive:"Positive",seriesItemNegative:"Negative",seriesItemLabels:"Item Labels",columnGroup:"Column",barGroup:"Bar",pieGroup:"Pie",lineGroup:"Line",scatterGroup:"X Y (Scatter)",areaGroup:"Area",polarGroup:"Polar",statisticalGroup:"Statistical",hierarchicalGroup:"Hierarchical",specializedGroup:"Specialized",combinationGroup:"Combination",groupedColumnTooltip:"Grouped",stackedColumnTooltip:"Stacked",normalizedColumnTooltip:"100% Stacked",groupedBarTooltip:"Grouped",stackedBarTooltip:"Stacked",normalizedBarTooltip:"100% Stacked",pieTooltip:"Pie",donutTooltip:"Donut",lineTooltip:"Line",stackedLineTooltip:"Stacked",normalizedLineTooltip:"100% Stacked",groupedAreaTooltip:"Area",stackedAreaTooltip:"Stacked",normalizedAreaTooltip:"100% Stacked",scatterTooltip:"Scatter",bubbleTooltip:"Bubble",histogramTooltip:"Histogram",radialColumnTooltip:"Radial Column",radialBarTooltip:"Radial Bar",radarLineTooltip:"Radar Line",radarAreaTooltip:"Radar Area",nightingaleTooltip:"Nightingale",rangeBarTooltip:"Range Bar",rangeAreaTooltip:"Range Area",boxPlotTooltip:"Box Plot",treemapTooltip:"Treemap",sunburstTooltip:"Sunburst",waterfallTooltip:"Waterfall",heatmapTooltip:"Heatmap",columnLineComboTooltip:"Column & Line",areaColumnComboTooltip:"Area & Column",customComboTooltip:"Custom Combination",innerRadius:"Inner Radius",startAngle:"Start Angle",endAngle:"End Angle",reverseDirection:"Reverse Direction",groupPadding:"Group Padding",seriesPadding:"Series Padding",tile:"Tile",whisker:"Whisker",cap:"Cap",capLengthRatio:"Length Ratio",labelPlacement:"Placement",inside:"Inside",outside:"Outside",noDataToChart:"No data available to be charted.",pivotChartRequiresPivotMode:"Pivot Chart requires Pivot Mode enabled.",chartSettingsToolbarTooltip:"Menu",chartLinkToolbarTooltip:"Linked to Grid",chartUnlinkToolbarTooltip:"Unlinked from Grid",chartDownloadToolbarTooltip:"Download Chart",chartMenuToolbarTooltip:"Menu",chartEdit:"Edit Chart",chartAdvancedSettings:"Advanced Settings",chartLink:"Link to Grid",chartUnlink:"Unlink from Grid",chartDownload:"Download Chart",histogramFrequency:"Frequency",seriesChartType:"Series Chart Type",seriesType:"Series Type",secondaryAxis:"Secondary Axis",seriesAdd:"Add a series",categoryAdd:"Add a category",bar:"Bar",column:"Column",histogram:"Histogram",advancedSettings:"Advanced Settings",direction:"Direction",horizontal:"Horizontal",vertical:"Vertical",seriesGroupType:"Group Type",groupedSeriesGroupType:"Grouped",stackedSeriesGroupType:"Stacked",normalizedSeriesGroupType:"100% Stacked",legendEnabled:"Enabled",groupedColumnFull:"Grouped Column",stackedColumnFull:"Stacked Column",normalizedColumnFull:"100% Stacked Column",groupedBarFull:"Grouped Bar",stackedBarFull:"Stacked Bar",normalizedBarFull:"100% Stacked Bar",stackedAreaFull:"Stacked Area",normalizedAreaFull:"100% Stacked Area",stackedLineFull:"Stacked Line",normalizedLineFull:"100% Stacked Line",customCombo:"Custom Combination",funnel:"Funnel",coneFunnel:"Cone Funnel",pyramid:"Pyramid",funnelGroup:"Funnel",funnelTooltip:"Funnel",coneFunnelTooltip:"Cone Funnel",pyramidTooltip:"Pyramid",dropOff:"Drop-Off",stageLabels:"Stage Labels",reverse:"Reverse",tooltipMode:"Tooltip Mode",tooltipModeSingle:"Single",tooltipModeShared:"Multiple",tooltipModeCompact:"Compact",groupedColumn:"Grouped",stackedColumn:"Stacked",pie:"Pie",donut:"Donut",line:"Line",scatter:"Scatter",bubble:"Bubble",area:"Area",stackedArea:"Stacked",radarLine:"Radar Line",radarArea:"Radar Area",nightingale:"Nightingale",radialColumn:"Radial Column",radialBar:"Radial Bar",boxPlot:"Box Plot",rangeBar:"Range Bar",rangeArea:"Range Area",treemap:"Treemap",sunburst:"Sunburst",waterfall:"Waterfall",heatmap:"Heatmap",columnLineCombo:"Column & Line",AreaColumnCombo:"Area & Column",ariaChartMenuClose:"Close Chart Edit Menu",ariaChartSelected:"Selected",group:"Group",timeFormatSlashesDDMMYYYY:"DD/MM/YYYY",timeFormatSlashesMMDDYYYY:"MM/DD/YYYY",timeFormatSlashesDDMMYY:"DD/MM/YY",timeFormatSlashesMMDDYY:"MM/DD/YY",timeFormatDotsDDMYY:"DD.M.YY",timeFormatDotsMDDYY:"M.DD.YY",timeFormatDashesYYYYMMDD:"YYYY-MM-DD",timeFormatSpacesDDMMMMYYYY:"DD MMMM YYYY",timeFormatHHMMSS:"HH:MM:SS",timeFormatHHMMSSAmPm:"HH:MM:SS AM/PM",sum:"Sum",first:"First",last:"Last",min:"Min",max:"Max",count:"Count",avg:"Average"},hD=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="chartTranslation"}translate(e){let t=this.getLocaleTextFunc(),i=hE[e];return t(e,i)}},hk=e=>t=>void 0==t||e(t),hL=e=>"string"==typeof e,hN=e=>"boolean"==typeof e,hG=e=>"object"==typeof e,hO=(e,t)=>i=>`AG Grid - unable to update chart as invalid params supplied:  \`${e}: ${i}\`, expected ${t}.`,hB=e=>`${e} is not supported in AG Charts Community ('ag-charts-enterprise' hasn't been loaded). See https://www.ag-grid.com/javascript-data-grid/integrated-charts-installation/ for more details.`,hV=["doughnut"],h_=["type","chartId","chartType","chartThemeName","chartThemeOverrides","unlinkChart"],hz=hk(e=>{if(function(e){return!!dk[e]||dL.has(e)}(e))return!0;if(hV.includes(e)){let t=dU(e);return(0,m._warnOnce)(`The chart type '${e}' has been deprecated. Please use '${t}' instead.`),t}return!1}),hH=hk(e=>"object"==typeof e),hU=hk(e=>"object"==typeof e),hW=hk(e=>"string"==typeof e||"function"==typeof e),hK=e=>({property:"chartType",validationFn:hk(t=>e||!t||!dO(dW(t),"isEnterprise")),warnMessage:e=>hB(`The '${e}' chart type`)}),h$=e=>({property:"switchCategorySeries",validationFn:hk(t=>{if(!t||e)return!0}),warnMessage:()=>hB("'switchCategorySeries' has been ignored as it"),warnIfFixed:!0}),hj=()=>[{property:"chartId",validationFn:hL,warnMessage:hO("chartId","string")},{property:"chartType",validationFn:hz,warnMessage:hO("chartType","ChartType")},{property:"chartThemeName",validationFn:hL,warnMessage:hO("chartThemeName","string")},{property:"chartThemeOverrides",validationFn:hH,warnMessage:hO("chartThemeOverrides","AgChartThemeOverrides")},{property:"unlinkChart",validationFn:hN,warnMessage:hO("unlinkChart","boolean")}],hY=e=>[{property:"cellRange",validationFn:hU,warnMessage:hO("cellRange","ChartParamsCellRange")},{property:"suppressChartRanges",validationFn:hN,warnMessage:hO("suppressChartRanges","boolean")},{property:"aggFunc",validationFn:hW,warnMessage:hO("aggFunc","string or IAggFunc")},h$(e)];function hq(e,t,i,s){let r;for(let i of t){let{property:t,validationFn:s,warnMessage:a,warnIfFixed:l}=i;if(t in e){let i=e[t],n=s(i);if(!0===n)continue;if(!1===n)return(0,m._warnOnce)(a(i)),!1;(r=r||{...e})[t]=n,l&&(0,m._warnOnce)(a(i))}}if(i){for(let t of Object.keys(e))if(!i.includes(t))return(0,m._warnOnce)(`Unexpected property supplied. ${s} does not contain: \`${t}\`.`),!1}return!r||r}var hZ=["ag-default","ag-material","ag-sheets","ag-polychroma","ag-vivid"],hX=class extends m.BeanStub{constructor(e){super(),this.model=e,this.isEnterprise=()=>this.agChartsExports.isEnterprise}wireBeans(e){this.rangeSvc=e.rangeSvc,this.agChartsExports=e.agChartsExports}postConstruct(){this.setChartRange(),this.model.unlinked&&this.rangeSvc&&this.rangeSvc.setCellRanges([]);let e=this.updateForGridChange.bind(this,{});this.addManagedEventListeners({cellSelectionChanged:e=>{e.id&&e.id===this.model.chartId&&this.updateForRangeChange()},columnMoved:e,columnPinned:e,columnVisible:e,columnRowGroupChanged:e,modelUpdated:e,cellValueChanged:this.updateForDataChange.bind(this),cellEditValuesChanged:this.updateForDataChange.bind(this)})}update(e){if(!this.validUpdateType(e))return!1;let t=function(e,t){var i,s,r,a;switch(e.type){case"rangeChartUpdate":return i=e,s=t,hq(i,[...hj(),hK(s),...hY(s),{property:"seriesChartTypes",validationFn:e=>void 0===e||Array.isArray(e)&&e.every(hG),warnMessage:hO("seriesChartTypes","Array of SeriesChartType")},{property:"useGroupColumnAsCategory",validationFn:hN,warnMessage:hO("useGroupColumnAsCategory","boolean")}],[...h_,"cellRange","suppressChartRanges","switchCategorySeries","aggFunc","seriesChartTypes","seriesGroupType","useGroupColumnAsCategory"],"UpdateRangeChartParams");case"pivotChartUpdate":return hq(e,[...hj()],[...h_],"UpdatePivotChartParams");case"crossFilterChartUpdate":return r=e,a=t,hq(r,[...hj(),...hY(a)],[...h_,"cellRange","suppressChartRanges","aggFunc"],"UpdateCrossFilterChartParams");default:return(0,m._warnOnce)(`Invalid value supplied for 'type': ${e.type}. It must be either 'rangeChartUpdate', 'pivotChartUpdate', or 'crossFilterChartUpdate'.`),!1}}(e,this.agChartsExports.isEnterprise);if(!t)return!1;let i=!0===t?e:t;return this.applyValidatedChartParams(i),!0}applyValidatedChartParams(e){let{chartId:t,chartType:i,chartThemeName:s,unlinkChart:r}=e,a={...{chartId:t,pivotChart:this.model.pivotChart,chartType:i??this.model.chartType,chartThemeName:s??this.model.chartThemeName,unlinkChart:r??this.model.unlinked,cellRange:this.model.suppliedCellRange,switchCategorySeries:this.model.switchCategorySeries,aggFunc:this.model.aggFunc,seriesChartTypes:void 0,suppressChartRanges:!1,crossFiltering:!1}};switch(e.type){case"rangeChartUpdate":a.cellRange=this.createCellRange(e)??this.model.suppliedCellRange,a.switchCategorySeries=e.switchCategorySeries??this.model.switchCategorySeries,a.aggFunc=e.aggFunc??this.model.aggFunc,a.seriesChartTypes=e.seriesChartTypes,a.suppressChartRanges=e.suppressChartRanges??this.model.suppressChartRanges,a.seriesGroupType=e.seriesGroupType??this.model.seriesGroupType,a.useGroupColumnAsCategory=e.useGroupColumnAsCategory??this.model.useGroupColumnAsCategory;break;case"crossFilterChartUpdate":a.cellRange=this.createCellRange(e)??this.model.suppliedCellRange,a.switchCategorySeries=!1,a.aggFunc=e.aggFunc??this.model.aggFunc,a.crossFiltering=!0,a.crossFilteringSort=this.model.crossFilteringSort,a.suppressChartRanges=e.suppressChartRanges??this.model.suppressChartRanges;break;case"pivotChartUpdate":a.switchCategorySeries=!1}this.model.updateModel(a),a.unlinkChart||a.suppressChartRanges?this.rangeSvc?.setCellRanges([]):this.setChartRange()}updateForGridChange(e){if(this.model.unlinked)return;let{maintainColState:t,setColsFromRange:i}=e??{};this.model.updateCellRanges({maintainColState:t,setColsFromRange:i}),this.model.updateData(),this.setChartRange()}updateForDataChange(){this.model.unlinked||(this.model.updateData(),this.raiseChartModelUpdateEvent())}updateForRangeChange(){this.updateForGridChange({setColsFromRange:!0}),this.raiseChartRangeSelectionChangedEvent()}updateForPanelChange(e){this.model.updateCellRanges(e),this.model.updateData(),e.skipAnimation&&this.getChartProxy().getChartRef().skipAnimations(),this.setChartRange(),this.raiseChartRangeSelectionChangedEvent()}updateThemeOverrides(e){this.chartProxy.updateThemeOverrides(e)}getChartUpdateParams(e){let t=this.getSelectedValueColState().map(e=>({colId:e.colId,displayName:e.displayName})),i=this.getChartData(),s=this.getSelectedDimensions(),r=this.model,a={data:i,groupData:r.groupChartData,grouping:this.isGrouping(),categories:s.map(({colId:e,displayName:t})=>{let i=r.categoryAxisType??r.getChartDataType(e);return{id:e,name:t,chartDataType:i,convertTime:"time"===i?r.getConvertTime(e):void 0}}),fields:t,chartId:this.getChartId(),getCrossFilteringContext:()=>({lastSelectedChartId:"xxx"}),seriesChartTypes:this.getSeriesChartTypes(),updatedOverrides:e,seriesGroupType:r.seriesGroupType};return this.isCategorySeriesSwitched()?this.invertCategorySeriesParams(a):a}invertCategorySeriesParams(e){let[t]=e.categories,i=[{id:hn,name:""}],s=e.data.map((e,i)=>{let s=`${t.id}:${i}`,r=e[t.id];return{colId:s,displayName:null==r?"":String(r)}}),r=e.fields.map(i=>{let s={[hn]:i.displayName};for(let[r,a]of e.data.entries()){let e=`${t.id}:${r}`,l=a[i.colId];s[e]=l}return s});return{...e,categories:i,fields:s,data:r}}getChartModel(){let e=this.model.pivotChart?"pivot":"range",t=this.isComboChart()?this.model.comboChartModel.seriesChartTypes:void 0;return{modelType:e,chartId:this.model.chartId,chartType:this.model.chartType,chartThemeName:this.getChartThemeName(),chartOptions:this.chartProxy?.getChartThemeOverrides(),chartPalette:this.chartProxy?.getChartPalette(),cellRange:this.getCellRangeParams(),switchCategorySeries:this.model.switchCategorySeries,suppressChartRanges:this.model.suppressChartRanges,aggFunc:this.model.aggFunc,unlinkChart:this.model.unlinked,seriesChartTypes:t,seriesGroupType:this.model.seriesGroupType,useGroupColumnAsCategory:this.model.useGroupColumnAsCategory}}getChartId(){return this.model.chartId}getChartData(){return this.model.chartData}getChartType(){return this.model.chartType}setChartType(e){this.updateMultiSeriesAndCategory(this.model.chartType,e),this.model.chartType=e,this.model.comboChartModel.updateSeriesChartTypes(),this.model.switchCategorySeries=!1,this.model.categoryAxisType=void 0,this.model.seriesGroupType=void 0,this.raiseChartModelUpdateEvent()}isCategorySeriesSwitched(){return this.model.switchCategorySeries&&!this.model.isGrouping()}switchCategorySeries(e){dY(this.getChartType())&&(this.model.switchCategorySeries=e,this.raiseChartModelUpdateEvent())}getAggFunc(){return this.model.aggFunc}setAggFunc(e,t){this.model.aggFunc===e||(this.model.aggFunc=e,t||(this.model.updateData(),this.raiseChartModelUpdateEvent()))}updateMultiSeriesAndCategory(e,t){let i=(e,t)=>{let i=0;for(let s of e)s.selected&&(i>=t?s.selected=!1:i++);0===i&&(e[0].selected=!0)},s=d$(t),r=dj(t),a=null!=s&&(d$(e)??100)>(s??100),l=null!=r&&(dj(e)??100)>(r??100);a&&i(this.model.dimensionColState,s),l&&i(this.model.valueColState,r),(a||l)&&(this.model.resetCellRanges(a,l),this.setChartRange(!0))}setChartThemeName(e,t){this.model.chartThemeName=e,t||this.raiseChartModelUpdateEvent()}getChartThemeName(){return this.model.chartThemeName}isPivotChart(){return this.model.pivotChart}isPivotMode(){return this.model.isPivotMode()}isGrouping(){return this.model.isGrouping()}isCrossFilterChart(){return this.model.crossFiltering}getThemeNames(){return this.gos.get("chartThemes")||hZ}getThemes(){return this.getThemeNames().map(e=>{let t=dX(e,this.agChartsExports._Theme)?e:this.chartProxy.lookupCustomChartTheme(e);return this.agChartsExports._Theme.getChartTheme(t)})}getPalettes(){return this.getThemes().map(e=>e.palette)}getSelectedValueColState(){return this.model.getValueColState().filter(e=>e.selected)}getSelectedDimensions(){return this.model.getSelectedDimensions()}getColStateForMenu(){return{dimensionCols:this.model.dimensionColState,valueCols:this.model.getValueColState()}}setChartRange(e=!1){!this.rangeSvc||this.model.suppressChartRanges||this.model.unlinked||this.rangeSvc.setCellRanges(this.getCellRanges()),e||this.raiseChartModelUpdateEvent()}detachChartRange(){this.model.unlinked=!this.model.unlinked,this.model.unlinked?this.rangeSvc&&this.rangeSvc.setCellRanges([]):this.updateForGridChange(),this.dispatchLocalEvent({type:"chartLinkedChanged"})}setChartProxy(e){this.chartProxy=e}getChartProxy(){return this.chartProxy}isActiveXYChart(){return["scatter","bubble"].includes(this.getChartType())}isChartLinked(){return!this.model.unlinked}customComboExists(){let e=this.model.comboChartModel.savedCustomSeriesChartTypes;return e&&e.length>0}getSeriesChartTypes(){return this.model.comboChartModel.seriesChartTypes}isComboChart(e){return this.model.isComboChart(e)}updateSeriesChartType(e,t,i){let s=this.model.comboChartModel.seriesChartTypes.find(t=>t.colId===e);if(s){let e="customCombo"!==this.model.chartType;e&&(this.model.chartType="customCombo");let r=s.chartType;null!=t&&(s.chartType=t),null!=i&&(s.secondaryAxis=i),this.model.comboChartModel.savedCustomSeriesChartTypes=this.model.comboChartModel.seriesChartTypes,this.model.comboChartModel.updateSeriesChartTypes(),this.updateForDataChange(),e&&this.dispatchLocalEvent({type:"chartTypeChanged"}),r!==t&&this.dispatchLocalEvent({type:"chartSeriesChartTypeChanged"}),this.raiseChartOptionsChangedEvent()}}getActiveSeriesChartTypes(){let e=this.getSelectedValueColState().map(e=>e.colId);return this.getSeriesChartTypes().filter(t=>e.includes(t.colId))}getChartSeriesTypes(e){let t=e??this.getChartType();return this.isComboChart(t)?["line","bar","area"]:[dW(t)]}getChartSeriesType(){let e=this.getSeriesChartTypes();if(0===e.length)return"bar";let t=e[0].chartType;return"columnLineCombo"===t?"bar":"areaColumnCombo"===t?"area":dW(t)}getCellRanges(){return[this.model.dimensionCellRange,this.model.valueCellRange].filter(e=>e)}createCellRange(e){return e.cellRange&&this.rangeSvc?.createPartialCellRangeFromRangeParams(e.cellRange,!0)}validUpdateType(e){if(!e.type)return(0,m._warn)(136),!1;let t={"Range Chart":()=>!this.isPivotChart()&&!this.isCrossFilterChart(),"Pivot Chart":()=>this.isPivotChart(),"Cross Filter Chart":()=>this.isCrossFilterChart()},i=Object.keys(t).find(e=>t[e]())??"Range Chart",s=e.type===`${i[0].toLowerCase()}${i.slice(1).replace(/ /g,"")}Update`;return s||(0,m._warn)(137,{currentChartType:i,type:e.type}),s}getCellRangeParams(){let e=this.getCellRanges(),t=e[0],i=t?.startRow||null,s=t?.endRow||null;return{rowStartIndex:i?.rowIndex??null,rowStartPinned:i?.rowPinned,rowEndIndex:s?.rowIndex??null,rowEndPinned:s?.rowPinned,columns:e.reduce((e,t)=>e.concat(t.columns.map(e=>e.getId())),[])}}setCategoryAxisType(e){this.model.categoryAxisType=e,this.raiseChartModelUpdateEvent()}getSeriesGroupType(){return this.model.seriesGroupType??this.chartProxy.getSeriesGroupType()}setSeriesGroupType(e){this.model.seriesGroupType=e,this.raiseChartModelUpdateEvent()}raiseChartModelUpdateEvent(){this.dispatchLocalEvent({type:"chartModelUpdate"}),this.raiseChartOptionsChangedEvent()}raiseChartUpdatedEvent(){this.dispatchLocalEvent({type:"chartUpdated"})}raiseChartApiUpdateEvent(){this.dispatchLocalEvent({type:"chartApiUpdate"})}raiseChartOptionsChangedEvent(){let{chartId:e,chartType:t}=this.getChartModel();this.eventSvc.dispatchEvent({type:"chartOptionsChanged",chartId:e,chartType:t,chartThemeName:this.getChartThemeName(),chartOptions:this.chartProxy?.getChartThemeOverrides()})}raiseChartRangeSelectionChangedEvent(){this.eventSvc.dispatchEvent({type:"chartRangeSelectionChanged",id:this.model.chartId,chartId:this.model.chartId,cellRange:this.getCellRangeParams()})}destroy(){super.destroy(),this.rangeSvc&&this.rangeSvc.setCellRanges([])}},hJ=class extends d2{getAxes(e){let t={x:{type:this.getXAxisType(e),position:"bottom"},y:{type:"number",position:"left"}};return this.isNormalised()&&(t.y.label={...t.y.label,formatter:e=>Math.round(e.value)+"%"}),t}getSeries(e){let[t]=e.categories,i=e.fields.map(e=>({type:this.standaloneChartType,xKey:t.id,xName:t.name,yKey:e.colId,yName:e.displayName,normalizedTo:"normalizedArea"===this.chartType?100:void 0,stacked:["normalizedArea","stackedArea"].includes(this.chartType)}));return this.crossFiltering?this.extractLineAreaCrossFilterSeries(i,e):i}isNormalised(){return!this.crossFiltering&&"normalizedArea"===this.chartType}},hQ=new Set(["bar","groupedBar","stackedBar","normalizedBar"]),h0=class extends d2{getAxes(e){let t={x:{type:this.getXAxisType(e),position:this.isHorizontal()?"left":"bottom"},y:{type:"number",position:this.isHorizontal()?"bottom":"left"}};return this.isNormalised()&&(t.y.label={...t.y.label,formatter:e=>Math.round(e.value)+"%"}),t}getSeries(e){let[t]=e.categories,i=e.fields.map(e=>{var i;return{type:this.standaloneChartType,direction:this.isHorizontal()?"horizontal":"vertical",stacked:this.crossFiltering||(i=this.chartType,dB.has(i)),normalizedTo:this.isNormalised()?100:void 0,xKey:t.id,xName:t.name,yKey:e.colId,yName:e.displayName}});return this.crossFiltering?this.extractCrossFilterSeries(i):i}extractCrossFilterSeries(e){let t=[];for(let i=0;i<e.length;i++){let s={...e[i],listeners:{seriesNodeClick:this.crossFilterCallback}},r={...s,yKey:`${s.yKey}-filtered-out`,showInLegend:!1};t.push(s),t.push(r)}return t}isNormalised(){return!this.crossFiltering&&["normalizedColumn","normalizedBar"].includes(this.chartType)}isHorizontal(){return hQ.has(this.chartType)}},h1=class extends d2{getAxes(e){let t={x:{type:this.getXAxisType(e),position:"bottom"},y:{type:"number",position:"left"}};return this.isNormalised()&&(t.y.label={...t.y.label,formatter:e=>Math.round(e.value)+"%"}),t}getSeries(e){let[t]=e.categories,i=["normalizedLine","stackedLine"].includes(this.chartType),s=e.fields.map(e=>({type:this.standaloneChartType,xKey:t.id,xName:t.name,yKey:e.colId,yName:e.displayName,normalizedTo:i&&this.isNormalised()?100:void 0,stacked:i}));return this.crossFiltering?this.extractLineAreaCrossFilterSeries(s,e):s}isNormalised(){return!this.crossFiltering&&["normalizedLine"].includes(this.chartType)}},h2=class extends d2{getAxes(e){return{x:{type:"number",position:"bottom"},y:{type:"number",position:"left"}}}getSeries(e){let[t]=e.categories,i=this.isPaired(),s=this.getSeriesDefinitions(e.fields,i),r=t.id===hn?void 0:t,a=s.map(e=>e?.sizeField?{type:"bubble",xKey:e.xField.colId,xName:e.xField.displayName??void 0,yKey:e.yField.colId,yName:e.yField.displayName??void 0,title:`${e.yField.displayName} vs ${e.xField.displayName}`,sizeKey:e.sizeField.colId,sizeName:e.sizeField.displayName??"",labelKey:r?r.id:e.yField.colId,labelName:r?r.name:void 0}:{type:"scatter",xKey:e.xField.colId,xName:e.xField.displayName??void 0,yKey:e.yField.colId,yName:e.yField.displayName??void 0,title:`${e.yField.displayName} vs ${e.xField.displayName}`,labelKey:r?r.id:e.yField.colId,labelName:r?r.name:void 0});return this.crossFiltering?this.extractCrossFilterSeries(a,e):a}extractCrossFilterSeries(e,t){let{data:i}=t,s=e=>`${e}-filtered-out`,r=e=>{let t;if("bubble"===e.type){let{sizeKey:r}=e;t=((e,t)=>{let i=[1/0,-1/0];if(null!=t)for(let r of e){let e=r[t]??r[s(t)];e<i[0]&&(i[0]=e),e>i[1]&&(i[1]=e)}if(i[0]<=i[1])return i})(i,r)}return{...e,domain:t,highlight:{highlightedItem:{fill:"yellow"}},listeners:{...e.listeners,seriesNodeClick:this.crossFilterCallback}}},a=e=>{let{yKey:t,xKey:i}=e,r={};return"bubble"===e.type&&(r={sizeKey:s(e.sizeKey)}),{...e,...r,yKey:s(t),xKey:s(i),showInLegend:!1,listeners:{...e.listeners,seriesNodeClick:e=>{let t=e.datum[s(i)],r={...e,xKey:i,datum:{...e.datum,[i]:t}};this.crossFilterCallback(r)}}}},l=e.map(r);return[...l,...l.map(a)]}getSeriesDefinitions(e,t){if(e.length<2)return[];let i="bubble"===this.chartType;if(t)return i?e.map((t,i)=>i%3==0?{xField:t,yField:e[i+1],sizeField:e[i+2]}:null).filter(e=>e?.yField&&e.sizeField):e.map((t,i)=>i%2==0?{xField:t,yField:e[i+1]}:null).filter(e=>e?.yField);let s=e[0];return i?e.map((t,i)=>i%2==1?{xField:s,yField:t,sizeField:e[i+1]}:null).filter(e=>e?.sizeField):e.filter((e,t)=>t>0).map(e=>({xField:s,yField:e}))}},h5=class extends d2{getAxes(e){let t=e?e.fields:[],i=new Map(t.map(e=>[e.colId,e])),{primaryYKeys:s,secondaryYKeys:r}=this.getYKeys(t,e.seriesChartTypes),a={x:{type:this.getXAxisType(e),position:"bottom"}};return s.length>0&&(a.y={type:"number",position:"left"}),r.length>0&&r.forEach(e=>{let t=i.get(e);t&&t.colId===e&&(a[`y_${e}`]={type:"number",position:"right"})}),a}getSeries(e){let{fields:t,seriesChartTypes:i}=e,[s]=e.categories;return t.map(e=>{let t=i.find(t=>t.colId===e.colId);if(t){let i=t.chartType,r=["groupedColumn","groupedBar"].includes(i),a=t.secondaryAxis?`y_${e.colId}`:"y";return{type:dW(i),xKey:s.id,yKey:e.colId,yName:e.displayName,yKeyAxis:a,stacked:["stackedArea","stackedColumn"].includes(i),...r?{grouped:!0}:{}}}})}getYKeys(e,t){let i=[],s=[];for(let r of e){let e=r.colId,a=t.find(t=>t.colId===e);a&&(a.secondaryAxis?s.push(e):i.push(e))}return{primaryYKeys:i,secondaryYKeys:s}}setSeriesChartThemeDefaults(e){let t=this.getSeriesChartThemeDefaults();if(!t)return;let i=new Set;for(let e of this.chartProxyParams.seriesChartTypes)i.add(e.chartType);for(let s of i)e[dW(s)]=t}},h4=class extends d1{getUpdateOptions(e,t){return{...t,data:this.crossFiltering?this.getCrossFilterData(e):e.data,series:this.getSeries(e)}}getSeries(e){let[t]=e.categories,i=e.fields.length,s={currentOffset:0,offsetAmount:i>1?20:40},r=this.getFields(e).map(e=>{let r={type:this.standaloneChartType,angleKey:e.colId,angleName:e.displayName,sectorLabelKey:e.colId,calloutLabelName:t.name,calloutLabelKey:t.id};if("donut"===this.chartType||"doughnut"===this.chartType){let t,a,{outerRadiusOffset:l,innerRadiusOffset:n}=(t=s.currentOffset,s.currentOffset-=s.offsetAmount,a=s.currentOffset,s.currentOffset-=s.offsetAmount,{outerRadiusOffset:t,innerRadiusOffset:a}),o=e.displayName?{title:{text:e.displayName,showInLegend:i>1}}:void 0;return{...r,type:"donut",outerRadiusOffset:l,innerRadiusOffset:n,...o}}return r});return this.crossFiltering?this.extractCrossFilterSeries(r):r}getCrossFilterData(e){let t=e.fields[0].colId,i=`${t}-filtered-out`;return e.data.map(e=>{let s=e[t]+e[i];return e[`${t}-total`]=s,e[i]=1,e[t]=e[t]/s,e})}extractCrossFilterSeries(e){let t=e[0],i=t.angleKey,s={...t,radiusMin:0,radiusMax:1,listeners:{seriesNodeClick:this.crossFilterCallback},legendItemKey:t.calloutLabelKey,angleKey:`${i}-total`},r={...s,radiusKey:i,sectorLabelKey:`${i}-total`};return[{...s,radiusKey:`${i}-filtered-out`,showInLegend:!1},r]}getFields(e){return"pie"===this.chartType?e.fields.slice(0,1):e.fields}getSeriesChartThemeDefaults(){return{series:{highlight:d0(this.crossFiltering)}}}},h3=class extends m.Component{constructor(){super('<div class="ag-chart-menu" data-ref="eMenu"></div>'),this.eMenu=m.RefPlaceholder,this.buttonListenersDestroyFuncs=[]}wireBeans(e){this.chartTranslation=e.chartTranslation}updateParams(e){let{buttons:t}=e;this.createButtons(t)}createButtons(e){for(let e of this.buttonListenersDestroyFuncs)e?.();this.buttonListenersDestroyFuncs=[];let t=this.eMenu;for(let i of((0,m._clearElement)(t),e)){let{buttonName:e,iconName:s,callback:r}=i,a=this.createButton(s),l=this.chartTranslation.translate(e+"ToolbarTooltip");l&&a instanceof HTMLElement&&(a.title=l),this.buttonListenersDestroyFuncs.push(...this.addManagedElementListeners(a,{click:e=>r(e.currentTarget)})),t.appendChild(a)}}createButton(e){let t=(0,m._createIconNoSpan)(e,this.beans);t.classList.add("ag-chart-menu-icon");let i=(0,m._createElement)({tag:"button",attrs:{type:"button"},cls:"ag-chart-menu-toolbar-button"});return i.appendChild(t),i}destroy(){this.buttonListenersDestroyFuncs=[],super.destroy()}},h6=class extends m.Component{constructor(e){super('<div class="ag-pill-select" role="presentation"></div>'),this.config=e??{};const{selectedValueList:t,valueFormatter:i,valueList:s}=this.config;this.selectedValues=t??[],this.valueList=s??[],this.valueFormatter=i??(e=>(0,m._escapeString)(e)),this.registerCSS(".ag-pill-select{display:flex;flex-direction:column}.ag-pill-select .ag-column-drop-list{padding:0}:where(.ag-pill-select){.ag-select{padding-top:var(--ag-spacing)}.ag-picker-field-wrapper{background-color:transparent;border:0}.ag-picker-field-display{cursor:pointer;font-weight:500}.ag-picker-field-display,.ag-picker-field-icon{color:var(--ag-chart-menu-label-color)}}")}postConstruct(){let{ariaLabel:e,onValuesChange:t,dragSourceId:i}=this.config;this.dropZonePanel=this.createManagedBean(new h7({getValues:()=>this.selectedValues,setValues:e=>this.updateValues(e),isDraggable:()=>this.selectedValues.length>1},e=>this.valueFormatter(e),e,i)),this.getGui().appendChild(this.dropZonePanel.getGui()),this.initSelect(),null!=t&&(this.onValuesChange=t)}setValues(e,t){let{added:i,removed:s,updated:r}=this.getChanges(this.valueList,e),a=!1;return(i.length||s.length||r.length)&&(a=!0),this.valueList=e,this.updateValues(t,a,!0),this}setValueFormatter(e){return this.valueFormatter=e,this}initSelect(){let e=this.createSelectOptions();if(!e.length)return!1;let{selectPlaceholder:t}=this.config;return this.eSelect=this.createBean(new m.AgSelect({options:e,placeholder:t,onValueChange:e=>this.addValue(e),pickerIcon:"chartsMenuAdd"})),this.getGui().appendChild(this.eSelect.getGui()),!0}createSelectOptions(){let e=[],{maxSelection:t}=this.config;if(t&&this.selectedValues.length>=t)return e;for(let t of this.valueList)this.selectedValues.includes(t)||e.push({value:t,text:this.valueFormatter(t)});return e}addValue(e){this.dropZonePanel.addItem(e)}updateValues(e,t,i){let s=this.selectedValues;this.selectedValues=e;let r=this.getChanges(s,e),a=t||r.added.length||r.removed.length,l=(0,m._getActiveDomElement)(this.beans),n=this.eSelect?.getGui().contains(l),o=this.dropZonePanel?.getGui().contains(l);i||this.onValuesChange?.(r);let d=!!a&&!this.refreshSelect();this.dropZonePanel.refreshGui(),a&&n&&(d?this.dropZonePanel.focusList(!0):this.eSelect?.getFocusableElement().focus()),o&&!e.length&&this.eSelect?.getFocusableElement().focus()}getChanges(e,t){let i=t.filter(t=>!e.includes(t));return{added:i,removed:e.filter(e=>!t.includes(e)),updated:t.filter((t,i)=>e[i]!==t),selected:t}}refreshSelect(){if(!this.eSelect)return this.initSelect();let e=this.createSelectOptions();return e.length?(this.eSelect.clearOptions().addOptions(e).setValue(void 0,!0),!0):((0,m._removeFromParent)(this.eSelect.getGui()),this.eSelect=this.destroyBean(this.eSelect),!1)}destroy(){this.destroyBean(this.eSelect),super.destroy()}},h8=class extends sJ{constructor(e,t,i,s,r,a){super(t,i,!1),this.value=e,this.valueFormatter=s,this.draggable=r,this.sourceId=a}getItem(){return this.value}getDisplayName(){return this.valueFormatter(this.value)}getAriaDisplayName(){return this.getDisplayName()}getTooltip(){}createGetDragItem(){return()=>({value:this.value})}getDragSourceType(){return m.DragSourceType.ChartPanel}getDragSourceId(){return this.sourceId}isMovable(){return this.isDraggable()}isDraggable(){return this.draggable}},h7=class extends sZ{constructor(e,t,i,s){super(!1),this.model=e,this.valueFormatter=t,this.ariaLabel=i,this.sourceId=s}postConstruct(){super.init()}isItemDroppable(e,t){return this.isSourceEventFromTarget(t)||null!=this.sourceId&&this.sourceId===t.dragSource.sourceId}updateItems(e){this.model.setValues(e)}getExistingItems(){return this.model.getValues()}getIconName(){return this.isPotentialDndItems()?"move":"notAllowed"}getAriaLabel(){return this.ariaLabel}createPillComponent(e,t,i){return new h8(e,t,i,this.valueFormatter,this.model.isDraggable(),this.sourceId)}getItems(e){return[e.value]}isInterestedIn(e){return e===m.DragSourceType.ChartPanel}},h9=class extends m.Component{constructor(e,t,i,s){super(s),this.chartController=e,this.allowMultipleSelection=t,this.maxSelection=i}wireBeans(e){this.chartTranslation=e.chartTranslation}addItem(e){this.groupComp.addItem(e)}createGroup(e,t,i,s,r){if(this.allowMultipleSelection){let r=e.filter(e=>e.selected);this.valuePillSelect=this.groupComp.createManagedBean(new h6({valueList:e,selectedValueList:r,valueFormatter:t,selectPlaceholder:this.chartTranslation.translate(i),dragSourceId:s,onValuesChange:e=>this.onValueChange(e),maxSelection:this.maxSelection})),this.groupComp.addItem(this.valuePillSelect)}else{let t=this.createValueSelectParams(e);t.onValueChange=t=>{for(let t of e)t.selected=!1;t.selected=!0,t.colId===hn&&this.chartController.setAggFunc(void 0,!0),this.chartController.updateForPanelChange({updatedColState:t,skipAnimation:r?.()})},this.valueSelect=this.groupComp.createManagedBean(new m.AgSelect(t)),this.groupComp.addItem(this.valueSelect)}}refreshValueSelect(e){if(!this.valueSelect)return;let{options:t,value:i}=this.createValueSelectParams(e);this.valueSelect.clearOptions().addOptions(t).setValue(i,!0)}createValueSelectParams(e){let t;return{options:e.map(e=>{let i=e.displayName??"";return e.selected&&(t=e),{value:e,text:i}}),value:t}}onValueChange({added:e,updated:t,removed:i,selected:s}){let r,a,l=()=>{s.forEach((e,t)=>{e.order=t}),a=!0};e.length?((r=e[0]).selected=!0,l()):i.length?(r=i[0]).selected=!1:t.length&&(l(),r=t[0]),r&&this.chartController.updateForPanelChange({updatedColState:r,resetOrder:a})}destroy(){this.valuePillSelect=void 0,this.valueSelect=void 0,super.destroy()}},ue=class extends h9{constructor(e,t,i,s,r){super(e,i,void 0,'<div id="categoriesGroup"></div>'),this.title=t,this.dimensionCols=s,this.isOpen=r}postConstruct(){this.groupComp=this.createBean(new tg({title:this.title,enabled:!0,suppressEnabledCheckbox:!0,suppressOpenCloseIcons:!1,cssIdentifier:"charts-data",expanded:this.isOpen})),this.createGroup(this.dimensionCols,e=>e.displayName??"","categoryAdd","categorySelect",()=>!this.chartController.getAggFunc()),this.createAggFuncControls(this.dimensionCols),this.getGui().appendChild(this.groupComp.getGui())}refresh(e){this.valuePillSelect?.setValues(e,e.filter(e=>e.selected)),this.refreshValueSelect(e),this.refreshAggFuncControls(e,this.chartController.getAggFunc())}createAggFuncControls(e){let t=this.chartController.getAggFunc();this.groupComp.addItem(this.aggFuncToggle=this.createBean(new m.AgToggleButton({label:this.chartTranslation.translate("aggregate"),labelAlignment:"left",labelWidth:"flex",inputWidth:"flex",value:void 0!=t,onValueChange:e=>{let t=e?"sum":void 0;this.chartController.setAggFunc(t),this.aggFuncSelect?.setValue(t,!0),this.aggFuncSelect?.setDisplayed(void 0!=t)}}))),this.groupComp.addItem(this.aggFuncSelect=this.createBean(new m.AgSelect({options:[{value:"sum",text:this.chartTranslation.translate("sum")},{value:"first",text:this.chartTranslation.translate("first")},{value:"last",text:this.chartTranslation.translate("last")},{value:"min",text:this.chartTranslation.translate("min")},{value:"max",text:this.chartTranslation.translate("max")},{value:"count",text:this.chartTranslation.translate("count")},{value:"avg",text:this.chartTranslation.translate("avg")}],value:"string"==typeof t?t:void 0,onValueChange:e=>{this.chartController.setAggFunc(e)}}))),this.refreshAggFuncControls(e,t)}refreshAggFuncControls(e,t){let i=e.filter(e=>e.selected).some(e=>e.colId!==hn);this.aggFuncToggle?.setValue(void 0!=t),this.aggFuncSelect?.setValue("string"==typeof t?t:void 0,!0),this.aggFuncToggle?.setDisplayed(i),this.aggFuncSelect?.setDisplayed(i&&void 0!=t)}clearAggFuncControls(){this.aggFuncToggle=this.destroyBean(this.aggFuncToggle),this.aggFuncSelect=this.destroyBean(this.aggFuncSelect)}destroy(){this.clearAggFuncControls(),this.groupComp=this.destroyBean(this.groupComp),super.destroy()}},ut=class extends m.BeanStub{constructor(e){super(),this.chartOptionsProxy=e}wireBeans(e){this.chartTranslation=e.chartTranslation}getDefaultColorPickerParams(e,t,i){return this.addValueParams(e,{label:this.chartTranslation.translate(t??"color"),labelWidth:"flex",inputWidth:"flex",labelAlignment:"top",pickerGap:6},i)}getDefaultNumberInputParams(e,t,i){return this.addValueParams(e,{label:this.chartTranslation.translate(t),labelAlignment:"top",labelWidth:"flex",inputWidth:"flex",precision:i?.precision,step:i?.step,min:i?.min,max:i?.max},{parseInputValue:e=>{let t=Number(e);return isNaN(t)?void 0:t},formatInputValue:e=>null==e?"":`${e}`})}getDefaultSliderParams(e,t,i,s){let r=this.chartOptionsProxy.getValue(e)??0;s&&Array.isArray(r)&&(r=r[0]);let a=this.getDefaultSliderParamsWithoutValueParams(r,t,i);return a.onValueChange=t=>this.chartOptionsProxy.setValue(e,s?[t]:t),a}getDefaultSliderParamsWithoutValueParams(e,t,i){return{label:this.chartTranslation.translate(t),minValue:0,maxValue:Math.max(e,i),textFieldWidth:45,value:`${e}`}}getDefaultCheckboxParams(e,t,i){let s=this.chartOptionsProxy.getValue(e),r={label:this.chartTranslation.translate(t),value:s,readOnly:i?.readOnly,passive:i?.passive};return r.onValueChange=t=>{this.chartOptionsProxy.setValue(e,"boolean"==typeof t?t:void 0)},r}getDefaultToggleParams(e,t,i){let s=this.chartOptionsProxy.getValue(e),r={label:this.chartTranslation.translate(t),labelAlignment:"left",labelWidth:"flex",inputWidth:"flex",value:s,readOnly:i?.readOnly,passive:i?.passive};return r.onValueChange=t=>{this.chartOptionsProxy.setValue(e,"boolean"==typeof t?t:void 0)},r}getDefaultSelectParams(e,t,i){return this.getDefaultSelectParamsWithoutValueParams(t,i,this.chartOptionsProxy.getValue(e),t=>{this.chartOptionsProxy.setValue(e,t)})}getDefaultSelectParamsWithoutValueParams(e,t,i,s){return{label:this.chartTranslation.translate(e),labelAlignment:"top",options:t,pickerGap:6,value:i,onValueChange:s}}getDefaultFontPanelParams(e,t){let i=t=>`${e}.${t}`;return this.addEnableParams(i("enabled"),{name:this.chartTranslation.translate(t),suppressEnabledCheckbox:!1,chartMenuParamsFactory:this,keyMapper:i})}addValueParams(e,t,i){let s=this.chartOptionsProxy.getValue(e);return t.value=i?.formatInputValue?i.formatInputValue(s):s,t.onValueChange=t=>{let s=i?.parseInputValue?i.parseInputValue(t):t;this.chartOptionsProxy.setValue(e,s)},t}addEnableParams(e,t){return t.enabled=this.chartOptionsProxy.getValue(e)??!1,t.onEnableChange=t=>this.chartOptionsProxy.setValue(e,t),t}getChartOptions(){return this.chartOptionsProxy}},ui=class extends m.Component{constructor(e,t){super(),this.chartMenuContext=e,this.isOpen=t,this.chartSpecificGroup=m.RefPlaceholder,this.hasContent=!1}wireBeans(e){this.chartTranslation=e.chartTranslation,this.chartSvc=e.chartSvc}postConstruct(){let e={title:this.getTitle(),enabled:!0,suppressEnabledCheckbox:!0,suppressOpenCloseIcons:!1,cssIdentifier:"charts-data",expanded:this.isOpen,items:[...this.createDirectionSelect(),this.createReverseSelect(),this.createGroupTypeSelect()]};this.setTemplate(`
            <div id="chartSpecificGroup">
                <ag-group-component data-ref="chartSpecificGroup"></ag-group-component>
            </div>`,[tC],{chartSpecificGroup:e}),this.setDisplayed(this.hasContent)}refresh(){this.hasContent=!1,this.chartSpecificGroup.setTitle(this.getTitle()),this.updateDirectionSelect(),this.updateReverseSelect(),this.updateGroupTypeSelect(),this.setDisplayed(this.hasContent)}getTitle(){let e=this.chartMenuContext.chartController.getChartType();return this.chartTranslation.translate(dq(e))}createDirectionSelect(){if(!this.chartSvc.isEnterprise())return[];let{chartOptionsService:e,chartController:t}=this.chartMenuContext,i=e.getSeriesOptionsProxy(()=>dW(t.getChartType())),s=this.createManagedBean(new ut(i)),r=["horizontal","vertical"].map(e=>({value:e,text:this.chartTranslation.translate(e)})),a=s.getDefaultSelectParams("direction","direction",r),l=a.onValueChange;return a.onValueChange=e=>{l(e),t.raiseChartModelUpdateEvent()},this.directionSelect=this.createManagedBean(new m.AgSelect(a)),this.updateDirectionSelect(),[this.directionSelect]}createReverseSelect(){let{chartMenuParamsFactory:e}=this.chartMenuContext,t=e.getDefaultToggleParams("series.reverse","reverse");return this.reverseToggle=this.createManagedBean(new m.AgToggleButton(t)),this.updateReverseSelect(),this.reverseToggle}updateReverseSelect(){let e="pyramid"===this.chartMenuContext.chartController.getChartType();this.updateDisplayed(this.reverseToggle,e)}updateDirectionSelect(){let e=dO(dW(this.chartMenuContext.chartController.getChartType()),"canSwitchDirection");this.updateDisplayed(this.directionSelect,e)}createGroupTypeSelect(){let{chartController:e,chartMenuParamsFactory:t}=this.chartMenuContext;return this.groupTypeSelect=this.createManagedBean(new m.AgSelect(t.getDefaultSelectParamsWithoutValueParams("seriesGroupType",dN.map(e=>({value:e,text:this.chartTranslation.translate(`${e}SeriesGroupType`)})),e.getSeriesGroupType(),t=>e.setSeriesGroupType(t)))),this.updateGroupTypeSelect(),this.groupTypeSelect}updateGroupTypeSelect(){let e=["radialColumn","radialBar","nightingale"].includes(this.chartMenuContext.chartController.getChartType());this.updateDisplayed(this.groupTypeSelect,e)}updateDisplayed(e,t){e?.setDisplayed(t),e&&(this.hasContent=this.hasContent||t)}},us=class extends m.Component{constructor(e,t,i){super('<div id="seriesChartTypeGroup"></div>'),this.chartController=e,this.columns=t,this.isOpen=i,this.selectedColIds=[],this.chartTypeComps=new Map,this.secondaryAxisComps=new Map}wireBeans(e){this.chartTranslation=e.chartTranslation}postConstruct(){this.createSeriesChartTypeGroup(this.columns)}refresh(e){(0,m._areEqual)(this.getValidColIds(e),this.selectedColIds)?this.refreshComps():this.recreate(e)}recreate(e){this.isOpen=this.seriesChartTypeGroupComp.isExpanded(),(0,m._clearElement)(this.getGui()),this.destroyBean(this.seriesChartTypeGroupComp),this.columns=e,this.selectedColIds=[],this.clearComps(),this.postConstruct()}getValidColIds(e){let t=this.chartController.getSeriesChartTypes();return e.filter(e=>e.selected&&!!t.filter(t=>t.colId===e.colId)[0]).map(({colId:e})=>e)}createSeriesChartTypeGroup(e){this.seriesChartTypeGroupComp=this.createBean(new tg({title:this.chartTranslation.translate("seriesChartType"),enabled:!0,suppressEnabledCheckbox:!0,suppressOpenCloseIcons:!1,cssIdentifier:"charts-data",expanded:this.isOpen}));let t=this.chartController.getSeriesChartTypes();for(let i of e){if(!i.selected)continue;let e=t.filter(e=>e.colId===i.colId)[0];if(!e)continue;this.selectedColIds.push(i.colId);let s=this.seriesChartTypeGroupComp.createManagedBean(new tg({title:i.displayName,enabled:!0,suppressEnabledCheckbox:!0,suppressOpenCloseIcons:!0,cssIdentifier:"charts-format-sub-level"})),r=e=>["groupedColumn","stackedColumn","stackedArea"].includes(e),a=this.seriesChartTypeGroupComp.createManagedBean(new m.AgCheckbox({label:this.chartTranslation.translate("secondaryAxis"),labelWidth:"flex",disabled:r(e.chartType),value:!!e.secondaryAxis,onValueChange:e=>this.chartController.updateSeriesChartType(i.colId,void 0,e)}));s.addItem(a);let l=["line","area","stackedArea","groupedColumn","stackedColumn"].map(e=>({value:e,text:this.chartTranslation.translate(dq(e))})),n=s.createManagedBean(new m.AgSelect({options:l,value:e.chartType,onValueChange:e=>this.chartController.updateSeriesChartType(i.colId,e)}));s.addItem(n),this.seriesChartTypeGroupComp.addItem(s),this.chartTypeComps.set(i.colId,n),this.secondaryAxisComps.set(i.colId,a)}this.getGui().appendChild(this.seriesChartTypeGroupComp.getGui())}refreshComps(){let e=this.chartController.getSeriesChartTypes();for(let t of this.selectedColIds){let i=e.find(e=>e.colId===t);if(!i)continue;let s=this.chartTypeComps.get(t),r=this.secondaryAxisComps.get(t);s?.setValue(i.chartType),r?.setValue(!!i.secondaryAxis),r?.setDisabled(this.isSecondaryAxisDisabled(i.chartType))}}clearComps(){this.chartTypeComps.clear(),this.secondaryAxisComps.clear()}isSecondaryAxisDisabled(e){return["groupedColumn","stackedColumn","stackedArea"].includes(e)}destroy(){this.clearComps(),this.seriesChartTypeGroupComp=this.destroyBean(this.seriesChartTypeGroupComp),super.destroy()}},ur=class extends h9{constructor(e,t,i,s,r,a,l){super(e,s,r,'<div id="seriesGroup"></div>'),this.chartOptionsService=t,this.title=i,this.valueCols=a,this.isOpen=l}postConstruct(){if(this.groupComp=this.createBean(new tg({title:this.title,enabled:!0,suppressEnabledCheckbox:!0,suppressOpenCloseIcons:!1,cssIdentifier:"charts-data",expanded:this.isOpen})),this.chartController.isActiveXYChart()){let e=this.groupComp.createManagedBean(new m.AgToggleButton({label:this.chartTranslation.translate("paired"),labelAlignment:"left",labelWidth:"flex",inputWidth:"flex",value:this.chartOptionsService.getPairedMode(),onValueChange:e=>{this.chartOptionsService.setPairedMode(!!e),this.chartController.updateForGridChange({maintainColState:!0})}}));this.groupComp.addItem(e)}this.createGroup(this.valueCols,this.generateGetSeriesLabel(this.valueCols),"seriesAdd","seriesSelect"),this.getGui().appendChild(this.groupComp.getGui())}refresh(e){this.valuePillSelect?.setValueFormatter(this.generateGetSeriesLabel(e)),this.valuePillSelect?.setValues(e,e.filter(e=>e.selected)),this.refreshValueSelect(e)}generateGetSeriesLabel(e){if(!this.chartController.isActiveXYChart())return e=>e.displayName??"";let t=e.filter(e=>e.selected),i="bubble"===this.chartController.getChartType(),s=this.chartOptionsService.getPairedMode(),r=new Map;return r.set(0,"X"),r.set(1,"Y"),r.set(2,"size"),e=>{let a,l=e.displayName??"";if(!e.selected)return l;let n=t.indexOf(e);return -1===n?l:(a=s?r.get(n%(i?3:2)):0===n?"X":i&&n%2==0?"size":"Y",`${l} (${a})`)}}destroy(){this.groupComp=this.destroyBean(this.groupComp),super.destroy()}},ua={groups:[{type:"categories",isOpen:!0},{type:"series",isOpen:!0},{type:"seriesChartType",isOpen:!0},{type:"chartSpecific",isOpen:!0}]},ul=class extends m.Component{constructor(e){super('<div class="ag-chart-data-wrapper ag-scrollable-container"></div>'),this.chartMenuContext=e,this.isSwitchCategorySeriesToggled=!1,this.restoreSwitchCategorySeriesToggleFocus=!1,this.panels=[],this.chartController=e.chartController}wireBeans(e){this.chartTranslation=e.chartTranslation,this.chartSvc=e.chartSvc}postConstruct(){this.createSwitchCategorySeriesToggle(),this.isSwitchCategorySeriesToggled=this.chartController.isCategorySeriesSwitched(),this.updatePanels();let e=this.updatePanels.bind(this);this.addManagedListeners(this.chartController,{chartModelUpdate:e,chartApiUpdate:e})}destroy(){this.clearPanelComponents(),super.destroy()}updatePanels(){let e=this.chartType,t=this.isSwitchCategorySeriesToggled,{dimensionCols:i,valueCols:s}=this.chartController.getColStateForMenu();this.chartType=this.chartController.getChartType(),this.isSwitchCategorySeriesToggled=this.chartController.isCategorySeriesSwitched();let r=this.isSwitchCategorySeriesToggled!==t;this.canRefresh(e,this.chartType)&&!r?(this.categoriesDataPanel?.refresh(i),this.seriesDataPanel?.refresh(s),this.seriesChartTypePanel?.refresh(s),this.chartSpecificPanel?.refresh()):this.recreatePanels(i,s);let a=dY(this.chartType)&&this.chartSvc.isEnterprise()&&!this.chartController.isGrouping();(0,m._setDisplayed)(this.switchCategorySeriesToggle.getGui(),a),r&&this.switchCategorySeriesToggle?.setValue(this.chartController.isCategorySeriesSwitched()),this.restoreSwitchCategorySeriesToggleFocus&&(this.restoreSwitchCategorySeriesToggleFocus=!1,a&&this.switchCategorySeriesToggle.getFocusableElement().focus())}canRefresh(e,t){if(void 0===e)return!1;if(e===t)return!0;let i=e=>["columnLineCombo","areaColumnCombo","customCombo"].includes(e);return!!(i(e)&&i(t))}recreatePanels(e,t){this.clearPanelComponents();let{chartType:i}=this;if(!i)return;let s=this.chartController.isCategorySeriesSwitched();this.getDataPanelDef().groups?.forEach(({type:r,isOpen:a})=>{r===(s?"series":"categories")?(this.categoriesDataPanel=this.createBean(new ue(this.chartController,this.getCategoryGroupTitle(s),this.getCategoryGroupMultipleSelect(i,s),e,a)),this.panels.push(this.categoriesDataPanel)):r===(s?"categories":"series")?(this.seriesDataPanel=this.createBean(new ur(this.chartController,this.chartMenuContext.chartOptionsService,this.getSeriesGroupTitle(s),this.getSeriesGroupMultipleSelect(i,s),this.getSeriesGroupMaxSelection(i,s),t,a)),this.panels.push(this.seriesDataPanel)):"seriesChartType"===r?this.chartController.isComboChart()&&(this.seriesChartTypePanel=this.createBean(new us(this.chartController,t,a)),this.panels.push(this.seriesChartTypePanel)):"chartSpecific"===r?(this.chartSpecificPanel=this.createBean(new ui(this.chartMenuContext,a)),this.panels.push(this.chartSpecificPanel)):(0,m._warn)(144,{type:r})}),(s?this.categoriesDataPanel:this.seriesDataPanel)?.addItem(this.switchCategorySeriesToggle.getGui()),this.addPanelComponents()}addPanelComponents(){if(!this.panels.length)return;let e=(0,m._getDocument)(this.beans).createDocumentFragment();for(let t of this.panels)t.addCss("ag-chart-data-section"),e.appendChild(t.getGui());this.getGui().appendChild(e)}clearPanelComponents(){for(let e of this.panels)e.getGui().remove(),this.destroyBean(e);this.panels=[]}getDataPanelDef(){return this.gos.get("chartToolPanelsDef")?.dataPanel??ua}getCategoryGroupTitle(e){return e?this.chartTranslation.translate("seriesLabels"):this.chartTranslation.translate(this.chartController.isActiveXYChart()?"labels":"categories")}getCategoryGroupMultipleSelect(e,t){return!t&&1!==d$(e)}getSeriesGroupTitle(e){return e?this.chartTranslation.translate("categoryValues"):this.chartTranslation.translate(this.chartController.isActiveXYChart()?"xyValues":"series")}getSeriesGroupMultipleSelect(e,t){return 1!==this.getSeriesGroupMaxSelection(e,t)}getSeriesGroupMaxSelection(e,t){if(!t)return dj(e)}createSwitchCategorySeriesToggle(){this.switchCategorySeriesToggle=this.createManagedBean(new m.AgToggleButton({label:this.chartTranslation.translate("switchCategorySeries"),labelAlignment:"left",labelWidth:"flex",inputWidth:"flex",value:this.chartController.isCategorySeriesSwitched(),onValueChange:e=>{this.restoreSwitchCategorySeriesToggleFocus=!0,this.chartController.switchCategorySeries(e)}}))}},un=class extends m.AgAbstractLabel{constructor(e){super(e,`<div class="ag-angle-select">
            <div data-ref="eLabel"></div>
            <div class="ag-wrapper ag-angle-select-wrapper">
                <div class="ag-angle-select-field">
                    <div data-ref="eParentCircle" class="ag-angle-select-parent-circle">
                        <div data-ref="eChildCircle" class="ag-angle-select-child-circle"></div>
                    </div>
                </div>
                <ag-input-number-field data-ref="eAngleValue"></ag-input-number-field>
            </div>
        </div>`,[m.AgInputNumberFieldSelector]),this.eLabel=m.RefPlaceholder,this.eParentCircle=m.RefPlaceholder,this.eChildCircle=m.RefPlaceholder,this.eAngleValue=m.RefPlaceholder,this.radius=0,this.offsetX=0,this.offsetY=0}wireBeans(e){this.dragSvc=e.dragSvc}postConstruct(){super.postConstruct();let{value:e,onValueChange:t}=this.config;null!=e&&this.setValue(e,void 0,!0),null!=t&&this.onValueChange(t),this.dragListener={eElement:this.eParentCircle,dragStartPixels:0,onDragStart:()=>{this.parentCircleRect=this.eParentCircle.getBoundingClientRect()},onDragging:e=>this.calculateAngleDrag(e),onDragStop:()=>{}},this.dragSvc?.addDragSource(this.dragListener),this.eAngleValue.setLabel("").setLabelWidth(5).setInputWidth(45).setMin(0).setMax(360).setValue(`${this.degrees}`).onValueChange(e=>{(null==e||""===e)&&(e="0");let t=parseFloat(e=this.eAngleValue.normalizeValue(e));t>180&&(t-=360),this.setValue(t)}),this.updateNumberInput(),(0,m._exists)(this.getValue())&&this.eAngleValue.setValue(this.normalizeNegativeValue(this.getValue()).toString()),this.addManagedListeners(this,{fieldValueChanged:()=>{this.eAngleValue.getInputElement().contains((0,m._getActiveDomElement)(this.beans))||this.updateNumberInput()}})}updateNumberInput(){let e=this.normalizeNegativeValue(this.getValue());this.eAngleValue.setValue(e.toString())}positionChildCircle(e){let t=this.parentCircleRect||{width:24,height:24},i=this.eChildCircle,s=t.width/2,r=t.height/2;i.style.left=`${s+8*Math.cos(e)}px`,i.style.top=`${r+8*Math.sin(e)}px`}calculatePolar(){let e=this.offsetX,t=this.offsetY,i=Math.atan2(t,e);this.degrees=this.toDegrees(i),this.radius=Math.sqrt(e*e+t*t),this.positionChildCircle(i)}calculateCartesian(){let e=this.toRadians(this.getValue()),t=this.getRadius();this.setOffsetX(Math.cos(e)*t).setOffsetY(Math.sin(e)*t)}setOffsetX(e){return this.offsetX!==e&&(this.offsetX=e,this.calculatePolar()),this}setOffsetY(e){return this.offsetY!==e&&(this.offsetY=e,this.calculatePolar()),this}calculateAngleDrag(e){let t=this.parentCircleRect,i=t.width/2,s=t.height/2,r=e.clientX-t.left,a=Math.atan2(e.clientY-t.top-s,r-i);this.setValue(a,!0)}toDegrees(e){return e/Math.PI*180}toRadians(e){return e/180*Math.PI}normalizeNegativeValue(e){return e<0?360+e:e}normalizeAngle180(e){return(e%=2*Math.PI)<-Math.PI?e+=2*Math.PI:e>=Math.PI&&(e-=2*Math.PI),e}getRadius(){return this.radius}setRadius(e){return this.radius===e||(this.radius=e,this.calculateCartesian()),this}onValueChange(e){return this.addManagedListeners(this,{fieldValueChanged:()=>{e(this.degrees)}}),this}getValue(e){return e?this.toRadians(this.degrees):this.degrees}setValue(e,t,i){let s;return s=t?e:this.normalizeAngle180(this.toRadians(e)),e=this.toDegrees(s),this.degrees!==e&&(this.degrees=Math.floor(e),this.calculateCartesian(),this.positionChildCircle(s),i||this.dispatchLocalEvent({type:"fieldValueChanged"})),this}setWidth(e){return(0,m._setFixedWidth)(this.getGui(),e),this}setDisabled(e){return super.setDisabled(e),this.eAngleValue.setDisabled(e),this}destroy(){this.dragSvc?.removeDragSource(this.dragListener),super.destroy()}},uo=class extends m.Component{constructor(e){super(),this.params=e,this.fontGroup=m.RefPlaceholder,this.activeComps=[],this.chartOptions=e.chartMenuParamsFactory.getChartOptions()}wireBeans(e){this.chartTranslation=e.chartTranslation}postConstruct(){let{cssIdentifier:e="charts-format-sub-level",name:t,enabled:i,onEnableChange:s,suppressEnabledCheckbox:r,chartMenuParamsFactory:a,keyMapper:l}=this.params;this.setTemplate(`<div class="ag-font-panel">
        <ag-group-component data-ref="fontGroup">
            <ag-select data-ref="familySelect"></ag-select>
            <ag-select data-ref="weightStyleSelect"></ag-select>
            <div class="ag-charts-font-size-color">
                <ag-select data-ref="sizeSelect"></ag-select>
                <ag-color-picker data-ref="colorPicker"></ag-color-picker>
            </div>
        </ag-group-component>
    </div>`,[tC,m.AgSelectSelector,hf],{fontGroup:{cssIdentifier:e,direction:"vertical",suppressOpenCloseIcons:!0,title:t,enabled:i,suppressEnabledCheckbox:!0,onEnableChange:e=>{s&&s(e)},useToggle:!r},familySelect:this.getFamilySelectParams(),weightStyleSelect:this.getWeightStyleSelectParams(),sizeSelect:this.getSizeSelectParams(),colorPicker:a.getDefaultColorPickerParams(l("color"))}),this.toggleCss("ag-font-panel-no-header",!t)}addItem(e,t){t?this.fontGroup.prependItem(e):this.fontGroup.addItem(e),this.activeComps.push(e)}setEnabled(e){this.fontGroup.setEnabled(e)}getFamilySelectParams(){let e=["Arial, sans-serif","Aria Black, sans-serif","Book Antiqua,  serif","Charcoal, sans-serif","Comic Sans MS, cursive","Courier, monospace","Courier New, monospace","Gadget, sans-serif","Geneva, sans-serif","Helvetica, sans-serif","Impact, sans-serif","Lucida Console, monospace","Lucida Grande, sans-serif","Lucida Sans Unicode,  sans-serif","Monaco, monospace","Palatino Linotype, serif","Palatino, serif","Times New Roman, serif","Times, serif","Verdana, sans-serif"],t=this.getInitialFontValue("fontFamily"),i=e[0];if(t){let s=e.map(e=>e.toLowerCase()).indexOf(t.toLowerCase());if(s>=0)i=e[s];else{let s=t[0].toUpperCase()+t.substring(1).toLowerCase();e.push(s),i=s}}let s=e.sort().map(e=>({value:e,text:e}));return this.params.chartMenuParamsFactory.getDefaultSelectParamsWithoutValueParams("font",s,`${i}`,e=>this.setFont({fontFamily:e}))}getSizeSelectParams(){let e=[8,10,12,14,16,18,20,22,24,26,28,30,32,34,36],t=this.getInitialFontValue("fontSize");e.includes(t)||e.push(t);let i=e.sort((e,t)=>e-t).map(e=>({value:`${e}`,text:`${e}`}));return this.params.chartMenuParamsFactory.getDefaultSelectParamsWithoutValueParams("size",i,`${t}`,e=>this.setFont({fontSize:parseInt(e,10)}))}getWeightStyleSelectParams(){let e=this.getInitialFontValue("fontWeight")??"normal",t=this.getInitialFontValue("fontStyle")??"normal",i=[{name:"normal",weight:"normal",style:"normal"},{name:"bold",weight:"bold",style:"normal"},{name:"italic",weight:"normal",style:"italic"},{name:"boldItalic",weight:"bold",style:"italic"}],s=i.find(i=>i.weight===e&&i.style===t);s||(s={name:"predefined",weight:e,style:t},i.unshift(s));let r=i.map(e=>({value:e.name,text:this.chartTranslation.translate(e.name)}));return this.params.chartMenuParamsFactory.getDefaultSelectParamsWithoutValueParams("weight",r,s.name,e=>{let t=i.find(t=>t.name===e);this.setFont({fontWeight:t.weight,fontStyle:t.style})})}destroyActiveComps(){for(let e of this.activeComps)(0,m._removeFromParent)(e.getGui()),this.destroyBean(e)}destroy(){this.destroyActiveComps(),super.destroy()}setFont(e){let{keyMapper:t}=this.params;for(let i of Object.keys(e)){let s=e[i];s&&this.chartOptions.setValue(t(i),s)}}getInitialFontValue(e){let{keyMapper:t}=this.params;return this.chartOptions.getValue(t(e))}},ud=class extends m.Component{constructor(e){super(),this.chartMenuUtils=e,this.axisTicksSizeSlider=m.RefPlaceholder}wireBeans(e){this.chartTranslation=e.chartTranslation}postConstruct(){let{chartMenuUtils:e}=this,t=e.addEnableParams("tick.enabled",{cssIdentifier:"charts-format-sub-level",direction:"vertical",suppressOpenCloseIcons:!0,title:this.chartTranslation.translate("ticks"),suppressEnabledCheckbox:!0,useToggle:!0}),i=e.getDefaultColorPickerParams("tick.stroke"),s=e.getDefaultSliderParams("tick.width","width",10),r=e.getDefaultSliderParams("tick.size","length",30);this.setTemplate(`<div>
            <ag-group-component data-ref="axisTicksGroup">
                <ag-color-picker data-ref="axisTicksColorPicker"></ag-color-picker>
                <ag-slider data-ref="axisTicksWidthSlider"></ag-slider>
                <ag-slider data-ref="axisTicksSizeSlider"></ag-slider>
            </ag-group-component>
        </div>`,[tC,hf,e7],{axisTicksGroup:t,axisTicksColorPicker:i,axisTicksWidthSlider:s,axisTicksSizeSlider:r})}setTickSizeSliderDisplayed(e){this.axisTicksSizeSlider.setDisplayed(e)}},uh=class extends m.Component{constructor(e){super(),this.chartMenuUtils=e,this.chartOptions=e.getChartOptions()}wireBeans(e){this.chartTranslation=e.chartTranslation}postConstruct(){let e=this.chartMenuUtils.addEnableParams("gridLine.enabled",{cssIdentifier:"charts-format-sub-level",direction:"vertical",suppressOpenCloseIcons:!0,title:this.chartTranslation.translate("gridLines"),suppressEnabledCheckbox:!0,useToggle:!0}),t=this.getGridLineColorPickerParams("color"),i=this.getGridLineWidthSliderParams("thickness"),s=this.getGridLineDashSliderParams("lineDash");this.setTemplate(`<div>
            <ag-group-component data-ref="gridLineGroup">
                <ag-color-picker data-ref="gridLineColorPicker"></ag-color-picker>
                <ag-slider data-ref="gridLineWidthSlider"></ag-slider>
                <ag-slider data-ref="gridLineLineDashSlider"></ag-slider>
            </ag-group-component>
        </div>`,[tC,hf,e7],{gridLineGroup:e,gridLineColorPicker:t,gridLineWidthSlider:i,gridLineLineDashSlider:s})}getGridLineColorPickerParams(e){return this.chartMenuUtils.getDefaultColorPickerParams("gridLine.style",e,{formatInputValue:e=>e?.[0]?.stroke,parseInputValue:e=>{let t=this.chartOptions.getValue("gridLine.style")??[];return 0===t.length?[{stroke:e,lineDash:[]}]:[{...t[0],stroke:e}]}})}getGridLineWidthSliderParams(e){return this.chartMenuUtils.getDefaultSliderParams("gridLine.width",e,10)}getGridLineDashSliderParams(e){let t=this.chartOptions.getValue("gridLine.style"),i=t?.[0]?.lineDash?.[0],s=this.chartMenuUtils.getDefaultSliderParamsWithoutValueParams(i??0,e,30);return s.onValueChange=e=>{let t=this.chartOptions.getValue("gridLine.style.0.stroke");this.chartOptions.setValue("gridLine.style",[{lineDash:[e],stroke:t}])},s}},uu=class extends m.Component{constructor(e,t){super(),this.axisType=e,this.options=t,this.axisGroup=m.RefPlaceholder,this.axisTypeSelect=m.RefPlaceholder,this.axisPositionSelect=m.RefPlaceholder,this.axisTimeFormatSelect=m.RefPlaceholder,this.activePanels=[],this.updateFuncs=[];const{chartOptionsService:i,seriesType:s,chartController:r}=t;this.chartOptionsService=i,this.chartController=r,this.chartOptionsSeriesProxy=i.getSeriesOptionsProxy(()=>s)}wireBeans(e){this.chartTranslation=e.chartTranslation}postConstruct(){let{isExpandedOnInit:e,chartOptionsService:t,registerGroupComponent:i}=this.options,s=this.axisType,r={cssIdentifier:"charts-format-top-level",direction:"vertical",title:this.translate(s),expanded:e,suppressEnabledCheckbox:!0},a=t.getCartesianAxisOptionsProxy(this.axisType),l=this.createManagedBean(new ut(a)),n=this.createManagedBean(new ut(t.getCartesianAxisThemeOverridesProxy(this.axisType))),o=this.getAxisTypeSelectParams(l,t.getCartesianAxisAppliedThemeOverridesProxy(this.axisType)),d=this.getAxisPositionSelectParams(l),h=this.getAxisTimeFormatSelectParams(l),u=this.getAxisColorInputParams(n),c=this.getAxisLineWidthSliderParams(n);this.setTemplate(`<div>
            <ag-group-component data-ref="axisGroup">
                <ag-select data-ref="axisTypeSelect"></ag-select>
                <ag-select data-ref="axisTimeFormatSelect"></ag-select>
                <ag-select data-ref="axisPositionSelect"></ag-select>
                <ag-color-picker data-ref="axisColorInput"></ag-color-picker>
                <ag-slider data-ref="axisLineWidthSlider"></ag-slider>
            </ag-group-component>
        </div>`,[tC,m.AgSelectSelector,hf,e7],{axisGroup:r,axisTypeSelect:o??void 0,axisPositionSelect:d??void 0,axisTimeFormatSelect:h??void 0,axisColorInput:u,axisLineWidthSlider:c}),i(this.axisGroup),this.axisTypeSelect.setDisplayed(!!o.options?.length),d||this.removeTemplateComponent(this.axisPositionSelect);let p=()=>{let e="time"===a.getValue("type");(0,m._setDisplayed)(this.axisTimeFormatSelect.getGui(),e)};h?(p(),this.addManagedEventListeners({chartOptionsChanged:()=>{p()}})):this.removeTemplateComponent(this.axisTimeFormatSelect),this.initGridLines(n),this.initAxisTicks(n),this.initAxisLabels(n);let g=()=>{for(let e of this.updateFuncs)e()};this.addManagedListeners(this.chartController,{chartUpdated:g,chartModelUpdate:()=>setTimeout(()=>{this.isAlive()&&(this.refreshAxisTypeSelect(l),p())})})}getAxisTypeSelectParams(e,t){let i=e.getChartOptions(),s=this.getAxisTypeSelectOptions(),r=e.getDefaultSelectParams("type","axisType",s);return r.onValueChange=e=>{let s=i.getValue("type");if(e===s)return;let r=t.getValue("*"),a="time"===e,l="time"===s!==a?a?"%d %B %Y":void 0:null;void 0===l&&i.clearValue?.("label","format"),this.chartOptionsService.setCartesianCategoryAxisType(this.axisType,e),null!=l&&i.setValue("label.format",l),t.setValue("*",r)},r}refreshAxisTypeSelect(e){let t=this.getAxisTypeSelectOptions(),i=!!t.length;this.axisTypeSelect.setDisplayed(i),i&&this.axisTypeSelect.clearOptions().addOptions(t).setValue(e.getChartOptions().getValue("type"))}getAxisTypeSelectOptions(){let e,t=this.chartController;return["heatmap","histogram","boxPlot","rangeBar","scatter","bubble"].includes(t.getChartType())||t.isGrouping()||!this.isCategoryAxis()||t.isCategorySeriesSwitched()||!((e=t.getChartData()[0])&&t.getSelectedDimensions().every(t=>!isNaN(parseFloat(e[t.colId]))))?[]:["category","number","time"].map(e=>({value:e,text:this.translate(e)}))}isCategoryAxis(){let e="horizontal"===this.chartOptionsSeriesProxy.getValue("direction");return e&&"yAxis"===this.axisType||!e&&"xAxis"===this.axisType}getAxisPositionSelectParams(e){var t,i;let s=(t=this.chartController.getChartType(),i=this.axisType,"heatmap"===t?null:"xAxis"===i?[{value:"top",text:this.translate("top")},{value:"bottom",text:this.translate("bottom")}]:"yAxis"===i?[{value:"left",text:this.translate("left")},{value:"right",text:this.translate("right")}]:void 0);return s?e.getDefaultSelectParams("position","position",s):null}getAxisTimeFormatSelectParams(e){if(!this.isCategoryAxis())return null;let t=[{value:"%d/%m/%Y",text:this.translate("timeFormatSlashesDDMMYYYY")},{value:"%m/%d/%Y",text:this.translate("timeFormatSlashesMMDDYYYY")},{value:"%d/%m/%y",text:this.translate("timeFormatSlashesDDMMYY")},{value:"%m/%d/%y",text:this.translate("timeFormatSlashesMMDDYY")},{value:"%d.%e.%y",text:this.translate("timeFormatDotsDDMYY")},{value:"%e.%d.%y",text:this.translate("timeFormatDotsMDDYY")},{value:"%Y-%m-%d",text:this.translate("timeFormatDashesYYYYMMDD")},{value:"%d %B %Y",text:this.translate("timeFormatSpacesDDMMMMYYYY")},{value:"%H:%M:%S",text:this.translate("timeFormatHHMMSS")},{value:"%I:%M:%S %p",text:this.translate("timeFormatHHMMSSAmPm")}];return e.getDefaultSelectParams("label.format","timeFormat",t)}getAxisColorInputParams(e){return e.getDefaultColorPickerParams("line.stroke")}getAxisLineWidthSliderParams(e){let t=e.getChartOptions(),i=e.getDefaultSliderParamsWithoutValueParams((t.getValue("line.enabled")?t.getValue("line.width"):null)??0,"thickness",10);return i.onValueChange=e=>{var i;i=0===e?null:e,t.setValues([{expression:"line.enabled",value:null!=i},{expression:"line.width",value:i??0}])},i}initGridLines(e){if("heatmap"===this.chartController.getChartType())return;let t=this.createBean(new uh(e));this.axisGroup.addItem(t),this.activePanels.push(t)}initAxisTicks(e){if(!this.hasConfigurableAxisTicks())return;let t=this.createBean(new ud(e));this.axisGroup.addItem(t),this.activePanels.push(t);let i=()=>t.setTickSizeSliderDisplayed(this.isGroupedCategoryAxis());this.updateFuncs.push(i),i()}hasConfigurableAxisTicks(){switch(this.chartController.getChartType()){case"radarLine":case"radarArea":case"rangeBar":case"boxPlot":case"waterfall":return!1;default:return!0}}initAxisLabels(e){let t={name:this.translate("labels"),enabled:!0,suppressEnabledCheckbox:!0,chartMenuParamsFactory:e,keyMapper:e=>`label.${e}`},i=this.createBean(new uo(t));this.axisGroup.addItem(i),this.activePanels.push(i),this.addAdditionalLabelComps(i,e)}addAdditionalLabelComps(e,t){this.addLabelPadding(e,t);let i=this.createRotationWidget("labelRotation",t),s=this.initLabelRotation(i,t);e.addItem(s),e.addItem(i)}initLabelRotation(e,t){let i=t.getChartOptions(),s=t=>{t&&(this.prevRotation=i.getValue("label.rotation")),i.setValues([{expression:"label.autoRotate",value:t},{expression:"label.rotation",value:t?void 0:this.prevRotation}]),e.setDisplayed(!t)},r="number"!=typeof i.getValue("label.rotation")&&i.getValue("label.autoRotate"),a=this.createBean(new m.AgCheckbox({label:this.translate("autoRotate"),value:r,onValueChange:s}));e.setDisplayed(!r);let l=()=>a.setDisplayed(this.isGroupedCategoryAxis());return this.updateFuncs.push(l),l(),a}createRotationWidget(e,t){let i=t.getChartOptions(),s=String.fromCharCode(176),r=new un({label:`${this.chartTranslation.translate(e)} ${s}`,labelWidth:"flex",value:i.getValue("label.rotation")??0,onValueChange:e=>i.setValue("label.rotation",e)});return this.updateFuncs.push(()=>{r.setValue(i.getValue("label.rotation")??0)}),this.createBean(r)}isGroupedCategoryAxis(){return"grouped-category"!==this.chartOptionsService.getCartesianAxisOptionsProxy(this.axisType).getValue("type")||!this.isCategoryAxis()}addLabelPadding(e,t){let i=this.createBean(new e8(t.getDefaultSliderParams("label.spacing","padding",30)));e.addItem(i)}translate(e){return this.chartTranslation.translate(e)}removeTemplateComponent(e){(0,m._removeFromParent)(e.getGui()),this.destroyBean(e)}destroyActivePanels(){for(let e of this.activePanels)(0,m._removeFromParent)(e.getGui()),this.destroyBean(e)}destroy(){this.destroyActivePanels(),super.destroy()}},uc=class extends m.Component{constructor(e){super(),this.options=e,this.axisGroup=m.RefPlaceholder}wireBeans(e){this.chartTranslation=e.chartTranslation}postConstruct(){let{isExpandedOnInit:e,chartAxisMenuParamsFactory:t,registerGroupComponent:i}=this.options,s={cssIdentifier:"charts-format-top-level",direction:"vertical",title:this.translate("polarAxis"),expanded:e,suppressEnabledCheckbox:!0},r=t.getDefaultColorPickerParams("line.stroke"),a=t.getDefaultSliderParams("line.width","thickness",10);this.setTemplate(`<div>
            <ag-group-component data-ref="axisGroup">
                <ag-color-picker data-ref="axisColorInput"></ag-color-picker>
                <ag-slider data-ref="axisLineWidthSlider"></ag-slider>
            </ag-group-component>
        </div>`,[tC,hf,e7],{axisGroup:s,axisColorInput:r,axisLineWidthSlider:a}),i(this.axisGroup),this.initAxis(),this.initAxisLabels(),this.initRadiusAxis()}initAxis(){let e=this.options.chartController.getChartType();if(["radarLine","radarArea"].includes(e)){let e=[{value:"circle",text:this.translate("circle")},{value:"polygon",text:this.translate("polygon")}];this.axisGroup.addItem(this.createSelect({labelKey:"shape",options:e,property:"shape"}))}"pie"!==e&&this.axisGroup.addItem(this.createSlider({labelKey:"innerRadius",defaultMaxValue:1,property:"innerRadiusRatio"}))}initAxisLabels(){let e={name:this.translate("labels"),enabled:!0,suppressEnabledCheckbox:!0,chartMenuParamsFactory:this.options.chartAxisMenuParamsFactory,keyMapper:e=>`label.${e}`},t=this.createManagedBean(new uo(e)),i=this.createOrientationWidget();t.addItem(i),this.axisGroup.addItem(t)}createOrientationWidget(){let e=[{value:"fixed",text:this.translate("fixed")},{value:"parallel",text:this.translate("parallel")},{value:"perpendicular",text:this.translate("perpendicular")}];return this.createSelect({labelKey:"orientation",options:e,property:"label.orientation"})}initRadiusAxis(){if(!dO(dW(this.options.chartController.getChartType()),"isRadial"))return;let e=[this.createSlider({labelKey:"groupPadding",defaultMaxValue:1,property:"paddingInner"}),this.createSlider({labelKey:"seriesPadding",defaultMaxValue:1,property:"groupPaddingInner"})],t=this.createManagedBean(new tg({cssIdentifier:"charts-format-sub-level",direction:"vertical",suppressOpenCloseIcons:!0,enabled:!0,suppressEnabledCheckbox:!0,title:this.translate("padding"),items:e})).hideEnabledCheckbox(!0).hideOpenCloseIcons(!0);this.axisGroup.addItem(t)}createSlider(e){let{labelKey:t,defaultMaxValue:i,step:s=.05,property:r}=e,a=this.options.chartAxisMenuParamsFactory.getDefaultSliderParams(r,t,i);return a.step=s,this.createManagedBean(new e8(a))}createSelect(e){let{labelKey:t,options:i,property:s}=e;return this.createManagedBean(new m.AgSelect(this.options.chartAxisMenuParamsFactory.getDefaultSelectParams(s,t,i)))}translate(e){return this.chartTranslation.translate(e)}},up=class extends m.Component{constructor(e){super(),this.chartMenuUtils=e}wireBeans(e){this.chartTranslation=e.chartTranslation}postConstruct(){let e=this.chartMenuUtils.addEnableParams("background.visible",{cssIdentifier:"charts-format-sub-level",direction:"vertical",suppressOpenCloseIcons:!0,title:this.chartTranslation.translate("background"),suppressEnabledCheckbox:!0,useToggle:!0}),t=this.chartMenuUtils.getDefaultColorPickerParams("background.fill");this.setTemplate(`<div>
            <ag-group-component data-ref="chartBackgroundGroup">
                <ag-color-picker data-ref="colorPicker"></ag-color-picker>
            </ag-group-component>
        <div>`,[tC,hf],{chartBackgroundGroup:e,colorPicker:t})}},ug=class extends m.Component{constructor(e,t){super(),this.chartMenuUtils=e,this.chartController=t,this.paddingTopSlider=m.RefPlaceholder}wireBeans(e){this.chartTranslation=e.chartTranslation}postConstruct(){let e={cssIdentifier:"charts-format-sub-level",direction:"vertical",suppressOpenCloseIcons:!0,title:this.chartTranslation.translate("padding"),suppressEnabledCheckbox:!0},t=e=>this.chartMenuUtils.getDefaultSliderParams("padding."+e,e,200);this.setTemplate(`<div>
            <ag-group-component data-ref="chartPaddingGroup">
                <ag-slider data-ref="paddingTopSlider"></ag-slider>
                <ag-slider data-ref="paddingRightSlider"></ag-slider>
                <ag-slider data-ref="paddingBottomSlider"></ag-slider>
                <ag-slider data-ref="paddingLeftSlider"></ag-slider>
            </ag-group-component>
        <div>`,[tC,e7],{chartPaddingGroup:e,paddingTopSlider:t("top"),paddingRightSlider:t("right"),paddingBottomSlider:t("bottom"),paddingLeftSlider:t("left")}),this.addManagedEventListeners({chartOptionsChanged:e=>{this.updateTopPadding(e.chartOptions)}})}updateTopPadding(e){let t=[...this.chartController.getChartSeriesTypes(),"common"].map(t=>e?.[t]?.padding?.top).find(e=>null!=e);null!=t&&this.paddingTopSlider.setValue(`${t}`)}},um=class extends m.Component{constructor(e){super(),this.options=e,this.chartGroup=m.RefPlaceholder}wireBeans(e){this.chartTranslation=e.chartTranslation}postConstruct(){let{chartController:e,chartMenuParamsFactory:t,isExpandedOnInit:i,registerGroupComponent:s}=this.options,r={cssIdentifier:"charts-format-top-level",direction:"vertical",title:this.chartTranslation.translate("chartStyle"),expanded:i,suppressEnabledCheckbox:!0,items:[this.createManagedBean(new ug(t,e)),this.createManagedBean(new up(t))]};this.setTemplate(`<div>
            <ag-group-component data-ref="chartGroup"></ag-group-component>
        </div>`,[tC],{chartGroup:r}),s(this.chartGroup)}},uf=class extends m.BeanStub{constructor(e){super(),this.groupContainer=e,this.id=0,this.groupComponents=new Map}addGroupComponent(e){let t=this.id++;this.groupComponents.set(t,e),e.isExpanded()&&(this.expandedGroupComponent=t),e.onExpandedChange(i=>{if(i){let i=this.expandedGroupComponent;if(this.expandedGroupComponent=t,null!=i){let t=e.getGui(),s=t.offsetTop-this.groupContainer.parentElement.scrollTop;this.groupComponents.get(i)?.toggleGroupExpand(!1,!0);let r=t.offsetTop-s;r<0&&(r=0),r!==this.groupContainer.parentElement.scrollTop&&(this.groupContainer.parentElement.scrollTop=r)}}else this.expandedGroupComponent=void 0})}destroy(){this.groupComponents.clear(),super.destroy()}},uC=class extends m.Component{constructor(e,t){super(),this.options=e,this.legendGroup=m.RefPlaceholder,this.enabledGroup=m.RefPlaceholder,this.isGradient=["treemap","sunburst","heatmap"].includes(e.seriesType),this.key=this.isGradient?"gradientLegend":"legend",this.chartController=t.chartController}wireBeans(e){this.chartTranslation=e.chartTranslation}postConstruct(){let{chartMenuParamsFactory:e,isExpandedOnInit:t,registerGroupComponent:i}=this.options,s=this.createManagedBean(new m.AgSelect(e.getDefaultSelectParams(`${this.key}.position`,"position",["top","right","bottom","left"].map(e=>({value:e,text:this.chartTranslation.translate(e)})))));this.enabledGroup=this.createManagedBean(new tg(e.addEnableParams(`${this.key}.enabled`,{cssIdentifier:"charts-format-sub-level",direction:"vertical",suppressOpenCloseIcons:!0,title:this.chartTranslation.translate("legendEnabled"),suppressEnabledCheckbox:!0,useToggle:!0,items:[this.createLabelPanel(e),s,...this.getItems(e)]})));let r={cssIdentifier:"charts-format-top-level",direction:"vertical",title:this.chartTranslation.translate("legend"),suppressEnabledCheckbox:!0,expanded:t,items:[this.enabledGroup]};this.setTemplate(`<div>
            <ag-group-component data-ref="legendGroup">
            </ag-group-component>
        </div>`,[tC],{legendGroup:r}),i(this.legendGroup);let a=this.updateLegendEnabledState.bind(this);this.addManagedListeners(this.chartController,{chartModelUpdate:a,chartApiUpdate:a})}updateLegendEnabledState(){let{valueCols:e}=this.chartController.getColStateForMenu();this.enabledGroup.setEnabled(e.filter(e=>e.selected).length>1)}getItems(e){let t=(t,i,s)=>this.createManagedBean(new e8(e.getDefaultSliderParams(`${this.key}.${t}`,i,s)));return this.isGradient?[this.createManagedBean(new m.AgCheckbox(e.addValueParams("gradientLegend.reverseOrder",{label:this.chartTranslation.translate("reverseDirection"),labelWidth:"flex"}))),t("gradient.thickness","thickness",40),t("gradient.preferredLength","preferredLength",300),t("spacing","spacing",200)]:[t("spacing","spacing",200),t("item.marker.size","markerSize",40),t("item.marker.strokeWidth","markerStroke",10),t("item.marker.padding","itemSpacing",20),t("item.paddingX","layoutHorizontalSpacing",50),t("item.paddingY","layoutVerticalSpacing",50)]}createLabelPanel(e){let t=this.isGradient?"gradientLegend.scale.label":"legend.item.label";return this.createManagedBean(new uo({enabled:!0,suppressEnabledCheckbox:!0,chartMenuParamsFactory:e,keyMapper:e=>`${t}.${e}`,cssIdentifier:"charts-format-sub-level-no-header"}))}},uv=class extends m.Component{constructor(e){super(),this.params=e,this.toggleableGroup=m.RefPlaceholder,this.activeComps=[],this.chartOptions=e.chartMenuParamsFactory.getChartOptions()}postConstruct(){let{tag:e,cssIdentifier:t="charts-format-sub-level",title:i,suppressEnabledCheckbox:s}=this.params,r=this.params.chartMenuParamsFactory.addEnableParams(`${e}.enabled`,{cssIdentifier:t,direction:"vertical",suppressOpenCloseIcons:!0,title:i,suppressEnabledCheckbox:!0,useToggle:!s});this.setTemplate(`<div class="ag-toggleable-group-panel">
                <ag-group-component data-ref="toggleableGroup">
                </ag-group-component>
            </div>`,[tC],{toggleableGroup:r}),this.toggleCss("ag-toggleable-group-panel-no-header",!i)}addItem(e,t){t?this.toggleableGroup.prependItem(e):this.toggleableGroup.addItem(e),this.activeComps.push(e)}setEnabled(e){this.toggleableGroup.setEnabled(e)}destroyActiveComps(){for(let e of this.activeComps)(0,m._removeFromParent)(e.getGui()),this.destroyBean(e)}destroy(){this.destroyActiveComps(),super.destroy()}},ub=class extends m.Component{constructor(e){super(),this.chartMenuUtils=e}wireBeans(e){this.chartTranslation=e.chartTranslation}postConstruct(){let e={cssIdentifier:"charts-format-sub-level",direction:"vertical",title:this.chartTranslation.translate("callout"),enabled:!0,suppressOpenCloseIcons:!0,suppressEnabledCheckbox:!0};this.setTemplate(`<div>
            <ag-group-component data-ref="calloutGroup">
                <ag-slider data-ref="calloutLengthSlider"></ag-slider>
                <ag-slider data-ref="calloutStrokeWidthSlider"></ag-slider>
                <ag-slider data-ref="labelOffsetSlider"></ag-slider>
            </ag-group-component>
        </div>`,[tC,e7],{calloutGroup:e,calloutLengthSlider:this.chartMenuUtils.getDefaultSliderParams("calloutLine.length","length",40),calloutStrokeWidthSlider:this.chartMenuUtils.getDefaultSliderParams("calloutLine.strokeWidth","strokeWidth",10),labelOffsetSlider:this.chartMenuUtils.getDefaultSliderParams("calloutLabel.offset","offset",30)})}},uy=class extends m.Component{constructor(e){super(),this.chartMenuUtils=e}wireBeans(e){this.chartTranslation=e.chartTranslation}postConstruct(){let e={cssIdentifier:"charts-format-sub-level",direction:"vertical",title:this.chartTranslation.translate("cap"),enabled:!0,suppressOpenCloseIcons:!0,suppressEnabledCheckbox:!0},t=this.chartMenuUtils.getDefaultSliderParams("cap.lengthRatio","capLengthRatio",1);t.step=.05,this.setTemplate(`<div>
            <ag-group-component data-ref="capsGroup">
                <ag-slider data-ref="capLengthRatioSlider"></ag-slider>
            </ag-group-component>
        </div>`,[tC,e7],{capsGroup:e,capLengthRatioSlider:t})}},uw=class extends m.Component{constructor(e){super(),this.chartMenuUtils=e}wireBeans(e){this.chartTranslation=e.chartTranslation}postConstruct(){let e={cssIdentifier:"charts-format-sub-level",direction:"vertical",title:this.chartTranslation.translate("connectorLine"),enabled:!0,suppressOpenCloseIcons:!0,suppressEnabledCheckbox:!0};this.setTemplate(`<div>
            <ag-group-component data-ref="lineGroup">
                <ag-color-picker data-ref="lineColorPicker"></ag-color-picker>
                <ag-slider data-ref="lineStrokeWidthSlider"></ag-slider>
                <ag-slider data-ref="lineOpacitySlider"></ag-slider>
                <ag-slider data-ref="lineDashSlider"></ag-slider>                
            </ag-group-component>
        </div>`,[tC,hf,e7],{lineGroup:e,lineColorPicker:this.chartMenuUtils.getDefaultColorPickerParams("line.stroke"),lineStrokeWidthSlider:this.getSliderParams("strokeWidth",10,"line.strokeWidth"),lineDashSlider:this.getSliderParams("lineDash",30,"line.lineDash",1,!0),lineOpacitySlider:this.getSliderParams("strokeOpacity",1,"line.strokeOpacity",.05)})}getSliderParams(e,t,i,s=1,r=!1){let a=this.chartMenuUtils.getDefaultSliderParams(i,e,t,r);return a.step=s,a}};function uS(e){return["square","circle","cross","diamond","plus","triangle","heart"].map(t=>({value:t,text:e.translate(t)}))}var ux=class extends m.Component{constructor(e){super(),this.chartMenuUtils=e}wireBeans(e){this.chartTranslation=e.chartTranslation}postConstruct(){let e=this.chartMenuUtils.addEnableParams("marker.enabled",{cssIdentifier:"charts-format-sub-level",direction:"vertical",title:this.chartTranslation.translate("markers"),suppressEnabledCheckbox:!0,useToggle:!0,suppressOpenCloseIcons:!0});this.setTemplate(`<div>
            <ag-group-component data-ref="seriesMarkersGroup">
                <ag-select data-ref="seriesMarkerShapeSelect"></ag-select>
                <ag-slider data-ref="seriesMarkerSizeSlider"></ag-slider>
                <ag-slider data-ref="seriesMarkerStrokeWidthSlider"></ag-slider>
            </ag-group-component>
        </div>`,[tC,m.AgSelectSelector,e7],{seriesMarkersGroup:e,seriesMarkerShapeSelect:this.chartMenuUtils.getDefaultSelectParams("marker.shape","shape",uS(this.chartTranslation)),seriesMarkerSizeSlider:this.chartMenuUtils.getDefaultSliderParams("marker.size","size",60),seriesMarkerStrokeWidthSlider:this.chartMenuUtils.getDefaultSliderParams("marker.strokeWidth","strokeWidth",10)})}},uF=class extends m.Component{constructor(e){super(),this.chartMenuUtils=e,this.seriesItemsGroup=m.RefPlaceholder,this.activePanels=[]}wireBeans(e){this.chartTranslation=e.chartTranslation}postConstruct(){let e={cssIdentifier:"charts-format-sub-level",direction:"vertical",title:this.chartTranslation.translate("seriesItems"),enabled:!0,suppressOpenCloseIcons:!0,suppressEnabledCheckbox:!0};this.setTemplate(`<div>
            <ag-group-component data-ref="seriesItemsGroup">
                <ag-select data-ref="seriesItemSelect"></ag-select>
            </ag-group-component>
        </div>`,[tC,m.AgSelectSelector],{seriesItemsGroup:e,seriesItemSelect:this.getSeriesItemsParams()}),this.initSeriesControls()}getSeriesItemsParams(){let e=[{value:"positive",text:this.chartTranslation.translate("seriesItemPositive")},{value:"negative",text:this.chartTranslation.translate("seriesItemNegative")}],t=e=>{this.destroyActivePanels(),this.initSeriesControls(e)};return this.chartMenuUtils.getDefaultSelectParamsWithoutValueParams("seriesItemType",e,"positive",t)}initSeriesControls(e="positive"){this.initSlider("strokeWidth",10,`item.${e}.strokeWidth`),this.initSlider("lineDash",30,`item.${e}.lineDash`,1,!0),this.initSlider("strokeOpacity",1,`item.${e}.strokeOpacity`,.05,!1),this.initSlider("fillOpacity",1,`item.${e}.fillOpacity`,.05,!1),this.initItemLabels(e)}initSlider(e,t,i,s=1,r=!1){let a=this.chartMenuUtils.getDefaultSliderParams(i,e,t,r);a.step=s;let l=this.seriesItemsGroup.createManagedBean(new e8(a));this.seriesItemsGroup.addItem(l),this.activePanels.push(l)}initItemLabels(e){let t=this.chartMenuUtils.getDefaultFontPanelParams(`item.${e}.label`,"seriesItemLabels"),i=this.createBean(new uo(t));this.seriesItemsGroup.addItem(i),this.activePanels.push(i)}destroyActivePanels(){for(let e of this.activePanels)(0,m._removeFromParent)(e.getGui()),this.destroyBean(e)}destroy(){this.destroyActivePanels(),super.destroy()}},uA=class extends m.Component{constructor(e,t="shadow"){super(),this.chartMenuUtils=e,this.propertyKey=t}wireBeans(e){this.chartTranslation=e.chartTranslation}postConstruct(){let e=this.propertyKey,t=this.chartMenuUtils.addEnableParams(`${e}.enabled`,{cssIdentifier:"charts-format-sub-level",direction:"vertical",suppressOpenCloseIcons:!0,title:this.chartTranslation.translate("shadow"),suppressEnabledCheckbox:!0,useToggle:!0}),i=this.chartMenuUtils.getDefaultColorPickerParams(`${e}.color`);this.setTemplate(`<div>
            <ag-group-component data-ref="shadowGroup">
                <ag-color-picker data-ref="shadowColorPicker"></ag-color-picker>
                <ag-slider data-ref="shadowBlurSlider"></ag-slider>
                <ag-slider data-ref="shadowXOffsetSlider"></ag-slider>
                <ag-slider data-ref="shadowYOffsetSlider"></ag-slider>
            </ag-group-component>
        </div>`,[tC,hf,e7],{shadowGroup:t,shadowColorPicker:i,shadowBlurSlider:this.getSliderParams("blur",0,20),shadowXOffsetSlider:this.getSliderParams("xOffset",-10,10),shadowYOffsetSlider:this.getSliderParams("yOffset",-10,10)})}getSliderParams(e,t,i){let s=`${this.propertyKey}.${e}`,r=this.chartMenuUtils.getDefaultSliderParams(s,e,i);return r.minValue=t,r}},uM=class extends m.Component{constructor(e){super(),this.chartMenuUtils=e}wireBeans(e){this.chartTranslation=e.chartTranslation}postConstruct(){let e={cssIdentifier:"charts-format-sub-level",direction:"vertical",enabled:!0,suppressOpenCloseIcons:!0,suppressEnabledCheckbox:!0};this.setTemplate(`<div>
            <ag-group-component data-ref="groupSpacing">
                <ag-slider data-ref="groupPaddingSlider"></ag-slider>
                <ag-slider data-ref="groupSpacingSlider"></ag-slider>
            </ag-group-component>
            <ag-group-component data-ref="tileSpacing">
                <ag-slider data-ref="tilePaddingSlider"></ag-slider>
                <ag-slider data-ref="tileSpacingSlider"></ag-slider>
            </ag-group-component>
        </div>`,[tC,e7],{groupSpacing:{...e,title:this.chartTranslation.translate("group")},tileSpacing:{...e,title:this.chartTranslation.translate("tile")},groupPaddingSlider:this.getSliderParams("padding","group.padding"),groupSpacingSlider:this.getSliderParams("spacing","group.gap"),tilePaddingSlider:this.getSliderParams("padding","tile.padding"),tileSpacingSlider:this.getSliderParams("spacing","tile.gap")})}getSliderParams(e,t){return this.chartMenuUtils.getDefaultSliderParams(t,e,10)}},uR=class extends m.Component{constructor(e){super(),this.chartMenuUtils=e,this.tooltipMode=m.RefPlaceholder}postConstruct(){let{chartMenuUtils:e,beans:t}=this,i="tooltip",s=t.chartTranslation,r=e.addEnableParams(`${i}.enabled`,{cssIdentifier:"charts-format-sub-level",direction:"vertical",suppressOpenCloseIcons:!0,title:s.translate("tooltips"),suppressEnabledCheckbox:!0,useToggle:!0}),a="tooltipMode",l=["single","shared","compact"].map(e=>({value:e,text:s.translate(`${a}${e[0].toUpperCase()+e.substring(1)}`)})),n=`${i}.mode`,o=e.getDefaultSelectParams(n,a,l);this.setTemplate(`<div>
            <ag-group-component data-ref="tooltipGroup">
                <ag-select data-ref="tooltipMode"></ag-select>
            </ag-group-component>
        </div>`,[tC,m.AgSelectSelector],{tooltipGroup:r,tooltipMode:o}),this.addManagedEventListeners({chartOptionsChanged:()=>{let t=e.getChartOptions().getValue(n);this.tooltipMode.setValue(t,!0)}})}},uT=class extends m.Component{constructor(e){super(),this.chartMenuUtils=e}wireBeans(e){this.chartTranslation=e.chartTranslation}postConstruct(){let e={cssIdentifier:"charts-format-sub-level",direction:"vertical",title:this.chartTranslation.translate("whisker"),enabled:!0,suppressOpenCloseIcons:!0,suppressEnabledCheckbox:!0};this.setTemplate(`<div>
            <ag-group-component data-ref="whiskersGroup">
                <ag-color-picker data-ref="whiskerColorPicker"></ag-color-picker>
                <ag-slider data-ref="whiskerThicknessSlider"></ag-slider>
                <ag-slider data-ref="whiskerOpacitySlider"></ag-slider>
                <ag-slider data-ref="whiskerLineDashSlider"></ag-slider>
                <ag-slider data-ref="whiskerLineDashOffsetSlider"></ag-slider>
            </ag-group-component>
        </div>`,[tC,hf,e7],{whiskersGroup:e,whiskerColorPicker:this.chartMenuUtils.getDefaultColorPickerParams("whisker.stroke"),whiskerThicknessSlider:this.chartMenuUtils.getDefaultSliderParams("whisker.strokeWidth","strokeWidth",10),whiskerOpacitySlider:this.chartMenuUtils.getDefaultSliderParams("whisker.strokeOpacity","strokeOpacity",1),whiskerLineDashSlider:this.chartMenuUtils.getDefaultSliderParams("whisker.lineDash","lineDash",30,!0),whiskerLineDashOffsetSlider:this.chartMenuUtils.getDefaultSliderParams("whisker.lineDashOffset","lineDashOffset",30)})}},uP="tooltips",uI="strokeWidth",uE="lineWidth",uD="lineDash",uk="lineOpacity",uL="fillOpacity",uN="labels",uG="shadow",uO="stageLabels",uB="markers",uV=class extends m.Component{constructor(e){super(),this.options=e,this.seriesGroup=m.RefPlaceholder,this.activePanels=[],this.widgetFuncs={lineWidth:()=>this.initStrokeWidth(uE),[uI]:()=>this.initStrokeWidth("strokeWidth"),lineColor:()=>this.initLineColor(),[uD]:()=>this.initLineDash(),[uk]:()=>this.initOpacity("strokeOpacity"),[uL]:()=>this.initOpacity("fillOpacity"),markers:()=>new ux(this.chartMenuUtils),[uN]:()=>this.initLabels(),sectorLabels:()=>this.initSectorLabels(),[uG]:()=>new uA(this.chartMenuUtils),[uP]:()=>new uR(this.options.chartMenuParamsFactory),bins:()=>this.initBins(),whiskers:()=>new uT(this.chartMenuUtils),caps:()=>new uy(this.chartMenuUtils),connectorLine:()=>new uw(this.chartMenuUtils),seriesItems:()=>new uF(this.chartMenuUtils),tileSpacing:()=>new uM(this.chartMenuUtils),shape:()=>this.initShape(),size:()=>this.initSize("size","size"),minSize:()=>this.initSize("size","minSize"),maxSize:()=>this.initSize("maxSize","maxSize"),dropoff:()=>this.initDropOff(),stageLabels:()=>this.initStageLabels()},this.seriesWidgetMappings={bar:[uP,uI,uD,uk,uL,uN,uG],pie:[uP,uI,uk,uL,uN,"sectorLabels",uG],donut:[uP,uI,uk,uL,uN,"sectorLabels",uG],line:[uP,uE,uD,uk,uB,uN],scatter:[uP,"shape","size",uI,uN],bubble:[uP,"shape","minSize","maxSize",uI,uN],area:[uP,uE,uD,uk,uL,uB,uN,uG],histogram:[uP,"bins",uI,uD,uk,uL,uN,uG],"radial-column":[uP,uI,uD,uk,uL,uN],"radial-bar":[uP,uI,uD,uk,uL,uN],"radar-line":[uP,uI,uD,uk,uB,uN],"radar-area":[uP,uI,uD,uk,uL,uB,uN],nightingale:[uP,uI,uD,uk,uL,uN],"box-plot":[uP,uI,uD,uk,uL,"whiskers","caps"],"range-bar":[uP,uI,uD,uk,uL,uN],"range-area":[uP,uE,uD,uk,uL,uB,uN,uG],treemap:[uP,"tileSpacing"],sunburst:[uP],heatmap:[uP,uN,"lineColor",uE,uk],waterfall:[uP,"connectorLine","seriesItems"],funnel:[uP,uI,uD,uk,uL,uN,"dropoff",uO,uG],"cone-funnel":[uP,uI,uD,uk,uL,uN,uO],pyramid:[uP,uI,uD,uk,uL,uN,uO,uG]},this.seriesType=e.seriesType}wireBeans(e){this.chartTranslation=e.chartTranslation}postConstruct(){let{isExpandedOnInit:e,chartOptionsService:t,chartController:i,registerGroupComponent:s}=this.options,r={cssIdentifier:"charts-format-top-level",direction:"vertical",title:this.translate("series"),expanded:e,suppressEnabledCheckbox:!0};this.setTemplate(`<div>
            <ag-group-component data-ref="seriesGroup">
            </ag-group-component>
        </div>`,[tC],{seriesGroup:r}),s(this.seriesGroup),this.chartMenuUtils=this.createManagedBean(new ut(t.getSeriesOptionsProxy(()=>this.seriesType))),this.addManagedListeners(i,{chartSeriesChartTypeChanged:this.refreshWidgets.bind(this)}),this.refreshWidgets()}refreshWidgets(){let{chartController:e}=this.options;this.destroyActivePanels(),e.getChartProxy().getChart().waitForUpdate().then(()=>{if(this.isAlive())for(let t of(e.isComboChart()&&(this.updateSeriesType(),this.initSeriesSelect()),this.seriesWidgetMappings[this.seriesType]??[])){let e,i=this.widgetFuncs[t]();if(Array.isArray(i)){let t=this.createBean(i[0]);e=t,i[1](t)}else e=this.createBean(i);this.seriesGroup.addItem(e),this.activePanels.push(e)}}).catch(e=>(0,m._error)(105,{e}))}initSeriesSelect(){let e=this.createBean(new m.AgSelect(this.chartMenuUtils.getDefaultSelectParamsWithoutValueParams("seriesType",this.getSeriesSelectOptions(),`${this.seriesType}`,e=>{this.seriesType=e,this.refreshWidgets()})));this.seriesGroup.addItem(e),this.activePanels.push(e)}initLineColor(){return new hm(this.chartMenuUtils.getDefaultColorPickerParams("stroke","strokeColor"))}initStrokeWidth(e,t){return new e8(this.chartMenuUtils.getDefaultSliderParams(t?`${t}.${e}`:"strokeWidth",e,10))}initLineDash(e){return new e8(this.chartMenuUtils.getDefaultSliderParams(e?`${e}.lineDash`:"lineDash","lineDash",30,!0))}initOpacity(e,t){let i=this.chartMenuUtils.getDefaultSliderParams(t?`${t}.${e}`:e,e,1);return i.step=.05,new e8(i)}initDropOff(){return[new uv({tag:"dropOff",cssIdentifier:"charts-format-sub-level",title:this.translate("dropOff"),suppressEnabledCheckbox:!1,chartMenuParamsFactory:this.chartMenuUtils}),e=>{for(let t of[this.initStrokeWidth("strokeWidth","dropOff"),this.initLineDash("dropOff"),this.initOpacity("strokeOpacity","dropOff"),this.initOpacity("fillOpacity","dropOff")]){let i=e.createManagedBean(t);e.addItem(i),this.activePanels.push(i)}}]}initLabels(){let e=dK(this.seriesType);return[new uo(this.chartMenuUtils.getDefaultFontPanelParams(e?"calloutLabel":"label",e?"calloutLabels":"labels")),t=>{if(e){let e=t.createManagedBean(new ub(this.chartMenuUtils));t.addItem(e),this.activePanels.push(e)}if("range-bar"===this.seriesType){let e=[{value:"inside",text:this.translate("inside")},{value:"outside",text:this.translate("outside")}],i=t.createManagedBean(new m.AgSelect(this.chartMenuUtils.getDefaultSelectParams("label.placement","labelPlacement",e)));t.addItem(i),this.activePanels.push(i);let s=t.createManagedBean(new e8(this.chartMenuUtils.getDefaultSliderParams("label.padding","padding",200)));t.addItem(s),this.activePanels.push(s)}}]}initSectorLabels(){return[new uo(this.chartMenuUtils.getDefaultFontPanelParams("sectorLabel","sectorLabels")),e=>{let t=this.chartMenuUtils.getDefaultSliderParams("sectorLabel.positionRatio","positionRatio",1);t.step=.05;let i=e.createManagedBean(new e8(t));e.addItem(i)}]}initStageLabels(){return new uo(this.chartMenuUtils.getDefaultFontPanelParams("stageLabel",uO))}initBins(){let e=this.chartMenuUtils.getDefaultSliderParams("binCount","histogramBinCount",20),t=this.chartMenuUtils.getChartOptions(),i=(t.getValue("bins")??t.getValue("calculatedBins",!0)).length;return e.value=`${i}`,e.maxValue=Math.max(i,20),new e8(e)}initShape(){return new m.AgSelect(this.chartMenuUtils.getDefaultSelectParams("shape","shape",uS(this.chartTranslation)))}initSize(e,t){return new e8(this.chartMenuUtils.getDefaultSliderParams(e,t,60))}getSeriesSelectOptions(){let e=this.getActiveSeriesTypes();return["area","bar","line"].filter(t=>e.includes(t)).map(e=>({value:e,text:this.translate(e)}))}updateSeriesType(){let e=this.getActiveSeriesTypes();!e.includes(this.seriesType)&&e.length>0&&(this.seriesType=e[0])}getActiveSeriesTypes(){return this.options.chartController.getActiveSeriesChartTypes().map(e=>dW(e.chartType))}translate(e){return this.chartTranslation.translate(e)}destroyActivePanels(){for(let e of this.activePanels)(0,m._removeFromParent)(e.getGui()),this.destroyBean(e)}destroy(){this.destroyActivePanels(),super.destroy()}},u_=class extends m.Component{constructor(e,t,i){super("<div></div>"),this.chartMenuUtils=e,this.name=t,this.key=i,this.chartOptions=e.getChartOptions()}wireBeans(e){this.chartTranslation=e.chartTranslation}postConstruct(){this.initFontPanel()}hasTitle(){let e=this.chartOptions.getValue(this.key);return e?.enabled&&e.text&&e.text.length>0}initFontPanel(){let e=this.hasTitle(),t={name:this.chartTranslation.translate(this.name),enabled:e,suppressEnabledCheckbox:!1,chartMenuParamsFactory:this.chartMenuUtils,keyMapper:e=>`${this.key}.${e}`,onEnableChange:e=>this.onEnableChange(e)};this.fontPanel=this.createManagedBean(new uo(t)),this.fontPanel.addItem(this.createBean(new m.AgInputTextField(this.getTextInputParams())),!0),this.fontPanel.addItem(this.createBean(new e8(this.getSpacingSliderParams()))),this.getGui().appendChild(this.fontPanel.getGui())}getTextInputParams(){return this.chartMenuUtils.addValueParams(`${this.key}.text`,{label:this.chartTranslation.translate("title"),labelAlignment:"top"})}getSpacingSliderParams(){return this.chartMenuUtils.getDefaultSliderParams(`${this.key}.spacing`,"spacing",100)}onEnableChange(e){this.chartOptions.setValue(`${this.key}.enabled`,e)}},uz=class extends u_{wireBeans(e){super.wireBeans(e),this.chartMenuSvc=e.chartMenuSvc}postConstruct(){this.titlePlaceholder=this.chartTranslation.translate("titlePlaceholder"),super.postConstruct(),this.addManagedEventListeners({chartTitleEdit:()=>{this.fontPanel.setEnabled(this.hasTitle())}})}getTextInputParams(){let e=super.getTextInputParams();return this.shouldOverrideTextWithPlaceholder(e.value)&&(e.value=this.titlePlaceholder),e}getSpacingSliderParams(){let e=super.getSpacingSliderParams();return e.value="10",e}onEnableChange(e){if(this.chartMenuSvc.doesChartToolbarExist()){let t=this.chartOptions.getValue("padding.top");this.chartOptions.setValue("padding.top",e?t-20:t+20)}this.chartOptions.setValue(`${this.key}.enabled`,e);let t=this.chartOptions.getValue(`${this.key}.text`);e&&this.shouldOverrideTextWithPlaceholder(t)&&this.chartOptions.setValue(`${this.key}.text`,this.titlePlaceholder)}shouldOverrideTextWithPlaceholder(e){return"Title"===e||e?.trim().length===0}},uH=class extends m.Component{constructor(e){super(),this.options=e,this.titleGroup=m.RefPlaceholder}wireBeans(e){this.chartTranslation=e.chartTranslation}postConstruct(){let{chartMenuParamsFactory:e,chartAxisMenuParamsFactory:t,chartOptionsService:i,seriesType:s,isExpandedOnInit:r=!1,registerGroupComponent:a}=this.options,l=[];if(dV(s)&&"pyramid"!==s){let e=e=>this.createManagedBean(new ut(i.getCartesianAxisThemeOverridesProxy(e)));l.push(this.createManagedBean(new u_(e("xAxis"),"horizontalAxisTitle","title"))),l.push(this.createManagedBean(new u_(e("yAxis"),"verticalAxisTitle","title")))}else dz(s)&&l.push(this.createManagedBean(new u_(t,"polarAxisTitle","title")));let n={cssIdentifier:"charts-format-top-level",direction:"vertical",title:this.chartTranslation.translate("chartTitles"),expanded:r,suppressEnabledCheckbox:!0,items:[this.createManagedBean(new uz(e,"chartTitle","title")),this.createManagedBean(new u_(e,"chartSubtitle","subtitle")),...l]};this.setTemplate(`<div>
            <ag-group-component data-ref="titleGroup"></ag-group-component>
        </div>`,[tC],{titleGroup:n}),a(this.titleGroup)}},uU={groups:[{type:"chart"},{type:"titles"},{type:"legend"},{type:"series"},{type:"axis"}]},uW=["axis","horizontalAxis","verticalAxis"],uK=class extends m.Component{constructor(e){super('<div class="ag-chart-format-wrapper"></div>'),this.chartMenuContext=e}postConstruct(){this.groupExpansionFeature=this.createManagedBean(new uf(this.getGui())),this.chartPanelFeature=this.createManagedBean(new hp(this.chartMenuContext.chartController,this.getGui(),"ag-chart-format-section",(e,t)=>this.createPanels(t))),this.chartPanelFeature.refreshPanels()}createPanels(e){let t=!1;this.getFormatPanelDef().groups?.forEach(({type:i,isOpen:s=!1})=>{if(!this.isGroupPanelShownInSeries(i,e))return;s&&(t&&(0,m._warn)(145,{group:i}),t=!0);let r=e=>this.groupExpansionFeature.addGroupComponent(e),a={...this.chartMenuContext,isExpandedOnInit:s,seriesType:e,registerGroupComponent:r};switch(i){case"chart":this.chartPanelFeature.addComponent(new um(a));break;case"titles":this.chartPanelFeature.addComponent(new uH(a));break;case"legend":this.chartPanelFeature.addComponent(new uC(a,this.chartMenuContext));break;case"axis":dz(e)?this.chartPanelFeature.addComponent(new uc(a)):dV(e)&&(this.chartPanelFeature.addComponent(new uu("xAxis",a)),this.chartPanelFeature.addComponent(new uu("yAxis",a)));break;case"horizontalAxis":this.chartPanelFeature.addComponent(new uu("xAxis",a));break;case"verticalAxis":this.chartPanelFeature.addComponent(new uu("yAxis",a));break;case"series":this.chartPanelFeature.addComponent(new uV(a));break;default:(0,m._warn)(147,{group:i})}})}getFormatPanelDef(){return this.gos.get("chartToolPanelsDef")?.formatPanel||uU}isGroupPanelShownInSeries(e,t){let i=["chart","titles","legend","series"].includes(e)||dV(t)&&uW.includes(e)||dz(t)&&"axis"===e,s=d_(t)&&"legend"===e||d_(t)&&uW.includes(e);return i&&!s}},u$=class extends m.Component{constructor(e,t,i){super(),this.agChartsExports=t,this.tooltipName=i,this.size=58,this.padding=5;const{_Scene:s}=t;this.root=new s.Group;const r=new s.Scene({width:this.size,height:this.size});r.canvas.element.classList.add("ag-chart-mini-thumbnail-canvas"),r.setRoot(this.root),r.setContainer(e),this.scene=r}wireBeans(e){this.chartTranslation=e.chartTranslation}postConstruct(){this.scene.canvas.element.title=this.chartTranslation.translate(this.tooltipName);try{this.scene.render()}catch(e){(0,m._error)(108,{e})}}};function uj(e){let{stacked:t,size:i,padding:s,xScalePadding:r,xScaleDomain:a,yScaleDomain:l,agChartsExports:{_Scene:n}}=e,o=new n.CategoryScale;o.domain=a,o.range=[s,i-s],o.paddingInner=r,o.paddingOuter=r;let d=new n.LinearScale;d.domain=l,d.range=[i-s,s];let h=(e,t,i)=>e.map((e,s)=>{let r=i.convert(e),a=new n.Rect;return a.x=t.convert(s),a.y=r,a.width=t.bandwidth,a.height=i.convert(0)-r,a.strokeWidth=0,a.crisp=!0,a});return t?e.data.map(e=>h(e,o,d)):h(e.data,o,d)}function uY(e,t,i,s){let r=[0,t[0].length-1],a=t.reduce((e,t)=>{for(let i of t)i<e[0]&&(e[0]=i),i>e[1]&&(e[1]=i);return e},[1/0,-1/0]);a[0]--,a[a.length-1]++;let l=new e.LinearScale;l.domain=r,l.range=[s,i-s];let n=new e.LinearScale;return n.domain=a,n.range=[i-s,s],{xScale:l,yScale:n}}function uq(e,t,i){return e.map(e=>e.map((e,s)=>[s>0?"lineTo":"moveTo",t.convert(s),i.convert(e)]))}function uZ(e,t){let i=new e.Path;return t.forEach(([e,t,s])=>i.path[e](t,s)),i}function uX(e,t){return e.map(([e,i])=>[e,i,t.convert(0)])}function uJ(e,t){let i=uZ(e,t);return i.fill=void 0,i.lineCap="round",i.strokeWidth=3,i}function uQ({_Scene:e},t,i,s,r){let{xScale:a,yScale:l}=uY(e,i,s,r),n=uq(i,a,l).map(t=>uJ(e,t)),o=new e.Group;return o.setClipRect(new e.BBox(r,r,s-2*r,s-2*r)),o.append(n),t.append(o),n}function u0(e){return e.map((e,t,i)=>e.map((e,s)=>i.slice(0,t+1).reduce((e,t)=>e+t[s],0)))}function u1(e){let t=e.map((t,i)=>e.reduce((e,t)=>Math.max(e,t[i]),0));return e.map(e=>e.map((e,i)=>e/t[i]*19))}function u2(e,t,i,s,r,a,l=0){let{_Scene:n}=e,o=new n.LinearScale;o.domain=[0,7],o.range=[-Math.PI,Math.PI].map(e=>e+Math.PI/2);let d=new n.LinearScale;d.domain=[0,10],d.range=[r,a];let h=[],u=s/2,c=i.map(e=>{let t=new n.Path;return t.strokeWidth=1,t.strokeOpacity=.5,t.lineCap="round",t.fill=void 0,t.fillOpacity=.8,e.forEach((e,i)=>{let s=o.convert(i),c=r+a-d.convert(e),p=c*Math.cos(s)+u,g=c*Math.sin(s)+u;if(t.path[i>0?"lineTo":"moveTo"](p,g),l>0){let e=new n.Marker({shape:"circle"});e.x=p,e.y=g,e.size=l,h.push(e)}}),t.path.closePath(),t}),p=new n.Group;return p.append([...c,...h]),t.append(p),{paths:c,markers:h}}function u5(e){let[t,i]=[1/0,-1/0];return{processedData:e.reduce((e,s,r)=>{let a=r>0?e[r-1]:void 0;e[r]??(e[r]=[]);let l=e[r];return s.forEach((e,s)=>{a&&(e+=a[s]),l[s]=e,l[s]<t&&(t=l[s]),l[s]>i&&(i=l[s])}),e},[]),min:t,max:i}}var u4=[[[13,16],[13,12],[3,12],[3,16]],[[12,11],[12,7],[4,7],[4,11]],[[10.125,6],[10.125,1.5],[5.875,1.5],[5.875,6]]],u3=class extends u${constructor(e,t,i,s,r,a="funnelTooltip",l=u4){super(e,t,a),this.shapes=function({_Scene:e},t,i,s,r){let{xScale:a,yScale:l}=function(e,t,i,s){let r=[],a=[];for(let e of t)for(let[t,i]of e)r.push(t),a.push(i);let l=new e.LinearScale;l.domain=[Math.min(...r),Math.max(...r)],l.range=[s,i-s];let n=new e.LinearScale;return n.domain=[Math.min(...a),Math.max(...a)],n.range=[i-s,s],{xScale:l,yScale:n}}(e,i,s,r),n=i.map(e=>e.map(([e,t],i)=>[i>0?"lineTo":"moveTo",a.convert(e),l.convert(t)])).map(e=>{let t,i,s;return t=e[0],i=e[1],s=(0,m._last)(e),(i[1]!==s[1]||i[2]!==s[2])&&e.push([t[0],i[1],i[2]]),e}).map(t=>uJ(e,t)).reduce((e,t)=>e.concat(t),[]),o=new e.Group;return o.setClipRect(new e.BBox(r,r,s-2*r,s-2*r)),o.append(n),t.append(o),n}(t,this.root,l,this.size,this.padding),this.updateColors(i,s)}updateColors(e,t){for(let i of this.shapes)i.fill=e[0],i.stroke=t[0],i.strokeWidth=0}},u6=[[[13,16],[10.75,11.5],[5.25,11.5],[3,16]],[[10.75,11.5],[8.875,6],[7.125,6],[5.25,11.5]],[[8.875,6],[8.875,1.5],[7.125,1.5],[7.125,6]]],u8=class extends u3{constructor(e,t,i,s,r,a="coneFunnelTooltip"){super(e,t,i,s,r,a,u6)}updateColors(e,t){this.shapes.forEach((i,s)=>{i.fill=e[0],i.fillOpacity=1-.2*s,i.stroke=t[0],i.strokeWidth=0})}},u7=[[[8,16],[10,12],[6,12]],[[10.5,11],[12.5,7],[3.5,7],[5.5,11]],[[13,6],[15.5,1.5],[.5,1.5],[3,6]]],u9=class extends u3{constructor(e,t,i,s,r,a="pyramidTooltip"){super(e,t,i,s,r,a,u7)}updateColors(e,t){this.shapes.forEach((i,s)=>{i.fill=e[s],i.stroke=t[s],i.strokeWidth=0})}},ce=class extends u${constructor(e,t,i){super(e,t,i),this.stroke="gray",this.axisOvershoot=3}postConstruct(){let{_Scene:e}=this.agChartsExports,t=this.size,i=this.padding,s=new e.Line;s.x1=i,s.y1=i,s.x2=i,s.y2=t-i+this.axisOvershoot,s.stroke=this.stroke;let r=new e.Line;r.x1=i-this.axisOvershoot+1,r.y1=t-i,r.x2=t-i+1,r.y2=t-i,r.stroke=this.stroke;let a=this.root;a.append(s),a.append(r),super.postConstruct()}},ct=class extends ce{constructor(e,t,i,s){super(e,t,"groupedColumnTooltip"),this.columnData=[2,3,4];const{root:r,columnData:a,size:l,padding:n}=this;this.columns=uj({stacked:!1,root:r,data:a,size:l,padding:n,xScaleDomain:[0,1,2],yScaleDomain:[0,4],xScalePadding:.3,agChartsExports:t}),r.append(this.columns),this.updateColors(i,s)}updateColors(e,t){this.columns.forEach((i,s)=>{i.fill=e[s],i.stroke=t[s]})}},ci=[[8,12,16],[6,9,12],[2,3,4]],cs=class extends ce{constructor(e,t,i,s,r,a=ci,l=[0,16],n="stackedColumnTooltip"){super(e,t,n);const{root:o,size:d,padding:h}=this;this.stackedColumns=uj({stacked:!0,root:o,data:a,size:d,padding:h,xScaleDomain:[0,1,2],yScaleDomain:l,xScalePadding:.3,agChartsExports:t}),o.append((0,m._flatten)(this.stackedColumns)),this.updateColors(i,s)}updateColors(e,t){this.stackedColumns.forEach((i,s)=>{for(let r of i)r.fill=e[s],r.stroke=t[s]})}},cr=[[10,10,10],[6,7,8],[2,4,6]],ca=class extends cs{constructor(e,t,i,s,r){super(e,t,i,s,r,cr,[0,10],"normalizedColumnTooltip")}},cl=class extends ce{constructor(e,t,i,s){super(e,t,"groupedBarTooltip");const{_Scene:r}=t,a=this.padding,l=this.size,n=new r.CategoryScale;n.domain=[0,1,2],n.range=[a,l-a],n.paddingInner=.3,n.paddingOuter=.3;const o=new r.LinearScale;o.domain=[0,4],o.range=[l-a,a];const d=o.convert(0),h=n.bandwidth;this.bars=[2,3,4].map((e,t)=>{let i=new r.Rect;return i.x=a,i.y=n.convert(t),i.width=d-o.convert(e),i.height=h,i.strokeWidth=0,i.crisp=!0,i}),this.updateColors(i,s),this.root.append(this.bars)}updateColors(e,t){this.bars.forEach((i,s)=>{i.fill=e[s],i.stroke=t[s]})}},cn=[[8,12,16],[6,9,12],[2,3,4]],co=class extends ce{constructor(e,t,i,s,r,a=cn,l=[0,16],n="stackedBarTooltip"){super(e,t,n);const{_Scene:o}=t,d=this.size,h=this.padding,u=new o.CategoryScale;u.domain=[0,1,2],u.range=[h,d-h],u.paddingInner=.3,u.paddingOuter=.3;const c=new o.LinearScale;c.domain=l,c.range=[d-h,h];const p=c.convert(0),g=u.bandwidth;this.bars=a.map(e=>e.map((e,t)=>{let i=new o.Rect;return i.x=h,i.y=u.convert(t),i.width=p-c.convert(e),i.height=g,i.strokeWidth=0,i.crisp=!0,i})),this.updateColors(i,s),this.root.append((0,m._flatten)(this.bars))}updateColors(e,t){this.bars.forEach((i,s)=>i.forEach(i=>{i.fill=e[s],i.stroke=t[s]}))}},cd=[[10,10,10],[6,7,8],[2,4,6]],ch=class extends co{constructor(e,t,i,s,r){super(e,t,i,s,r,cd,[0,10],"normalizedBarTooltip")}},cu=class extends u${constructor(e,t,i,s,r,a=.6,l="donutTooltip"){super(e,t,l);const{size:n,padding:o,agChartsExports:{_Scene:d}}=this,h=(n-2*o)/2,u=h+o,c=d.toRadians,p=[[c(-90),c(30)],[c(30),c(120)],[c(120),c(180)],[c(180),c(210)],[c(210),c(240)],[c(240),c(270)]];this.sectors=p.map(([e,t])=>{let i=new d.Sector;return i.centerX=u,i.centerY=u,i.innerRadius=h*a,i.outerRadius=h,i.startAngle=e,i.endAngle=t,i.stroke=void 0,i.strokeWidth=0,i.inset=.75,i}),this.updateColors(i,s),this.root.append(this.sectors)}updateColors(e,t){this.sectors.forEach((i,s)=>{i.fill=e[s%e.length],i.stroke=t[s%t.length]})}},cc={chartType:"donut",miniChart:cu},cp=class extends cu{constructor(e,t,i,s,r){super(e,t,i,s,r,0,"pieTooltip")}},cg=[[1,3,5],[2,6,4],[5,3,1]],cm=class extends ce{constructor(e,t,i,s,r,a=cg,l="lineTooltip"){super(e,t,l);const{size:n,padding:o,root:d}=this;this.lines=uQ(t,d,a,n,o),this.updateColors(i,s)}updateColors(e,t){this.lines.forEach((t,i)=>{t.stroke=e[i]})}},cf=u0(cg),cC=class extends cm{constructor(e,t,i,s,r,a=cf,l="stackedLineTooltip"){super(e,t,i,s,r,a,l)}},cv=u1(cf),cb=class extends cm{constructor(e,t,i,s,r,a=cv,l="normalizedLineTooltip"){super(e,t,i,s,r,a,l)}},cy=class extends ce{constructor(e,t,i,s){super(e,t,"scatterTooltip");const{size:r,padding:a,agChartsExports:{_Scene:l}}=this,n=new l.LinearScale;n.domain=[-.5,4],n.range=[2*a,r-a];const o=new l.LinearScale;o.domain=[-.5,3.5],o.range=[r-a,a];const d=[];[[[.3,3],[1.1,.9],[2,.4],[3.4,2.4]],[[0,.3],[1,2],[2.4,1.4],[3,0]]].forEach(e=>{e.forEach(([e,t])=>{let i=new l.Arc;i.strokeWidth=0,i.centerX=n.convert(e),i.centerY=o.convert(t),i.radius=2.5,d.push(i)})}),this.points=d,this.updateColors(i,s);const h=new l.Group;h.setClipRect(new l.BBox(a,a,r-2*a,r-2*a)),h.append(this.points),this.root.append(h)}updateColors(e,t){this.points.forEach((i,s)=>{i.stroke=t[s%t.length],i.fill=e[s%e.length]})}},cw=class extends ce{constructor(e,t,i,s){super(e,t,"bubbleTooltip");const{size:r,padding:a,agChartsExports:{_Scene:l}}=this,n=new l.LinearScale;n.domain=[0,1],n.range=[2*a,r-a];const o=new l.LinearScale;o.domain=[0,1],o.range=[r-a,a];const d=[];[[[.1,.3,5],[.5,.4,7],[.2,.8,7]],[[.8,.7,5],[.7,.3,9]]].forEach(e=>{e.forEach(([e,t,i])=>{let s=new l.Arc;s.strokeWidth=0,s.centerX=n.convert(e),s.centerY=o.convert(t),s.radius=i,s.fillOpacity=.7,d.push(s)})}),this.points=d,this.updateColors(i,s);const h=new l.Group;h.setClipRect(new l.BBox(a,a,r-2*a,r-2*a)),h.append(this.points),this.root.append(h)}updateColors(e,t){this.points.forEach((i,s)=>{i.stroke=t[s%t.length],i.fill=e[s%e.length]})}},cS=class extends ce{constructor(e,t,i,s,r,a=cg,l="groupedAreaTooltip",n=!1){super(e,t,l),this.areas=function(e,t,i,s,r,a=!1){var l;let{xScale:n,yScale:o}=uY(e,i,s,r),d=(l=uq(i,n,o),l.map((e,t,i)=>{var s,r,l;let n=[...a?(s=i,r=t,l=o,0===r?uX(s[r],l):[...s[r-1]]):uX(e,o)].reverse().map(([e,t,i])=>["lineTo",t,i]),d=e[0],h=(0,m._last)(n);return(d[1]!==h[1]||d[2]!==h[2])&&n.push(["lineTo",d[1],d[2]]),[...e,...n]})),h=new e.Group;h.setClipRect(new e.BBox(r,r,s-2*r,s-2*r));let u=d.map(t=>uZ(e,t));return h.append(u),t.append(h),u}(t._Scene,this.root,a,this.size,this.padding,n),this.updateColors(i,s)}updateColors(e,t){this.areas.forEach((i,s)=>{i.fill=e[s],i.stroke=t[s],i.strokeWidth=1,i.strokeOpacity=.75,i.fillOpacity=.7})}},cx=u0(cg),cF=class extends cS{constructor(e,t,i,s,r,a=cx,l="stackedAreaTooltip"){super(e,t,i,s,r,a,l,!0)}updateColors(e,t){this.areas.forEach((i,s)=>{i.fill=e[s],i.stroke=t[s]})}},cA=u1(cx),cM=class extends cF{constructor(e,t,i,s,r,a=cA,l="normalizedAreaTooltip"){super(e,t,i,s,r,a,l)}},cR=class extends ce{constructor(e,t,i,s){super(e,t,"histogramTooltip");const{padding:r,size:a,agChartsExports:{_Scene:l}}=this,n=[2,5,11,13,10,6,1],o=new l.LinearScale;o.domain=[0,n.length],o.range=[r,a-r];const d=new l.LinearScale;d.domain=[0,n.reduce((e,t)=>Math.max(e,t),0)],d.range=[a-r,r];const h=d.convert(0);this.bars=n.map((e,t)=>{let i=d.convert(e),s=o.convert(t),r=o.convert(t+1),a=new l.Rect;return a.x=s,a.y=i,a.width=r-s,a.height=h-i,a.strokeWidth=1,a.strokeOpacity=.75,a.crisp=!0,a}),this.updateColors(i,s),this.root.append(this.bars)}updateColors([e],[t]){for(let i of this.bars)i.fill=e,i.stroke=t}},cT=class extends u${constructor(e,t,i){super(e,t,i),this.stroke="gray",this.showRadiusAxisLine=!0,this.showAngleAxisLines=!0}postConstruct(){let{_Scene:e}=this.agChartsExports,t=this.size,i=this.padding,s=(t-2*i)/2,r=this.showAngleAxisLines?[s,.8*s,.6*s,.4*s]:[],a=new e.Line;a.x1=t/2,a.y1=i,a.x2=t/2,a.y2=t-i-s-r[r.length-1],a.stroke=this.stroke,a.strokeOpacity=.5,a.fill=void 0,a.visible=this.showRadiusAxisLine;let l=i+s;this.gridLines=r.map((t,i)=>{let s=new e.Path;return s.path.arc(l,l,t,0,2*Math.PI),s.strokeWidth=1,s.stroke=this.stroke,s.strokeOpacity=0===i?.5:.2,s.fill=void 0,s});let n=this.root;n.append(a),this.gridLines.length>0&&n.append(this.gridLines),super.postConstruct()}},cP=class extends cT{constructor(e,t,i,s){super(e,t,"radialColumnTooltip"),this.data=[[6,8,10,2,6,5],[4,4,3,6,4,4],[5,4,2,9,8,9]],this.showRadiusAxisLine=!1;const{padding:r,size:a,data:l,agChartsExports:{_Scene:n}}=this,o=(a-2*r)/2,d=.4*o,h=new n.CategoryScale;h.domain=l[0].map((e,t)=>t),h.range=[0,2*Math.PI],h.paddingInner=0,h.paddingOuter=0;const u=.7*h.bandwidth,{processedData:c,max:p}=u5(l),g=new n.LinearScale;g.domain=[0,p],g.range=[d,o];const m=this.size/2;this.series=c.map((e,t)=>{let i=0===t?void 0:c[t-1],s=new n.TranslatableGroup({zIndex:1e6}),r=e.map((e,t)=>{let s=i?.[t],r=g.convert(e),a=g.convert(s??0),l=h.convert(t),c=l+u,p=n.getRadialColumnWidth(l,c,o,.5,.5),m=new n.RadialColumnShape;return m.columnWidth=p,m.innerRadius=a,m.outerRadius=r,m.startAngle=l,m.endAngle=c,m.isBeveled=!0,m.axisInnerRadius=d,m.axisOuterRadius=o,m.stroke=void 0,m.strokeWidth=0,m});return s.append(r),s.translationX=m,s.translationY=m,s}),this.root.append(this.series),this.updateColors(i,s)}updateColors(e,t){this.series.forEach((i,s)=>{for(let r of i.children())r.fill=e[s%e.length],r.stroke=t[s%t.length]})}},cI=class extends cT{constructor(e,t,i,s){super(e,t,"radialBarTooltip"),this.data=[[6,8,10],[4,4,3],[5,4,2]],this.showRadiusAxisLine=!1;const{size:r,padding:a,data:l,agChartsExports:{_Scene:n}}=this,o=(r-a)/2,d=new n.CategoryScale;d.domain=l[0].map((e,t)=>t),d.range=[.4*o,o],d.paddingInner=.5,d.paddingOuter=0;const h=d.bandwidth,{processedData:u,max:c}=u5(l),p=new n.LinearScale;p.domain=[0,Math.ceil(1.5*c)];const g=1.5*Math.PI,m=g+2*Math.PI;p.range=[g,m];const f=r/2;this.series=u.map((e,t)=>{let i=t<0?void 0:u[t-1],s=new n.Group({zIndex:1e6}),r=e.map((e,t)=>{let s=i?.[t]??0,r=d.convert(t),a=p.convert(s),l=p.convert(e),o=new n.Sector;return o.centerX=f,o.centerY=f,o.innerRadius=r-h,o.outerRadius=r,o.startAngle=a,o.endAngle=l,o.stroke=void 0,o.strokeWidth=0,o});return s.append(r),s}),this.root.append(this.series),this.updateColors(i,s)}updateColors(e,t){this.series.forEach((i,s)=>{for(let r of i.children())r.fill=e[s%e.length],r.stroke=t[s%t.length]})}},cE=class extends cT{constructor(e,t,i,s){super(e,t,"radarLineTooltip"),this.markerSize=4,this.data=[[8,7,8,7,8,8,7,8],[6,8,5,10,6,7,4,6],[0,3,3,5,4,4,2,0]],this.showRadiusAxisLine=!1;const{size:r,padding:a,root:l,data:n}=this,{paths:o,markers:d}=u2(t,l,n,r,(r-2*a)/2,0,this.markerSize);this.lines=o,this.markers=d,this.updateColors(i,s)}updateColors(e,t){this.lines.forEach((i,s)=>{let r=this.data[s].length;i.stroke=e[s];let a=s*r;for(let i of this.markers.slice(a,a+r))i.stroke=t[s],i.fill=e[s]})}},cD=class extends cT{constructor(e,t,i,s){super(e,t,"radarAreaTooltip"),this.data=[[8,10,5,7,4,1,5,8],[1,1,2,7,7,8,10,1],[4,5,9,9,4,2,3,4]];const{size:r,padding:a,root:l,data:n}=this;this.showRadiusAxisLine=!1;const o=(r-2*a)/2;this.areas=u2(t,l,n,r,o,o-.3*r).paths,this.updateColors(i,s)}updateColors(e,t){this.areas.forEach((i,s)=>{i.fill=e[s],i.stroke=t[s]})}},ck=class extends cT{constructor(e,t,i,s){super(e,t,"nightingaleTooltip"),this.data=[[6,10,9,8,7,8],[4,6,5,4,5,5],[3,5,4,3,4,7]],this.showRadiusAxisLine=!1;const{size:r,padding:a,data:l,agChartsExports:{_Scene:n}}=this,o=new n.CategoryScale;o.domain=l[0].map((e,t)=>t),o.range=[-Math.PI,Math.PI],o.paddingInner=0,o.paddingOuter=0;const d=.7*o.bandwidth,{processedData:h,max:u}=u5(l),c=new n.LinearScale;c.domain=[0,u],c.range=[0,(r-2*a)/2];const p=r/2;this.series=h.map((e,t)=>{let i=t<0?void 0:h[t-1],s=new n.Group({zIndex:1e6}),r=e.map((e,t)=>{let s=i?.[t],r=c.convert(e),a=c.convert(s??0),l=o.convert(t),h=l+d,u=new n.Sector;return u.centerX=p,u.centerY=p,u.innerRadius=a,u.outerRadius=r,u.startAngle=l,u.endAngle=h,u.stroke=void 0,u.strokeWidth=0,u});return s.append(r),s}),this.root.append(this.series),this.updateColors(i,s)}updateColors(e,t){this.series.forEach((i,s)=>{for(let r of i.children())r.fill=e[s%e.length],r.stroke=t[s%t.length]})}},cL=class extends ce{constructor(e,t,i,s){super(e,t,"rangeBarTooltip"),this.bars=this.createRangeBar(this.root,[3,3.5,3],this.size,this.padding,"vertical"),this.updateColors(i,s)}updateColors(e,t){this.bars.forEach((i,s)=>{i.fill=e[s],i.stroke=t[s]})}createRangeBar(e,t,i,s,r){let a="horizontal"===r,l=2*s,{_Scene:n}=this.agChartsExports,o=new n.CategoryScale;o.domain=t.map((e,t)=>t),o.range=[s,i-s],o.paddingInner=.3,o.paddingOuter=.3;let d=new n.LinearScale;d.domain=[.7*t.reduce((e,t)=>Math.min(e,t),1/0),1.3*t.reduce((e,t)=>Math.max(e,t),0)],d.range=[l,i-l];let h=o.bandwidth,u=t.map((e,t)=>{let[i,s]=[.7*e,1.3*e],r=o.convert(t),l=d.convert(i),u=d.convert(s)-l,c=new n.Rect;return c.x=a?l:r,c.y=a?r:l,c.width=a?u:h,c.height=a?h:u,c.strokeWidth=0,c.crisp=!0,c});return e.append(u),u}},cN=class extends ce{constructor(e,t,i,s){super(e,t,"rangeAreaTooltip");const r=[cG({offset:1.5,length:4,pattern:{low:3,high:5,period:4}}),cG({offset:1.5,length:4,pattern:{low:2.25,high:4.25,period:4}}),cG({offset:3,length:4,pattern:{low:2.5,high:4.5,period:4}})].map(e=>e.map(([e,t])=>({x:e,low:t-.875,high:t+.875}))),{lines:a,areas:l}=this.createRangeArea(this.root,r,this.size,this.padding);this.lines=a,this.areas=l,this.updateColors(i,s)}updateColors(e,t){e=cB(e,1,2),t=cB(t,1,2),this.lines.forEach(([e,i],s)=>{e.fill=void 0,e.stroke=t[s],i.fill=void 0,i.stroke=t[s]}),this.areas.forEach((t,i)=>{t.fill=e[i]})}createRangeArea(e,t,i,s){let r=t.reduce((e,t)=>t.reduce((e,{x:t})=>Math.min(e,t),e),1/0),a=t.reduce((e,t)=>t.reduce((e,{x:t})=>Math.max(e,t),e),-1/0),l=t.reduce((e,t)=>t.reduce((e,{low:t})=>Math.min(e,t),e),1/0),n=t.reduce((e,t)=>t.reduce((e,{high:t})=>Math.max(e,t),e),-1/0),{_Scene:o}=this.agChartsExports,d=new o.LinearScale;d.domain=[r,a],d.range=[s,i-s];let h=2*s,u=new o.LinearScale;u.domain=[l,n],u.range=[i-h,h];let c=[],p=[];return t.map(e=>{let t=new o.Path,i=new o.Path,s=new o.Path;return c.push([t,i]),p.push(s),t.strokeWidth=0,i.strokeWidth=0,s.strokeWidth=0,s.fillOpacity=.8,t.path.clear(),i.path.clear(),s.path.clear(),e.map((e,r)=>{let{x:a,low:l,high:n}=e,o=d.convert(a),h=u.convert(l),c=u.convert(n),p=r>0?"lineTo":"moveTo";return t.path[p](o,c),i.path[p](o,h),s.path[p](o,c),[o,h]})}).forEach((e,t)=>{let i=e.length-1,s=p[t];for(let t=i;t>=0;t--){let[i,r]=e[t];s.path.lineTo(i,r)}}),e.append(p.concat(...c)),{lines:c,areas:p}}};function cG(e){var t;let{offset:i,length:s,pattern:r}=e,a=function(e,t,i){let{period:s}=i,r=e/s,a=[0,.5].map(e=>e-r).map(cO).sort((e,t)=>e-t);return Array.from({length:Math.floor(a.length*(s/t))},(e,t)=>a[t%a.length]+Math.floor(t/a.length)).map(e=>e*s).map(t=>{var s;return[s=t,l(e+s,i)]})}(i,s,r);return(0===a.length||0!==a[0][0])&&a.unshift([0,l(i+0,r)]),a[a.length-1][0]!==s&&a.push([t=s,l(i+t,r)]),a;function l(e,t){let{low:i,high:s,period:r}=t,a=cO(e/r);return i+(s-i)*(a>.5?1-2*(a-.5):2*a)}}function cO(e){let t=e%1;return t<0?t+1:t}function cB(e,t,i){let s=[...e],r=s[t];return s[t]=s[i],s[i]=r,s}var cV={columnGroup:{column:{range:!0,pivot:!0,enterprise:!1,icon:{chartType:"groupedColumn",miniChart:ct}},stackedColumn:{range:!0,pivot:!0,enterprise:!1,icon:{chartType:"stackedColumn",miniChart:cs}},normalizedColumn:{range:!0,pivot:!0,enterprise:!1,icon:{chartType:"normalizedColumn",miniChart:ca}}},barGroup:{bar:{range:!0,pivot:!0,enterprise:!1,icon:{chartType:"groupedBar",miniChart:cl}},stackedBar:{range:!0,pivot:!0,enterprise:!1,icon:{chartType:"stackedBar",miniChart:co}},normalizedBar:{range:!0,pivot:!0,enterprise:!1,icon:{chartType:"normalizedBar",miniChart:ch}}},pieGroup:{pie:{range:!0,pivot:!0,enterprise:!1,icon:{chartType:"pie",miniChart:cp}},donut:{range:!0,pivot:!0,enterprise:!1,icon:cc},doughnut:{range:!0,pivot:!0,enterprise:!1,icon:cc}},lineGroup:{line:{range:!0,pivot:!0,enterprise:!1,icon:{chartType:"line",miniChart:cm}},stackedLine:{range:!0,pivot:!0,enterprise:!1,icon:{chartType:"stackedLine",miniChart:cC}},normalizedLine:{range:!0,pivot:!0,enterprise:!1,icon:{chartType:"normalizedLine",miniChart:cb}}},scatterGroup:{scatter:{range:!0,pivot:!0,enterprise:!1,icon:{chartType:"scatter",miniChart:cy}},bubble:{range:!0,pivot:!0,enterprise:!1,icon:{chartType:"bubble",miniChart:cw}}},areaGroup:{area:{range:!0,pivot:!0,enterprise:!1,icon:{chartType:"area",miniChart:cS}},stackedArea:{range:!0,pivot:!0,enterprise:!1,icon:{chartType:"stackedArea",miniChart:cF}},normalizedArea:{range:!0,pivot:!0,enterprise:!1,icon:{chartType:"normalizedArea",miniChart:cM}}},polarGroup:{radarLine:{range:!0,pivot:!1,enterprise:!0,icon:{chartType:"radarLine",miniChart:cE}},radarArea:{range:!0,pivot:!1,enterprise:!0,icon:{chartType:"radarArea",miniChart:cD}},nightingale:{range:!0,pivot:!1,enterprise:!0,icon:{chartType:"nightingale",miniChart:ck}},radialColumn:{range:!0,pivot:!1,enterprise:!0,icon:{chartType:"radialColumn",miniChart:cP}},radialBar:{range:!0,pivot:!1,enterprise:!0,icon:{chartType:"radialBar",miniChart:cI}}},statisticalGroup:{boxPlot:{range:!0,pivot:!1,enterprise:!0,icon:{chartType:"boxPlot",miniChart:class extends ce{constructor(e,t,i,s,r){super(e,t,"boxPlotTooltip");const{size:a,padding:l,agChartsExports:{_Scene:n}}=this,o=[11,11.5,10.5],d=new n.LinearScale;d.domain=[.8*o.reduce((e,t)=>Math.min(e,t),1/0),1.2*o.reduce((e,t)=>Math.max(e,t),0)],d.range=[a-1.5*l,l];const h=new n.CategoryScale;h.domain=o.map((e,t)=>t),h.range=[l,a-l],h.paddingInner=.4,h.paddingOuter=.2;const u=Math.round(h.bandwidth),c=Math.round(h.bandwidth/2);this.boxPlotGroups=o.map((e,t)=>{let[i,s,r,a]=[.8*e,.9*e,1.1*e,1.2*e],l=Math.round(d.convert(r)),o=Math.round(h.convert(t)),p=Math.round(o+u),g=Math.round(d.convert(s)),m=Math.round(d.convert(i)),f=Math.round(d.convert(e)),C=Math.round(d.convert(a)),v=o+c,b=new n.Group,y=new n.Rect,w=new n.Line,S=new n.Line,x=new n.Line,F=new n.Line,A=new n.Line;return y.x=o,y.y=l,y.width=u,y.height=g-l,y.strokeWidth=1,y.strokeOpacity=.75,y.crisp=!0,this.setLineProperties(w,o,p,f,f),this.setLineProperties(S,v,v,C,l),this.setLineProperties(x,v,v,m,g),this.setLineProperties(F,o,p,C,C),this.setLineProperties(A,o,p,m,m),b.append([y,w,S,x,F,A]),b}),this.updateColors(i,s,r),this.root.append(this.boxPlotGroups)}updateColors(e,t,i){let{_Theme:s}=this.agChartsExports;this.boxPlotGroups.forEach((r,a)=>{for(let l of r.children()){let r=e[a%e.length];l.fill=i?r:s.resolveOperation({$mix:[r,{$ref:"backgroundColor"},.7]}),l.stroke=t[a%t.length]}})}setLineProperties(e,t,i,s,r){e.x1=t,e.x2=i,e.y1=s,e.y2=r,e.strokeOpacity=.75}}}},histogram:{range:!0,pivot:!1,enterprise:!1,icon:{chartType:"histogram",miniChart:cR}},rangeBar:{range:!0,pivot:!1,enterprise:!0,icon:{chartType:"rangeBar",miniChart:cL}},rangeArea:{range:!0,pivot:!1,enterprise:!0,icon:{chartType:"rangeArea",miniChart:cN}}},hierarchicalGroup:{treemap:{range:!0,pivot:!0,enterprise:!0,icon:{chartType:"treemap",miniChart:class extends u${constructor(e,t,i,s,r){super(e,t,"treemapTooltip");const{size:a,padding:l,agChartsExports:{_Scene:n}}=this,o=[[1,1],[3,2,1]],d=o.length%2==0?.3:.2,h=[l,a-l],u=o.length,c=u*(u+1)/2,p=d/(u-1),g=h[1]-h[0],m=g-d;let f=h[0];this.rects=o.reduce((e,t,i)=>{e??(e=[]);let s=(u-i)/c*m,r=t.length,a=t.reduce((e,t)=>e+t,0),l=d/(r-1||1),o=r>1?g-d:g,C=h[0],v=t.map(e=>{let t=new n.Rect,i=o*e/a;return t.x=f,t.y=C,t.width=s,t.height=i,t.strokeWidth=.75,t.crisp=!0,C+=i+l,t});return f+=s+p,e.push(...v),e},[]),this.updateColors(i,s,r);const C=new n.Group;C.setClipRect(new n.BBox(l,l,a-l,a-l)),C.append(this.rects),this.root.append(C)}updateColors(e,t,i){let{_Theme:s}=this.agChartsExports;this.rects.forEach((r,a)=>{r.fill=e[a%t.length],r.stroke=i?t[a%t.length]:s.resolveOperation({$ref:"backgroundColor"})})}}}},sunburst:{range:!0,pivot:!0,enterprise:!0,icon:{chartType:"sunburst",miniChart:class extends cT{constructor(e,t,i,s){super(e,t,"sunburstTooltip"),this.data=[[[],[]],[[],[]],[[],[]]],this.angleOffset=-Math.PI/2,this.innerRadiusRatio=0,this.showRadiusAxisLine=!1,this.showAngleAxisLines=!1;const{data:r,size:a,padding:l,angleOffset:n,innerRadiusRatio:o,agChartsExports:{_Scene:d}}=this,h=(a-2*l)/2,u=[n+0,n+2*Math.PI],c=Math.abs(u[1]-u[0]),p=[h*o,h],g=Math.abs(p[1]-p[0]);let m=0;const f=(e,t)=>{for(let i of e){let e=t+1;m=Math.max(m,e),f(i,e)}};f(r,0);const C=g/m,v=this.size/2,b=u[0];this.series=[];const y=(e,t,i,s,r)=>{if(!Array.isArray(e))return;let a=t+1,l=i;e.forEach((e,i,n)=>{let o=r;o||(o=new d.Group,this.series.push(o));let h=p[0]+t*C,u=p[0]+a*C,c=1/n.length,g=l,m=g+s*c,f=new d.Sector;f.centerX=v,f.centerY=v,f.innerRadius=h,f.outerRadius=u,f.startAngle=g,f.endAngle=m,f.stroke=void 0,f.strokeWidth=0,f.inset=.75,l=m,o.append(f),y(e,a,g,Math.abs(m-g),o)})};y(r,0,b,c),this.root.append(this.series),this.updateColors(i,s)}updateColors(e,t){this.series.forEach((i,s)=>{for(let r of i.children())r.fill=e[s%e.length],r.stroke=t[s%t.length]})}}}}},specializedGroup:{heatmap:{range:!0,pivot:!1,enterprise:!0,icon:{chartType:"heatmap",miniChart:class extends u${constructor(e,t,i,s,r){super(e,t,"heatmapTooltip");const{size:a,padding:l,agChartsExports:{_Scene:n}}=this,o=Array.from({length:3},(e,t)=>Array.from({length:3},(e,t)=>t)),d=o.map((e,t)=>t),h=new n.CategoryScale;h.domain=d,h.range=[l,a-l],h.paddingInner=.01,h.paddingOuter=.1;const u=new n.CategoryScale;u.domain=d,u.range=[l,a-l],u.paddingInner=.01,u.paddingOuter=.1;const c=h.bandwidth??0,p=u.bandwidth??0;this.rects=o.reduce((e,t,i)=>{e??(e=[]);let s=t.map((e,t)=>{let s=new n.Rect;return s.x=h.convert(i),s.y=u.convert(t),s.width=c,s.height=p,s.strokeWidth=0,s.crisp=!0,s});return e.push(...s),e},[]),this.updateColors(i,s,r);const g=new n.Group;g.setClipRect(new n.BBox(l,l,a-l,a-l)),g.append(this.rects),this.root.append(g)}updateColors(e,t,i){let{_Theme:s,_Util:r}=this.agChartsExports,a=i?[e[0],e[1]]:s.resolveOperation({$palette:"divergingColors"}),l=i?t[0]:s.resolveOperation({$ref:"backgroundColor"}),n=r.interpolateColor(a[0],a[1]);this.rects.forEach((e,t)=>{e.fill=n(.2*t),e.stroke=l})}}}},waterfall:{range:!0,pivot:!1,enterprise:!0,icon:{chartType:"waterfall",miniChart:class extends ce{constructor(e,t,i,s,r){super(e,t,"waterfallTooltip"),this.data=[4,3,-3,6,-3],this.bars=this.createWaterfall(this.root,this.data,this.size,this.padding,"vertical").bars,this.updateColors(i,s,r)}updateColors(e,t,i){let{data:s,agChartsExports:{_Theme:r}}=this,a={fill:i?e[0]:r.resolveOperation({$palette:"altUp.fill"}),stroke:i?t[0]:r.resolveOperation({$palette:"altUp.stroke"})},l={fill:i?e[1]:r.resolveOperation({$palette:"altDown.fill"}),stroke:i?t[1]:r.resolveOperation({$palette:"altDown.stroke"})};this.bars.forEach((e,t)=>{let i=s[t]>=0;e.fill=i?a.fill:l.fill,e.stroke=i?a.stroke:l.stroke})}createWaterfall(e,t,i,s,r){let a=2*s,{processedData:l,min:n,max:o}=u5(t.map(e=>[e])),d=l.reduce((e,t)=>e.concat(t),[]),{_Scene:h}=this.agChartsExports,u=new h.LinearScale;u.domain=[Math.min(n,0),o],u.range=[i-a,a];let c=new h.CategoryScale;c.domain=t.map((e,t)=>t),c.range=[s,i-s],c.paddingInner=.2,c.paddingOuter=.3;let p=c.bandwidth,g=new h.Path;g.stroke="#575757",g.strokeWidth=0;let m=Math.floor(g.strokeWidth)%2/2,f=g.path;f.clear();let C="horizontal"===r,v=d.map((e,i)=>{let s=i>0?d[i-1]:0,r=t[i]>0,a=Math.round(u.convert(e)),l=Math.round(u.convert(s)),n=(r?a:l)-m,o=Math.abs((r?l:a)+m-n),g=c.convert(i),v=new h.Rect;v.x=C?n:g,v.y=C?g:n,v.width=C?o:p,v.height=C?p:o,v.strokeWidth=0,v.crisp=!0;let b=a+m,y=l+m;if(i>0){let e=C?y:v.x,t=C?v.y:y;f.lineTo(e,t)}let w=C?b:v.x,S=C?v.y:b;return f.moveTo(w,S),v});return e.append([g,...v]),{bars:v}}}}}},combinationGroup:{columnLineCombo:{range:!0,pivot:!0,enterprise:!1,icon:{chartType:"columnLineCombo",miniChart:class extends ce{constructor(e,t,i,s){super(e,t,"columnLineComboTooltip"),this.columnData=[3,4],this.lineData=[[5,4,6,5,4]];const{root:r,columnData:a,lineData:l,size:n,padding:o}=this;this.columns=uj({stacked:!1,root:r,data:a,size:n,padding:o,xScaleDomain:[0,1],yScaleDomain:[0,4],xScalePadding:.5,agChartsExports:t}),r.append(this.columns),this.lines=uQ(t,r,l,n,o),this.updateColors(i,s)}updateColors(e,t){this.columns.forEach((i,s)=>{i.fill=e[s],i.stroke=t[s]}),this.lines.forEach((t,i)=>{t.stroke=e[i+2]})}}}},areaColumnCombo:{range:!0,pivot:!0,enterprise:!1,icon:{chartType:"areaColumnCombo",miniChart:class extends ce{constructor(e,t,i,s){super(e,t,"areaColumnComboTooltip"),this.columnData=[3,4.5],this.areaData=[[5,4,6,5,4]];const{root:r,columnData:a,areaData:l,size:n,padding:o,agChartsExports:{_Scene:d}}=this;this.columns=uj({stacked:!1,root:r,data:a,size:n,padding:o,xScaleDomain:[0,1],yScaleDomain:[0,6],xScalePadding:.5,agChartsExports:t});const h=new d.CategoryScale;h.range=[o,n-o],h.domain=[0,1,2,3,4],h.paddingInner=1,h.paddingOuter=0;const u=new d.LinearScale;u.range=[n-o,o],u.domain=[0,6];const c=[],p=u.convert(0),g=h.convert(0);l.forEach((e,t)=>{let i=c[t]||(c[t]=[]);e.forEach((e,t)=>{let s=h.convert(t),r=u.convert(e);i[t]={x:s,y:r}});let s=h.convert(e.length-1);c[t].push({x:s,y:p},{x:g,y:p})}),this.areas=c.map(e=>{let t=new d.Path;t.strokeWidth=0,t.fillOpacity=.8;let i=t.path;return e.forEach((e,t)=>i[t>0?"lineTo":"moveTo"](e.x,e.y)),t});const m=new d.Group;m.setClipRect(new d.BBox(o,o,n-2*o,n-2*o));const f=new d.Group;f.setClipRect(new d.BBox(o,o,n-2*o,n-2*o)),m.append(this.areas),f.append(this.columns),r.append(m),r.append(f),this.updateColors(i,s)}updateColors(e,t){this.areas.forEach((i,s)=>{i.fill=e[s],i.stroke=t[s]}),this.columns.forEach((i,s)=>{i.fill=e[s+1],i.stroke=t[s+1]})}}}},customCombo:{range:!0,pivot:!0,enterprise:!1,icon:{chartType:"customCombo",miniChart:class extends u${constructor(e,t,i,s){super(e,t,"customComboTooltip"),this.columnData=[3,4],this.lineData=[[5,4,6,5,4]];const{root:r,columnData:a,lineData:l,size:n,padding:o,agChartsExports:{_Scene:d}}=this;this.columns=uj({stacked:!1,root:r,data:a,size:n,padding:o,xScaleDomain:[0,1],yScaleDomain:[0,4],xScalePadding:.5,agChartsExports:t}),r.append(this.columns),this.lines=uQ(this.agChartsExports,r,l,n,o);const h="grey",u=new d.Line;u.x1=o,u.y1=o,u.x2=o,u.y2=n-o+3,u.stroke=h;const c=new d.Line;c.x1=o-3+1,c.y1=n-o,c.x2=n-o+1,c.y2=n-o,c.stroke=h;const p=new d.Path;this.buildPenIconPath(p),p.fill="whitesmoke",p.stroke="darkslategrey",p.strokeWidth=1,r.append([c,u,p]),this.updateColors(i,s)}updateColors(e,t){this.columns.forEach((i,s)=>{i.fill=e[s],i.stroke=t[s]}),this.lines.forEach((t,i)=>{t.stroke=e[i+2]})}buildPenIconPath(e){let{path:t}=e;t.moveTo(25.76,43.46),t.lineTo(31.27,48.53),t.moveTo(49.86,22),t.lineTo(49.86,22),t.cubicCurveTo(49.01994659053345,21.317514933510974,47.89593834348529,21.09645997825817,46.86,21.41),t.lineTo(46.86,21.41),t.cubicCurveTo(45.55460035985361,21.77260167850787,44.38777081121966,22.517979360321792,43.51,23.55),t.lineTo(25.51,43.8),t.lineTo(25.43,43.89),t.lineTo(23.01,51.89),t.lineTo(22.83,52.46),t.lineTo(31.02,48.86),t.lineTo(49.02,28.52),t.lineTo(49.02,28.52),t.cubicCurveTo(49.940716461596224,27.521914221246085,50.54302631059587,26.2720342455763,50.75,24.93),t.lineTo(50.75,24.93),t.cubicCurveTo(50.95363374988308,23.866379846512814,50.62080640232334,22.77066734274871,49.86,22),t.closePath(),t.moveTo(41.76,25.5),t.lineTo(47.34,30.5),t.moveTo(40.74,26.65),t.lineTo(46.25,31.71)}}}}},funnelGroup:{funnel:{range:!0,pivot:!1,enterprise:!0,icon:{chartType:"funnel",miniChart:u3}},coneFunnel:{range:!0,pivot:!1,enterprise:!0,icon:{chartType:"coneFunnel",miniChart:u8}},pyramid:{range:!0,pivot:!1,enterprise:!0,icon:{chartType:"pyramid",miniChart:u9}}}},c_={columnGroup:["column","stackedColumn","normalizedColumn"],barGroup:["bar","stackedBar","normalizedBar"],pieGroup:["pie","donut"],lineGroup:["line","stackedLine","normalizedLine"],areaGroup:["area","stackedArea","normalizedArea"],scatterGroup:["scatter","bubble"],polarGroup:["radarLine","radarArea","nightingale","radialColumn","radialBar"],statisticalGroup:["boxPlot","histogram","rangeBar","rangeArea"],hierarchicalGroup:["treemap","sunburst"],specializedGroup:["heatmap","waterfall"],funnelGroup:["funnel","coneFunnel","pyramid"],combinationGroup:["columnLineCombo","areaColumnCombo","customCombo"]},cz=class extends m.Component{constructor(e,t,i,s,r=c_){super('<div class="ag-chart-settings-mini-wrapper"></div>'),this.wrappers=new Map,this.chartController=e,this.fills=t,this.strokes=i,this.isCustomTheme=s,this.chartGroups={...r}}wireBeans(e){this.chartTranslation=e.chartTranslation}postConstruct(){!this.chartController.customComboExists()&&this.chartGroups.combinationGroup&&(this.chartGroups.combinationGroup=this.chartGroups.combinationGroup.filter(e=>"customCombo"!==e));let e=this.getGui(),t=this.chartController.isEnterprise(),i=this.chartController.isPivotChart(),s=!i;for(let{label:r,items:a}of Object.keys(this.chartGroups).map(e=>{let r=e in cV?cV[e]:void 0;if(!r)return(0,m._warn)(148,{group:e}),null;let a=(this.chartGroups[e]??[]).map(a=>{let l=a in r?r[a]:void 0;return l?!t&&l.enterprise?null:s&&l.range||i&&l.pivot?l:null:((0,m._warn)(149,{group:e,chartType:a}),null)}).filter(e=>null!=e);return 0===a.length?null:{label:this.chartTranslation.translate(e),items:a}}).filter(e=>null!=e)){let t=this.createBean(new tg({title:r,suppressEnabledCheckbox:!0,enabled:!0,suppressOpenCloseIcons:!0,cssIdentifier:"charts-settings",direction:"horizontal",suppressKeyboardNavigation:!0}));for(let e of a){let{miniChart:i,chartType:s}=e.icon,r=document.createElement("div");r.classList.add("ag-chart-mini-thumbnail"),r.setAttribute("tabindex","0"),r.setAttribute("role","button");let a=()=>{this.chartController.setChartType(s),this.updateSelectedMiniChart()};this.addManagedListeners(r,{click:a,keydown:e=>{(e.key==m.KeyCode.ENTER||e.key===m.KeyCode.SPACE)&&(e.preventDefault(),a())}}),this.wrappers.set(s,r),this.createBean(new i(r,this.beans.agChartsExports,this.fills,this.strokes,this.isCustomTheme)),t.addItem(r)}e.appendChild(t.getGui())}this.updateSelectedMiniChart()}updateSelectedMiniChart(){let e=this.chartController.getChartType();this.wrappers.forEach((t,i)=>{let s=i===e;t.classList.toggle("ag-selected",s);let r=this.chartTranslation.translate(dq(i)),a=s?`${r}. ${this.chartTranslation.translate("ariaChartSelected")}`:r;(0,m._setAriaLabel)(t,a)})}destroy(){this.wrappers.clear(),super.destroy()}},cH=class extends m.Component{constructor(e){super(`<div class="ag-chart-settings-wrapper">
            <div data-ref="eMiniChartsContainer" class="ag-chart-settings-mini-charts-container ag-scrollable-container"></div>
            <div data-ref="eNavBar" class="ag-chart-settings-nav-bar">
                <div data-ref="ePrevBtn" class="ag-chart-settings-prev">
                    <button type="button" class="ag-button ag-chart-settings-prev-button"></button>
                </div>
                <div data-ref="eCardSelector" class="ag-chart-settings-card-selector"></div>
                <div data-ref="eNextBtn" class="ag-chart-settings-next">
                    <button type="button" class="ag-button ag-chart-settings-next-button"></button>
                </div>
            </div>
        </div>`),this.chartController=e,this.eMiniChartsContainer=m.RefPlaceholder,this.eNavBar=m.RefPlaceholder,this.eCardSelector=m.RefPlaceholder,this.ePrevBtn=m.RefPlaceholder,this.eNextBtn=m.RefPlaceholder,this.miniChartsContainers=[],this.cardItems=[],this.activePaletteIndex=0,this.palettes=[],this.themes=[]}postConstruct(){this.resetPalettes();let e=this.gos.get("enableRtl");this.ePrevBtn.insertAdjacentElement("afterbegin",(0,m._createIconNoSpan)(e?"chartsThemeNext":"chartsThemePrevious",this.beans)),this.eNextBtn.insertAdjacentElement("afterbegin",(0,m._createIconNoSpan)(e?"chartsThemePrevious":"chartsThemeNext",this.beans)),this.addManagedElementListeners(this.ePrevBtn,{click:()=>this.setActivePalette(this.getPrev(),"left")}),this.addManagedElementListeners(this.eNextBtn,{click:()=>this.setActivePalette(this.getNext(),"right")});let t=()=>this.resetPalettes(!0);this.addManagedListeners(this.chartController,{chartTypeChanged:t,chartApiUpdate:t}),this.scrollSelectedIntoView()}scrollSelectedIntoView(){setTimeout(()=>{let e=this.miniChartsContainers.find(e=>!e.getGui().classList.contains("ag-hidden")).getGui().querySelector(".ag-selected");if(e){let t=e.offsetParent;t&&this.eMiniChartsContainer.scrollTo(0,t.offsetTop)}},250)}resetPalettes(e){let t=this.chartController.getPalettes(),i=this.gos.get("chartToolPanelsDef")?.settingsPanel?.chartGroupsDef;if((0,m._areEqual)(t,this.palettes)&&!e||this.isAnimating)return;this.palettes=t,this.themes=this.chartController.getThemeNames(),this.activePaletteIndex=this.themes.findIndex(e=>e===this.chartController.getChartThemeName()),this.cardItems=[],(0,m._clearElement)(this.eCardSelector),this.destroyMiniCharts();let{themes:s}=this;this.palettes.forEach((e,t)=>{let r=this.activePaletteIndex===t,{fills:a=[],strokes:l=[]}=e,n=!dX(s[t],this.beans.agChartsExports._Theme),o=this.createBean(new cz(this.chartController,a,l,n,i));this.miniChartsContainers.push(o),this.eMiniChartsContainer.appendChild(o.getGui()),this.addCardLink(t),r?o.updateSelectedMiniChart():o.setDisplayed(!1)}),(0,m._setDisplayed)(this.eNavBar,this.palettes.length>1),(0,m._radioCssClass)(this.cardItems[this.activePaletteIndex],"ag-selected","ag-not-selected")}addCardLink(e){let t=document.createElement("div");t.classList.add("ag-chart-settings-card-item"),this.addManagedElementListeners(t,{click:()=>{this.setActivePalette(e,e<this.activePaletteIndex?"left":"right")}}),this.eCardSelector.appendChild(t),this.cardItems.push(t)}getPrev(){let e=this.activePaletteIndex-1;return e<0&&(e=this.palettes.length-1),e}getNext(){let e=this.activePaletteIndex+1;return e>=this.palettes.length&&(e=0),e}setActivePalette(e,t){if(this.isAnimating||this.activePaletteIndex===e)return;(0,m._radioCssClass)(this.cardItems[e],"ag-selected","ag-not-selected");let i=this.miniChartsContainers[this.activePaletteIndex],s=i.getGui(),r=this.miniChartsContainers[e],a=r.getGui();i.updateSelectedMiniChart(),r.updateSelectedMiniChart();let l=a.style.left=`${(0,m._getAbsoluteWidth)(this.getGui())*("left"===t?-1:1)}px`;this.activePaletteIndex=e,this.isAnimating=!0;let n="ag-animating";r.setDisplayed(!0),i.addCss(n),r.addCss(n),this.chartController.setChartThemeName(this.themes[e]),window.setTimeout(()=>{s.style.left=`${-parseFloat(l)}px`,a.style.left="0px"},0),window.setTimeout(()=>{this.isAnimating=!1,i.removeCss(n),r.removeCss(n),i.setDisplayed(!1)},300)}destroyMiniCharts(){(0,m._clearElement)(this.eMiniChartsContainer),this.miniChartsContainers=this.destroyBeans(this.miniChartsContainers)}destroy(){this.destroyMiniCharts(),super.destroy()}},cU=class extends m.Component{constructor(e,t){super(),this.panels=e,this.chartMenuContext=t,this.tabs=[]}wireBeans(e){this.chartTranslation=e.chartTranslation}postConstruct(){for(let e of this.panels){let t=e.replace("chart","").toLowerCase(),i=this.createPanel(t),s=this.createTab(e,t,i);this.tabs.push(s),this.addDestroyFunc(()=>this.destroyBean(i))}this.tabbedLayout=new tp({items:this.tabs,cssClass:"ag-chart-tabbed-menu",keepScrollPosition:!0,suppressFocusBodyOnOpen:!0,suppressTrapFocus:!0,enableCloseButton:!0,closeButtonAriaLabel:this.chartTranslation.translate("ariaChartMenuClose"),onCloseClicked:()=>{this.eventSource?.focus({preventScroll:!0}),this.dispatchLocalEvent({type:"closed"})}}),this.createBean(this.tabbedLayout)}createTab(e,t,i){let s=(0,m._createElement)({tag:"div",cls:`ag-chart-tab ag-chart-${t}`});this.createBean(i),s.appendChild(i.getGui());let r=this.chartTranslation.translate(t);return{title:(0,m._createElement)({tag:"div",children:r}),titleLabel:r,bodyPromise:m.AgPromise.resolve(s),getScrollableContainer:()=>s.querySelector(".ag-scrollable-container")||s,name:e}}showTab(e){let t=this.tabs[e];this.tabbedLayout.showItem(t)}getGui(){return this.tabbedLayout?.getGui()}showMenu(e,t){this.eventSource=e,t||this.tabbedLayout?.focusHeader(!0)}destroy(){this.parentComponent?.isAlive()&&this.destroyBean(this.parentComponent),super.destroy()}createPanel(e){switch(e){case"data":return new ul(this.chartMenuContext);case"format":return new uK(this.chartMenuContext);default:return new cH(this.chartMenuContext.chartController)}}},cW=class extends m.Component{constructor(e,t,i){super('<div class="ag-chart-menu-wrapper"></div>'),this.eChartContainer=e,this.eMenuPanelContainer=t,this.chartMenuContext=i,this.buttons={chartLink:{iconName:"linked",callback:()=>this.chartMenuSvc.toggleLinked(this.chartMenuContext)},chartUnlink:{iconName:"unlinked",callback:()=>this.chartMenuSvc.toggleLinked(this.chartMenuContext)},chartDownload:{iconName:"chartsDownload",callback:()=>this.chartMenuSvc.downloadChart(this.chartMenuContext)},chartMenu:{iconName:"chartsMenu",callback:e=>this.showMenuList(e)}},this.panels=[],this.menuVisible=!1,this.chartController=i.chartController}wireBeans(e){this.chartMenuSvc=e.chartMenuSvc,this.chartMenuListFactory=e.chartMenuListFactory}postConstruct(){this.chartToolbar=this.createManagedBean(new h3),this.getGui().appendChild(this.chartToolbar.getGui()),this.refreshToolbarAndPanels(),this.addManagedEventListeners({chartCreated:e=>{e.chartId===this.chartController.getChartId()&&this.gos.get("chartToolPanelsDef")?.defaultToolPanel&&this.showMenu({panel:this.defaultPanel,suppressFocus:!0})}}),this.addManagedListeners(this.chartController,{chartLinkedChanged:this.refreshToolbarAndPanels.bind(this)}),this.refreshMenuClasses(),this.addManagedListeners(this.chartController,{chartApiUpdate:this.refreshToolbarAndPanels.bind(this)})}isVisible(){return this.menuVisible}getExtraPaddingDirections(){return["chartMenu","chartLink","chartUnlink","chartDownload"].some(e=>this.chartToolbarOptions.includes(e))?["top"]:[]}refreshToolbarAndPanels(){this.initToolbarOptionsAndPanels(),this.updateToolbar()}initToolbarOptionsAndPanels(){let{panels:e,defaultPanel:t}=this.chartMenuSvc.getChartToolPanels(this.chartController);this.panels=e,this.defaultPanel=t,this.chartToolbarOptions=this.chartMenuSvc.getChartToolbarOptions()}updateToolbar(){let e=this.chartToolbarOptions.map(e=>{let{iconName:t,callback:i}=this.buttons[e];return{buttonName:e,iconName:t,callback:i}});this.chartToolbar.updateParams({buttons:e})}createMenuPanel(e){let t=this.menuPanel=this.createBean(new ti({height:"100%",closable:!0,hideTitleBar:!0,cssIdentifier:"chart-menu"}));return t.setParentComponent(this),this.eMenuPanelContainer.appendChild(t.getGui()),this.tabbedMenu=this.createBean(new cU(this.panels,this.chartMenuContext)),this.addManagedListeners(this.tabbedMenu,{closed:()=>{this.hideMenu()}}),this.addManagedListeners(t,{destroyed:()=>this.destroyBean(this.tabbedMenu)}),new m.AgPromise(i=>{window.setTimeout(()=>{t.setBodyComponent(this.tabbedMenu),this.tabbedMenu.showTab(e),i(t)},100)})}showContainer(e,t){this.menuPanel&&(this.menuVisible=!0,this.refreshMenuClasses(),this.tabbedMenu.showMenu(e,t))}showMenu(e){let{panel:t,eventSource:i,suppressFocus:s}=e??{};if(this.menuPanel&&!t)this.showContainer(i,s);else{let e=t||this.defaultPanel,r=this.panels.indexOf(e);r<0&&((0,m._warn)(143,{panel:t}),r=this.panels.indexOf(this.defaultPanel)),this.menuPanel?(this.tabbedMenu.showTab(r),this.showContainer(i,s)):this.createMenuPanel(r).then(()=>this.showContainer(i,s))}}hideMenu(){this.menuVisible=!1,this.refreshMenuClasses()}refreshMenuClasses(){this.eChartContainer.classList.toggle("ag-chart-menu-visible",this.menuVisible),this.eChartContainer.classList.toggle("ag-chart-menu-hidden",!this.menuVisible)}showMenuList(e){this.chartMenuListFactory.showMenuList({eventSource:e,showMenu:()=>this.showMenu({eventSource:e}),chartMenuContext:this.chartMenuContext})}destroy(){super.destroy(),this.menuPanel?.isAlive()&&this.destroyBean(this.menuPanel),this.tabbedMenu?.isAlive()&&this.destroyBean(this.tabbedMenu)}},cK=["number","category","time","grouped-category"],c$=[...cK,"angle-category","angle-number","radius-category","radius-number"],cj=class extends m.BeanStub{constructor(e){super(),this.chartController=e}getChartThemeOverridesProxy(){return{getValue:e=>this.getChartOption(e),setValue:(e,t)=>this.setChartThemeOverrides([{expression:e,value:t}]),setValues:e=>this.setChartThemeOverrides(e)}}getAxisThemeOverridesProxy(){return{getValue:e=>this.getAxisProperty(e),setValue:(e,t)=>this.setAxisThemeOverrides([{expression:e,value:t}]),setValues:e=>this.setAxisThemeOverrides(e)}}getCartesianAxisOptionsProxy(e){return{getValue:t=>this.getCartesianAxisProperty(e,t),setValue:(t,i)=>this.setCartesianAxisOptions(e,[{expression:t,value:i}]),setValues:t=>this.setCartesianAxisOptions(e,t),clearValue:(t,i)=>this.clearCartesianAxisOptions(e,t,i)}}getCartesianAxisThemeOverridesProxy(e){return{getValue:t=>this.getCartesianAxisProperty(e,t),setValue:(t,i)=>this.setCartesianAxisThemeOverrides(e,[{expression:t,value:i}]),setValues:t=>this.setCartesianAxisThemeOverrides(e,t)}}getCartesianAxisAppliedThemeOverridesProxy(e){return{getValue:t=>this.getCartesianAxisThemeOverride(e,"*"===t?null:t),setValue:(t,i)=>this.setCartesianAxisThemeOverrides(e,[{expression:"*"===t?null:t,value:i}]),setValues:t=>this.setCartesianAxisThemeOverrides(e,t)}}getSeriesOptionsProxy(e){return{getValue:(t,i)=>this.getSeriesOption(e(),t,i),setValue:(t,i)=>this.setSeriesOptions(e(),[{expression:t,value:i}]),setValues:t=>this.setSeriesOptions(e(),t)}}getPersistedChartThemeOverrides(e,t,i,s){let r=this.getRetainedChartThemeOverrideKeys(i,s),a=this.getRetainedChartAxisThemeOverrideKeys(null,i,s),l=this.createChartOptions();for(let t of r){let r=this.retrieveChartOptionsThemeOverride(e,i,t);void 0!==r&&this.assignChartOptionsThemeOverride(l,s,t,r)}return t&&this.assignPersistedAxisOverrides({existingAxes:t,retainedChartAxisThemeOverrideKeys:a,existingChartOptions:e,targetChartOptions:l,existingChartType:i,targetChartType:s}),l.theme.overrides}assignPersistedAxisOverrides(e){let{existingAxes:t,retainedChartAxisThemeOverrideKeys:i,existingChartOptions:s,targetChartOptions:r,existingChartType:a,targetChartType:l}=e;for(let{expression:e,targetAxisTypes:n}of i)for(let i of t.map(e=>e.type)){let t=this.retrieveChartOptionsThemeOverride(s,a,["axes",i,e].join("."));if(void 0!==t)for(let i of n)this.assignChartOptionsThemeOverride(r,l,["axes",i,e].join("."),t)}}getRetainedChartThemeOverrideKeys(e,t){let i;return["animation",...(i=[],dV(dW(e))&&dV(dW(t))&&i.push("zoom","navigator"),i)]}getRetainedChartAxisThemeOverrideKeys(e,t,i){return dV(dW(t))&&dV(dW(i))?this.getRetainedCartesianAxisThemeOverrideKeys(e).map(e=>({expression:e,targetAxisTypes:cK})):[]}getRetainedCartesianAxisThemeOverrideKeys(e){let t="xAxis"===e?["",".top",".bottom"]:"yAxis"===e?["",".left",".right"]:["",".left",".right",".top",".bottom"],i=[];for(let e of["crosshair"])for(let s of t)i.push(`${e}${s}`);return i}getChartOption(e){return dD(this.getChart(),e,void 0)}setChartThemeOverrides(e){let t=this.getChartType(),i=this.createChartOptions();for(let{expression:s,value:r}of e)this.assignChartOptionsThemeOverride(i,t,s,r);this.applyChartOptions(i)}applyChartOptions(e,t){0===Object.keys(e).length||(this.updateChart(e),t?.silent||this.raiseChartOptionsChangedEvent())}awaitChartOptionUpdate(e){this.chartController.getChartProxy().getChart().waitForUpdate().then(()=>e()).catch(e=>(0,m._error)(108,{e}))}getAxisProperty(e){return dD(this.getChart().axes?.x,e,void 0)}setAxisThemeOverrides(e){let t=this.getChart(),i=this.getChartType(),s=this.createChartOptions();for(let{expression:r,value:a}of e){let e=Object.values(t.axes??{}).filter(e=>{let t=r.split("."),i=e;for(let e of t){if(!(e in i))return!1;i=i[e]}return!0});if(e)for(let t of e)this.isValidAxisType(t)&&this.assignChartAxisThemeOverride(s,i,t.type,null,r,a)}this.applyChartOptions(s)}getCartesianAxisProperty(e,t){let i=this.getChartAxes();return dD(this.getCartesianAxis(i,e),t,void 0)}getCartesianAxisThemeOverride(e,t){let i=this.getChartAxes(),s=this.getCartesianAxis(i,e);if(!s||!this.isValidAxisType(s))return;let r=this.getChartType(),a=this.getChart().getOptions();return this.retrieveChartAxisThemeOverride(a,r,s.type,"yAxis"===e?["left","right"]:["bottom","top"],t)}setCartesianAxisThemeOverrides(e,t){let i=this.getChartAxes(),s=this.getCartesianAxis(i,e);if(!s||!this.isValidAxisType(s))return;let r=this.getChartType(),a=this.createChartOptions();for(let{expression:i,value:l}of t)this.assignChartAxisThemeOverride(a,r,s.type,"yAxis"===e?["left","right"]:["bottom","top"],i,l);this.applyChartOptions(a)}setCartesianAxisOptions(e,t){this.updateCartesianAxisOptions(e,i=>{let s="yAxis"===e?"y":"x";for(let{expression:e,value:r}of t)this.assignChartOption(i,`axes.${s}.${e}`,r)})}clearCartesianAxisOptions(e,t,i){this.updateCartesianAxisOptions(e,s=>{let r="yAxis"===e?"y":"x";this.clearChartOption(s,`axes.${r}.${t}`,i)})}updateCartesianAxisOptions(e,t){let i=this.getChart().getOptions(),s="axes"in i?i.axes:void 0;if(!i||!s)return;let r=this.getChartAxes(),a=this.getCartesianAxis(r,e);if(!a)return;let l=this.createChartOptions();l.axes=s,t(l,a,i),this.applyChartOptions(l)}setCartesianCategoryAxisType(e,t){this.updateCartesianAxisOptions(e,(i,s,r)=>{let a=this.getChartType();this.assignPersistedAxisOverrides({existingAxes:[s],retainedChartAxisThemeOverrideKeys:this.getRetainedChartAxisThemeOverrideKeys(e,a,a),existingChartOptions:r,targetChartOptions:i,existingChartType:a,targetChartType:a}),this.assignChartOption(i,"axes.x.type",t),this.chartController.setCategoryAxisType(t)})}getCartesianAxis(e,t){if(!(e.length<2))switch(t){case"xAxis":return"x"===e[0].direction?e[0]:e[1];case"yAxis":return"y"===e[1].direction?e[1]:e[0]}}getSeriesOption(e,t,i){let s=this.getChart().series.find(t=>{var i,s;return i=e,s=t,!!dG[i]&&s.type===i});return dD(i?s:s?.properties.toJson(),t,void 0)}setSeriesOptions(e,t){let i=this.createChartOptions();for(let{expression:s,value:r}of t)this.assignChartOptionsSeriesThemeOverride(i,e,`series.${s}`,r);this.applyChartOptions(i)}getPairedMode(){return this.chartController.getChartProxy().isPaired()}setPairedMode(e){this.chartController.getChartProxy().setPaired(e)}getChartAxes(){return Object.values(this.getChart().axes??{})}retrieveChartAxisThemeOverride(e,t,i,s,r){if(!s)return this.retrieveChartOptionsThemeOverride(e,t,["axes",i,...r?[r]:[]].join("."));for(let a of s){let s=this.retrieveChartOptionsThemeOverride(e,t,["axes",i,a,...r?[r]:[]].join("."));if(void 0!==s)return s}}assignChartAxisThemeOverride(e,t,i,s,r,a){if(s)for(let l of s)this.assignChartOptionsThemeOverride(e,t,["axes",i,l,...r?[r]:[]].join("."),a);else this.assignChartOptionsThemeOverride(e,t,["axes",i,...r?[r]:[]].join("."),a)}isValidAxisType(e){return c$.includes(e.type)}getChartType(){return this.chartController.getChartType()}getChart(){return this.chartController.getChartProxy().getChart()}updateChart(e){let t=this.chartController.getChartProxy().getChartRef();t.skipAnimations(),t.updateDelta(e)}createChartOptions(){return{theme:{overrides:{}}}}retrieveChartOptionsThemeOverride(e,t,i){for(let s of this.getChartThemeOverridesSeriesTypeKeys(t)){let t=this.retrieveChartOptionsSeriesThemeOverride(e,s,i);if(void 0!==t)return t}}assignChartOptionsThemeOverride(e,t,i,s){for(let r of this.getChartThemeOverridesSeriesTypeKeys(t))this.assignChartOptionsSeriesThemeOverride(e,r,i,s)}retrieveChartOptionsSeriesThemeOverride(e,t,i){return this.retrieveChartOption(e,["theme","overrides",t,...i?[i]:[]].join("."))}assignChartOptionsSeriesThemeOverride(e,t,i,s){this.assignChartOption(e,["theme","overrides",t,...i?[i]:[]].join("."),s)}getChartThemeOverridesSeriesTypeKeys(e){let t=this.chartController.getChartSeriesTypes(e);return this.chartController.isComboChart()&&t.push("common"),t}retrieveChartOption(e,t){return dD(e,t,void 0)}assignChartOption(e,t,i){!function(e,t,i){if(null==e)return;let s=t.split("."),r=e;s.filter(e=>!dE.has(e)).forEach((e,t)=>{r[e]||(r[e]={}),t<s.length-1&&(r=r[e])}),r[s[s.length-1]]=i}(e,t,i)}clearChartOption(e,t,i){let s=dD(e,t,void 0);s&&delete s[i]}raiseChartOptionsChangedEvent(){let e=this.chartController.getChartModel();this.eventSvc.dispatchEvent({type:"chartOptionsChanged",chartId:e.chartId,chartType:e.chartType,chartThemeName:this.chartController.getChartThemeName(),chartOptions:e.chartOptions})}},cY=class extends m.Component{constructor(e){super(`
            <div style="height: 100%; width: 100%;">
                <div class="ag-chart" data-ref="eWrapper">
                    <div data-ref="eChartContainer" class="ag-chart-components-wrapper ag-chart-menu-hidden">
                        <div data-ref="eChart" class="ag-chart-canvas-wrapper"></div>
                        <div data-ref="eEmpty" class="ag-chart-empty-text ag-unselectable"></div>
                    </div>
                    <div data-ref="eMenuContainer" class="ag-chart-docked-container"></div>
                </div>
            </div>
            `),this.eChart=m.RefPlaceholder,this.eWrapper=m.RefPlaceholder,this.eChartContainer=m.RefPlaceholder,this.eMenuContainer=m.RefPlaceholder,this.eEmpty=m.RefPlaceholder,this.params=e}wireBeans(e){this.crossFilterService=e.chartCrossFilterSvc,this.chartTranslation=e.chartTranslation,this.chartMenuSvc=e.chartMenuSvc,this.focusSvc=e.focusSvc,this.popupSvc=e.popupSvc,this.enterpriseChartProxyFactory=e.enterpriseChartProxyFactory,this.environment=e.environment}postConstruct(){let e={...this.params,chartType:dU(this.params.chartType),chartThemeName:this.getThemeName()},t=this.gos.get("enableRtl");this.eWrapper.classList.add(t?"ag-rtl":"ag-ltr");let i=this.createBean(new ho(e));this.chartController=this.createManagedBean(new hX(i)),this.chartOptionsService=this.createManagedBean(new cj(this.chartController)),this.validateCustomThemes(),this.createChart(),this.params.insideDialog?this.addDialog():(this.addManagedEventListeners({stylesChanged:this.updateTheme.bind(this)}),this.updateTheme()),this.addMenu(),this.addManagedElementListeners(this.getGui(),{focusin:this.setActiveChartCellRange.bind(this)}),this.addManagedListeners(this.chartController,{chartModelUpdate:this.update.bind(this)}),this.addManagedPropertyListeners(["chartThemeOverrides","chartThemes"],this.reactivePropertyUpdate.bind(this)),this.update(),this.raiseChartCreatedEvent()}updateTheme(){this.environment.applyThemeClasses(this.getGui())}createChart(){let e;this.chartProxy&&(e=this.chartProxy.destroy({keepChartInstance:!0}));let t=(e,t)=>{this.params.crossFilteringContext.lastSelectedChartId=t?"":this.chartController.getChartId(),t&&this.params.crossFilteringResetCallback(),this.crossFilterService.filter(e,t)},i=this.chartController.getChartType(),s={agChartsExports:this.beans.agChartsExports,chartType:i,chartInstance:e,getChartThemeName:this.getChartThemeName.bind(this),getChartThemes:this.getChartThemes.bind(this),customChartThemes:this.gos.get("customChartThemes"),styleNonce:this.gos.get("styleNonce"),getGridOptionsChartThemeOverrides:()=>this.getGridOptionsChartThemeOverrides(),getExtraPaddingDirections:()=>this.chartMenu?.getExtraPaddingDirections()??[],apiChartThemeOverrides:this.params.chartThemeOverrides,crossFiltering:this.params.crossFiltering??!1,crossFilterCallback:t,parentElement:this.eChart,grouping:this.chartController.isGrouping(),chartThemeToRestore:this.params.chartThemeName,chartOptionsToRestore:this.params.chartOptionsToRestore,chartPaletteToRestore:this.params.chartPaletteToRestore,seriesChartTypes:this.chartController.getSeriesChartTypes(),translate:e=>this.chartTranslation.translate(e),context:(0,m._addGridCommonParams)(this.gos,{})};(this.params.chartOptionsToRestore=void 0,this.chartType=i,this.chartProxy=this.createChartProxy(s),this.chartProxy)?(this.chartController.setChartProxy(this.chartProxy),this.createMenuContext()):(0,m._warn)(138,{chartType:s.chartType})}createMenuContext(){if(this.chartMenuContext)return;let e=this.createManagedBean(new ut(this.chartOptionsService.getChartThemeOverridesProxy())),t=this.createManagedBean(new ut(this.chartOptionsService.getAxisThemeOverridesProxy()));this.chartMenuContext={chartController:this.chartController,chartOptionsService:this.chartOptionsService,chartMenuParamsFactory:e,chartAxisMenuParamsFactory:t}}getChartThemeName(){return this.chartController.getChartThemeName()}getChartThemes(){return this.chartController.getThemeNames()}getGridOptionsChartThemeOverrides(){return this.gos.get("chartThemeOverrides")}createChartProxy(e){let{chartType:t}=e;switch(t){case"column":case"bar":case"groupedColumn":case"stackedColumn":case"normalizedColumn":case"groupedBar":case"stackedBar":case"normalizedBar":return new h0(e);case"pie":case"donut":case"doughnut":return new h4(e);case"area":case"stackedArea":case"normalizedArea":return new hJ(e);case"line":case"stackedLine":case"normalizedLine":return new h1(e);case"scatter":case"bubble":return new h2(e);case"columnLineCombo":case"areaColumnCombo":case"customCombo":return new h5(e)}let i=this.enterpriseChartProxyFactory?.createChartProxy(e);if(!i)throw(0,m._errMsg)(251,{chartType:t});return i}addDialog(){let e=this.chartTranslation.translate(this.params.pivotChart?"pivotChartTitle":"rangeChartTitle"),{width:t,height:i}=this.getBestDialogSize(),s=this.params.focusDialogOnOpen?()=>setTimeout(()=>(0,m._focusInto)(this.getGui())):void 0;this.chartDialog=new tB({resizable:!0,movable:!0,maximizable:!0,title:e,width:t,height:i,component:this,centered:!0,closable:!0,afterGuiAttached:s,postProcessPopupParams:{type:"chart"}}),this.createBean(this.chartDialog),this.chartDialog.addEventListener("destroyed",()=>{this.destroy(),this.chartMenuSvc.hideAdvancedSettings();let e=this.focusSvc.getFocusedCell();setTimeout(()=>{this.focusSvc.isAlive()&&(e?this.focusSvc.setFocusedCell({...e,forceBrowserFocus:!0}):(0,m._focusGridInnerElement)(this.beans))})})}getBestDialogSize(){let e=this.popupSvc.getPopupParent(),t=.75*(0,m._getAbsoluteWidth)(e),i=.75*(0,m._getAbsoluteHeight)(e),s=this.chartProxy.getChart(),r=this.params.insideDialog?850:s.width,a=this.params.insideDialog?470:s.height;return(r>t||a>i)&&(a=Math.round(.553*(r=Math.min(r,t))))>i&&(r=Math.min(r,Math.round((a=i)/.553))),{width:r,height:a}}addMenu(){this.params.crossFiltering||(this.chartMenu=this.createBean(new cW(this.eChartContainer,this.eMenuContainer,this.chartMenuContext)),this.eChartContainer.appendChild(this.chartMenu.getGui()))}update(e){let t,i,s,r;if(e?.chartId&&!this.chartController.update(e))return;let a=this.chartTypeChanged(e),l=a||this.chartEmpty?(t=this.chartType,i=this.chartProxy.getChart(),s=i?.getOptions(),r=Object.values(i?.axes??{}),this.chartOptionsService.getPersistedChartThemeOverrides(s,r,t,a??t)):void 0;a&&this.createChart(),l&&e?.chartThemeOverrides&&(0,m._mergeDeep)(l,e.chartThemeOverrides);let n=l??e?.chartThemeOverrides;this.updateChart(n),e?.chartId&&this.chartProxy.getChart().waitForUpdate().then(()=>{this.chartController.raiseChartApiUpdateEvent()})}updateChart(e){let{chartProxy:t}=this,i=this.chartController.getSelectedValueColState(),s=this.chartController.getChartData(),r=this.handleEmptyChart(s,i.length);if(this.chartEmpty=r,r){e&&this.chartController.updateThemeOverrides(e);return}let a=this.chartController.getChartUpdateParams(e);t.update(a),this.chartProxy.getChart().waitForUpdate().then(()=>{this.chartController.raiseChartUpdatedEvent()})}chartTypeChanged(e){let[t,i]=[this.chartController.getChartType(),e?.chartType],s=i?dU(i):void 0;return this.chartType!==t?s??t:s&&t!==s?s:null}getChartModel(){return this.chartController.getChartModel()}getChartImageDataURL(e){return this.chartProxy.getChartImageDataURL(e)}handleEmptyChart(e,t){let i=this.chartController.isPivotChart()&&!this.chartController.isPivotMode(),s=this.chartController.getChartType(),r=1;this.chartController.isActiveXYChart()?r="bubble"===s?3:2:dH(dW(s))&&(r=0);let a=t<r||0===e.length;if(this.eChart){let e=i||a;(0,m._setDisplayed)(this.eChart,!e),(0,m._setDisplayed)(this.eEmpty,e)}return i?(this.eEmpty.textContent=this.chartTranslation.translate("pivotChartRequiresPivotMode"),!0):!!a&&(this.eEmpty.textContent=this.chartTranslation.translate("noDataToChart"),!0)}downloadChart(e,t,i){this.chartProxy.downloadChart(e,t,i)}openChartToolPanel(e){let t=e?hP[e]:e;this.chartMenu.showMenu({panel:t})}closeChartToolPanel(){this.chartMenu.hideMenu()}getChartId(){return this.chartController.getChartId()}getUnderlyingChart(){return this.chartProxy.getChartRef()}crossFilteringReset(){this.chartProxy.crossFilteringReset()}setMaximized(e){this.chartDialog?.setMaximized(e)}setActiveChartCellRange(e){this.getGui().contains(e.relatedTarget)||this.chartController.setChartRange(!0)}getThemeName(){let e=this.gos.get("chartThemes")||hZ;if(0===e.length)throw Error((0,m._errMsg)(254));let{chartThemeName:t}=this.params;return e.includes(t)?t:e[0]}getAllKeysInObjects(e){let t={};for(let i of e.filter(e=>null!=e))for(let e of Object.keys(i))t[e]=null;return Object.keys(t)}validateCustomThemes(){let e=this.getChartThemes(),t=this.gos.get("customChartThemes");if(t)for(let i of this.getAllKeysInObjects([t]))e.includes(i)||(0,m._warn)(139,{customThemeName:i})}reactivePropertyUpdate(){this.chartController.setChartThemeName(this.getThemeName(),!0);let e=this.getChartId(),t=this.chartController.isCrossFilterChart()?"crossFilter":this.getChartModel().modelType,i=this.gos.get("chartThemeOverrides")||{};this.update({type:`${t}ChartUpdate`,chartId:e,chartThemeOverrides:i})}raiseChartCreatedEvent(){this.chartProxy.getChart().waitForUpdate().then(()=>{this.eventSvc.dispatchEvent({type:"chartCreated",chartId:this.chartController.getChartId()})})}raiseChartDestroyedEvent(){this.eventSvc.dispatchEvent({type:"chartDestroyed",chartId:this.chartController.getChartId()})}destroy(){super.destroy(),this.chartProxy&&this.chartProxy.destroy(),this.destroyBean(this.chartMenu),this.chartDialog?.isAlive()&&this.destroyBean(this.chartDialog),this.onDestroyColorSchemeChangeListener?.();let e=this.getGui();(0,m._clearElement)(e),(0,m._removeFromParent)(e),this.raiseChartDestroyedEvent()}};function cq(e){return e=pn("chartOptions.legend.item.marker.type","shape",e),e=pn("chartOptions.seriesDefaults.marker.type","shape",e),e=pn("chartOptions.legend.padding","spacing",e)}function cZ(e){let{chartType:t,chartPalette:i,chartOptions:{xAxis:s,yAxis:r,...a},...l}=e=po("chartOptions.seriesDefaults.marker.minSize",e),n=function(e){switch(e){case"bar":case"stackedBar":case"normalizedBar":return["number","category"];case"groupedBar":return["number","grouped-category"];case"column":case"stackedColumn":case"normalizedColumn":case"line":case"stackedLine":case"normalizedLine":case"area":case"stackedArea":case"normalizedArea":case"histogram":return["category","number"];case"groupedColumn":return["grouped-category","number"];case"scatter":case"bubble":return["number","number"];default:return}}(t),o=n?.map((e,t)=>({type:e,...0===t?s:r}));return{chartType:t,chartThemeName:({borneo:"ag-default",material:"ag-material",bright:"ag-vivid"})[i]??"ag-default",chartOptions:{...a,axes:o,xAxis:s,yAxis:r},...l}}function cX(e){return pn("chartOptions.seriesDefaults.label.minRequiredAngle","minAngle",e)}function cJ(e){return e=po("chart",e=ph("chartOptions.seriesDefaults.highlightStyle",e,({dimOpacity:e,...t})=>({...t,...null!=e?{series:{dimOpacity:e}}:{}}))),e=po("chartOptions.seriesDefaults.tooltipClass",e),e=ps("chartOptions.axes[].label.rotation",0,e=po("chartOptions.seriesDefaults.tooltipTracking",e)),e=ps("chartOptions.axes[].label.rotation",335,e)}function cQ(e){let t=({item:e,series:t,...i})=>({item:{...i,...e},...t?{series:t}:{}});return e=ph("chartOptions.seriesDefaults.highlightStyle",e,t),e=ph("chartOptions.series[].highlightStyle",e,t)}function c0(e){e=pa("chartOptions.seriesDefaults.fill.opacity","chartOptions.seriesDefaults.fillOpacity",e),e=pa("chartOptions.seriesDefaults.stroke.opacity","chartOptions.seriesDefaults.strokeOpacity",e),e=po("chartOptions.seriesDefaults.fill",e=pa("chartOptions.seriesDefaults.stroke.width","chartOptions.seriesDefaults.strokeWidth",e)),e=po("chartOptions.seriesDefaults.stroke",e),e=po("chartOptions.seriesDefaults.callout.colors",e),e=po("chartOptions.xAxis",e);let{chartType:t,chartOptions:{axes:i,series:s,seriesDefaults:r,...a},...l}=e=po("chartOptions.yAxis",e),n=dU(t),o=dW(n),d=[o],h={};if(!dK(o)){let e={top:{},bottom:{},left:{},right:{}},t=i.map(({type:t,...i})=>({[t]:{...e,...i}})).reduce(pc,{});for(let i of dZ.filter(e=>null==t[e]))t[i]={...e};h.axes=t}let u=d.map(e=>({[e]:{...h,series:r,...a}})).reduce(pc,{});return{...l,chartType:n,chartOptions:u}}function c1(e){return e=po("chartOptions.*.title.padding",e),e=po("chartOptions.*.subtitle.padding",e),e=pr("chartOptions.*.axes.*.title.enabled",!1,e=po("chartOptions.*.axes.*.title.padding",e))}function c2(e){return e=pn("chartOptions.pie.series.callout","calloutLine",e),e=pn("chartOptions.pie.series.label","calloutLabel",e),e=pn("chartOptions.pie.series.labelKey","sectorLabelKey",e),e=pn("chartOptions.pie.series.labelName","sectorLabelName",e),e=pn("chartOptions.donut.series.callout","calloutLine",e),e=pn("chartOptions.donut.series.label","calloutLabel",e),e=pn("chartOptions.donut.series.labelKey","sectorLabelKey",e),e=pn("chartOptions.donut.series.labelName","sectorLabelName",e)}function c5(e){return e=pl("chartOptions.scatter.series.fill","chartOptions.scatter.series.marker.fill",e),e=pl("chartOptions.scatter.series.fillOpacity","chartOptions.scatter.series.marker.fillOpacity",e),e=pl("chartOptions.scatter.series.stroke","chartOptions.scatter.series.marker.stroke",e),e=pl("chartOptions.scatter.series.strokeOpacity","chartOptions.scatter.series.marker.strokeOpacity",e),e=pa("chartOptions.scatter.series.paired","chartOptions.scatter.paired",e=pl("chartOptions.scatter.series.strokeWidth","chartOptions.scatter.series.marker.strokeWidth",e))}function c4(e){return po("chartOptions.axes[].tick.count",e)}function c3(e){return ph("chartOptions.*.tooltip",e,({tracking:e,...t})=>{let i={...t};return!1===e?(i.position??(i.position={type:"pointer"}),i.range??(i.range="nearest")):!0===e&&(i.position??(i.position={type:"node"}),i.range??(i.range="nearest")),i})}function c6(e){return e=pn("chartOptions.pie.series.labelKey","sectorLabelKey",e),e=pr("chartOptions.common.legend.position","right",e=function e(t,i,s){"string"==typeof t&&(t=t.split("."));let r=t[0];return t.length>1&&(s[r]=e(t.slice(1),i,s[r]??{})),Object.keys(s).includes(r)||(s[r]=i),s}("chartOptions.common.legend.enabled",!0,e=po("chartOptions.*.series.flipXY",e=c3(e=c4(e=pn("chartOptions.pie.series.labelName","sectorLabelName",e))))))}function c8(e){let t=pn("chartOptions.column","bar",e),i={"ag-pastel":"ag-sheets","ag-solar":"ag-polychroma"}[t.chartThemeName]||t.chartThemeName;return{...t,chartThemeName:i}}function c7(e){return pd("chartOptions.*.autoSize",!0,e,(e,t)=>{!0===e[t]||!1===e[t]&&(e.minHeight=600,e.minWidth=300),delete e[t]})}function c9(e){return e=po("chartOptions.*.axes.category.label.format",e),e=po("chartOptions.*.axes.category.crosshair.label.format",e),e=po("chartOptions.*.axes.angle-category.label.format",e),e=pn("chartOptions.*.axes.*.label.padding","spacing",e=po("chartOptions.*.axes.radius-category.label.format",e)),e=pd("chartOptions.*.axes.*.crossLines.label.position",!0,e=po("chartOptions.*.axes.*.crossLines.label.className",e=pn("chartOptions.*.navigator.miniChart.label.padding","spacing",e)),(e,t)=>{"string"==typeof e[t]&&(e[t]=e[t].replace(/([A-Z])/,"-$1").toLowerCase())}),e=pu("chartOptions.bar.series.label.placement",e=po("chartOptions.bullet",e),{inside:"inside-center",outside:"inside-end"}),e=po("chartOptions.*.navigator.min",e=pu("chartOptions.waterfall.series.item.*.label.placement",e,{inside:"inside-center",start:"outside-start",end:"outside-end"})),e=po("chartOptions.*.navigator.max",e),e=po("chartOptions.*.zoom.ratioX",e),e=po("chartOptions.*.zoom.ratioY",e),e=po("chartOptions.*.zoom.rangeX",e),e=po("chartOptions.*.zoom.rangeY",e)}function pe(e){return pd("chartOptions.series[].highlightStyle",!0,e,(e,t)=>{let i=e[t];if(null==i)return;let s={};if(i.item&&(s.highlightedItem=i.item),i.series){let{dimOpacity:e,...t}=i.series;null!=e&&(s.unhighlightedSeries={opacity:e}),Object.keys(t).length>0&&(s.highlightedSeries=t)}delete e[t],e.highlight=s}),e}function pt(e,t,i){if(pi(e)>pi(t.version)){let s=i(t);return s.version=e,s}return t}function pi(e){let{major:t,minor:i,patch:s}=function(e){let t=e.includes("-beta")?e.replace(/-beta.*/,""):e,i="string"==typeof t?t.split(".").map(e=>Number(e)):[];if(3!==i.length||i.some(e=>isNaN(e)))throw Error((0,m._errMsg)(253,{version:t}));return{major:i[0],minor:i[1],patch:i[2]}}(e);return 1e4*t+100*i+s}function ps(e,t,i){return pd(e,!0,i,(e,i)=>{e[i]===t&&delete e[i]})}function pr(e,t,i){return pd(e,!1,i,(e,i)=>{null==e[i]&&(e[i]=t)})}function pa(e,t,i){let s,r=!1;return(i=pd(e,!0,i,(e,t)=>{r=!0,s=e[t],delete e[t]}),r)?pd(t,!1,i,(e,t)=>{e[t]=s}):i}function pl(e,t,i){let s,r=!1;return(i=pd(e,!0,i,(e,t)=>{r=!0,s=e[t],delete e[t]}),r)?pd(t,!1,i,(e,t)=>{void 0===e[t]&&(e[t]=s)}):i}function pn(e,t,i){return pd(e,!0,i,(e,i)=>{e[t]=e[i],delete e[i]})}function po(e,t){return pd(e,!0,t,(e,t)=>delete e[t])}function pd(e,t,i,s){let r=e instanceof Array?e:e.split("."),a=r.slice(0,r.length-1),l=r[r.length-1];return ph(a,i,e=>{let i=Object.keys(e).includes(l);if(t&&!i)return e;let r={...e};return s(r,l),r})}function ph(e,t,i){let s=e instanceof Array?e:e.split(".");if(t={...t},0===s.length)return i(t);if(s[0].startsWith("{"))for(let e of s[0].substring(1,s[0].lastIndexOf("}")).split(","))null!=t[e]&&(t[e]=ph(s.slice(1),t[e],i));else if(s[0].endsWith("[]")){let r=s[0].substring(0,e[0].indexOf("["));t[r]instanceof Array&&(t[r]=t[r].map(e=>ph(s.slice(1),e,i)))}else if("*"===s[0])for(let e of Object.keys(t))t[e]=ph(s.slice(1),t[e],i);else null!=t[s[0]]&&(t[s[0]]=ph(s.slice(1),t[s[0]],i));return t}function pu(e,t,i){return pd(e,!0,t,(e,t)=>{"string"==typeof e[t]&&(e[t]=i[t]??t)})}var pc=(e,t)=>({...e,...t}),pp=class extends m.BeanStub{constructor(){super(...arguments),this.beanName="chartSvc",this.activeCharts=new Set,this.activeChartComps=new Set,this.crossFilteringContext={lastSelectedChartId:""},this.isEnterprise=()=>this.agChartsExports.isEnterprise}wireBeans(e){this.visibleCols=e.visibleCols,this.rangeSvc=e.rangeSvc,this.agChartsExports=e.agChartsExports}updateChart(e){if(0===this.activeChartComps.size)return void(0,m._warn)(124);let t=[...this.activeChartComps].find(t=>t.getChartId()===e.chartId);t?t.update(e):(0,m._warn)(125,{chartId:e.chartId})}getChartModels(){let e=[],t=e=>({...e,version:tv});for(let i of this.activeChartComps)e.push(t(i.getChartModel()));return e}getChartRef(e){let t;for(let i of this.activeCharts)i.chartId===e&&(t=i);return t}getChartComp(e){let t;for(let i of this.activeChartComps)i.getChartId()===e&&(t=i);return t}getChartImageDataURL(e){let t;for(let i of this.activeChartComps)i.getChartId()===e.chartId&&(t=i.getChartImageDataURL(e.fileFormat));return t}downloadChart(e){let t=Array.from(this.activeChartComps).find(t=>t.getChartId()===e.chartId);t?.downloadChart(e.dimensions,e.fileName,e.fileFormat)}openChartToolPanel(e){let t=Array.from(this.activeChartComps).find(t=>t.getChartId()===e.chartId);t?.openChartToolPanel(e.panel)}closeChartToolPanel(e){let t=Array.from(this.activeChartComps).find(t=>t.getChartId()===e);t?.closeChartToolPanel()}createChartFromCurrentRange(e="groupedColumn",t){let i=this.getSelectedRange();return this.createChart({cellRange:i,chartType:e,focusDialogOnOpen:!t})}restoreChart(e,t){var i,s;let r,a,l,n;if(!e)return void(0,m._warn)(126);if(e.version!==tv&&((i=e).version,null==i.version&&(i.version=function(e){if(null!=e.version)return e.version;let t=(e,...t)=>Object.keys(e||{}).some(e=>t.includes(e)),i=e.chartOptions,s=t(i,"seriesDefaults")?i?.seriesDefaults:i?.[Object.keys(i)[0]],[r="27.1.0"]=Object.entries({"27.0.0":t(e,"seriesChartTypes"),"26.2.0":!t(i,"seriesDefaults"),"26.1.0":t(s?.highlightStyle,"item"),"26.0.0":t(s?.highlightStyle,"series"),"25.1.0":t(s?.label,"minAngle"),"25.0.0":t(e,"modelType","aggFunc","unlinkChart","suppressChartRanges")||t(s,"lineDash","lineDashOffset"),"24.0.0":t(e,"chartThemeName","chart")||t(i,"series"),"23.2.0":t(i,"navigator"),"23.0.0":t(i?.legend?.item?.marker,"shape"),"22.1.0":t(e,"chartPalette","chartType")}).filter(([e,t])=>t)[0];return r}(i)),i=pt("23.0.0",i,cq),i=pt("24.0.0",i,cZ),i=pt("25.1.0",i,cX),i=pt("26.0.0",i,cJ),i=pt("26.1.0",i,cQ),i=pt("26.2.0",i,c0),i=pt("28.0.0",i,c1),i=pt("28.2.0",i,c2),i=pt("29.0.0",i,c5),i=pt("29.1.0",i,c4),i=pt("29.2.0",i,c3),i=pt("30.0.0",i,c6),i=pt("31.0.0",i,c8),i=pt("32.0.0",i,c7),i=pt("33.0.0",i,c9),s=po("chartOptions.*.width",s=i=pt("34.0.0",i,pe)),e=i=pt(tv,i=s=pr("chartOptions.*.axes.category.label.autoRotate",!0,s=po("chartOptions.*.height",s)),e=>e)),"pivot"===e.modelType?(this.gos.updateGridOptions({options:{pivotMode:!0},source:"pivotChart"}),r=this.createCellRange(void 0,!0),a=!0,l=!0):(r=this.createCellRange(e.cellRange),n=e.chartPalette,l=e.suppressChartRanges),r)return this.createChart({...e,cellRange:r,pivotChart:a,suppressChartRanges:l,chartContainer:t,chartOptionsToRestore:e.chartOptions,chartPaletteToRestore:n})}createRangeChart(e,t){let i=this.createCellRange(e.cellRange);if(i)return this.createChart({...e,cellRange:i,focusDialogOnOpen:!t})}createPivotChart(e,t){this.gos.updateGridOptions({options:{pivotMode:!0},source:"pivotChart"});let i=this.createCellRange(void 0,!0);if(i)return this.createChart({...e,cellRange:i,pivotChart:!0,suppressChartRanges:!0,focusDialogOnOpen:!t})}createCrossFilterChart(e,t){let i=this.createCellRange(e.cellRange);if(!i)return;let s=void 0===e.suppressChartRanges||null===e.suppressChartRanges||e.suppressChartRanges;return this.createChart({...e,cellRange:i,suppressChartRanges:s,crossFiltering:!0,crossFilteringSort:e.sort,focusDialogOnOpen:!t})}createChart(e){var t;let i=hq(e,[hK(t=this.agChartsExports.isEnterprise),h$(t)]);if(!i)return;let{chartType:s,chartContainer:r}=e=!0===i?e:i,a=this.gos.getCallback("createChartContainer"),l=new cY({...e,chartId:this.generateId(),chartType:dU(s),insideDialog:!(r||a),crossFilteringContext:this.crossFilteringContext,crossFilteringResetCallback:()=>{for(let e of this.activeChartComps)e.crossFilteringReset()}});this.createBean(l);let n=this.createChartRef(l);return r?r.appendChild(n.chartElement):a?a(n):l.addEventListener("destroyed",()=>{this.activeChartComps.delete(l),this.activeCharts.delete(n)}),n}createChartRef(e){let t={destroyChart:()=>{this.activeCharts.has(t)&&(this.destroyBean(e),this.activeChartComps.delete(e),this.activeCharts.delete(t))},focusChart:()=>{(0,m._focusInto)(e.getGui())},chartElement:e.getGui(),chart:e.getUnderlyingChart(),chartId:e.getChartModel().chartId,setMaximized:e.setMaximized.bind(e)};return this.activeCharts.add(t),this.activeChartComps.add(e),t}getSelectedRange(){let e=this.rangeSvc?.getCellRanges();if(!e||0===e.length)return{columns:[]};let t=new Set,i=Number.MAX_VALUE,s=-Number.MAX_VALUE;for(let{startRow:r,endRow:a,columns:l}of e){if(!(r&&a))continue;for(let e of l)t.add(e);let{rowIndex:e,rowPinned:n}=r,{rowIndex:o,rowPinned:d}=a;if("top"===n){if("top"===d)continue;e=0}if("bottom"===d){if("bottom"===n)continue;o=this.beans.pageBounds.getLastRow()}void 0!==e&&(i=Math.min(i,e)),void 0!==o&&(s=Math.max(s,o))}if(i===Number.MAX_VALUE||s===-Number.MAX_VALUE)return{columns:[]};let r=Array.from(t);return{columns:r,startColumn:r[0],startRow:{rowIndex:i,rowPinned:void 0},endRow:{rowIndex:s,rowPinned:void 0}}}generateId(){return`id-${Math.random().toString(36).substring(2,18)}`}createCellRange(e,t){let i=t?{rowStartIndex:null,rowStartPinned:void 0,rowEndIndex:null,rowEndPinned:void 0,columns:this.visibleCols.allCols.map(e=>e.getColId())}:e,s=i&&this.rangeSvc?.createPartialCellRangeFromRangeParams(i,!0);return s||(0,m._warn)(127,{allRange:t}),s}destroy(){for(let e of this.activeCharts)e.destroyChart();super.destroy()}};function pg(e){return e?.match(/\d+\.\d+\.\d+/)}function pm({type:e,gridVersion:t,chartsVersion:i}){let s="AG Grid: AG Grid version is incompatible. Please see https://www.ag-grid.com/javascript-data-grid/modules/ for more information.";if(!t)return s;let r=function(e){if(!e||!pg(e))return;let[t,i]=e.split(".")||[],s=`${t}.${i}.x`,r=parseInt(t,10)-28+6;if(!(r<0))return{gridMajorMinor:s,chartsMajorMinor:`${r}.${i}.x`}}(t);if(!r)return s;let{gridMajorMinor:a,chartsMajorMinor:l}=r;return"incompatible"===e?`AG Grid version ${t} and AG Charts version ${i} is not supported. AG Grid version ${a} should be used with AG Chart ${l}. Please see https://www.ag-grid.com/javascript-data-grid/modules/ for more information.`:"invalidCharts"===e?`AG Grid version ${a} should be used with AG Chart ${l} not ${i}. Please see https://www.ag-grid.com/javascript-data-grid/modules/ for more information.`:s}var pf={linked:"linked",unlinked:"unlinked",chartsMenu:"menu-alt",chartsDownload:"save",chartsMenuEdit:"chart",chartsMenuAdvancedSettings:"settings",chartsMenuAdd:"plus",chartsColorPicker:"small-down",chartsThemePrevious:"previous",chartsThemeNext:"next"},pC={getChartModels:function(e){return e.frameworkOverrides.wrapIncoming(()=>e.chartSvc?.getChartModels())},getChartRef:function(e,t){return e.frameworkOverrides.wrapIncoming(()=>e.chartSvc?.getChartRef(t))},getChartImageDataURL:function(e,t){return e.frameworkOverrides.wrapIncoming(()=>e.chartSvc?.getChartImageDataURL(t))},downloadChart:function(e,t){return e.frameworkOverrides.wrapIncoming(()=>e.chartSvc?.downloadChart(t))},openChartToolPanel:function(e,t){return e.frameworkOverrides.wrapIncoming(()=>e.chartSvc?.openChartToolPanel(t))},closeChartToolPanel:function(e,t){return e.frameworkOverrides.wrapIncoming(()=>e.chartSvc?.closeChartToolPanel(t.chartId))},createRangeChart:function(e,t){return e.frameworkOverrides.wrapIncoming(()=>e.chartSvc?.createRangeChart(t,!0))},createPivotChart:function(e,t){return e.frameworkOverrides.wrapIncoming(()=>e.chartSvc?.createPivotChart(t,!0))},createCrossFilterChart:function(e,t){return e.frameworkOverrides.wrapIncoming(()=>e.chartSvc?.createCrossFilterChart(t,!0))},updateChart:function(e,t){return e.frameworkOverrides.wrapIncoming(()=>e.chartSvc?.updateChart(t))},restoreChart:function(e,t,i){return e.frameworkOverrides.wrapIncoming(()=>e.chartSvc?.restoreChart(t,i))}},pv=[nr,tb,m._SharedDragAndDropModule,m._PopupModule,sm],pb=[m.AllCommunityModule,lf,s8,r3,lK,l$,lJ,rC,{moduleName:"ContextMenu",version:tv,beans:[ro],apiFunctions:{showContextMenu:function(e,t){let{contextMenuSvc:i}=e;if(!i)return;let{rowNode:s,column:r,value:a,x:l,y:n}=t||{},{x:o,y:d}=i.getContextMenuPosition(s,r);null!=l&&(o=l),null!=n&&(d=n),i.showContextMenu({mouseEvent:new MouseEvent("mousedown",{clientX:o,clientY:d}),rowNode:s,column:r,value:a,source:"api"})}},dependsOn:[rf]},nr,rb,lw,ld,lh,lu,nV,n_,{moduleName:"Formula",version:tv,userComponents:{agFormulaCellEditor:oS},beans:[dC,ox,oF],dependsOn:[lw],css:['.formula-error:after{background-color:var(--ag-invalid-color);content:"";height:12px;position:absolute;top:-6px;width:12px}:where(.ag-ltr) .formula-error:after{right:-6px;transform:rotate(45deg)}:where(.ag-rtl) .formula-error:after{left:-6px;transform:rotate(-45deg)}']},r_,an,iT,sp,r5,{moduleName:"ViewportRowModel",version:tv,rowModels:["viewport"],beans:[lc],dependsOn:[tb]},{moduleName:"Pivot",version:tv,rowModels:["clientSide"],beans:[nu],dependsOn:[nc,ld,a6]},{moduleName:"TreeData",version:tv,dynamicBeans:{treeGroupStrategy:nm},rowModels:["clientSide"],dependsOn:[nb,aP,a6,a7]},{moduleName:"Find",version:tv,apiFunctions:{findGetTotalMatches:function(e){return e.findSvc?.totalMatches??0},findGoTo:function(e,t,i){e.findSvc?.goTo(t,i)},findNext:function(e){e.findSvc?.next()},findPrevious:function(e){e.findSvc?.previous()},findGetActiveMatch:function(e){return e.findSvc?.activeMatch},findGetNumMatches:function(e,t){let{node:i,column:s}=t;return e.findSvc?.getNumMatches(i,s)??0},findGetParts:function(e,t){return e.findSvc?.getParts(t)??[]},findClearActive:function(e){e.findSvc?.clearActive()},findRefresh:function(e){return e.findSvc?.refresh(!0)}},dependsOn:[tb,{moduleName:"FindCore",version:tv,rowModels:["clientSide"],beans:[dR],userComponents:{agFindCellRenderer:dF},css:[".ag-find-cell{display:block;overflow:hidden;text-overflow:ellipsis}.ag-find-match{background-color:var(--ag-find-match-background-color);color:var(--ag-find-match-color)}.ag-find-active-match{background-color:var(--ag-find-active-match-background-color);color:var(--ag-find-active-match-color)}"]}]},dT,i6],py="AllEnterprise";g.ModuleRegistry.registerModules([g.AllCommunityModule,{with:e=>{let t;return{moduleName:py,version:tv,dependsOn:[...pb,(e=>{if(e.setup(),e.setGridContext?.(!0),e.isEnterprise&&e.setLicenseKey){let t={setLicenseKey:e.setLicenseKey};v.setChartsLicenseManager(t)}return{moduleName:"IntegratedCharts",version:tv,icons:pf,apiFunctions:pC,dependsOn:pv,css:['.ag-chart{display:flex;height:100%;position:relative;width:100%}.ag-chart-components-wrapper{display:flex}.ag-chart-canvas-wrapper,.ag-chart-components-wrapper{flex:1 1 auto;position:relative}.ag-chart-menu{background:var(--ag-background-color);background-color:color-mix(in srgb,transparent,var(--ag-background-color) 30%);border-radius:var(--ag-border-radius);display:flex;flex-direction:row;gap:20px;padding:4px 2px;position:absolute;top:8px;width:auto;--ag-icon-size:20px}:where(.ag-ltr) .ag-chart-menu{justify-content:right;right:calc(var(--ag-cell-horizontal-padding) + var(--ag-spacing) - 4px)}:where(.ag-rtl) .ag-chart-menu{justify-content:left;left:calc(var(--ag-cell-horizontal-padding) + var(--ag-spacing) - 4px)}.ag-chart-docked-container{min-width:var(--ag-chart-menu-panel-width);position:relative}:where(.ag-chart-menu-hidden)~.ag-chart-docked-container{display:none}.ag-chart-tabbed-menu{display:flex;flex-direction:column;height:100%;overflow:hidden;width:100%}.ag-chart-tabbed-menu-header{cursor:default;flex:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.ag-chart-tabbed-menu-body{align-items:stretch;display:flex;flex:1 1 auto;overflow:hidden;position:relative}.ag-chart-tabbed-menu-body:after{background:linear-gradient(var(--ag-background-color),transparent);content:"";display:block;height:16px;left:0;position:absolute;right:0;top:0}.ag-chart-tab{overflow:hidden;overflow-y:auto;width:100%}.ag-chart-settings{overflow-x:hidden}.ag-chart-settings-wrapper{display:flex;flex-direction:column;height:100%;overflow:hidden;position:relative;width:100%}.ag-chart-settings-nav-bar{align-items:center;border-top:solid var(--ag-border-width) var(--ag-border-color);display:flex;height:30px;padding:0 10px;-webkit-user-select:none;-moz-user-select:none;user-select:none;width:100%}.ag-chart-settings-card-selector{align-items:center;display:flex;flex:1 1 auto;height:100%;justify-content:space-around;padding:0 10px}.ag-chart-settings-card-item{background-color:var(--ag-foreground-color);border-radius:4px;cursor:pointer;height:8px;position:relative;width:8px;&.ag-not-selected{opacity:.2}&.ag-selected{background-color:var(--ag-accent-color)}}.ag-chart-settings-card-item:before{background-color:transparent;content:" ";display:block;height:20px;left:50%;margin-left:-10px;margin-top:-10px;position:absolute;top:50%;width:20px}.ag-chart-settings-next,.ag-chart-settings-prev{flex:none;position:relative}.ag-chart-settings-next:focus-within,.ag-chart-settings-prev:focus-within{border-radius:1px;box-shadow:var(--ag-focus-shadow)}.ag-chart-settings-next-button,.ag-chart-settings-prev-button{cursor:pointer;height:100%;left:0;opacity:0;position:absolute;top:0;width:100%}.ag-chart-settings-mini-charts-container{flex:1 1 auto;overflow:hidden auto;position:relative}.ag-chart-settings-mini-wrapper{display:flex;flex-direction:column;left:0;min-height:100%;overflow:hidden;padding-bottom:var(--ag-widget-container-vertical-padding);position:absolute;top:0;width:100%;&.ag-animating{transition:left .3s;transition-timing-function:ease-in-out}}.ag-chart-mini-thumbnail{border:solid var(--ag-border-width) var(--ag-border-color);border-radius:5px;cursor:pointer;padding:1px;&.ag-selected{border-color:var(--ag-accent-color);border-width:calc(var(--ag-border-width) + 1px);padding:unset}&:focus-visible{border-color:var(--ag-accent-color);box-shadow:var(--ag-focus-shadow)}}.ag-chart-mini-thumbnail-canvas{display:block}.ag-chart-advanced-settings-wrapper,.ag-chart-data-wrapper,.ag-chart-format-wrapper{display:flex;flex-direction:column;padding-bottom:16px;position:relative;-webkit-user-select:none;-moz-user-select:none;user-select:none}.ag-chart-advanced-settings-wrapper,.ag-chart-data-wrapper{height:100%;overflow-y:auto}.ag-chart-advanced-settings{background-color:var(--ag-chrome-background-color)}.ag-chart-advanced-settings,.ag-chart-advanced-settings-wrapper{width:100%}.ag-chart-advanced-settings-wrapper{padding-bottom:0}.ag-chart-advanced-settings-section{border-bottom:solid var(--ag-border-width) var(--ag-border-color);display:flex;margin:0;padding-bottom:var(--ag-widget-container-vertical-padding);padding-top:var(--ag-widget-container-vertical-padding)}.ag-chart-empty-text{align-items:center;background-color:var(--ag-background-color);display:flex;height:100%;justify-content:center;top:0;width:100%}.ag-charts-font-size-color{align-self:stretch;display:flex;justify-content:space-between}.ag-chart-menu-icon{border-radius:var(--ag-border-radius);cursor:pointer;margin:2px 0;opacity:.8}.ag-chart-menu-icon:hover{opacity:1}.ag-chart-menu-toolbar-button{background-color:unset;border:0;border-radius:1px;padding:0 2px}.ag-chart-data-column-drag-handle{margin-left:var(--ag-spacing)}.ag-chart-data-section,.ag-chart-format-section{display:flex;margin:0;:where(.ag-label:not(.ag-group-title-bar)){color:var(--ag-chart-menu-label-color)}:where(.ag-label-align-top .ag-label){margin-bottom:var(--ag-widget-vertical-spacing);margin-top:calc(var(--ag-widget-vertical-spacing)*.5)}:where(.ag-slider.ag-label-align-top .ag-label){margin-bottom:0}.ag-label{display:inline-block}}.ag-chart-menu-panel{--ag-panel-background-color:var(--ag-chrome-background-color)}:where(.ag-ltr) .ag-chart-menu-panel{border-left:solid var(--ag-border-width) var(--ag-border-color)}:where(.ag-rtl) .ag-chart-menu-panel{border-right:solid var(--ag-border-width) var(--ag-border-color)}.ag-chart-data-wrapper,.ag-chart-format-wrapper{margin:0;padding:0}.ag-group{.ag-charts-data-group-item{padding-bottom:var(--ag-widget-container-vertical-padding);position:relative}.ag-charts-data-group-item:where(:not(:last-child)){margin-bottom:var(--ag-spacing)}.ag-charts-advanced-settings-top-level-group-title-bar{background-color:unset;position:relative}.ag-charts-data-group-item:where(:not(.ag-charts-format-sub-level-group,.ag-pill-select,.ag-select)){height:var(--ag-list-item-height)}.ag-charts-data-group-item:where(.ag-picker-field){margin-top:var(--ag-spacing)}.ag-charts-advanced-settings-top-level-group-item,.ag-charts-format-top-level-group-item{margin:var(--ag-spacing) 0}.ag-charts-format-sub-level-group-container{display:flex;flex-direction:column;padding:var(--ag-widget-vertical-spacing) 0}.ag-charts-settings-group-container{border-top:none;display:grid;font-weight:500;grid-template-columns:60px 1fr 60px 1fr 60px;row-gap:8px;:where(.ag-chart-mini-thumbnail:nth-child(3n+1)){grid-column:1}:where(.ag-chart-mini-thumbnail:nth-child(3n+2)){grid-column:3}:where(.ag-chart-mini-thumbnail:nth-child(3n+3)){grid-column:5}}.ag-charts-data-group-title-bar,.ag-charts-format-top-level-group-title-bar,.ag-charts-settings-group-title-bar{border-top:none;font-weight:500;margin:0;padding:var(--ag-widget-container-vertical-padding) var(--ag-widget-container-horizontal-padding);position:relative}.ag-charts-format-sub-level-group-title-bar{background:none;font-weight:500;padding:var(--ag-widget-vertical-spacing) 0}&.ag-charts-data-group,&.ag-charts-format-top-level-group{border-top:solid var(--ag-border-width) var(--ag-border-color)}.ag-charts-data-group-container,.ag-charts-format-top-level-group-container,.ag-charts-settings-group-container{margin:0;padding:0 var(--ag-widget-container-horizontal-padding)}.ag-charts-format-sub-level-group-item,.ag-charts-format-sub-level-no-header-group-item,.ag-charts-format-top-level-group-item{margin-bottom:var(--ag-widget-vertical-spacing)}&.ag-charts-format-sub-level-group,&.ag-charts-format-top-level-group,.ag-charts-format-sub-level-group-item:last-child,.ag-charts-format-top-level-group-item{margin:0;padding:0}.ag-charts-advanced-settings-top-level-group-container{margin:0}.ag-charts-advanced-settings-top-level-group-container,.ag-charts-advanced-settings-top-level-group-title-bar{padding:0 var(--ag-widget-container-horizontal-padding)}.ag-charts-advanced-settings-top-level-group-item{margin-bottom:0;margin-top:calc(var(--ag-widget-vertical-spacing)*2)}}.ag-chart-settings-card-item.ag-not-selected:hover{opacity:.35}.ag-angle-select{align-items:center;display:flex}.ag-angle-select-wrapper{display:flex}.ag-angle-select-parent-circle{background-color:var(--ag-background-color);border:solid var(--ag-border-width) var(--ag-border-color);border-radius:12px;display:block;height:24px;position:relative;width:24px}.ag-angle-select-child-circle{background-color:var(--ag-foreground-color);border-radius:3px;height:6px;left:12px;margin-left:-3px;margin-top:-4px;position:absolute;top:4px;width:6px}.ag-slider-wrapper{display:flex;:where(.ag-input-field){flex:1 1 auto}}.ag-color-panel{display:flex;flex-direction:column;padding:var(--ag-spacing);text-align:center;width:100%}.ag-spectrum-color{cursor:default;flex:1 1 auto;overflow:visible;position:relative}.ag-spectrum-color,.ag-spectrum-fill{border-radius:var(--ag-border-radius)}.ag-spectrum-fill{inset:0;position:absolute}.ag-spectrum-val{background-image:linear-gradient(0deg,#000,hsla(20,42%,65%,0));cursor:pointer}.ag-spectrum-dragger{background:#000;border:var(--ag-color-picker-thumb-border-width) solid #fff;border-radius:var(--ag-color-picker-thumb-size);box-shadow:0 0 2px 0 rgba(0,0,0,.24);cursor:pointer;height:var(--ag-color-picker-thumb-size);pointer-events:none;position:absolute;width:var(--ag-color-picker-thumb-size)}.ag-spectrum-alpha,.ag-spectrum-hue{cursor:default}.ag-spectrum-hue-background{background:linear-gradient(270deg,red 3%,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red);height:100%;width:100%}.ag-spectrum-alpha-background{background:linear-gradient(to right,var(--ag-internal-spectrum-alpha-color-from),var(--ag-internal-spectrum-alpha-color-to)),url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="4" height="4"><rect x="0" y="0" width="4" height="4" fill="%23fff"/><path d="M0 0H2V4H4V2H0Z" fill="%23b2b2b2"/></svg>\') 0 0 /4px 4px;height:100%;width:100%}.ag-spectrum-tool{cursor:pointer;height:var(--ag-color-picker-track-size);margin-bottom:10px;position:relative}.ag-spectrum-slider,.ag-spectrum-tool{border-radius:var(--ag-color-picker-thumb-size)}.ag-spectrum-slider{border:var(--ag-color-picker-thumb-border-width) solid #fff;box-shadow:0 1px 4px 0 rgba(0,0,0,.37);height:var(--ag-color-picker-thumb-size);margin-top:calc(var(--ag-color-picker-track-size)/2*-1 + var(--ag-color-picker-thumb-size)/2*-1);pointer-events:none;position:absolute;width:var(--ag-color-picker-thumb-size)}:where(.ag-spectrum-alpha) .ag-spectrum-slider{background:linear-gradient(to bottom,var(--ag-internal-spectrum-alpha-color),var(--ag-internal-spectrum-alpha-color)) var(--ag-background-color)}.ag-recent-colors{display:flex;gap:6px;margin:10px var(--ag-spacing) 2px}.ag-recent-color{border:solid var(--ag-border-width) var(--ag-border-color);cursor:pointer}.ag-angle-select[disabled]{opacity:.5;pointer-events:none}:where(.ag-ltr) .ag-angle-select-field,:where(.ag-ltr) .ag-slider-field{margin-right:calc(var(--ag-spacing)*2)}:where(.ag-rtl) .ag-angle-select-field,:where(.ag-rtl) .ag-slider-field{margin-left:calc(var(--ag-spacing)*2)}.ag-color-dialog{border-radius:5px}:where(.ag-color-picker){.ag-picker-field-wrapper{padding-left:var(--ag-spacing);padding-right:var(--ag-spacing)}.ag-picker-field-display{align-items:center;display:flex;flex-direction:row;min-height:var(--ag-list-item-height)}}:where(.ag-ltr) .ag-color-picker-color,:where(.ag-ltr) .ag-color-picker-value{margin-right:var(--ag-spacing)}:where(.ag-rtl) .ag-color-picker-color,:where(.ag-rtl) .ag-color-picker-value{margin-left:var(--ag-spacing)}.ag-spectrum-tools{padding:10px 0 0}.ag-spectrum-alpha-background,.ag-spectrum-hue-background{border-radius:var(--ag-color-picker-track-border-radius)}.ag-color-input-color,.ag-color-picker-color,.ag-recent-color{border-radius:var(--ag-color-picker-color-border-radius)}.ag-spectrum-sat{background-image:linear-gradient(90deg,#fff,hsla(20,42%,65%,0))}.ag-recent-color,.ag-spectrum-color,.ag-spectrum-slider{&:where(:not(:disabled,[readonly])):focus-visible{box-shadow:var(--ag-focus-shadow)}}.ag-color-input-color,.ag-color-picker-color{border:solid var(--ag-border-width) var(--ag-border-color);height:var(--ag-icon-size);width:var(--ag-icon-size)}:where(.ag-ltr) .ag-color-input .ag-input-field-input{padding-left:calc(var(--ag-icon-size) + var(--ag-spacing)*2)}:where(.ag-rtl) .ag-color-input .ag-input-field-input{padding-right:calc(var(--ag-icon-size) + var(--ag-spacing)*2)}:where(.ag-color-input) .ag-color-input-color{position:absolute}:where(.ag-ltr) :where(.ag-color-input) .ag-color-input-color{margin-left:var(--ag-spacing)}:where(.ag-rtl) :where(.ag-color-input) .ag-color-input-color{margin-right:var(--ag-spacing)}.ag-range-field{align-items:center;display:flex;:where(.ag-input-wrapper){height:100%}}.ag-range-field-input{-webkit-appearance:none;-moz-appearance:none;appearance:none;background:none;height:100%;overflow:visible;padding:0;width:100%;&:disabled{opacity:.5}}.ag-range-field-input{&::-webkit-slider-runnable-track{background-color:var(--ag-border-color);border-radius:1.5px;height:3px;margin:0;padding:0;width:100%}&::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;background-color:var(--ag-background-color);border:solid var(--ag-border-width) var(--ag-border-color);border-radius:100%;height:var(--ag-icon-size);margin:0;padding:0;transform:translateY(calc(var(--ag-icon-size)*-.5 + 1.5px));width:var(--ag-icon-size)}&:focus::-webkit-slider-thumb{border-color:var(--ag-accent-color);box-shadow:var(--ag-focus-shadow)}&:active::-webkit-slider-runnable-track{background-color:var(--ag-accent-color)}}.ag-range-field-input{&::-moz-range-track{background-color:var(--ag-border-color);border-radius:1.5px;height:3px;margin:0;padding:0;width:100%}&::-moz-ag-range-thumb{-moz-appearance:none;appearance:none;background-color:var(--ag-background-color);border:solid var(--ag-border-width) var(--ag-border-color);border-radius:100%;height:var(--ag-icon-size);margin:0;padding:0;transform:translateY(calc(var(--ag-icon-size)*-.5 + 1.5px));width:var(--ag-icon-size)}&:focus::-moz-ag-range-thumb{border-color:var(--ag-accent-color);box-shadow:var(--ag-focus-shadow)}&:active::-moz-ag-range-track{background-color:var(--ag-accent-color)}}'],validate:()=>(function({gridVersion:e,chartsVersion:t}){if(!pg(t))return{isValid:!1,message:pm({type:"invalidCharts",gridVersion:e,chartsVersion:t})};if(!pg(e))return{isValid:!1,message:pm({type:"invalidGrid",gridVersion:e,chartsVersion:t})};let[i,s]=e.split(".")||[],[r,a,l]=t.split(".")||[],n=function({gridMajorVersion:e,chartsMajorVersion:t}){let i=parseInt(e,10),s=parseInt(t,10),r=i-28;return r===s-6&&r>=0}({gridMajorVersion:i,chartsMajorVersion:r});return n&&s===a||l.includes("beta")?{isValid:!0}:n&&s===a?{isValid:!1,message:pm({type:"invalid",gridVersion:e,chartsVersion:t})}:{isValid:!1,message:pm({type:"incompatible",gridVersion:e,chartsVersion:t})}})({gridVersion:tv,chartsVersion:e.VERSION}),beans:[dP.bind(null,e),pp,hD,hM,hF,hI,hc,hS]}})(e),((t=e).setup(),{moduleName:"Sparklines",version:tv,dependsOn:[tb],css:[".ag-sparkline-wrapper{height:100%;line-height:normal;position:absolute;top:0;width:100%}"],userComponents:{agSparklineCellRenderer:{classImp:dS,params:{createSparkline:t.createSparkline}}},validate:()=>({isValid:!0})})]}},moduleName:py,version:tv,dependsOn:pb}]);let pw=({title:e,description:t,children:i})=>(0,u.jsxs)("section",{className:"rounded-lg border border-zinc-200 bg-white p-6 shadow-sm dark:border-zinc-700 dark:bg-zinc-800",children:[(0,u.jsx)("h2",{className:"mb-2 text-lg font-semibold text-zinc-900 dark:text-zinc-100",children:e}),(0,u.jsx)("p",{className:"mb-4 text-sm text-zinc-500 dark:text-zinc-400",children:t}),i]}),pS=[{account:"ACC-1001",name:"Nora Whitfield",country:"United States",totalCalls:4,callRecords:[{callId:"C-2001",direction:"Outbound",number:"555-1234",duration:120,switchCode:"SW-A"},{callId:"C-2002",direction:"Inbound",number:"555-5678",duration:45,switchCode:"SW-B"},{callId:"C-2003",direction:"Outbound",number:"555-8765",duration:200,switchCode:"SW-A"},{callId:"C-2004",direction:"Inbound",number:"555-4321",duration:60,switchCode:"SW-C"}]},{account:"ACC-1002",name:"James Thornton",country:"Canada",totalCalls:3,callRecords:[{callId:"C-3001",direction:"Outbound",number:"555-1111",duration:90,switchCode:"SW-A"},{callId:"C-3002",direction:"Inbound",number:"555-2222",duration:150,switchCode:"SW-B"},{callId:"C-3003",direction:"Outbound",number:"555-3333",duration:30,switchCode:"SW-C"}]},{account:"ACC-1003",name:"Sofia Alvarez",country:"Mexico",totalCalls:2,callRecords:[{callId:"C-4001",direction:"Inbound",number:"555-4444",duration:180,switchCode:"SW-A"},{callId:"C-4002",direction:"Outbound",number:"555-5555",duration:75,switchCode:"SW-B"}]},{account:"ACC-1004",name:"Liam Chen",country:"Australia",totalCalls:5,callRecords:[{callId:"C-5001",direction:"Outbound",number:"555-6666",duration:300,switchCode:"SW-A"},{callId:"C-5002",direction:"Inbound",number:"555-7777",duration:110,switchCode:"SW-B"},{callId:"C-5003",direction:"Outbound",number:"555-8888",duration:55,switchCode:"SW-C"},{callId:"C-5004",direction:"Inbound",number:"555-9999",duration:220,switchCode:"SW-A"},{callId:"C-5005",direction:"Outbound",number:"555-0000",duration:40,switchCode:"SW-B"}]},{account:"ACC-1005",name:"Emma Johansson",country:"Sweden",totalCalls:1,callRecords:[{callId:"C-6001",direction:"Inbound",number:"555-1010",duration:95,switchCode:"SW-C"}]}],px=()=>{let e=(0,c.useMemo)(()=>pS,[]),t=(0,c.useMemo)(()=>[{field:"account",headerName:"Account",cellRenderer:"agGroupCellRenderer"},{field:"name",headerName:"Name"},{field:"country",headerName:"Country"},{field:"totalCalls",headerName:"Total Calls"}],[]),i=(0,c.useMemo)(()=>({detailGridOptions:{columnDefs:[{field:"callId",headerName:"Call ID"},{field:"direction",headerName:"Direction"},{field:"number",headerName:"Number",minWidth:150},{field:"duration",headerName:"Duration (s)",valueFormatter:e=>e.value?`${e.value}s`:""},{field:"switchCode",headerName:"Switch"}],defaultColDef:{flex:1,sortable:!0}},getDetailRowData:e=>{e.successCallback(e.data.callRecords)}}),[]),s=(0,c.useCallback)(e=>{setTimeout(()=>{e.api.getDisplayedRowAtIndex(0)?.setExpanded(!0)},0)},[]);return(0,u.jsx)("div",{className:"ag-theme-quartz",style:{height:400},children:(0,u.jsx)(p.AgGridReact,{theme:g.themeQuartz,rowData:e,columnDefs:t,masterDetail:!0,detailCellRendererParams:i,detailRowHeight:300,defaultColDef:{flex:1,sortable:!0,resizable:!0},onFirstDataRendered:s})})},pF=[{name:"Desktop",type:"folder",size:"--",created:"2023-01-15",modified:"2024-12-01",children:[{name:"Documents",type:"folder",size:"--",created:"2023-02-10",modified:"2024-11-28",children:[{name:"Reports",type:"folder",size:"--",created:"2023-06-01",modified:"2024-10-15",children:[{name:"Q1-Report.pdf",type:"file",size:"2.4 MB",created:"2024-04-01",modified:"2024-04-01"},{name:"Q2-Report.pdf",type:"file",size:"3.1 MB",created:"2024-07-01",modified:"2024-07-15"},{name:"Q3-Report.pdf",type:"file",size:"2.8 MB",created:"2024-10-01",modified:"2024-10-05"}]},{name:"Resume.docx",type:"file",size:"450 KB",created:"2023-03-22",modified:"2024-09-10"},{name:"Budget.xlsx",type:"file",size:"1.2 MB",created:"2023-05-14",modified:"2024-11-20"}]},{name:"Images",type:"folder",size:"--",created:"2023-04-18",modified:"2024-08-30",children:[{name:"vacation-photo.jpg",type:"file",size:"5.6 MB",created:"2024-06-15",modified:"2024-06-15"},{name:"screenshot.png",type:"file",size:"1.8 MB",created:"2024-08-30",modified:"2024-08-30"}]},{name:"notes.txt",type:"file",size:"12 KB",created:"2023-01-20",modified:"2024-12-01"}]},{name:"Downloads",type:"folder",size:"--",created:"2023-01-15",modified:"2024-11-30",children:[{name:"installer.exe",type:"file",size:"45.2 MB",created:"2024-11-15",modified:"2024-11-15"},{name:"dataset.csv",type:"file",size:"8.9 MB",created:"2024-11-28",modified:"2024-11-28"},{name:"ebook.pdf",type:"file",size:"14.3 MB",created:"2024-11-30",modified:"2024-11-30"}]},{name:"Projects",type:"folder",size:"--",created:"2023-08-01",modified:"2024-12-05",children:[{name:"web-app",type:"folder",size:"--",created:"2023-08-15",modified:"2024-12-05",children:[{name:"index.html",type:"file",size:"8 KB",created:"2023-08-15",modified:"2024-12-05"},{name:"styles.css",type:"file",size:"24 KB",created:"2023-08-15",modified:"2024-11-20"},{name:"app.js",type:"file",size:"56 KB",created:"2023-08-15",modified:"2024-12-01"}]},{name:"README.md",type:"file",size:"3 KB",created:"2023-08-01",modified:"2024-10-10"}]}],pA=()=>{let e=(0,c.useMemo)(()=>pF,[]),t=(0,c.useMemo)(()=>[{field:"size",headerName:"Size",width:120},{field:"type",headerName:"Type",width:100},{field:"created",headerName:"Created",width:140},{field:"modified",headerName:"Modified",width:140}],[]),i=(0,c.useMemo)(()=>({headerName:"Name",minWidth:300,flex:1,cellRendererParams:{suppressCount:!0}}),[]);return(0,u.jsx)("div",{className:"ag-theme-quartz",style:{height:400},children:(0,u.jsx)(p.AgGridReact,{theme:g.themeQuartz,rowData:e,columnDefs:t,treeData:!0,treeDataChildrenField:"children",autoGroupColumnDef:i,groupDefaultExpanded:1,defaultColDef:{sortable:!0,resizable:!0}})})},pM=()=>[{id:1,task:"Design system architecture",priority:"High",status:"In Progress",assignee:"Alice"},{id:2,task:"Set up CI/CD pipeline",priority:"High",status:"Done",assignee:"Bob"},{id:3,task:"Write unit tests",priority:"Medium",status:"To Do",assignee:"Charlie"},{id:4,task:"Create API documentation",priority:"Low",status:"To Do",assignee:"Diana"},{id:5,task:"Implement authentication",priority:"High",status:"In Progress",assignee:"Eve"},{id:6,task:"Database migration",priority:"Medium",status:"Done",assignee:"Frank"},{id:7,task:"Performance optimization",priority:"Medium",status:"To Do",assignee:"Grace"},{id:8,task:"Security audit",priority:"High",status:"To Do",assignee:"Henry"},{id:9,task:"User acceptance testing",priority:"Low",status:"To Do",assignee:"Ivy"},{id:10,task:"Deploy to production",priority:"High",status:"To Do",assignee:"Jack"}],pR=()=>{let[e]=(0,c.useState)(pM),t=(0,c.useMemo)(()=>[{field:"task",headerName:"Task",rowDrag:!0,flex:2},{field:"priority",headerName:"Priority",width:120},{field:"status",headerName:"Status",width:130},{field:"assignee",headerName:"Assignee",width:120}],[]);return(0,u.jsx)("div",{className:"ag-theme-quartz",style:{height:350},children:(0,u.jsx)(p.AgGridReact,{theme:g.themeQuartz,rowData:e,columnDefs:t,rowDragManaged:!0,defaultColDef:{sortable:!0,resizable:!0}})})},pT=[{section:"header",jan:"Warehouse Alpha - Monthly Report"},{section:"quarters",jan:"Q1",apr:"Q2"},{jan:534,feb:612,mar:243,apr:231,may:428,jun:197},{jan:765,feb:146,mar:389,apr:512,may:328,jun:275},{jan:335,feb:422,mar:198,apr:367,may:289,jun:441},{jan:289,feb:342,mar:476,apr:198,may:564,jun:312},{section:"header",jan:"Warehouse Beta - Monthly Report"},{section:"quarters",jan:"Q1",apr:"Q2"},{jan:121,feb:212,mar:324,apr:431,may:228,jun:131},{jan:221,feb:312,mar:124,apr:231,may:328,jun:231},{jan:182,feb:262,mar:224,apr:331,may:178,jun:291},{jan:98,feb:132,mar:274,apr:189,may:348,jun:221}],pP=()=>{let e=(0,c.useMemo)(()=>pT,[]),t=(0,c.useMemo)(()=>[{headerName:"Jan",field:"jan",colSpan:e=>{let t=e.data;return"header"===t.section?6:"quarters"===t.section?3:1},cellStyle:e=>"header"===e.data.section?{backgroundColor:"#2244cc22",fontWeight:"bold",fontSize:"16px",textAlign:"center"}:"quarters"===e.data.section?{backgroundColor:"#2244cc11",fontWeight:"bold"}:void 0},{headerName:"Feb",field:"feb"},{headerName:"Mar",field:"mar"},{headerName:"Apr",field:"apr",colSpan:e=>"quarters"===e.data.section?3:1,cellStyle:e=>"quarters"===e.data.section?{backgroundColor:"#2244cc11",fontWeight:"bold"}:null},{headerName:"May",field:"may"},{headerName:"Jun",field:"jun"}],[]),i=(0,c.useCallback)(e=>{if("header"===e.data.section)return 50},[]);return(0,u.jsx)("div",{className:"ag-theme-quartz",style:{height:350},children:(0,u.jsx)(p.AgGridReact,{theme:g.themeQuartz,rowData:e,columnDefs:t,getRowHeight:i,defaultColDef:{width:120,sortable:!1,suppressMovable:!0}})})},pI=[{region:"North",product:"Widget Pro",amount:15400,quantity:120,date:"2024-01-15",salesperson:"Alice Chen"},{region:"South",product:"Gadget Plus",amount:22300,quantity:85,date:"2024-02-20",salesperson:"Bob Martinez"},{region:"East",product:"Widget Pro",amount:18700,quantity:145,date:"2024-03-10",salesperson:"Carol Kim"},{region:"West",product:"Service Elite",amount:31200,quantity:62,date:"2024-04-05",salesperson:"David Lee"},{region:"North",product:"Gadget Plus",amount:12800,quantity:98,date:"2024-05-18",salesperson:"Emma Davis"},{region:"South",product:"Widget Pro",amount:28900,quantity:210,date:"2024-06-22",salesperson:"Frank Wilson"},{region:"East",product:"Service Elite",amount:45600,quantity:38,date:"2024-07-14",salesperson:"Grace Park"},{region:"West",product:"Gadget Plus",amount:19500,quantity:110,date:"2024-08-30",salesperson:"Henry Brown"},{region:"North",product:"Service Elite",amount:36700,quantity:45,date:"2024-09-12",salesperson:"Ivy Johnson"},{region:"South",product:"Widget Pro",amount:14200,quantity:102,date:"2024-10-25",salesperson:"Jack Smith"},{region:"East",product:"Gadget Plus",amount:21100,quantity:76,date:"2024-11-08",salesperson:"Karen White"},{region:"West",product:"Widget Pro",amount:33400,quantity:180,date:"2024-12-01",salesperson:"Leo Garcia"}],pE=()=>{let e=(0,c.useRef)(null),t=(0,c.useMemo)(()=>pI,[]),i=(0,c.useMemo)(()=>[{field:"region",headerName:"Region",width:110},{field:"product",headerName:"Product",flex:1},{field:"amount",headerName:"Amount",width:130,valueFormatter:e=>e.value?.toLocaleString("en-US",{style:"currency",currency:"USD"})},{field:"quantity",headerName:"Qty",width:90},{field:"date",headerName:"Date",width:130},{field:"salesperson",headerName:"Salesperson",flex:1}],[]),s=(0,c.useCallback)(()=>{e.current?.api.exportDataAsCsv()},[]),r=(0,c.useCallback)(()=>{e.current?.api.exportDataAsExcel()},[]);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("div",{className:"mb-3 flex gap-2",children:[(0,u.jsx)("button",{onClick:s,className:"rounded-md bg-emerald-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2",children:"Export CSV"}),(0,u.jsx)("button",{onClick:r,className:"rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:"Export Excel"})]}),(0,u.jsx)("div",{className:"ag-theme-quartz",style:{height:350},children:(0,u.jsx)(p.AgGridReact,{ref:e,theme:g.themeQuartz,rowData:t,columnDefs:i,defaultColDef:{sortable:!0,filter:!0,resizable:!0}})})]})},pD=[{id:1,name:"Alice Chen",email:"alice@company.com",department:"Engineering",role:"Senior Dev",phone:"555-0101"},{id:2,name:"Bob Martinez",email:"bob@company.com",department:"Sales",role:"Account Exec",phone:"555-0102"},{id:3,name:"Carol Kim",email:"carol@company.com",department:"Marketing",role:"Content Lead",phone:"555-0103"},{id:4,name:"David Lee",email:"david@company.com",department:"Engineering",role:"Staff Engineer",phone:"555-0104"},{id:5,name:"Emma Davis",email:"emma@company.com",department:"HR",role:"HR Manager",phone:"555-0105"},{id:6,name:"Frank Wilson",email:"frank@company.com",department:"Finance",role:"Controller",phone:"555-0106"},{id:7,name:"Grace Park",email:"grace@company.com",department:"Engineering",role:"Tech Lead",phone:"555-0107"},{id:8,name:"Henry Brown",email:"henry@company.com",department:"Operations",role:"Ops Manager",phone:"555-0108"}],pk=()=>{let e=(0,c.useMemo)(()=>pD,[]),t=(0,c.useMemo)(()=>[{field:"name",headerName:"Name",flex:1},{field:"email",headerName:"Email",flex:1},{field:"department",headerName:"Department",width:140},{field:"role",headerName:"Role",width:150},{field:"phone",headerName:"Phone",width:130}],[]),i=(0,c.useCallback)(e=>[{name:"Send Email",action:()=>{alert(`Sending email to ${e.node?.data?.email}`)},icon:'<span style="font-size: 16px;">&#9993;</span>'},{name:"View Profile",action:()=>{alert(`Profile: ${e.node?.data?.name}
Department: ${e.node?.data?.department}
Role: ${e.node?.data?.role}`)},icon:'<span style="font-size: 16px;">&#128100;</span>'},{name:"Call Employee",action:()=>{alert(`Calling ${e.node?.data?.name} at ${e.node?.data?.phone}`)},icon:'<span style="font-size: 16px;">&#9742;</span>'},"separator","copy","copyWithHeaders","separator","export"],[]);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:"mb-2 text-sm text-zinc-600 dark:text-zinc-400",children:"Right-click on any row to see custom context menu items."}),(0,u.jsx)("div",{className:"ag-theme-quartz",style:{height:350},children:(0,u.jsx)(p.AgGridReact,{theme:g.themeQuartz,rowData:e,columnDefs:t,getContextMenuItems:i,defaultColDef:{sortable:!0,resizable:!0}})})]})},pL=[{region:"North",product:"Widget A",revenue:45200,units:320,profit:12400},{region:"North",product:"Widget B",revenue:38100,units:280,profit:9800},{region:"South",product:"Widget A",revenue:52300,units:410,profit:15600},{region:"South",product:"Widget B",revenue:29700,units:195,profit:7200},{region:"East",product:"Widget A",revenue:61500,units:505,profit:18900},{region:"East",product:"Widget B",revenue:43800,units:355,profit:11300},{region:"West",product:"Widget A",revenue:37900,units:290,profit:9100},{region:"West",product:"Widget B",revenue:55200,units:440,profit:16700},{region:"North",product:"Gadget X",revenue:28400,units:160,profit:6500},{region:"South",product:"Gadget X",revenue:33100,units:210,profit:8200},{region:"East",product:"Gadget X",revenue:41600,units:300,profit:10800},{region:"West",product:"Gadget X",revenue:36900,units:265,profit:9400}],pN=()=>{let e=(0,c.useMemo)(()=>pL,[]),t=(0,c.useMemo)(()=>[{field:"region",headerName:"Region",width:120},{field:"product",headerName:"Product",width:130},{field:"revenue",headerName:"Revenue",width:140,valueFormatter:e=>e.value?.toLocaleString("en-US",{style:"currency",currency:"USD"})},{field:"units",headerName:"Units Sold",width:120},{field:"profit",headerName:"Profit",flex:1,valueFormatter:e=>e.value?.toLocaleString("en-US",{style:"currency",currency:"USD"})}],[]),i=(0,c.useMemo)(()=>({statusPanels:[{statusPanel:"agTotalRowCountComponent",align:"left"},{statusPanel:"agFilteredRowCountComponent",align:"left"},{statusPanel:"agSelectedRowCountComponent",align:"center"},{statusPanel:"agAggregationComponent",align:"right"}]}),[]);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:"mb-2 text-sm text-zinc-600 dark:text-zinc-400",children:"Select rows and observe the status bar at the bottom. Select numeric cells to see aggregation values."}),(0,u.jsx)("div",{className:"ag-theme-quartz",style:{height:350},children:(0,u.jsx)(p.AgGridReact,{theme:g.themeQuartz,rowData:e,columnDefs:t,statusBar:i,rowSelection:{mode:"multiRow",headerCheckbox:!0},defaultColDef:{sortable:!0,filter:!0,resizable:!0},cellSelection:!0})})]})},pG=[{ticker:"AAPL",open:182.63,high:184.95,low:181.48,close:184.25,volume:0x37894f4,change:1.62},{ticker:"MSFT",open:378.91,high:382.1,low:377.55,close:381.45,volume:0x1521600,change:2.54},{ticker:"GOOGL",open:141.8,high:143.25,low:140.92,close:142.65,volume:0x1211514,change:.85},{ticker:"AMZN",open:178.25,high:180.9,low:177.1,close:179.55,volume:0x2b8fe78,change:1.3},{ticker:"NVDA",open:875.4,high:892.15,low:870.25,close:888.7,volume:0x251c1f4,change:13.3},{ticker:"META",open:505.3,high:512.8,low:503.15,close:510.92,volume:0xe8768c,change:5.62},{ticker:"TSLA",open:248.5,high:255.3,low:246.8,close:253.18,volume:0x5811500,change:4.68},{ticker:"JPM",open:198.72,high:200.45,low:197.3,close:199.85,volume:8456200,change:1.13},{ticker:"V",open:278.6,high:281.3,low:277.15,close:280.45,volume:6789400,change:1.85},{ticker:"JNJ",open:156.4,high:158.2,low:155.85,close:157.9,volume:7123800,change:1.5},{ticker:"WMT",open:165.3,high:167.45,low:164.8,close:166.72,volume:9234500,change:1.42},{ticker:"PG",open:162.8,high:164.55,low:161.9,close:163.95,volume:5678900,change:1.15}],pO=()=>{let e=(0,c.useMemo)(()=>pG,[]),t=(0,c.useMemo)(()=>[{field:"ticker",headerName:"Ticker",width:100,pinned:"left"},{field:"open",headerName:"Open",width:110,valueFormatter:e=>e.value?.toFixed(2)},{field:"high",headerName:"High",width:110,valueFormatter:e=>e.value?.toFixed(2)},{field:"low",headerName:"Low",width:110,valueFormatter:e=>e.value?.toFixed(2)},{field:"close",headerName:"Close",width:110,valueFormatter:e=>e.value?.toFixed(2)},{field:"volume",headerName:"Volume",width:140,valueFormatter:e=>e.value?.toLocaleString()},{field:"change",headerName:"Change",width:110,valueFormatter:e=>e.value>=0?`+${e.value.toFixed(2)}`:e.value?.toFixed(2),cellStyle:e=>({color:e.value>=0?"#16a34a":"#dc2626",fontWeight:"600"})}],[]);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:"mb-2 text-sm text-zinc-600 dark:text-zinc-400",children:"Click and drag across cells to create a selection range. Hold Ctrl to create multiple ranges."}),(0,u.jsx)("div",{className:"ag-theme-quartz",style:{height:350},children:(0,u.jsx)(p.AgGridReact,{theme:g.themeQuartz,rowData:e,columnDefs:t,cellSelection:!0,defaultColDef:{sortable:!0,resizable:!0}})})]})};function pB(){return(0,u.jsx)("div",{className:"min-h-screen bg-zinc-50 p-8 dark:bg-zinc-900",children:(0,u.jsxs)("div",{className:"mx-auto max-w-7xl",children:[(0,u.jsx)("h1",{className:"mb-2 text-3xl font-bold text-zinc-900 dark:text-zinc-100",children:"Advanced Grid Features"}),(0,u.jsx)("p",{className:"mb-8 text-zinc-600 dark:text-zinc-400",children:"Enterprise features: Master/Detail, Tree Data, Row Dragging, Export, and more"}),(0,u.jsxs)("div",{className:"grid gap-6",children:[(0,u.jsx)(pw,{title:"1. Master/Detail Grid",description:"Expandable rows with nested detail grids showing call records. Click the arrow on the first row to expand.",children:(0,u.jsx)(px,{})}),(0,u.jsx)(pw,{title:"2. Tree Data Grid",description:"Hierarchical file explorer with nested folder/file structure. Expand folders to browse the tree.",children:(0,u.jsx)(pA,{})}),(0,u.jsx)(pw,{title:"3. Row Dragging",description:"Drag the grip handle on any row to reorder tasks. Managed row dragging handles the repositioning.",children:(0,u.jsx)(pR,{})}),(0,u.jsx)(pw,{title:"4. Column Spanning",description:"Report-style layout where header rows span all 6 columns and quarter labels span 3 columns each.",children:(0,u.jsx)(pP,{})}),(0,u.jsx)(pw,{title:"5. CSV & Excel Export",description:"Click the buttons to export grid data. CSV export uses community features; Excel export uses enterprise.",children:(0,u.jsx)(pE,{})}),(0,u.jsx)(pw,{title:"6. Context Menu",description:"Right-click any row to see custom menu items: Send Email, View Profile, Call Employee, plus defaults.",children:(0,u.jsx)(pk,{})}),(0,u.jsx)(pw,{title:"7. Status Bar",description:"Footer status bar showing total rows, filtered rows, selected rows, and aggregation of selected numeric cells.",children:(0,u.jsx)(pN,{})}),(0,u.jsx)(pw,{title:"8. Range Selection",description:"Click and drag to select a range of cells. Financial data with color-coded change column.",children:(0,u.jsx)(pO,{})})]})]})})}e.s(["default",()=>pB],57745)}]);